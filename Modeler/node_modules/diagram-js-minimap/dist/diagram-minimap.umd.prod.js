!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DiagramJSMinimap=e()}(this,(function(){"use strict";function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}function e(t,e,n){return 2==arguments.length?t.getAttribute(e):null===n?t.removeAttribute(e):(t.setAttribute(e,n),t)}const n=Object.prototype.toString;function i(t){return new r(t)}function r(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}r.prototype.add=function(t){return this.list.add(t),this},r.prototype.remove=function(t){return"[object RegExp]"==n.call(t)?this.removeMatching(t):(this.list.remove(t),this)},r.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},r.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},r.prototype.array=function(){return Array.from(this.list)},r.prototype.has=r.prototype.contains=function(t){return this.list.contains(t)};var o,s={},a=window.addEventListener?"addEventListener":"attachEvent",h=window.removeEventListener?"removeEventListener":"detachEvent",c="addEventListener"!==a?"on":"",u=t({__proto__:null,bind:s.bind=function(t,e,n,i){return t[a](c+e,n,i||!1),n},unbind:s.unbind=function(t,e,n,i){return t[h](c+e,n,i||!1),n},default:s},[s]);function l(t,e){return(e=e||document).querySelector(t)}function p(t,e){return function(t,e){e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}(e,t),t}"undefined"!=typeof document&&((o=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',o.getElementsByTagName("link").length,o=void 0);var f={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function d(t,e,n){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=f[i];r?(2===r&&"number"==typeof n&&(n=String(n)+"px"),t.style[i]=n):t.setAttributeNS(null,e,n)}function v(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return f[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);d(t,e,n)}else!function(t,e){var n,i,r=Object.keys(e);for(n=0;i=r[n];n++)d(t,i,e[i])}(t,e);return t}const g=Object.prototype.toString;function m(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function y(t){var e=t.parentNode;return e&&e.removeChild(t),t}m.prototype.add=function(t){return this.list.add(t),this},m.prototype.remove=function(t){return"[object RegExp]"==g.call(t)?this.removeMatching(t):(this.list.remove(t),this)},m.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},m.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},m.prototype.array=function(){return Array.from(this.list)},m.prototype.has=m.prototype.contains=function(t){return this.list.contains(t)};var _="http://www.w3.org/2000/svg",w='<svg xmlns="'+_+'"';function T(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(_)&&(t=w+t.substring(4)):(t=w+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var i=document.createDocumentFragment(),r=n.firstChild;r.firstChild;)i.appendChild(r.firstChild);return i}function x(t,e){var n;return"<"===t.charAt(0)?(n=T(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(_,t),e&&v(n,e),n}const E=Object.prototype.toString,b=Object.prototype.hasOwnProperty;function C(t,e){return b.call(t,e)}function R(t,e){let n,i;if(void 0===t)return;const r=function(t){return"[object Array]"===E.call(t)}(t)?A:S;for(let o in t)if(C(t,o)&&(n=t[o],i=e(n,r(o)),!1===i))return n}function D(t,e){return!!function(t,e,n){return R(t,(function(t,i){n=e(n,t,i)})),n}(t,(function(t,n,i){return t&&e(n,i)}),!0)}function S(t){return t}function A(t){return Number(t)}function M(t,...e){return Object.assign(t,...e)}var P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */
!function(t){!function(e,n,i,r){var o,s=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),h=Math.round,c=Math.abs,u=Date.now;function l(t,e,n){return setTimeout(y(t,n),e)}function p(t,e,n){return!!Array.isArray(t)&&(f(t,n[e],n),!0)}function f(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==r)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function d(t,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,r,i),t.apply(this,arguments)}}o="function"!=typeof Object.assign?function(t){if(t===r||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==r&&null!==i)for(var o in i)i.hasOwnProperty(o)&&(e[o]=i[o])}return e}:Object.assign;var v=d((function(t,e,n){for(var i=Object.keys(e),o=0;o<i.length;)(!n||n&&t[i[o]]===r)&&(t[i[o]]=e[i[o]]),o++;return t}),"extend","Use `assign`."),g=d((function(t,e){return v(t,e,!0)}),"merge","Use `assign`.");function m(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&o(i,n)}function y(t,e){return function(){return t.apply(e,arguments)}}function _(t,e){return"function"==typeof t?t.apply(e&&e[0]||r,e):t}function w(t,e){return t===r?e:t}function T(t,e,n){f(C(e),(function(e){t.addEventListener(e,n,!1)}))}function x(t,e,n){f(C(e),(function(e){t.removeEventListener(e,n,!1)}))}function E(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function b(t,e){return t.indexOf(e)>-1}function C(t){return t.trim().split(/\s+/g)}function R(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function D(t){return Array.prototype.slice.call(t,0)}function S(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];R(r,s)<0&&i.push(t[o]),r[o]=s,o++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function A(t,e){for(var n,i,o=e[0].toUpperCase()+e.slice(1),a=0;a<s.length;){if((i=(n=s[a])?n+o:e)in t)return i;a++}return r}var M=1;function P(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var O="ontouchstart"in e,I=A(e,"PointerEvent")!==r,N=O&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z="touch",j="mouse",k=24,Y=["x","y"],X=["clientX","clientY"];function V(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){_(t.options.enable,[t])&&n.handler(e)},this.init()}function F(t,e,n){var i=n.pointers.length,o=n.changedPointers.length,s=1&e&&i-o==0,a=12&e&&i-o==0;n.isFirst=!!s,n.isFinal=!!a,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,o=i.length;n.firstInput||(n.firstInput=L(e));o>1&&!n.firstMultiple?n.firstMultiple=L(e):1===o&&(n.firstMultiple=!1);var s=n.firstInput,a=n.firstMultiple,h=a?a.center:s.center,l=e.center=q(i);e.timeStamp=u(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=G(h,l),e.distance=H(h,l),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y});e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=W(e.deltaX,e.deltaY);var p=B(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=p.x,e.overallVelocityY=p.y,e.overallVelocity=c(p.x)>c(p.y)?p.x:p.y,e.scale=a?(f=a.pointers,d=i,H(d[0],d[1],X)/H(f[0],f[1],X)):1,e.rotation=a?function(t,e){return G(e[1],e[0],X)+G(t[1],t[0],X)}(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,o,s,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(h>25||a.velocity===r)){var u=e.deltaX-a.deltaX,l=e.deltaY-a.deltaY,p=B(h,u,l);i=p.x,o=p.y,n=c(p.x)>c(p.y)?p.x:p.y,s=W(u,l),t.lastInterval=e}else n=a.velocity,i=a.velocityX,o=a.velocityY,s=a.direction;e.velocity=n,e.velocityX=i,e.velocityY=o,e.direction=s}(n,e);var f,d;var v=t.element;E(e.srcEvent.target,v)&&(v=e.srcEvent.target);e.target=v}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function L(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:h(t.pointers[n].clientX),clientY:h(t.pointers[n].clientY)},n++;return{timeStamp:u(),pointers:e,center:q(e),deltaX:t.deltaX,deltaY:t.deltaY}}function q(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:h(n/e),y:h(i/e)}}function B(t,e,n){return{x:e/t||0,y:n/t||0}}function W(t,e){return t===e?1:c(t)>=c(e)?t<0?2:4:e<0?8:16}function H(t,e,n){n||(n=Y);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function G(t,e,n){n||(n=Y);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}V.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(P(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(P(this.element),this.evWin,this.domHandler)}};var U={mousedown:1,mousemove:2,mouseup:4},Z="mousedown",$="mousemove mouseup";function J(){this.evEl=Z,this.evWin=$,this.pressed=!1,V.apply(this,arguments)}m(J,V,{handler:function(t){var e=U[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:j,srcEvent:t}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:z,3:"pen",4:j,5:"kinect"},tt="pointerdown",et="pointermove pointerup pointercancel";function nt(){this.evEl=tt,this.evWin=et,V.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(tt="MSPointerDown",et="MSPointerMove MSPointerUp MSPointerCancel"),m(nt,V,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=K[i],o=Q[t.pointerType]||t.pointerType,s=o==z,a=R(e,t.pointerId,"pointerId");1&r&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):12&r&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))}});var it={touchstart:1,touchmove:2,touchend:4,touchcancel:8},rt="touchstart",ot="touchstart touchmove touchend touchcancel";function st(){this.evTarget=rt,this.evWin=ot,this.started=!1,V.apply(this,arguments)}function at(t,e){var n=D(t.touches),i=D(t.changedTouches);return 12&e&&(n=S(n.concat(i),"identifier",!0)),[n,i]}m(st,V,{handler:function(t){var e=it[t.type];if(1===e&&(this.started=!0),this.started){var n=at.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:t})}}});var ht={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ct="touchstart touchmove touchend touchcancel";function ut(){this.evTarget=ct,this.targetIds={},V.apply(this,arguments)}function lt(t,e){var n=D(t.touches),i=this.targetIds;if(3&e&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=D(t.changedTouches),a=[],h=this.target;if(o=n.filter((function(t){return E(t.target,h)})),1===e)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),12&e&&delete i[s[r].identifier],r++;return a.length?[S(o.concat(a),"identifier",!0),a]:void 0}m(ut,V,{handler:function(t){var e=ht[t.type],n=lt.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:t})}});function pt(){V.apply(this,arguments);var t=y(this.handler,this);this.touch=new ut(this.manager,t),this.mouse=new J(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function ft(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,dt.call(this,e)):12&t&&dt.call(this,e)}function dt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),2500)}}function vt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),s=Math.abs(n-r.y);if(o<=25&&s<=25)return!0}return!1}m(pt,V,{handler:function(t,e,n){var i=n.pointerType==z,r=n.pointerType==j;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)ft.call(this,e,n);else if(r&&vt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var gt=A(a.style,"touchAction"),mt=gt!==r,yt="compute",_t="auto",wt="manipulation",Tt="none",xt="pan-x",Et="pan-y",bt=function(){if(!mt)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){t[i]=!n||e.CSS.supports("touch-action",i)})),t}();function Ct(t,e){this.manager=t,this.set(e)}Ct.prototype={set:function(t){t==yt&&(t=this.compute()),mt&&this.manager.element.style&&bt[t]&&(this.manager.element.style[gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return f(this.manager.recognizers,(function(e){_(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(b(t,Tt))return Tt;var e=b(t,xt),n=b(t,Et);if(e&&n)return Tt;if(e||n)return e?xt:Et;if(b(t,wt))return wt;return _t}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=b(i,Tt)&&!bt.none,o=b(i,Et)&&!bt["pan-y"],s=b(i,xt)&&!bt["pan-x"];if(r){var a=1===t.pointers.length,h=t.distance<2,c=t.deltaTime<250;if(a&&h&&c)return}if(!s||!o)return r||o&&6&n||s&&n&k?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Rt=32;function Dt(t){this.options=o({},this.defaults,t||{}),this.id=M++,this.manager=null,this.options.enable=w(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function St(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function At(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Mt(t,e){var n=e.manager;return n?n.get(t):t}function Pt(){Dt.apply(this,arguments)}function Ot(){Pt.apply(this,arguments),this.pX=null,this.pY=null}function It(){Pt.apply(this,arguments)}function Nt(){Dt.apply(this,arguments),this._timer=null,this._input=null}function zt(){Pt.apply(this,arguments)}function jt(){Pt.apply(this,arguments)}function kt(){Dt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Yt(t,e){return(e=e||{}).recognizers=w(e.recognizers,Yt.defaults.preset),new Xt(t,e)}Dt.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(p(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Mt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return p(t,"dropRecognizeWith",this)||(t=Mt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(p(t,"requireFailure",this))return this;var e=this.requireFail;return-1===R(e,t=Mt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(p(t,"dropRequireFailure",this))return this;t=Mt(t,this);var e=R(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<8&&i(e.options.event+St(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+St(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Rt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=o({},t);if(!_(this.options.enable,[this,e]))return this.reset(),void(this.state=Rt);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},m(Pt,Dt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,r=this.attrTest(t);return i&&(8&n||!r)?16|e:i||r?4&n?8|e:2&e?4|e:2:Rt}}),m(Ot,Pt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(Et),t&k&&e.push(xt),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(6&e.direction?(r=0===o?1:o<0?2:4,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===s?1:s<0?8:16,n=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return Pt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=At(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),m(It,Pt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),m(Nt,Dt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[_t]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||12&t.eventType&&!r)this.reset();else if(1&t.eventType)this.reset(),this._timer=l((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return Rt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}}),m(zt,Pt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),m(jt,Pt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ot.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:n&k&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=At(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),m(kt,Dt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[wt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||H(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Rt},failTimeout:function(){return this._timer=l((function(){this.state=Rt}),this.options.interval,this),Rt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Yt.VERSION="2.0.7",Yt.defaults={domEvents:!1,touchAction:yt,enable:!0,inputTarget:null,inputClass:null,preset:[[zt,{enable:!1}],[It,{enable:!1},["rotate"]],[jt,{direction:6}],[Ot,{direction:6},["swipe"]],[kt],[kt,{event:"doubletap",taps:2},["tap"]],[Nt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Xt(t,e){var n;this.options=o({},Yt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(I?nt:N?ut:O?pt:J))(n,F),this.touchAction=new Ct(this,this.options.touchAction),Vt(this,!0),f(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Vt(t,e){var n,i=t.element;i.style&&(f(t.options.cssProps,(function(r,o){n=A(i.style,o),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}Xt.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&8&r.state)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&14&n.state&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof Dt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(p(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(p(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=R(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==r&&e!==r){var n=this.handlers;return f(C(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==r){var n=this.handlers;return f(C(t),(function(t){e?n[t]&&n[t].splice(R(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var i=n.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](e),r++}},destroy:function(){this.element&&Vt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(Yt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Rt,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:k,DIRECTION_ALL:30,Manager:Xt,Input:V,TouchAction:Ct,TouchInput:ut,MouseInput:J,PointerEventInput:nt,TouchMouseInput:pt,SingleTouchInput:st,Recognizer:Dt,AttrRecognizer:Pt,Tap:kt,Pan:Ot,Swipe:jt,Pinch:It,Rotate:zt,Press:Nt,on:T,off:x,each:f,merge:g,extend:v,assign:o,inherit:m,bindFn:y,prefixed:A}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Yt,t.exports?t.exports=Yt:e.Hammer=Yt}(window,document)}(O);var I=O.exports,N={exports:{}};
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
!function(t,e){var n;n=P,t.exports=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,n=String(t),i=n.length,r=-1,o="",s=n.charCodeAt(0);++r<i;)0!=(e=n.charCodeAt(r))?o+=e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==s?"\\"+e.toString(16)+" ":0==r&&1==i&&45==e||!(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?"\\"+n.charAt(r):n.charAt(r):o+="�";return o};return t.CSS||(t.CSS={}),t.CSS.escape=e,e}(n)}(N);var z=N.exports;var j={min:.2,max:4};function k(t,e,n,i,r){var o=this;this._canvas=i,this._elementRegistry=r,this._eventBus=n,this._injector=e,this._state={isOpen:void 0,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0},this._init();var s=new I.Manager(document);s.add(new I.Pan),s.on("panmove",p),s.on("panend",f);var a=new I.Manager(this._svg);a.add(new I.Pan),a.on("panstart",l(!0)),a.add(new I.Tap),a.on("tap",(function(t){c(G(t))}));var h=new I.Manager(this._viewportDom);function c(t){o._state._svgClientRect&&!L(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect()),X(Y({x:t.x-o._state._svgClientRect.left,y:t.y-o._state._svgClientRect.top},o._svg,o._lastViewbox),o._canvas),o._update()}function l(t){return function(e){var n=G(e);o._state._svgClientRect&&!L(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect()),t&&c(n);var r=Y({x:n.x-o._state._svgClientRect.left,y:n.y-o._state._svgClientRect.top},o._svg,o._lastViewbox),s=i.viewbox(),a=function(t,e){var n={x:e.x+e.width/2,y:e.y+e.height/2};return{x:t.x-n.x,y:t.y-n.y}}(r,s),h=o._viewportDom.getBoundingClientRect(),l={x:n.x-h.left+1,y:n.y-h.top+1};M(o._state,{cachedViewbox:s,initialDragPosition:{x:n.x,y:n.y},isDragging:!0,offsetViewport:a,offsetViewportDom:l,viewportClientRect:o._viewport.getBoundingClientRect(),parentClientRect:o._parent.getBoundingClientRect()}),u.bind(document,"mousemove",p),u.bind(document,"mouseup",f)}}function p(t){var e=G(t);if(o._state.isDragging){o._state._svgClientRect&&!L(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect());var n=o._state.offsetViewportDom,i=o._state.viewportClientRect,r=o._state.parentClientRect;M(o._viewportDom.style,{top:e.y-n.y-r.top+"px",left:e.x-n.x-r.left+"px"});var s=B(r,{top:e.y-n.y-r.top,left:e.x-n.x-r.left,width:i.width,height:i.height});M(o._overlay.style,{clipPath:s});var a=Y({x:e.x-o._state._svgClientRect.left,y:e.y-o._state._svgClientRect.top},o._svg,o._lastViewbox);X({x:a.x-o._state.offsetViewport.x,y:a.y-o._state.offsetViewport.y},o._canvas)}}function f(t){var e=G(t);o._state.isDragging&&(o._state.initialDragPosition.x===e.x&&o._state.initialDragPosition.y===e.y&&c(t),o._update(),M(o._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),u.unbind(document,"mousemove",p),u.unbind(document,"mouseup",f))}h.add(new I.Pan),h.on("panstart",l(!1)),this.toggle(t&&t.open||!1),u.bind(this._viewportDom,"mousedown",l(!1)),u.bind(this._svg,"mousedown",l(!0)),u.bind(this._parent,"wheel",(function(t){if(t.preventDefault(),t.stopPropagation(),t.ctrlKey&&(o._state._svgClientRect&&!L(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect()),e=t,n=o._state._svgClientRect,e.x>n.left&&e.x<n.left+n.width&&e.y>n.top&&e.y<n.top+n.height)){var e,n,r,s,a,h,c=0===t.deltaMode?.02:.32,u=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*q(t.deltaY)*-c;if(o._state.zoomDelta+=u,Math.abs(o._state.zoomDelta)>.1){var l=u>0?1:-1,p=Math.log(i.zoom())/Math.log(10),f=(r=j,s=20,a=Math.log(r.min)/Math.log(10),h=Math.log(r.max)/Math.log(10),(Math.abs(a)+Math.abs(h))/s),d=Math.round(p/f)*f;d+=f*l;var v=Math.pow(10,d);i.zoom(function(t,e){return Math.max(t.min,Math.min(t.max,e))}(j,v),g),o._state.zoomDelta=0;var g=Y({x:t.clientX-o._state._svgClientRect.left,y:t.clientY-o._state._svgClientRect.top},o._svg,o._lastViewbox);X(g,o._canvas),o._update()}}})),u.bind(this._toggle,"click",(function(t){t.preventDefault(),t.stopPropagation(),o.toggle()})),n.on(["shape.added","connection.added"],(function(t){var e=t.element;o._addElement(e),o._update()})),n.on(["shape.removed","connection.removed"],(function(t){var e=t.element;o._removeElement(e),o._update()})),n.on("elements.changed",250,(function(t){t.elements.forEach((function(t){o._updateElement(t)})),o._update()})),n.on("element.updateId",(function(t){var e=t.element,n=t.newId;o._updateElementId(e,n)})),n.on("canvas.viewbox.changed",(function(){o._state.isDragging||o._update()})),n.on("canvas.resized",(function(){document.body.contains(o._parent)&&(o._state.isDragging||o._update(),o._state._svgClientRect=o._svg.getBoundingClientRect())})),n.on(["root.set","plane.set"],(function(t){o._clear(),(t.element||t.plane.rootElement).children.forEach((function(t){o._addElement(t)})),o._update()}))}function Y(t,e,n){var i=e.getBoundingClientRect(),r=function(t,e){var n=t.width/t.height,i=M({},{x:t.x,y:t.y,width:t.width,height:t.height});if(n>e){var r=i.width*(1/e);M(i,{y:i.y-(r-i.height)/2,height:r})}else if(n<e){var o=i.height*e;M(i,{x:i.x-(o-i.width)/2,width:o})}return i}(n,i.width/i.height);return{x:V(t.x,0,i.width,r.x,r.x+r.width),y:V(t.y,0,i.height,r.y,r.y+r.height)}}function X(t,e){var n=e.viewbox(),i=n.width,r=n.height;e.viewbox({x:t.x-i/2,y:t.y-r/2,width:i,height:r})}function V(t,e,n,i,r){return(t-e)*(r-i)/(n-e)+i}function F(t,e,n){var i=function(t){var e=l(".children",t);e||p(t,e=x("g",{class:"children"}));return e}(e),r=[].slice.call(i.childNodes)[n];r?e.insertBefore(t,r.nextSibling):e.appendChild(t)}function L(t){return 0===t.width&&0===t.height}k.$inject=["config.minimap","injector","eventBus","canvas","elementRegistry"],k.prototype._init=function(){var t=this._canvas.getContainer(),e=this._parent=document.createElement("div");i(e).add("djs-minimap"),t.appendChild(e);var n=this._toggle=document.createElement("div");i(n).add("toggle"),e.appendChild(n);var r=this._map=document.createElement("div");i(r).add("map"),e.appendChild(r);var o=this._svg=x("svg");v(o,{width:"100%",height:"100%"}),p(r,o),p(o,this._elementsGroup=x("g"));var s=this._viewportGroup=x("g");p(o,s);var a,h=this._viewport=x("rect");(a=h,new m(a)).add("viewport"),p(s,h),u.bind(e,"mousedown",(function(t){t.stopPropagation()}));var c=this._viewportDom=document.createElement("div");i(c).add("viewport-dom"),this._parent.appendChild(c);var l=this._overlay=document.createElement("div");i(l).add("overlay"),this._parent.appendChild(l)},k.prototype._update=function(){var t=this._canvas.viewbox(),e=t.inner,n=t.outer;if(H(t)){var i,r,o,s,a=n.width-e.width,h=n.height-e.height;e.width<n.width?(i=e.x-a/2,o=n.width,e.x+e.width<n.width&&(i=Math.min(0,e.x))):(i=e.x,o=e.width),e.height<n.height?(r=e.y-h/2,s=n.height,e.y+e.height<n.height&&(r=Math.min(0,e.y))):(r=e.y,s=e.height),i-=50,r-=50,o+=100,s+=100,this._lastViewbox={x:i,y:r,width:o,height:s},v(this._svg,{viewBox:i+", "+r+", "+o+", "+s}),v(this._viewport,{x:t.x,y:t.y,width:t.width,height:t.height});var c=this._state._parentClientRect=this._parent.getBoundingClientRect(),u=this._viewport.getBoundingClientRect(),l={top:u.top-c.top,left:u.left-c.left,width:u.width,height:u.height};M(this._viewportDom.style,{top:l.top+"px",left:l.left+"px",width:l.width+"px",height:l.height+"px"});var p=B(c,l);M(this._overlay.style,{clipPath:p})}},k.prototype.open=function(){M(this._state,{isOpen:!0}),i(this._parent).add("open");var t=this._injector.get("translate",!1)||function(t){return t};e(this._toggle,"title",t("X")),this._update(),this._eventBus.fire("minimap.toggle",{open:!0})},k.prototype.close=function(){M(this._state,{isOpen:!1}),i(this._parent).remove("open");var t=this._injector.get("translate",!1)||function(t){return t};e(this._toggle,"title",t("Open minimap")),this._eventBus.fire("minimap.toggle",{open:!1})},k.prototype.toggle=function(t){var e=this.isOpen();void 0===t&&(t=!e),t!=e&&(t?this.open():this.close())},k.prototype.isOpen=function(){return this._state.isOpen},k.prototype._updateElement=function(t){try{void 0!==t.parent&&null!==t.parent&&(this._removeElement(t),this._addElement(t))}catch(t){console.warn("Minimap#_updateElement errored",t)}},k.prototype._updateElementId=function(t,e){try{var n=l("#"+z(t.id),this._elementsGroup);n&&(n.id=e)}catch(t){console.warn("Minimap#_updateElementId errored",t)}},k.prototype.isOnActivePlane=function(t){var e=this._canvas;return e.findRoot?e.findRoot(t)===e.getRootElement():!e.findPlane||e.findPlane(t)===e.getActivePlane()},k.prototype._addElement=function(t){var e=this;if(this._removeElement(t),this.isOnActivePlane(t)){var n,i,r,o=this._createElement(t),s=l("#"+z(t.parent.id),this._elementsGroup);if(o){var a=function(t,e){var n=l(".djs-children",e.parentNode);if(!n)return;var i=[].slice.call(n.childNodes),r=-1;return i.forEach((function(e,n){l(".djs-element",e)===t&&(r=n)})),r}(this._elementRegistry.getGraphics(t),this._elementRegistry.getGraphics(t.parent));return"undefined"!==a&&s?s.childNodes.length>a?F(o,s,a):F(o,s,s.childNodes.length-1):this._elementsGroup.appendChild(o),!function(t){return t.waypoints}(t)?(i=t.x,r=t.y,s&&(i-=(n=t.parent).x,r-=n.y),v(o,{transform:"translate("+i+" "+r+")"})):(i=0,r=0,void 0!==(n=t.parent).x&&void 0!==n.y&&(i=-n.x,r=-n.y),v(o,{transform:"translate("+i+" "+r+")"})),t.children&&t.children.length&&t.children.forEach((function(t){e._addElement(t)})),o}}},k.prototype._removeElement=function(t){var e=this._svg.getElementById(t.id);e&&y(e)},k.prototype._createElement=function(t){var e,n=this._elementRegistry.getGraphics(t);if(n&&(e=function(t){return t.childNodes[0]}(n),e)){var i=function(t){return t.cloneNode(!0)}(e);return v(i,{id:t.id}),i}},k.prototype._clear=function(){!function(t){for(var e;e=t.firstChild;)y(e)}(this._elementsGroup)};var q=Math.sign||function(t){return t>=0?1:-1};function B(t,e){return"polygon("+[W(e.left,e.top),W(e.left+e.width,e.top),W(e.left+e.width,e.top+e.height),W(e.left,e.top+e.height),W(e.left,t.height),W(t.width,t.height),W(t.width,0),W(0,0),W(0,t.height),W(e.left,t.height)].join(", ")+")"}function W(t,e){return t+"px "+e+"px"}function H(t){return D(t,(function(t){return e=t,"[object Object]"===E.call(e)?H(t):function(t){return"[object Number]"===E.call(t)}(t)&&isFinite(t);var e}))}function G(t){return t.center?t.center:{x:t.clientX,y:t.clientY}}return{__init__:["minimap"],minimap:["type",k]}}));
