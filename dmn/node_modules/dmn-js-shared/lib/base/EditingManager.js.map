{"version":3,"file":"EditingManager.js","names":["Manager","Ids","isAny","EditingManager","_init","options","on","event","error","_collectIds","definitions","elementsById","_moddle","ids","clear","viewer","elements","viewsChanged","some","e","_updateViews","moddle","$model","id","claim","_createModdle"],"sources":["../../src/base/EditingManager.js"],"sourcesContent":["import Manager from './Manager';\n\nimport Ids from 'ids';\n\nimport { isAny } from '../util/ModelUtil';\n\n\nexport default class EditingManager extends Manager {\n\n  _init(options) {\n\n    super._init(options);\n\n    // hook ID collection into the modeler\n    this.on('import.parse.complete', (event) => {\n      if (!event.error) {\n        this._collectIds(event.definitions, event.elementsById);\n      }\n    });\n\n    this.on('destroy', () => {\n      this._moddle.ids.clear();\n    });\n\n    this.on('viewer.created', ({ viewer }) => {\n\n      viewer.on('elements.changed', ({ elements }) => {\n\n        var viewsChanged = elements.some(function(e) {\n          return isAny(e, [ 'dmn:Decision', 'dmn:Definitions' ]);\n        });\n\n        if (viewsChanged) {\n          this._updateViews();\n        }\n      });\n    });\n  }\n\n  /**\n   * Collect ids processed during parsing of the\n   * definitions object.\n   *\n   * @param {ModdleElement} definitions\n   * @param {Array<ModdleElement>} elementsById\n   */\n  _collectIds(definitions, elementsById) {\n\n    var moddle = definitions.$model,\n        ids = moddle.ids,\n        id;\n\n    // remove references from previous import\n    ids.clear();\n\n    for (id in elementsById) {\n      ids.claim(id, elementsById[id]);\n    }\n  }\n\n  _createModdle(options) {\n    var moddle = super._createModdle(options);\n\n    // attach ids to moddle to be able to track\n    // and validated ids in the DMN XML document\n    // tree\n    moddle.ids = new Ids([ 32, 36, 1 ]);\n\n    return moddle;\n  }\n\n}\n"],"mappings":"AAAA,OAAOA,OAAO,MAAM,WAAW;AAE/B,OAAOC,GAAG,MAAM,KAAK;AAErB,SAASC,KAAK,QAAQ,mBAAmB;AAGzC,eAAe,MAAMC,cAAc,SAASH,OAAO,CAAC;EAElDI,KAAK,CAACC,OAAO,EAAE;IAEb,KAAK,CAACD,KAAK,CAACC,OAAO,CAAC;;IAEpB;IACA,IAAI,CAACC,EAAE,CAAC,uBAAuB,EAAGC,KAAK,IAAK;MAC1C,IAAI,CAACA,KAAK,CAACC,KAAK,EAAE;QAChB,IAAI,CAACC,WAAW,CAACF,KAAK,CAACG,WAAW,EAAEH,KAAK,CAACI,YAAY,CAAC;MACzD;IACF,CAAC,CAAC;IAEF,IAAI,CAACL,EAAE,CAAC,SAAS,EAAE,MAAM;MACvB,IAAI,CAACM,OAAO,CAACC,GAAG,CAACC,KAAK,EAAE;IAC1B,CAAC,CAAC;IAEF,IAAI,CAACR,EAAE,CAAC,gBAAgB,EAAE,QAAgB;MAAA,IAAbS,MAAM,QAANA,MAAM;MAEjCA,MAAM,CAACT,EAAE,CAAC,kBAAkB,EAAE,SAAkB;QAAA,IAAfU,QAAQ,SAARA,QAAQ;QAEvC,IAAIC,YAAY,GAAGD,QAAQ,CAACE,IAAI,CAAC,UAASC,CAAC,EAAE;UAC3C,OAAOjB,KAAK,CAACiB,CAAC,EAAE,CAAE,cAAc,EAAE,iBAAiB,CAAE,CAAC;QACxD,CAAC,CAAC;QAEF,IAAIF,YAAY,EAAE;UAChB,IAAI,CAACG,YAAY,EAAE;QACrB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACEX,WAAW,CAACC,WAAW,EAAEC,YAAY,EAAE;IAErC,IAAIU,MAAM,GAAGX,WAAW,CAACY,MAAM;MAC3BT,GAAG,GAAGQ,MAAM,CAACR,GAAG;MAChBU,EAAE;;IAEN;IACAV,GAAG,CAACC,KAAK,EAAE;IAEX,KAAKS,EAAE,IAAIZ,YAAY,EAAE;MACvBE,GAAG,CAACW,KAAK,CAACD,EAAE,EAAEZ,YAAY,CAACY,EAAE,CAAC,CAAC;IACjC;EACF;EAEAE,aAAa,CAACpB,OAAO,EAAE;IACrB,IAAIgB,MAAM,GAAG,KAAK,CAACI,aAAa,CAACpB,OAAO,CAAC;;IAEzC;IACA;IACA;IACAgB,MAAM,CAACR,GAAG,GAAG,IAAIZ,GAAG,CAAC,CAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAE,CAAC;IAEnC,OAAOoB,MAAM;EACf;AAEF"}