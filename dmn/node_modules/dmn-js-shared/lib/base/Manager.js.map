{"version":3,"file":"Manager.js","names":["EventBus","DmnModdle","domify","query","domQuery","remove","domRemove","assign","debounce","every","find","isDefined","isFunction","isNumber","wrapForCompatibility","DEFAULT_CONTAINER_OPTIONS","width","height","position","Manager","constructor","options","_emit","views","_views","activeView","_activeView","_eventBus","_viewsChanged","_viewers","open","bind","importXML","saveXML","_init","xml","self","Promise","resolve","reject","previousActiveView","_clear","then","parseWarnings","_moddle","fromXML","parseResult","definitions","rootElement","references","elementsById","warnings","ParseCompleteEvent","error","_setDefinitions","view","_getInitialView","noDisplayableContentsErr","Error","result","catch","allWarnings","concat","parseError","checkDMNCompatibilityError","checkValidationError","clearError","data","event","createEvent","Object","defineProperty","enumerable","get","console","warn","getDefinitions","_definitions","getActiveView","getActiveViewer","_getViewer","getView","element","filter","v","getViews","toXML","on","off","once","attachTo","parentNode","prototype","jquery","appendChild","_container","detach","destroy","keys","forEach","viewerId","viewer","safeExecute","_options","_createModdle","container","containerOptions","style","ensureUnit","_switchView","_updateViews","viewProviders","_getViewProviders","displayableElements","drgElement","newViews","provider","opens","$type","id","name","type","push","newActiveView","viewsEqual","activeViewChanged","viewNameChanged","viewsChanged","length","newView","preferredView","initialView","complete","openError","openResult","activeViewer","newViewer","_createViewer","Viewer","providerOptions","commonOptions","common","additionalModules","_parent","moddle","fire","moddleExtensions","val","err","message","olderDMNVersion","indexOf","pattern","match","exec","a","b","method"],"sources":["../../src/base/Manager.js"],"sourcesContent":["import EventBus from 'diagram-js/lib/core/EventBus';\n\nimport DmnModdle from 'dmn-moddle';\n\nimport {\n  domify,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport {\n  assign,\n  debounce,\n  every,\n  find,\n  isDefined,\n  isFunction,\n  isNumber\n} from 'min-dash';\n\nimport {\n  wrapForCompatibility\n} from '../util/CompatibilityUtils';\n\n\n/**\n * @typedef {import('./View').OpenResult} OpenResult\n */\n\n/**\n * @typedef {import('./View').OpenError} OpenError\n */\n\n\nconst DEFAULT_CONTAINER_OPTIONS = {\n  width: '100%',\n  height: '100%',\n  position: 'relative'\n};\n\n/**\n * The base class for DMN viewers and editors.\n *\n * @abstract\n */\nexport default class Manager {\n\n  /**\n   * Create a new instance with the given options.\n   *\n   * @param  {Object} options\n   *\n   * @return {Manager}\n   */\n  constructor(options = {}) {\n    this._eventBus = new EventBus();\n\n    this._viewsChanged = debounce(this._viewsChanged, 0);\n\n    this._views = [];\n    this._viewers = {};\n\n    // keep support for callbacks\n    this.open = wrapForCompatibility(this.open.bind(this));\n    this.importXML = wrapForCompatibility(this.importXML.bind(this));\n    this.saveXML = wrapForCompatibility(this.saveXML.bind(this));\n\n    this._init(options);\n  }\n\n  /**\n  * The importXML result.\n  *\n  * @typedef {Object} ImportXMLResult\n  *\n  * @property {Array<string>} warnings\n  */\n\n  /**\n  * The importXML error.\n  *\n  * @typedef {Error} ImportXMLError\n  *\n  * @property {Array<string>} warnings\n  */\n\n  /**\n   * Parse and render a DMN diagram.\n   *\n   * Once finished the viewer reports back the result to the\n   * provided callback function with (err, warnings).\n   *\n   * ## Life-Cycle Events\n   *\n   * During import the viewer will fire life-cycle events:\n   *\n   *   * import.parse.start (about to read model from xml)\n   *   * import.parse.complete (model read; may have worked or not)\n   *   * import.render.start (graphical import start)\n   *   * import.render.complete (graphical import finished)\n   *   * import.done (everything done)\n   *\n   * You can use these events to hook into the life-cycle.\n   *\n   * @param {string} xml the DMN xml\n   * @param {Object} [options]\n   * @param {boolean} [options.open=true]\n   *\n   * @return {Promise<ImportXMLResult, ImportXMLError>}\n   */\n  importXML(xml, options) {\n    var self = this;\n\n    options = options || { open: true };\n\n    return new Promise(function(resolve, reject) {\n      var previousActiveView = self._activeView;\n\n      // clean up previously rendered diagram before new import\n      self._clear().then(() => {\n\n        // hook in pre-parse listeners +\n        // allow xml manipulation\n        xml = self._emit('import.parse.start', { xml: xml }) || xml;\n\n        var parseWarnings;\n\n        self._moddle.fromXML(xml, 'dmn:Definitions').then((parseResult) => {\n\n          var definitions = parseResult.rootElement;\n          var references = parseResult.references;\n          var elementsById = parseResult.elementsById;\n          parseWarnings = parseResult.warnings;\n\n          // hook in post parse listeners +\n          // allow definitions manipulation\n          definitions = self._emit('import.parse.complete', ParseCompleteEvent({\n            error: null,\n            definitions: definitions,\n            elementsById: elementsById,\n            references: references,\n            warnings: parseWarnings\n          })) || definitions;\n          self._setDefinitions(definitions);\n\n          if (!options.open) {\n            self._emit('import.done', { error: null, warnings: parseWarnings });\n\n            resolve({ warnings: parseWarnings });\n            return;\n          }\n\n          // open either previously active view or view of the same type if available\n          var view = self._getInitialView(self._views, previousActiveView);\n\n          if (!view) {\n            var noDisplayableContentsErr = new Error('no displayable contents');\n\n            self._emit('import.done',\n              { error: noDisplayableContentsErr, warnings: parseWarnings });\n\n            noDisplayableContentsErr.warnings = parseWarnings;\n\n            return reject(noDisplayableContentsErr);\n          }\n\n          self.open(view)\n            .then(result => ({ warnings: result.warnings }))\n            .catch(error => ({ error: error, warnings: error.warnings }))\n            .then(result => {\n              var allWarnings = [].concat(parseWarnings, result.warnings);\n\n              self._emit('import.done', { error: result.error, warnings: allWarnings });\n\n              if (result.error) {\n                result.error.warnings = allWarnings;\n                reject(result.error);\n              } else {\n                resolve({ warnings: allWarnings });\n              }\n\n            });\n        }).catch((parseError) => {\n\n          parseWarnings = parseError.warnings;\n\n          parseError = checkDMNCompatibilityError(parseError, xml) ||\n            checkValidationError(parseError) ||\n            parseError;\n\n          self._emit('import.parse.complete', ParseCompleteEvent({\n            error: parseError,\n            warnings: parseWarnings\n          }));\n\n          self._emit('import.done', { error: parseError, warnings: parseWarnings });\n\n          parseError.warnings = parseWarnings;\n\n          return reject(parseError);\n        });\n      }).catch(clearError => {\n        self._emit('import.done', { error: clearError, warnings: [] });\n        clearError.warnings = [];\n\n        return reject(clearError);\n      });\n    });\n\n    // TODO: remove with future dmn-js version\n    function ParseCompleteEvent(data) {\n\n      var event = self._eventBus.createEvent(data);\n\n      Object.defineProperty(event, 'context', {\n        enumerable: true,\n        get: function() {\n\n          console.warn(new Error(\n            'import.parse.complete <context> is deprecated ' +\n            'and will be removed in future library versions'\n          ));\n\n          return {\n            warnings: data.warnings,\n            references: data.references,\n            elementsById: data.elementsById\n          };\n        }\n      });\n\n      return event;\n    }\n  }\n\n  getDefinitions() {\n    return this._definitions;\n  }\n\n  /**\n   * Return active view.\n   *\n   * @return {View}\n   */\n  getActiveView() {\n    return this._activeView;\n  }\n\n  /**\n   * Get the currently active viewer instance.\n   *\n   * @return {View}\n   */\n  getActiveViewer() {\n    var activeView = this.getActiveView();\n\n    return activeView && this._getViewer(activeView);\n  }\n\n  getView(element) {\n    return this._views.filter(function(v) {\n      return v.element === element;\n    })[0];\n  }\n\n  getViews() {\n    return this._views;\n  }\n\n  /**\n   * The saveXML result.\n   *\n   * @typedef {Object} SaveXMLResult\n   *\n   * @property {string} xml\n   */\n\n  /**\n   * Export the currently displayed DMN diagram as\n   * a DMN XML document.\n   *\n   * ## Life-Cycle Events\n   *\n   * During XML saving the viewer will fire life-cycle events:\n   *\n   *   * saveXML.start (before serialization)\n   *   * saveXML.serialized (after xml generation)\n   *   * saveXML.done (everything done)\n   *\n   * You can use these events to hook into the life-cycle.\n   *\n   * @param {Object} [options] export options\n   * @param {boolean} [options.format=false] output formated XML\n   * @param {boolean} [options.preamble=true] output preamble\n   *\n   * @return {Promise<SaveXMLResult, Error>}\n   */\n  saveXML(options) {\n    var self = this;\n\n    options = options || {};\n\n    var definitions = this._definitions;\n\n    return new Promise(function(resolve, reject) {\n\n      if (!definitions) {\n        reject(new Error('no definitions loaded'));\n        return;\n      }\n\n      // allow to fiddle around with definitions\n      definitions = self._emit('saveXML.start', {\n        definitions: definitions\n      }) || definitions;\n\n      self._moddle.toXML(definitions, options)\n        .then(function(result) {\n\n          var xml = result.xml;\n\n          xml = self._emit('saveXML.serialized', {\n            xml: xml\n          }) || xml;\n\n          return { xml };\n        }).catch((error) => ({ error }))\n        .then((result) => {\n\n          self._emit('saveXML.done', result);\n\n          if (result.error) {\n            reject(result.error);\n          } else {\n            resolve({ xml: result.xml });\n          }\n        });\n\n    });\n\n  }\n\n  /**\n   * Register an event listener\n   *\n   * Remove a previously added listener via {@link #off(event, callback)}.\n   *\n   * @param {string} event\n   * @param {number} [priority]\n   * @param {Function} callback\n   * @param {Object} [that]\n   */\n  on(...args) {\n    this._eventBus.on(...args);\n  }\n\n  /**\n   * De-register an event listener\n   *\n   * @param {string} event\n   * @param {Function} callback\n   */\n  off(...args) {\n    this._eventBus.off(...args);\n  }\n\n  /**\n   * Register a listener to be invoked once only.\n   *\n   * @param {string} event\n   * @param {number} [priority]\n   * @param {Function} callback\n   * @param {Object} [that]\n   */\n  once(...args) {\n    this._eventBus.once(...args);\n  }\n\n  attachTo(parentNode) {\n\n    // unwrap jQuery if provided\n    if (parentNode.get && parentNode.constructor.prototype.jquery) {\n      parentNode = parentNode.get(0);\n    }\n\n    if (typeof parentNode === 'string') {\n      parentNode = domQuery(parentNode);\n    }\n\n    parentNode.appendChild(this._container);\n\n    this._emit('attach', {});\n  }\n\n  detach() {\n    this._emit('detach', {});\n\n    domRemove(this._container);\n  }\n\n  destroy() {\n    Object.keys(this._viewers).forEach((viewerId) => {\n      var viewer = this._viewers[viewerId];\n\n      safeExecute(viewer, 'destroy');\n    });\n\n    domRemove(this._container);\n  }\n\n  _init(options) {\n    this._options = options;\n\n    this._moddle = this._createModdle(options);\n\n    this._viewers = {};\n    this._views = [];\n\n    const container = domify('<div class=\"dmn-js-parent\"></div>');\n\n    const containerOptions = assign({}, DEFAULT_CONTAINER_OPTIONS, options);\n\n    assign(container.style, {\n      width: ensureUnit(containerOptions.width),\n      height: ensureUnit(containerOptions.height),\n      position: containerOptions.position\n    });\n\n    this._container = container;\n\n    if (options.container) {\n      this.attachTo(options.container);\n    }\n  }\n\n  _clear() {\n    return this._switchView(null);\n  }\n\n  /**\n   * Open diagram view.\n   *\n   * @param  {View} view\n   * @returns {Promise} Resolves with {OpenResult} when successful\n   * or rejects with {OpenError}\n   */\n  open(view) {\n    return this._switchView(view);\n  }\n\n  _setDefinitions(definitions) {\n    this._definitions = definitions;\n\n    this._updateViews();\n  }\n\n  _viewsChanged = () => {\n    this._emit('views.changed', {\n      views: this._views,\n      activeView: this._activeView\n    });\n  };\n\n  /**\n   * Recompute changed views after elements in\n   * the DMN diagram have changed.\n   */\n  _updateViews() {\n\n    var definitions = this._definitions;\n\n    if (!definitions) {\n      this._views = [];\n      this._switchView(null);\n\n      return;\n    }\n\n    var viewProviders = this._getViewProviders();\n\n    var displayableElements = [ definitions, ...(definitions.drgElement || []) ];\n\n    // compute list of available views\n    var views = this._views,\n        newViews = [];\n\n    for (var element of displayableElements) {\n      var provider = find(viewProviders, function(provider) {\n        if (typeof provider.opens === 'string') {\n          return provider.opens === element.$type;\n        } else {\n          return provider.opens(element);\n        }\n      });\n\n      if (!provider) {\n        continue;\n      }\n\n      var view = {\n        element,\n        id: element.id,\n        name: element.name,\n        type: provider.id\n      };\n\n      newViews.push(view);\n    }\n\n    var activeView = this._activeView,\n        newActiveView;\n\n    if (activeView) {\n\n      // check the new active view\n      newActiveView = find(newViews, function(view) {\n        return viewsEqual(activeView, view);\n      }) || this._getInitialView(newViews);\n\n      if (!newActiveView) {\n        this._switchView(null);\n        return;\n      }\n    }\n\n    // Views have changed if\n    // active view has changed OR\n    // number of views has changed OR\n    // not all views equal\n    var activeViewChanged = !viewsEqual(activeView, newActiveView)\n      || viewNameChanged(activeView, newActiveView);\n\n    var viewsChanged = views.length !== newViews.length\n        || !every(newViews, function(newView) {\n          return find(views, function(view) {\n            return viewsEqual(view, newView) && !viewNameChanged(view, newView);\n          });\n        });\n\n    this._activeView = newActiveView;\n    this._views = newViews;\n\n    if (activeViewChanged || viewsChanged) {\n      this._viewsChanged();\n    }\n  }\n\n  _getInitialView(views, preferredView) {\n    var initialView;\n\n    if (preferredView) {\n      initialView = find(views, function(view) {\n        return viewsEqual(view, preferredView);\n      }) || find(views, function(view) {\n        return view.type === preferredView;\n      });\n    }\n\n    return initialView || views[0];\n  }\n\n  /**\n   * Switch to another view.\n   *\n   * @param  {View} newView\n   * @returns {Promise} Resolves with {OpenResult} when successful\n   * or rejects with {OpenError}\n   */\n  _switchView(newView) {\n    var self = this;\n\n    return new Promise(function(resolve, reject) {\n      var complete = (openError, openResult) => {\n        self._viewsChanged();\n\n        if (openError) {\n          reject(openError);\n        } else {\n          resolve(openResult);\n        }\n      };\n\n      var activeView = self.getActiveView(),\n          activeViewer;\n\n      var newViewer = newView && self._getViewer(newView),\n          element = newView && newView.element;\n\n      if (activeView) {\n        activeViewer = self._getViewer(activeView);\n\n        if (activeViewer !== newViewer) {\n          safeExecute(activeViewer, 'clear');\n\n          activeViewer.detach();\n        }\n      }\n\n      self._activeView = newView;\n\n      if (newViewer) {\n\n        if (activeViewer !== newViewer) {\n          newViewer.attachTo(self._container);\n        }\n\n        self._emit('import.render.start', {\n          view: newView,\n          element: element\n        });\n\n        newViewer.open(element)\n          .then(\n            result => {\n              self._emit('import.render.complete', {\n                view: newView,\n                error: null,\n                warnings: result.warnings\n              });\n\n              complete(null, result);\n            })\n          .catch(\n            error => {\n              self._emit('import.render.complete', {\n                view: newView,\n                error: error,\n                warnings: error.warnings\n              });\n\n              complete(error, null);\n            }\n          );\n\n        return;\n      }\n\n      // no active view\n      complete();\n    });\n  }\n\n  _getViewer(view) {\n\n    var type = view.type;\n\n    var viewer = this._viewers[type];\n\n    if (!viewer) {\n      viewer = this._viewers[type] = this._createViewer(view.type);\n\n      this._emit('viewer.created', {\n        type: type,\n        viewer: viewer\n      });\n    }\n\n    return viewer;\n  }\n\n  _createViewer(id) {\n\n    var provider = find(this._getViewProviders(), function(provider) {\n      return provider.id === id;\n    });\n\n    if (!provider) {\n      throw new Error('no provider for view type <' + id + '>');\n    }\n\n    var Viewer = provider.constructor;\n\n    var providerOptions = this._options[id] || {};\n    var commonOptions = this._options.common || {};\n\n    return new Viewer({\n      ...commonOptions,\n      ...providerOptions,\n      additionalModules: [\n        ...(providerOptions.additionalModules || []), {\n          _parent: [ 'value', this ],\n          moddle: [ 'value', this._moddle ]\n        }\n      ]\n    });\n  }\n\n  /**\n   * Emit an event.\n   */\n  _emit(...args) {\n    return this._eventBus.fire(...args);\n  }\n\n  _createModdle(options) {\n    return new DmnModdle(options.moddleExtensions);\n  }\n\n  /**\n   * Return the list of available view providers.\n   *\n   * @abstract\n   *\n   * @return {Array<ViewProvider>}\n   */\n  _getViewProviders() {\n    return [];\n  }\n\n}\n\n\n// helpers //////////////////////\n\n/**\n * Ensure the passed argument is a proper unit (defaulting to px)\n */\nfunction ensureUnit(val) {\n  return val + (isNumber(val) ? 'px' : '');\n}\n\nfunction checkDMNCompatibilityError(err, xml) {\n\n  // check if we can indicate opening of old DMN 1.1 or DMN 1.2 diagrams\n\n  if (err.message !== 'failed to parse document as <dmn:Definitions>') {\n    return null;\n  }\n\n  var olderDMNVersion = (\n    (xml.indexOf('\"http://www.omg.org/spec/DMN/20151101/dmn.xsd\"') !== -1 && '1.1') ||\n    (xml.indexOf('\"http://www.omg.org/spec/DMN/20180521/MODEL/\"') !== -1 && '1.2')\n  );\n\n  if (!olderDMNVersion) {\n    return null;\n  }\n\n  err = new Error(\n    'unsupported DMN ' + olderDMNVersion + ' file detected; ' +\n    'only DMN 1.3 files can be opened'\n  );\n\n  console.error(\n    'Cannot open what looks like a DMN ' + olderDMNVersion + ' diagram. ' +\n    'Please refer to https://bpmn.io/l/dmn-compatibility.html ' +\n    'to learn how to make the toolkit compatible with older DMN files',\n    err\n  );\n\n  return err;\n}\n\nfunction checkValidationError(err) {\n\n  // check if we can help the user by indicating wrong DMN 1.3 xml\n  // (in case he or the exporting tool did not get that right)\n\n  var pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/,\n      match = pattern.exec(err.message);\n\n  if (!match) {\n    return null;\n  }\n\n  err.message =\n    'unparsable content <' + match[ 1 ] + '> detected; ' +\n    'this may indicate an invalid DMN 1.3 diagram file' + match[ 2 ];\n\n  return err;\n}\n\nfunction viewsEqual(a, b) {\n  if (!isDefined(a)) {\n    if (!isDefined(b)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  if (!isDefined(b)) {\n    return false;\n  }\n\n  // compare by element OR element ID equality\n  return a.element === b.element || a.id === b.id;\n}\n\nfunction viewNameChanged(a, b) {\n  return !a || !b || a.name !== b.name;\n}\n\nfunction safeExecute(viewer, method) {\n  if (isFunction(viewer[ method ])) {\n    viewer[ method ]();\n  }\n}\n"],"mappings":"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"}