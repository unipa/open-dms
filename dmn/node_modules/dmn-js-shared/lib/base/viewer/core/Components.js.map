{"version":3,"file":"Components.js","names":["isFunction","isNumber","DEFAULT_PRIORITY","Components","constructor","_listeners","getComponent","type","context","listeners","component","i","length","callback","getComponents","components","push","onGetComponent","priority","Error","_getListeners","existingListener","idx","newListener","splice","offGetComponent","listener","listenerCallback"],"sources":["../../../../src/base/viewer/core/Components.js"],"sourcesContent":["import {\r\n  isFunction,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nconst DEFAULT_PRIORITY = 1000;\r\n\r\n\r\nexport default class Components {\r\n\r\n  constructor() {\r\n    this._listeners = {};\r\n  }\r\n\r\n  getComponent(type, context) {\r\n    const listeners = this._listeners[type];\r\n\r\n    if (!listeners) {\r\n      return;\r\n    }\r\n\r\n    let component;\r\n\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      component = listeners[i].callback(context);\r\n\r\n      if (component) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return component;\r\n  }\r\n\r\n  getComponents(type, context) {\r\n    const listeners = this._listeners[type];\r\n\r\n    if (!listeners) {\r\n      return;\r\n    }\r\n\r\n    const components = [];\r\n\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      const component = listeners[i].callback(context);\r\n\r\n      if (component) {\r\n        components.push(component);\r\n      }\r\n    }\r\n\r\n    if (!components.length) {\r\n      return;\r\n    }\r\n\r\n    return components;\r\n  }\r\n\r\n  onGetComponent(type, priority, callback) {\r\n    if (isFunction(priority)) {\r\n      callback = priority;\r\n      priority = DEFAULT_PRIORITY;\r\n    }\r\n\r\n    if (!isNumber(priority)) {\r\n      throw new Error('priority must be a number');\r\n    }\r\n\r\n    const listeners = this._getListeners(type);\r\n\r\n    let existingListener,\r\n        idx;\r\n\r\n    const newListener = { priority, callback };\r\n\r\n    for (idx = 0; (existingListener = listeners[idx]); idx++) {\r\n      if (existingListener.priority < priority) {\r\n\r\n        // prepend newListener at before existingListener\r\n        listeners.splice(idx, 0, newListener);\r\n        return;\r\n      }\r\n    }\r\n\r\n    listeners.push(newListener);\r\n  }\r\n\r\n  offGetComponent(type, callback) {\r\n    const listeners = this._getListeners(type);\r\n\r\n    let listener,\r\n        listenerCallback,\r\n        idx;\r\n\r\n    if (callback) {\r\n\r\n      // move through listeners from back to front\r\n      // and remove matching listeners\r\n      for (idx = listeners.length - 1; (listener = listeners[idx]); idx--) {\r\n        listenerCallback = listener.callback;\r\n\r\n        if (listenerCallback === callback) {\r\n          listeners.splice(idx, 1);\r\n        }\r\n      }\r\n    } else {\r\n\n      // clear listeners\r\n      listeners.length = 0;\r\n    }\r\n  }\r\n\r\n  _getListeners(type) {\r\n    let listeners = this._listeners[type];\r\n\r\n    if (!listeners) {\r\n      this._listeners[type] = listeners = [];\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n}"],"mappings":"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"}