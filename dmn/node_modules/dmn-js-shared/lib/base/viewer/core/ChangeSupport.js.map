{"version":3,"file":"ChangeSupport.js","names":["ChangeSupport","constructor","eventBus","_listeners","on","elements","elementsChanged","element","newId","updateId","id","invoked","elementsLength","length","i","listenersLength","j","onElementsChanged","listener","offElementsChanged","idx","indexOf","splice","oldId","$inject"],"sources":["../../../../src/base/viewer/core/ChangeSupport.js"],"sourcesContent":["export default class ChangeSupport {\r\n  constructor(eventBus) {\r\n    this._listeners = {};\r\n\r\n    eventBus.on('elements.changed', ({ elements }) => {\r\n      this.elementsChanged(elements);\r\n    });\r\n\r\n    eventBus.on('element.updateId', ({ element, newId }) => {\r\n      this.updateId(element.id, newId);\r\n    });\r\n  }\r\n\r\n  elementsChanged(elements) {\r\n    const invoked = {};\r\n\r\n    const elementsLength = elements.length;\r\n\r\n    for (let i = 0; i < elementsLength; i++) {\r\n      const { id } = elements[i];\r\n\r\n      if (invoked[id]) {\r\n        return;\r\n      }\r\n\r\n      invoked[id] = true;\r\n\r\n      const listenersLength = this._listeners[id] && this._listeners[id].length;\r\n\r\n      if (listenersLength) {\r\n        for (let j = 0; j < listenersLength; j++) {\r\n\r\n          // listeners might remove themselves before they get called\r\n          this._listeners[id][j] && this._listeners[id][j]();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  onElementsChanged(id, listener) {\r\n    if (!this._listeners[id]) {\r\n      this._listeners[id] = [];\r\n    }\r\n\r\n    // avoid push for better performance\r\n    this._listeners[id][this._listeners[id].length] = listener;\r\n  }\r\n\r\n  offElementsChanged(id, listener) {\r\n    if (!this._listeners[id]) {\r\n      return;\r\n    }\r\n\r\n    if (listener) {\r\n      const idx = this._listeners[id].indexOf(listener);\r\n\r\n      if (idx !== -1) {\r\n        this._listeners[id].splice(idx, 1);\r\n      }\r\n    } else {\r\n      this._listeners[id].length = 0;\r\n    }\r\n  }\r\n\r\n  updateId(oldId, newId) {\r\n    if (this._listeners[oldId]) {\r\n\r\n      this._listeners[newId] = this._listeners[oldId];\r\n\r\n      delete this._listeners[oldId];\r\n\r\n    }\r\n  }\r\n}\r\n\r\nChangeSupport.$inject = [ 'eventBus' ];"],"mappings":"AAAA,eAAe,MAAMA,aAAa,CAAC;EACjCC,WAAW,CAACC,QAAQ,EAAE;IACpB,IAAI,CAACC,UAAU,GAAG,CAAC,CAAC;IAEpBD,QAAQ,CAACE,EAAE,CAAC,kBAAkB,EAAE,QAAkB;MAAA,IAAfC,QAAQ,QAARA,QAAQ;MACzC,IAAI,CAACC,eAAe,CAACD,QAAQ,CAAC;IAChC,CAAC,CAAC;IAEFH,QAAQ,CAACE,EAAE,CAAC,kBAAkB,EAAE,SAAwB;MAAA,IAArBG,OAAO,SAAPA,OAAO;QAAEC,KAAK,SAALA,KAAK;MAC/C,IAAI,CAACC,QAAQ,CAACF,OAAO,CAACG,EAAE,EAAEF,KAAK,CAAC;IAClC,CAAC,CAAC;EACJ;EAEAF,eAAe,CAACD,QAAQ,EAAE;IACxB,MAAMM,OAAO,GAAG,CAAC,CAAC;IAElB,MAAMC,cAAc,GAAGP,QAAQ,CAACQ,MAAM;IAEtC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,cAAc,EAAEE,CAAC,EAAE,EAAE;MACvC,MAAQJ,EAAE,GAAKL,QAAQ,CAACS,CAAC,CAAC,CAAlBJ,EAAE;MAEV,IAAIC,OAAO,CAACD,EAAE,CAAC,EAAE;QACf;MACF;MAEAC,OAAO,CAACD,EAAE,CAAC,GAAG,IAAI;MAElB,MAAMK,eAAe,GAAG,IAAI,CAACZ,UAAU,CAACO,EAAE,CAAC,IAAI,IAAI,CAACP,UAAU,CAACO,EAAE,CAAC,CAACG,MAAM;MAEzE,IAAIE,eAAe,EAAE;QACnB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,eAAe,EAAEC,CAAC,EAAE,EAAE;UAExC;UACA,IAAI,CAACb,UAAU,CAACO,EAAE,CAAC,CAACM,CAAC,CAAC,IAAI,IAAI,CAACb,UAAU,CAACO,EAAE,CAAC,CAACM,CAAC,CAAC,EAAE;QACpD;MACF;IACF;EACF;EAEAC,iBAAiB,CAACP,EAAE,EAAEQ,QAAQ,EAAE;IAC9B,IAAI,CAAC,IAAI,CAACf,UAAU,CAACO,EAAE,CAAC,EAAE;MACxB,IAAI,CAACP,UAAU,CAACO,EAAE,CAAC,GAAG,EAAE;IAC1B;;IAEA;IACA,IAAI,CAACP,UAAU,CAACO,EAAE,CAAC,CAAC,IAAI,CAACP,UAAU,CAACO,EAAE,CAAC,CAACG,MAAM,CAAC,GAAGK,QAAQ;EAC5D;EAEAC,kBAAkB,CAACT,EAAE,EAAEQ,QAAQ,EAAE;IAC/B,IAAI,CAAC,IAAI,CAACf,UAAU,CAACO,EAAE,CAAC,EAAE;MACxB;IACF;IAEA,IAAIQ,QAAQ,EAAE;MACZ,MAAME,GAAG,GAAG,IAAI,CAACjB,UAAU,CAACO,EAAE,CAAC,CAACW,OAAO,CAACH,QAAQ,CAAC;MAEjD,IAAIE,GAAG,KAAK,CAAC,CAAC,EAAE;QACd,IAAI,CAACjB,UAAU,CAACO,EAAE,CAAC,CAACY,MAAM,CAACF,GAAG,EAAE,CAAC,CAAC;MACpC;IACF,CAAC,MAAM;MACL,IAAI,CAACjB,UAAU,CAACO,EAAE,CAAC,CAACG,MAAM,GAAG,CAAC;IAChC;EACF;EAEAJ,QAAQ,CAACc,KAAK,EAAEf,KAAK,EAAE;IACrB,IAAI,IAAI,CAACL,UAAU,CAACoB,KAAK,CAAC,EAAE;MAE1B,IAAI,CAACpB,UAAU,CAACK,KAAK,CAAC,GAAG,IAAI,CAACL,UAAU,CAACoB,KAAK,CAAC;MAE/C,OAAO,IAAI,CAACpB,UAAU,CAACoB,KAAK,CAAC;IAE/B;EACF;AACF;AAEAvB,aAAa,CAACwB,OAAO,GAAG,CAAE,UAAU,CAAE"}