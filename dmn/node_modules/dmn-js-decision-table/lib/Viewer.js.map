{"version":3,"file":"Viewer.js","names":["Table","importDecision","assign","domify","remove","domRemove","TranslateModule","annotationsModule","coreModule","decisionTableHeadModule","decisionTablePropertiesModule","decisionRuleIndicesModule","decisionRulesModule","hitPolicyModule","viewDrdModule","PoweredByModule","Viewer","constructor","options","container","_createContainer","renderer","_container","open","decision","self","Promise","resolve","reject","err","_decision","clear","warnings","e","_init","modules","additionalModules","config","baseModules","getModules","extraModules","staticModules","decisionTable","allModules","on","event","priority","callback","target","get","off","_emit","type","fire","attachTo","parentNode","Error","detach","appendChild","destroy","_getModules"],"sources":["../src/Viewer.js"],"sourcesContent":["import Table from 'table-js';\n\nimport { importDecision } from './import/Importer';\n\nimport { assign } from 'min-dash';\n\nimport {\n  domify,\n  remove as domRemove\n} from 'min-dom';\n\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\n\nimport annotationsModule from './features/annotations';\nimport coreModule from './core';\nimport decisionTableHeadModule from './features/decision-table-head';\nimport decisionTablePropertiesModule from './features/decision-table-properties';\nimport decisionRuleIndicesModule from './features/decision-rule-indices';\nimport decisionRulesModule from './features/decision-rules';\nimport hitPolicyModule from './features/hit-policy';\nimport viewDrdModule from './features/view-drd';\nimport PoweredByModule from './features/powered-by';\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\n */\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\n */\n\n\nexport default class Viewer extends Table {\n\n  constructor(options = {}) {\n    const container = Viewer._createContainer();\n\n    super(assign(options, {\n      renderer: {\n        container\n      }\n    }));\n\n    this._container = container;\n  }\n\n  /**\n   * Open diagram element.\n   *\n   * @param  {ModdleElement} decision\n   * @returns {Promise} Resolves with {OpenResult} when successful\n   * or rejects with {OpenError}\n   */\n  open(decision) {\n    var self = this;\n\n    return new Promise((resolve, reject) => {\n      var err;\n\n      // use try/catch to not swallow synchronous exceptions\n      // that may be raised during model parsing\n      try {\n\n        if (self._decision) {\n\n          // clear existing rendered diagram\n          self.clear();\n        }\n\n        // update decision\n        self._decision = decision;\n\n        // perform import\n        return importDecision(self, decision, function(err, warnings) {\n          if (err) {\n            err.warnings = warnings || [];\n            reject(err);\n          } else {\n            resolve({ warnings: warnings || [] });\n          }\n        });\n      } catch (e) {\n        err = e;\n      }\n\n      // handle synchronously thrown exception\n      if (err) {\n        err.warnings = err.warnings || [];\n        reject(err);\n      } else {\n        resolve({ warnings: [] });\n      }\n    });\n  }\n\n  /**\n   * Initialize the table, returning { modules: [], config }.\n   *\n   * @param  {Object} options\n   *\n   * @return {Object} init config\n   */\n  _init(options) {\n\n    let {\n      modules,\n      additionalModules,\n      ...config\n    } = options;\n\n    let baseModules = modules || this.getModules();\n    let extraModules = additionalModules || [];\n    let staticModules = [\n      {\n        decisionTable: [ 'value', this ]\n      }\n    ];\n\n    let allModules = [\n      PoweredByModule,\n      ...baseModules,\n      ...extraModules,\n      ...staticModules\n    ];\n\n    return {\n      modules: allModules,\n      config\n    };\n  }\n\n  /**\n   * Register an event listener\n   *\n   * Remove a previously added listener via {@link #off(event, callback)}.\n   *\n   * @param {string} event\n   * @param {number} [priority]\n   * @param {Function} callback\n   * @param {Object} [that]\n   */\n  on(event, priority, callback, target) {\n    return this.get('eventBus').on(event, priority, callback, target);\n  }\n\n  /**\n   * De-register an event listener\n   *\n   * @param {string} event\n   * @param {Function} callback\n   */\n  off(event, callback) {\n    this.get('eventBus').off(event, callback);\n  }\n\n  /**\n   * Emit an event on the underlying {@link EventBus}\n   *\n   * @param  {string} type\n   * @param  {Object} event\n   *\n   * @return {Object} event processing result (if any)\n   */\n  _emit(type, event) {\n    return this.get('eventBus').fire(type, event);\n  }\n\n  /**\n   * Attach viewer to given parent node.\n   *\n   * @param  {Element} parentNode\n   */\n  attachTo(parentNode) {\n\n    if (!parentNode) {\n      throw new Error('parentNode required');\n    }\n\n    // ensure we detach from the\n    // previous, old parent\n    this.detach();\n\n    const container = this._container;\n\n    parentNode.appendChild(container);\n\n    this._emit('attach', {});\n  }\n\n  /**\n   * Detach viewer from parent node, if attached.\n   */\n  detach() {\n\n    const container = this._container,\n          parentNode = container.parentNode;\n\n    if (!parentNode) {\n      return;\n    }\n\n    this._emit('detach', {});\n\n    domRemove(container);\n  }\n\n  destroy() {\n    super.destroy();\n\n    this.detach();\n  }\n\n  getModules() {\n    return Viewer._getModules();\n  }\n\n  static _getModules() {\n    return [\n      annotationsModule,\n      coreModule,\n      TranslateModule,\n      decisionTableHeadModule,\n      decisionTablePropertiesModule,\n      decisionRuleIndicesModule,\n      decisionRulesModule,\n      hitPolicyModule,\n      viewDrdModule\n    ];\n  }\n\n  static _createContainer() {\n    return domify(\n      '<div class=\"dmn-decision-table-container\"></div>'\n    );\n  }\n\n}\n"],"mappings":"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"}