{"version":3,"file":"IdClaimBehavior.js","names":["CommandInterceptor","isArray","IdClaimBehavior","constructor","eventBus","moddle","modeling","_ids","ids","_modeling","preExecute","event","context","element","row","col","claimId","businessObject","cells","forEach","cell","id","assigned","$descriptor","properties","property","value","name","v","$type","$inject"],"sources":["../../../../src/features/modeling/behavior/IdClaimBehavior.js"],"sourcesContent":["import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport { isArray } from 'min-dash';\r\n\r\n\r\nexport default class IdClaimBehavior extends CommandInterceptor {\r\n\r\n  constructor(eventBus, moddle, modeling) {\r\n    super(eventBus);\r\n\r\n    this._ids = moddle.ids;\r\n    this._modeling = modeling;\r\n\r\n    this.preExecute([\r\n      'row.add',\r\n      'col.add'\r\n    ], event => {\r\n      const context = event.context,\r\n            element = context.row || context.col;\r\n\r\n      this.claimId(element.businessObject);\r\n\r\n      if (element.cells) {\r\n        element.cells.forEach(cell => this.claimId(cell.businessObject));\r\n      }\r\n    });\r\n  }\r\n\r\n  claimId(businessObject) {\r\n\r\n    if (businessObject.id && !this._ids.assigned(businessObject.id)) {\r\n      this._modeling.claimId(businessObject.id, businessObject);\r\n    }\r\n\r\n    businessObject.$descriptor.properties.forEach(property => {\r\n      const value = businessObject[property.name];\r\n\r\n      // not set\r\n      if (!value) {\r\n        return;\r\n      }\r\n\r\n      // array of moddle elements\r\n      if (isArray(value)) {\r\n        value.forEach(v => this.claimId(v));\r\n      }\r\n\r\n      // moddle element\r\n      if (value.$type) {\r\n        this.claimId(value);\r\n      }\r\n    });\r\n\r\n  }\r\n}\r\n\r\nIdClaimBehavior.$inject = [ 'eventBus', 'moddle', 'modeling' ];"],"mappings":"AAAA,OAAOA,kBAAkB,MAAM,2CAA2C;AAE1E,SAASC,OAAO,QAAQ,UAAU;AAGlC,eAAe,MAAMC,eAAe,SAASF,kBAAkB,CAAC;EAE9DG,WAAW,CAACC,QAAQ,EAAEC,MAAM,EAAEC,QAAQ,EAAE;IACtC,KAAK,CAACF,QAAQ,CAAC;IAEf,IAAI,CAACG,IAAI,GAAGF,MAAM,CAACG,GAAG;IACtB,IAAI,CAACC,SAAS,GAAGH,QAAQ;IAEzB,IAAI,CAACI,UAAU,CAAC,CACd,SAAS,EACT,SAAS,CACV,EAAEC,KAAK,IAAI;MACV,MAAMC,OAAO,GAAGD,KAAK,CAACC,OAAO;QACvBC,OAAO,GAAGD,OAAO,CAACE,GAAG,IAAIF,OAAO,CAACG,GAAG;MAE1C,IAAI,CAACC,OAAO,CAACH,OAAO,CAACI,cAAc,CAAC;MAEpC,IAAIJ,OAAO,CAACK,KAAK,EAAE;QACjBL,OAAO,CAACK,KAAK,CAACC,OAAO,CAACC,IAAI,IAAI,IAAI,CAACJ,OAAO,CAACI,IAAI,CAACH,cAAc,CAAC,CAAC;MAClE;IACF,CAAC,CAAC;EACJ;EAEAD,OAAO,CAACC,cAAc,EAAE;IAEtB,IAAIA,cAAc,CAACI,EAAE,IAAI,CAAC,IAAI,CAACd,IAAI,CAACe,QAAQ,CAACL,cAAc,CAACI,EAAE,CAAC,EAAE;MAC/D,IAAI,CAACZ,SAAS,CAACO,OAAO,CAACC,cAAc,CAACI,EAAE,EAAEJ,cAAc,CAAC;IAC3D;IAEAA,cAAc,CAACM,WAAW,CAACC,UAAU,CAACL,OAAO,CAACM,QAAQ,IAAI;MACxD,MAAMC,KAAK,GAAGT,cAAc,CAACQ,QAAQ,CAACE,IAAI,CAAC;;MAE3C;MACA,IAAI,CAACD,KAAK,EAAE;QACV;MACF;;MAEA;MACA,IAAIzB,OAAO,CAACyB,KAAK,CAAC,EAAE;QAClBA,KAAK,CAACP,OAAO,CAACS,CAAC,IAAI,IAAI,CAACZ,OAAO,CAACY,CAAC,CAAC,CAAC;MACrC;;MAEA;MACA,IAAIF,KAAK,CAACG,KAAK,EAAE;QACf,IAAI,CAACb,OAAO,CAACU,KAAK,CAAC;MACrB;IACF,CAAC,CAAC;EAEJ;AACF;AAEAxB,eAAe,CAAC4B,OAAO,GAAG,CAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,CAAE"}