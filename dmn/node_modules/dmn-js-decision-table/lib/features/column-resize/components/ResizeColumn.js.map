{"version":3,"file":"ResizeColumn.js","names":["Component","inject","closest","domClosest","is","getBusinessObject","ResizeColumn","constructor","props","context","forceUpdate","event","cell","target","startResize","node","minWidth","onEnd","saveWidth","newWidth","col","update","annotationsWidth","width","modeling","updateProperties","componentDidMount","root","getRoot","changeSupport","onElementsChanged","componentWillUnmount","offElementsChanged","sheet","isLastInputOrOutput","bo","inputs","get","indexOf","length","outputs","render","style","right","handleMouseDown","translate","$inject","noop","preventDefault","initialWidth","getBoundingClientRect","initialX","clientX","currentUpdate","document","addEventListener","handleMouseMove","handleMouseUp","currentWidth","getResizedWidth","cancelAnimationFrame","requestAnimationFrame","removeEventListener","currentX","delta","Math","max"],"sources":["../../../../src/features/column-resize/components/ResizeColumn.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { inject } from 'table-js/lib/components';\n\nimport {\n  closest as domClosest\n} from 'min-dom';\n\nimport { is, getBusinessObject } from 'dmn-js-shared/lib/util/ModelUtil';\n\n\nexport default class ResizeColumn extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    inject(this);\n  }\n\n  componentDidMount() {\n    const root = this.getRoot();\n\n    this.changeSupport.onElementsChanged(root, this.onElementsChanged);\n  }\n\n  componentWillUnmount() {\n    const root = this.getRoot();\n\n    this.changeSupport.offElementsChanged(root, this.onElementsChanged);\n  }\n\n  getRoot() {\n    return this.sheet.getRoot();\n  }\n\n  onElementsChanged = () => {\n    this.forceUpdate();\n  };\n\n  handleMouseDown = event => {\n    const cell = domClosest(event.target, 'th', false);\n\n    startResize({\n      node: cell,\n      event,\n      minWidth: this.props.minWidth || 150,\n      onEnd: this.saveWidth\n    });\n  };\n\n  saveWidth = newWidth => {\n    const { col } = this.props;\n\n    const update = {};\n\n    if (is(col, 'dmn:DecisionTable')) {\n      update.annotationsWidth = newWidth;\n    } else {\n      update.width = newWidth;\n    }\n\n    this.modeling.updateProperties(col, update);\n  };\n\n  isLastInputOrOutput() {\n    const { col } = this.props,\n          root = this.getRoot(),\n          bo = getBusinessObject(root);\n\n    if (is(col, 'dmn:InputClause')) {\n      const inputs = bo.get('input');\n\n      return inputs.indexOf(col) === inputs.length - 1;\n    } else if (is(col, 'dmn:OutputClause')) {\n      const outputs = bo.get('output');\n\n      return outputs.indexOf(col) === outputs.length - 1;\n    }\n  }\n\n  render() {\n    const style = this.isLastInputOrOutput() ? {\n      right: '-7px',\n      width: '27px'\n    } : null;\n\n    return (\n      <div\n        onMouseDown={ this.handleMouseDown }\n        className=\"resize-column-handle\"\n        title={ this.translate('Resize') }\n        style={ style }\n      />\n    );\n  }\n}\n\nResizeColumn.$inject = [ 'sheet', 'changeSupport', 'translate', 'modeling' ];\n\n// helper\nfunction startResize({ node, event, minWidth, onEnd = noop }) {\n  event.preventDefault();\n\n  const initialWidth = node.getBoundingClientRect().width;\n  const initialX = event.clientX;\n\n  let currentUpdate;\n\n  document.addEventListener('mousemove', handleMouseMove);\n  document.addEventListener('mouseup', handleMouseUp);\n\n  function handleMouseMove(event) {\n    event.preventDefault();\n\n    const currentWidth = getResizedWidth(event.clientX);\n\n    if (currentUpdate) {\n      cancelAnimationFrame(currentUpdate);\n    }\n\n    currentUpdate = requestAnimationFrame(() => {\n      node.style.width = currentWidth + 'px';\n    });\n  }\n\n  function handleMouseUp(event) {\n    event.preventDefault();\n\n    document.removeEventListener('mousemove', handleMouseMove);\n    document.removeEventListener('mouseup', handleMouseUp);\n\n    const currentWidth = getResizedWidth(event.clientX);\n\n    onEnd(currentWidth);\n  }\n\n  function getResizedWidth(currentX) {\n    const delta = currentX - initialX;\n\n    return Math.max(initialWidth + delta, minWidth);\n  }\n}\n\nfunction noop() {}\n"],"mappings":"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"}