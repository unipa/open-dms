{"version":3,"file":"DecisionRulesCellEditorComponent.js","names":["Component","isString","is","EditableComponent","Cell","DecisionRulesCellEditorComponent","constructor","props","context","state","isFocussed","changeCellValue","bind","onFocus","onBlur","onElementsChanged","forceUpdate","componentWillMount","injector","cell","changeSupport","_changeSupport","_modeling","get","id","componentWillUnmount","offElementsChanged","value","editCell","businessObject","setState","render","rowIndex","row","col","colIndex","isUnaryTest","text","TableCellEditor","_expressionLanguages","_translate","isDefaultExpressionLanguage","expressionLanguage","defaultExpressionLanguage","getDefaultExpressionLanguage","getDescription","description","getExpressionLanguageLabel","getLabel","label","isScript","isInputCell","indexOf","elementType","getDefault","expressionLanguageLabel","getClassName","getEditor","className"],"sources":["../../../../src/features/decision-rules/components/DecisionRulesCellEditorComponent.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { isString } from 'min-dash';\n\nimport { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport EditableComponent from 'dmn-js-shared/lib/components/EditableComponent';\n\nimport { Cell } from 'table-js/lib/components';\n\n\nexport default class DecisionRulesCellEditorComponent extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.state = {\n      isFocussed: false\n    };\n\n    this.changeCellValue = this.changeCellValue.bind(this);\n    this.onFocus = this.onFocus.bind(this);\n    this.onBlur = this.onBlur.bind(this);\n    this.onElementsChanged = this.onElementsChanged.bind(this);\n  }\n\n\n  onElementsChanged() {\n    this.forceUpdate();\n  }\n\n\n  componentWillMount() {\n    const { injector } = this.context;\n\n    const { cell } = this.props;\n\n    const changeSupport = this._changeSupport = this.context.changeSupport;\n\n    this._modeling = injector.get('modeling');\n\n    changeSupport.onElementsChanged(cell.id, this.onElementsChanged);\n  }\n\n\n  componentWillUnmount() {\n    const { cell } = this.props;\n\n    this._changeSupport.offElementsChanged(cell.id, this.onElementsChanged);\n  }\n\n\n  changeCellValue(value) {\n    const { cell } = this.props;\n\n    this._modeling.editCell(cell.businessObject, value);\n  }\n\n\n  onFocus() {\n    this.setState({\n      isFocussed: true\n    });\n  }\n\n\n  onBlur() {\n    this.setState({\n      isFocussed: false\n    });\n  }\n\n\n  render() {\n    const {\n      cell,\n      rowIndex,\n      row,\n      col,\n      colIndex\n    } = this.props;\n\n    const { isFocussed } = this.state;\n\n    const isUnaryTest = is(cell, 'dmn:UnaryTests');\n    const businessObject = cell.businessObject;\n\n    return (\n      <Cell\n        className={ isUnaryTest ? 'input-cell' : 'output-cell' }\n        elementId={ cell.id }\n        coords={ `${rowIndex}:${colIndex}` }\n        data-row-id={ row.id }\n        data-col-id={ col.id }\n      >\n        <TableCellEditor\n          className=\"cell-editor\"\n          placeholder={ isUnaryTest ? '-' : '' }\n          ctrlForNewline={ true }\n          onFocus={ this.onFocus }\n          onBlur={ this.onBlur }\n          isFocussed={ isFocussed }\n          onChange={ this.changeCellValue }\n          value={ businessObject.text }\n          businessObject={ businessObject } />\n      </Cell>\n    );\n  }\n}\n\n\nclass TableCellEditor extends EditableComponent {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this._expressionLanguages = context.injector.get('expressionLanguages');\n    this._translate = context.injector.get('translate');\n  }\n\n  isDefaultExpressionLanguage(businessObject) {\n    const { expressionLanguage } = businessObject;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage(\n      businessObject\n    ).value;\n\n    return !expressionLanguage || expressionLanguage === defaultExpressionLanguage;\n  }\n\n  getDescription(businessObject) {\n    return businessObject.description;\n  }\n\n  getExpressionLanguageLabel(businessObject) {\n    const { expressionLanguage } = businessObject;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage(businessObject);\n\n    return this._expressionLanguages.getLabel(expressionLanguage) ||\n      defaultExpressionLanguage.label;\n  }\n\n  isScript(businessObject) {\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage(businessObject);\n\n    const isInputCell = is(businessObject, 'dmn:UnaryTests');\n\n    if (!isInputCell) {\n      return false;\n    }\n\n    if (businessObject.text.indexOf('\\n') !== -1) {\n      return true;\n    }\n\n    return businessObject.expressionLanguage &&\n      businessObject.expressionLanguage !== defaultExpressionLanguage;\n  }\n\n  getDefaultExpressionLanguage(businessObject) {\n    const elementType = is(businessObject, 'dmn:UnaryTests') ? 'inputCell' : 'outputCell';\n\n    return this._expressionLanguages.getDefault(elementType);\n  }\n\n  render() {\n    const {\n      businessObject,\n      isFocussed\n    } = this.props;\n\n    const description = this.getDescription(businessObject);\n\n    const isDefaultExpressionLanguage = this.isDefaultExpressionLanguage(businessObject);\n\n    const expressionLanguageLabel = this.getExpressionLanguageLabel(businessObject);\n\n    const isScript = this.isScript(businessObject);\n\n    return (\n      <div className={ this.getClassName() }>\n        {\n          isString(description)\n            && !isFocussed\n            && <div className=\"description-indicator\"></div>\n        }\n        {\n          this.getEditor({\n            className: isScript ? 'script-editor' : null\n          })\n        }\n        {\n          !isDefaultExpressionLanguage &&\n          !isFocussed && (\n            <span\n              className=\"dms-badge dmn-expression-language\"\n              title={ this._translate(\n                'Expression Language = {expressionLanguageLabel}',\n                { expressionLanguageLabel }\n              ) }>\n              <span class=\"dms-badge-icon dmn-icon-file-code\"></span>\n              <span class=\"dms-badge-label\">{ expressionLanguageLabel }</span>\n            </span>\n          )\n        }\n      </div>\n    );\n  }\n}\n"],"mappings":";AAAA,SAASA,SAAS,QAAQ,SAAS;AAEnC,SAASC,QAAQ,QAAQ,UAAU;AAEnC,SAASC,EAAE,QAAQ,kCAAkC;AAErD,OAAOC,iBAAiB,MAAM,gDAAgD;AAE9E,SAASC,IAAI,QAAQ,yBAAyB;AAG9C,eAAe,MAAMC,gCAAgC,SAASL,SAAS,CAAC;EAEtEM,WAAW,CAACC,KAAK,EAAEC,OAAO,EAAE;IAC1B,KAAK,CAACD,KAAK,EAAEC,OAAO,CAAC;IAErB,IAAI,CAACC,KAAK,GAAG;MACXC,UAAU,EAAE;IACd,CAAC;IAED,IAAI,CAACC,eAAe,GAAG,IAAI,CAACA,eAAe,CAACC,IAAI,CAAC,IAAI,CAAC;IACtD,IAAI,CAACC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACD,IAAI,CAAC,IAAI,CAAC;IACtC,IAAI,CAACE,MAAM,GAAG,IAAI,CAACA,MAAM,CAACF,IAAI,CAAC,IAAI,CAAC;IACpC,IAAI,CAACG,iBAAiB,GAAG,IAAI,CAACA,iBAAiB,CAACH,IAAI,CAAC,IAAI,CAAC;EAC5D;EAGAG,iBAAiB,GAAG;IAClB,IAAI,CAACC,WAAW,EAAE;EACpB;EAGAC,kBAAkB,GAAG;IACnB,MAAQC,QAAQ,GAAK,IAAI,CAACV,OAAO,CAAzBU,QAAQ;IAEhB,MAAQC,IAAI,GAAK,IAAI,CAACZ,KAAK,CAAnBY,IAAI;IAEZ,MAAMC,aAAa,GAAG,IAAI,CAACC,cAAc,GAAG,IAAI,CAACb,OAAO,CAACY,aAAa;IAEtE,IAAI,CAACE,SAAS,GAAGJ,QAAQ,CAACK,GAAG,CAAC,UAAU,CAAC;IAEzCH,aAAa,CAACL,iBAAiB,CAACI,IAAI,CAACK,EAAE,EAAE,IAAI,CAACT,iBAAiB,CAAC;EAClE;EAGAU,oBAAoB,GAAG;IACrB,MAAQN,IAAI,GAAK,IAAI,CAACZ,KAAK,CAAnBY,IAAI;IAEZ,IAAI,CAACE,cAAc,CAACK,kBAAkB,CAACP,IAAI,CAACK,EAAE,EAAE,IAAI,CAACT,iBAAiB,CAAC;EACzE;EAGAJ,eAAe,CAACgB,KAAK,EAAE;IACrB,MAAQR,IAAI,GAAK,IAAI,CAACZ,KAAK,CAAnBY,IAAI;IAEZ,IAAI,CAACG,SAAS,CAACM,QAAQ,CAACT,IAAI,CAACU,cAAc,EAAEF,KAAK,CAAC;EACrD;EAGAd,OAAO,GAAG;IACR,IAAI,CAACiB,QAAQ,CAAC;MACZpB,UAAU,EAAE;IACd,CAAC,CAAC;EACJ;EAGAI,MAAM,GAAG;IACP,IAAI,CAACgB,QAAQ,CAAC;MACZpB,UAAU,EAAE;IACd,CAAC,CAAC;EACJ;EAGAqB,MAAM,GAAG;IACP,oBAMI,IAAI,CAACxB,KAAK;MALZY,IAAI,eAAJA,IAAI;MACJa,QAAQ,eAARA,QAAQ;MACRC,GAAG,eAAHA,GAAG;MACHC,GAAG,eAAHA,GAAG;MACHC,QAAQ,eAARA,QAAQ;IAGV,MAAQzB,UAAU,GAAK,IAAI,CAACD,KAAK,CAAzBC,UAAU;IAElB,MAAM0B,WAAW,GAAGlC,EAAE,CAACiB,IAAI,EAAE,gBAAgB,CAAC;IAC9C,MAAMU,cAAc,GAAGV,IAAI,CAACU,cAAc;IAE1C;MAAA,aAEgBO,WAAW,GAAG,YAAY,GAAG,aAAa;MAAA,aAC1CjB,IAAI,CAACK,EAAE;MAAA,oBACPQ,QAAQ,cAAIG,QAAQ;MAAA,eAClBF,GAAG,CAACT,EAAE;MAAA,eACNU,GAAG,CAACV,EAAE;MAAA;QAAA,aAGR,aAAa;QAAA,eACTY,WAAW,GAAG,GAAG,GAAG,EAAE;QAAA,kBACnB,IAAI;QAAA,WACX,IAAI,CAACvB,OAAO;QAAA,UACb,IAAI,CAACC,MAAM;QAAA,cACPJ,UAAU;QAAA,YACZ,IAAI,CAACC,eAAe;QAAA,SACvBkB,cAAc,CAACQ,IAAI;QAAA,kBACVR;MAAc;IAAA;EAGvC;AACF;AAGA,MAAMS,eAAe,SAASnC,iBAAiB,CAAC;EAE9CG,WAAW,CAACC,KAAK,EAAEC,OAAO,EAAE;IAC1B,KAAK,CAACD,KAAK,EAAEC,OAAO,CAAC;IAErB,IAAI,CAAC+B,oBAAoB,GAAG/B,OAAO,CAACU,QAAQ,CAACK,GAAG,CAAC,qBAAqB,CAAC;IACvE,IAAI,CAACiB,UAAU,GAAGhC,OAAO,CAACU,QAAQ,CAACK,GAAG,CAAC,WAAW,CAAC;EACrD;EAEAkB,2BAA2B,CAACZ,cAAc,EAAE;IAC1C,MAAQa,kBAAkB,GAAKb,cAAc,CAArCa,kBAAkB;IAE1B,MAAMC,yBAAyB,GAAG,IAAI,CAACC,4BAA4B,CACjEf,cAAc,CACf,CAACF,KAAK;IAEP,OAAO,CAACe,kBAAkB,IAAIA,kBAAkB,KAAKC,yBAAyB;EAChF;EAEAE,cAAc,CAAChB,cAAc,EAAE;IAC7B,OAAOA,cAAc,CAACiB,WAAW;EACnC;EAEAC,0BAA0B,CAAClB,cAAc,EAAE;IACzC,MAAQa,kBAAkB,GAAKb,cAAc,CAArCa,kBAAkB;IAE1B,MAAMC,yBAAyB,GAAG,IAAI,CAACC,4BAA4B,CAACf,cAAc,CAAC;IAEnF,OAAO,IAAI,CAACU,oBAAoB,CAACS,QAAQ,CAACN,kBAAkB,CAAC,IAC3DC,yBAAyB,CAACM,KAAK;EACnC;EAEAC,QAAQ,CAACrB,cAAc,EAAE;IACvB,MAAMc,yBAAyB,GAAG,IAAI,CAACC,4BAA4B,CAACf,cAAc,CAAC;IAEnF,MAAMsB,WAAW,GAAGjD,EAAE,CAAC2B,cAAc,EAAE,gBAAgB,CAAC;IAExD,IAAI,CAACsB,WAAW,EAAE;MAChB,OAAO,KAAK;IACd;IAEA,IAAItB,cAAc,CAACQ,IAAI,CAACe,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;MAC5C,OAAO,IAAI;IACb;IAEA,OAAOvB,cAAc,CAACa,kBAAkB,IACtCb,cAAc,CAACa,kBAAkB,KAAKC,yBAAyB;EACnE;EAEAC,4BAA4B,CAACf,cAAc,EAAE;IAC3C,MAAMwB,WAAW,GAAGnD,EAAE,CAAC2B,cAAc,EAAE,gBAAgB,CAAC,GAAG,WAAW,GAAG,YAAY;IAErF,OAAO,IAAI,CAACU,oBAAoB,CAACe,UAAU,CAACD,WAAW,CAAC;EAC1D;EAEAtB,MAAM,GAAG;IACP,qBAGI,IAAI,CAACxB,KAAK;MAFZsB,cAAc,gBAAdA,cAAc;MACdnB,UAAU,gBAAVA,UAAU;IAGZ,MAAMoC,WAAW,GAAG,IAAI,CAACD,cAAc,CAAChB,cAAc,CAAC;IAEvD,MAAMY,2BAA2B,GAAG,IAAI,CAACA,2BAA2B,CAACZ,cAAc,CAAC;IAEpF,MAAM0B,uBAAuB,GAAG,IAAI,CAACR,0BAA0B,CAAClB,cAAc,CAAC;IAE/E,MAAMqB,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACrB,cAAc,CAAC;IAE9C,6BACmB,IAAI,CAAC2B,YAAY,EAAE,GAEhCvD,QAAQ,CAAC6C,WAAW,CAAC,IAChB,CAACpC,UAAU,0BACI,uBAAuB,CAAO,EAGlD,IAAI,CAAC+C,SAAS,CAAC;MACbC,SAAS,EAAER,QAAQ,GAAG,eAAe,GAAG;IAC1C,CAAC,CAAC,EAGF,CAACT,2BAA2B,IAC5B,CAAC/B,UAAU,2BAEG,mCAAmC,0BAKjC,mCAAmC,0BACnC,iBAAiB,EAAG6C,uBAAuB;MAAA,SAL/C,IAAI,CAACf,UAAU,CACrB,iDAAiD,EACjD;QAAEe;MAAwB,CAAC;IAC5B,EAIJ;EAIT;AACF"}