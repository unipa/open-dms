{"version":3,"file":"CellSelectionUtil.js","names":["closest","matches","query","cssEscape","setRange","getRange","SELECTABLE_SELECTOR","ELEMENT_SELECTOR","getElementId","node","getAttribute","getElementCoords","coordsAttr","split","row","col","getNodeByCoords","elementCoords","container","getNodeById","elementId","isUnselectableNode","findSelectableAncestor","getFocusableNode","el","selector","ensureFocus","focusEl","document","body","contains","activeElement","focus","range","end","start"],"sources":["../../../src/features/cell-selection/CellSelectionUtil.js"],"sourcesContent":["import {\n  closest,\n  matches,\n  query\n} from 'min-dom';\n\nimport cssEscape from 'css.escape';\n\nimport {\n  setRange,\n  getRange\n} from 'selection-ranges';\n\nexport const SELECTABLE_SELECTOR = '[contenteditable]';\n\nexport const ELEMENT_SELECTOR = '[data-element-id]';\n\n\nexport function getElementId(node) {\n  return node.getAttribute('data-element-id');\n}\n\nexport function getElementCoords(node) {\n  const coordsAttr = node.getAttribute('data-coords');\n\n  if (!coordsAttr) {\n    return null;\n  }\n\n  const [ row, col ] = coordsAttr.split(':');\n\n  return {\n    row,\n    col\n  };\n}\n\nexport function getNodeByCoords(elementCoords, container) {\n  const coordsAttr = `${elementCoords.row}:${elementCoords.col}`;\n\n  return query(`[data-coords=\"${ cssEscape(coordsAttr) }\"]`, container);\n}\n\nexport function getNodeById(elementId, container) {\n  return query(`[data-element-id=\"${ cssEscape(elementId) }\"]`, container);\n}\n\nexport function isUnselectableNode(node) {\n  return closest(node, '.no-deselect', true);\n}\n\n/**\n * Find semantically _selectable_ element in the nodes ancestors.\n *\n * @param {Element} node\n *\n * @return {Element} node\n */\nexport function findSelectableAncestor(node) {\n  return closest(node, ELEMENT_SELECTOR, true);\n}\n\n/**\n * Return focusable node in selectable el.\n *\n * @param  {Element} el\n *\n * @return {Element}\n */\nexport function getFocusableNode(el) {\n\n  const selector = SELECTABLE_SELECTOR;\n\n  return (\n    matches(el, selector)\n      ? el\n      : query(selector, el)\n  );\n}\n\n/**\n * Ensure element or element childNode has the proper focus.\n *\n * @param {Element} el\n */\nexport function ensureFocus(el) {\n\n  const focusEl = getFocusableNode(el);\n\n  if (!focusEl) {\n    return;\n  }\n\n  // QUIRK: otherwise range and focus related actions may\n  // yield errors in older browsers (PhantomJS / IE)\n  if (!document.body.contains(focusEl)) {\n    return;\n  }\n\n  // nothing to do, if element already has focus\n  if (document.activeElement === focusEl) {\n    return;\n  }\n\n  // (1) focus\n  focusEl.focus();\n\n  // (2) set cursor to element end\n  const range = getRange(focusEl);\n\n  if (!range || range.end === 0) {\n    setRange(focusEl, { start: 5000, end: 5000 });\n  }\n}"],"mappings":";;;;;;AAAA,SACEA,OAAO,EACPC,OAAO,EACPC,KAAK,QACA,SAAS;AAEhB,OAAOC,SAAS,MAAM,YAAY;AAElC,SACEC,QAAQ,EACRC,QAAQ,QACH,kBAAkB;AAEzB,OAAO,MAAMC,mBAAmB,GAAG,mBAAmB;AAEtD,OAAO,MAAMC,gBAAgB,GAAG,mBAAmB;AAGnD,OAAO,SAASC,YAAY,CAACC,IAAI,EAAE;EACjC,OAAOA,IAAI,CAACC,YAAY,CAAC,iBAAiB,CAAC;AAC7C;AAEA,OAAO,SAASC,gBAAgB,CAACF,IAAI,EAAE;EACrC,MAAMG,UAAU,GAAGH,IAAI,CAACC,YAAY,CAAC,aAAa,CAAC;EAEnD,IAAI,CAACE,UAAU,EAAE;IACf,OAAO,IAAI;EACb;EAEA,0BAAqBA,UAAU,CAACC,KAAK,CAAC,GAAG,CAAC;IAAA;IAAlCC,GAAG;IAAEC,GAAG;EAEhB,OAAO;IACLD,GAAG;IACHC;EACF,CAAC;AACH;AAEA,OAAO,SAASC,eAAe,CAACC,aAAa,EAAEC,SAAS,EAAE;EACxD,MAAMN,UAAU,aAAMK,aAAa,CAACH,GAAG,cAAIG,aAAa,CAACF,GAAG,CAAE;EAE9D,OAAOb,KAAK,0BAAmBC,SAAS,CAACS,UAAU,CAAC,UAAOM,SAAS,CAAC;AACvE;AAEA,OAAO,SAASC,WAAW,CAACC,SAAS,EAAEF,SAAS,EAAE;EAChD,OAAOhB,KAAK,8BAAuBC,SAAS,CAACiB,SAAS,CAAC,UAAOF,SAAS,CAAC;AAC1E;AAEA,OAAO,SAASG,kBAAkB,CAACZ,IAAI,EAAE;EACvC,OAAOT,OAAO,CAACS,IAAI,EAAE,cAAc,EAAE,IAAI,CAAC;AAC5C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASa,sBAAsB,CAACb,IAAI,EAAE;EAC3C,OAAOT,OAAO,CAACS,IAAI,EAAEF,gBAAgB,EAAE,IAAI,CAAC;AAC9C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASgB,gBAAgB,CAACC,EAAE,EAAE;EAEnC,MAAMC,QAAQ,GAAGnB,mBAAmB;EAEpC,OACEL,OAAO,CAACuB,EAAE,EAAEC,QAAQ,CAAC,GACjBD,EAAE,GACFtB,KAAK,CAACuB,QAAQ,EAAED,EAAE,CAAC;AAE3B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASE,WAAW,CAACF,EAAE,EAAE;EAE9B,MAAMG,OAAO,GAAGJ,gBAAgB,CAACC,EAAE,CAAC;EAEpC,IAAI,CAACG,OAAO,EAAE;IACZ;EACF;;EAEA;EACA;EACA,IAAI,CAACC,QAAQ,CAACC,IAAI,CAACC,QAAQ,CAACH,OAAO,CAAC,EAAE;IACpC;EACF;;EAEA;EACA,IAAIC,QAAQ,CAACG,aAAa,KAAKJ,OAAO,EAAE;IACtC;EACF;;EAEA;EACAA,OAAO,CAACK,KAAK,EAAE;;EAEf;EACA,MAAMC,KAAK,GAAG5B,QAAQ,CAACsB,OAAO,CAAC;EAE/B,IAAI,CAACM,KAAK,IAAIA,KAAK,CAACC,GAAG,KAAK,CAAC,EAAE;IAC7B9B,QAAQ,CAACuB,OAAO,EAAE;MAAEQ,KAAK,EAAE,IAAI;MAAED,GAAG,EAAE;IAAK,CAAC,CAAC;EAC/C;AACF"}