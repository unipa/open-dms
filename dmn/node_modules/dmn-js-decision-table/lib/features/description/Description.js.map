{"version":3,"file":"Description.js","names":["isString","isAny","getNodeById","DescriptionEditor","LOW_PRIORITY","LOWER_PRIORITY","OFFSET_X","Description","constructor","components","contextMenu","elementRegistry","eventBus","modeling","renderer","translate","cell","_modeling","updateProperties","description","container","_renderer","getContainer","node","id","bounds","getBoundingClientRect","position","getPosition","_contextMenu","open","contextMenuType","autoFocus","offset","x","y","close","_translate","on","event","defaultPrevented","target","element","get","getDescription","preventDefault","onGetComponent","context","businessObject","existingDescription","className","onClick","removeDescription","addDescription","$inject","top","left","width","height","parentNode","scrollLeft","scrollTop"],"sources":["../../../src/features/description/Description.js"],"sourcesContent":["import { isString } from 'min-dash';\r\n\r\nimport { isAny } from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nimport {\r\n  getNodeById\r\n} from '../cell-selection/CellSelectionUtil';\r\n\r\nimport DescriptionEditor from './components/DescriptionEditor';\r\n\r\nconst LOW_PRIORITY = 500;\r\n\r\nconst LOWER_PRIORITY = 750;\r\n\r\nconst OFFSET_X = 26;\r\n\r\n\r\nexport default class Description {\r\n\r\n  constructor(\r\n      components, contextMenu, elementRegistry,\r\n      eventBus, modeling, renderer, translate) {\r\n\r\n    this._contextMenu = contextMenu;\r\n    this._modeling = modeling;\r\n    this._renderer = renderer;\r\n    this._translate = translate;\r\n\r\n\r\n    eventBus.on('cell.click', LOWER_PRIORITY, (event) => {\r\n\r\n      if (event.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      const {\r\n        target,\r\n        id\r\n      } = event;\r\n\r\n      const element = elementRegistry.get(id);\r\n\r\n      if (!isAny(element, [ 'dmn:UnaryTests', 'dmn:LiteralExpression' ])) {\r\n        return;\r\n      }\r\n\r\n      const description = getDescription(element);\r\n\r\n      if (!description) {\r\n\r\n        // prevent focus\r\n        event.preventDefault();\r\n      }\r\n\r\n      const container = renderer.getContainer(),\r\n            bounds = target.getBoundingClientRect();\r\n\r\n      const position = getPosition(container, bounds);\r\n\r\n      contextMenu.open(position, {\r\n        contextMenuType: 'cell-description',\r\n        autoFocus: false,\r\n        id,\r\n        offset: {\r\n          x: 4,\r\n          y: 4\r\n        }\r\n      });\r\n    });\r\n\r\n    components.onGetComponent('context-menu', (context = {}) => {\r\n      if (context.contextMenuType\r\n        && context.contextMenuType === 'cell-description') {\r\n\r\n        const element = elementRegistry.get(context.id);\r\n\r\n        const description = getDescription(element);\r\n\r\n        if (isString(description)) {\r\n          return DescriptionEditor;\r\n        }\r\n      }\r\n    });\r\n\r\n    components.onGetComponent('context-menu-cell-additional', LOW_PRIORITY,\r\n      (context = {}) => {\r\n        if (context.contextMenuType\r\n          && context.contextMenuType === 'context-menu') {\r\n\r\n          const { id } = context;\r\n\r\n          if (!id) {\r\n            return;\r\n          }\r\n\r\n          const element = elementRegistry.get(id);\r\n\r\n          // element might not be in element registry (e.g. cut)\r\n          if (!element) {\r\n            return;\r\n          }\r\n\r\n          const { businessObject } = element;\r\n\r\n          const { description } = businessObject;\r\n\r\n          const existingDescription = isString(description);\r\n\r\n          const className =\r\n            existingDescription\r\n              ? 'remove-description'\r\n              : 'add-description';\r\n\r\n          const onClick =\r\n            existingDescription\r\n              ? () => this.removeDescription(element)\r\n              : () => this.addDescription(element);\r\n\r\n          return (\r\n            <div\r\n              className={ `context-menu-group-entry ${ className }` }\r\n              onClick={ onClick }>\r\n              {\r\n                isString(description)\r\n                  ?\r\n                  this._translate('Remove Cell Description')\r\n                  :\r\n                  this._translate('Add Cell Description')\r\n              }\r\n            </div>\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  addDescription = (cell) => {\r\n    this._modeling.updateProperties(cell, {\r\n      description: ''\r\n    });\r\n\r\n    const container = this._renderer.getContainer();\r\n\r\n    const node = getNodeById(cell.id, container);\r\n\r\n    const bounds = node.getBoundingClientRect();\r\n\r\n    const position = getPosition(container, bounds);\r\n\r\n    this._contextMenu.open(position, {\r\n      contextMenuType: 'cell-description',\r\n      id: cell.id,\r\n      autoFocus: true,\r\n      offset: {\r\n        x: 4,\r\n        y: 4\r\n      }\r\n    });\r\n  };\r\n\r\n  removeDescription = (cell) => {\r\n    this._modeling.updateProperties(cell, {\r\n      description: null\r\n    });\r\n\r\n    this._contextMenu.close();\r\n  };\r\n}\r\n\r\nDescription.$inject = [\r\n  'components',\r\n  'contextMenu',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'modeling',\r\n  'renderer',\r\n  'translate'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction getPosition(container, bounds) {\r\n  const { top, left, width, height } = bounds;\r\n\r\n  return {\r\n    x: left + container.parentNode.scrollLeft - OFFSET_X,\r\n    y: top + container.parentNode.scrollTop,\r\n    width: width + (2 * OFFSET_X),\r\n    height\r\n  };\r\n}\r\n\r\nfunction getDescription(element) {\r\n  return element\r\n    && element.businessObject\r\n    && element.businessObject.description;\r\n}"],"mappings":"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"}