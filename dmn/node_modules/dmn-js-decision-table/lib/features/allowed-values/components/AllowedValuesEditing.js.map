{"version":3,"file":"AllowedValuesEditing.js","names":["Component","is","List","ValidatedInput","getValuesArray","parseString","AllowedValuesEditing","constructor","props","context","forceUpdate","values","target","getAllowedValuesTarget","setState","_modeling","editAllowedValues","setPredefinedValues","isValid","value","inputValue","event","isEnter","keyCode","stopPropagation","preventDefault","state","parsedString","onListChange","concat","map","isCheckable","isRemovable","group","_translate","e","removePredefinedValues","injector","get","_changeSupport","changeSupport","inputValues","text","outputValues","componentWillMount","onElementsChanged","id","componentWillUnmount","offElementsChanged","element","getElement","$parent","output","input","inputExpression","render","typeRef","isNull","length","Label","handleRemovePredifinedValuesClick","onInput","onKeyDown","label"],"sources":["../../../../src/features/allowed-values/components/AllowedValuesEditing.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport List from 'dmn-js-shared/lib/components/List';\n\nimport ValidatedInput from 'dmn-js-shared/lib/components/ValidatedInput';\n\nimport {\n  getValuesArray,\n  parseString\n} from '../Utils';\n\n\nexport default class AllowedValuesEditing extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this._translate = context.injector.get('translate');\n\n    this._modeling = context.injector.get('modeling');\n    this._changeSupport = context.changeSupport;\n\n    const target = this.getAllowedValuesTarget();\n\n    const parsedString = parseString(\n      (target.inputValues && target.inputValues.text) ||\n      (target.outputValues && target.outputValues.text) ||\n      ''\n    );\n\n    if (parsedString) {\n      this.state = {\n        values: parsedString.values.map(value => {\n          return {\n            value,\n            isCheckable: false,\n            isRemovable: true,\n            group: this._translate('Predefined Values')\n          };\n        }),\n        inputValue: ''\n      };\n    } else {\n      this.state = {\n        values: null,\n        inputValue: ''\n      };\n    }\n  }\n\n  onElementsChanged = () => {\n    this.forceUpdate();\n  };\n\n  componentWillMount() {\n    const target = this.getAllowedValuesTarget();\n\n    this._changeSupport.onElementsChanged(target.id, this.onElementsChanged);\n  }\n\n  componentWillUnmount() {\n    const target = this.getAllowedValuesTarget();\n\n    this._changeSupport.offElementsChanged(target.id, this.onElementsChanged);\n  }\n\n  setPredefinedValues = (values) => {\n\n    // inputClause or outputClause\n    const target = this.getAllowedValuesTarget();\n\n    this.setState({\n      values\n    });\n\n    this._modeling.editAllowedValues(\n      target,\n      values && getValuesArray(values)\n    );\n  };\n\n  onListChange = (values) => {\n    this.setPredefinedValues(values);\n  };\n\n  getAllowedValuesTarget() {\n    const element = this.getElement();\n\n    if (is(element, 'dmn:LiteralExpression')) {\n      return element.$parent;\n    } else {\n      return element;\n    }\n  }\n\n  onInput = ({ isValid, value }) => {\n    this.setState({\n      inputValue: value\n    });\n  };\n\n  /**\n   * Add new value on ENTER.\n   */\n  onKeyDown = ({ isValid, event }) => {\n\n    if (!isEnter(event.keyCode)) {\n      return;\n    }\n\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (isValid) {\n      const {\n        inputValue,\n        values\n      } = this.state;\n\n      const parsedString = parseString(inputValue);\n\n      this.onListChange((values || []).concat(parsedString.values.map(value => {\n        return {\n          value,\n          isCheckable: false,\n          isRemovable: true,\n          group: this._translate('Predefined Values')\n        };\n      })));\n\n      this.setState({\n        inputValue: ''\n      });\n\n    }\n  };\n\n  handleRemovePredifinedValuesClick = (e) => {\n    e.stopPropagation();\n\n    this.removePredefinedValues();\n  };\n\n  removePredefinedValues = () => {\n    this.setPredefinedValues(null);\n  };\n\n  getElement() {\n    return this.props.context.output || this.props.context.input.inputExpression;\n  }\n\n  render() {\n    const element = this.getElement();\n\n    const {\n      inputValue,\n      values\n    } = this.state;\n\n    return (\n      element.typeRef === 'string' ?\n        <div className=\"context-menu-container allowed-values-edit\">\n          <div className=\"dms-form-control\">\n            {\n              !isNull(values)\n              && values.length > 0\n              && <List\n                labelComponent={ Label }\n                items={ values }\n                onChange={ this.onListChange } />\n            }\n\n            {\n              !isNull(values)\n              && !values.length\n              && <div>\n                <label className=\"dms-label\">\n                  { this._translate('Predefined Values') }\n                </label>\n                <span className=\"placeholder\">\n                  { this._translate('No values') }\n                </span>\n              </div>\n            }\n\n            {\n              !isNull(values)\n              && <p class=\"dms-hint\">\n                <button type=\"button\" className=\"del-values\"\n                  onClick={ this.handleRemovePredifinedValuesClick }>\n                  { this._translate('Clear predefined values.') }\n                </button>\n              </p>\n            }\n\n            <label className=\"dms-label\">\n              { this._translate('Add Predefined Values') }\n            </label>\n\n            <ValidatedInput\n              onInput={ this.onInput }\n              onKeyDown={ this.onKeyDown }\n              placeholder={ this._translate('\"value\", \"value\", ...') }\n              type=\"text\"\n              validate={ value => {\n                if (!parseString(value)) {\n                  return this._translate('Strings must be in double quotes.');\n                }\n              } }\n              value={ inputValue } />\n          </div>\n        </div>\n        : null\n    );\n  }\n}\n\nfunction Label(label) {\n  return <label className=\"dms-label\">{ label }</label>;\n}\n\n\n// helpers //////////////////////\n\nfunction isEnter(keyCode) {\n  return keyCode === 13;\n}\n\nfunction isNull(value) {\n  return value === null;\n}"],"mappings":"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"}