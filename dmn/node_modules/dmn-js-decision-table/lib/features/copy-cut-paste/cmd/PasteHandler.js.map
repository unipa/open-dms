{"version":3,"file":"PasteHandler.js","names":["Row","Col","reviveDescriptor","PasteHandler","constructor","clipboard","dmnFactory","elementFactory","elementRegistry","eventBus","moddle","modeling","sheet","_clipboard","_dmnFactory","_elementFactory","_elementRegistry","_eventBus","_model","_modeling","_sheet","postExecute","context","element","after","data","get","Error","root","getRoot","elements","_keepIds","keepIds","index","rows","indexOf","forEach","addRow","cols","addCol","oldElements","revert","$inject"],"sources":["../../../../src/features/copy-cut-paste/cmd/PasteHandler.js"],"sourcesContent":["import { Row, Col } from 'table-js/lib/model';\r\n\r\nimport { reviveDescriptor } from '../DescriptorUtil';\r\n\r\n/**\r\n * A handler that implements pasting elements.\r\n */\r\nexport default class PasteHandler {\r\n\r\n  constructor(\r\n      clipboard,\r\n      dmnFactory,\r\n      elementFactory,\r\n      elementRegistry,\r\n      eventBus,\r\n      moddle,\r\n      modeling,\r\n      sheet\r\n  ) {\r\n    this._clipboard = clipboard;\r\n    this._dmnFactory = dmnFactory;\r\n    this._elementFactory = elementFactory;\r\n    this._elementRegistry = elementRegistry;\r\n    this._eventBus = eventBus;\r\n    this._model = moddle;\r\n    this._modeling = modeling;\r\n    this._sheet = sheet;\r\n  }\r\n\r\n\r\n  /**\r\n   * <do>\r\n   */\r\n  postExecute(context) {\r\n    let {\r\n      element,\r\n      after\r\n    } = context;\r\n\r\n    const data = this._clipboard.get();\r\n\r\n    if (!data) {\r\n      throw new Error('missing clipboard data');\r\n    }\r\n\r\n    const root = this._sheet.getRoot();\r\n\r\n    // (1) create elements from descriptors\r\n    const elements = reviveDescriptor(data.elements, {\r\n      _dmnFactory: this._dmnFactory,\r\n      _keepIds: data.keepIds,\r\n      _model: this._model\r\n    }).root;\r\n\r\n    // (2) add elements to sheet\r\n    if (element instanceof Row) {\r\n\r\n      let index = root.rows.indexOf(element);\r\n\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n\r\n      elements.forEach(element => {\r\n        if (after) {\r\n          index++;\r\n        }\r\n\r\n        this._modeling.addRow(element, index);\r\n      });\r\n\r\n    } else if (element instanceof Col) {\r\n\r\n      let index = root.cols.indexOf(element);\r\n\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n\r\n      elements.forEach(element => {\r\n        if (after) {\r\n          index++;\r\n        }\r\n\r\n        this._modeling.addCol(element, index);\r\n      });\r\n\r\n    }\r\n\r\n    context.oldElements = this._clipboard.get();\r\n\r\n    return this._sheet.getRoot();\r\n  }\r\n\r\n  /**\r\n   * <undo>\r\n   */\r\n  revert(context) {\r\n\r\n  }\r\n\r\n}\r\n\r\nPasteHandler.$inject = [\r\n  'clipboard',\r\n  'dmnFactory',\r\n  'elementFactory',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'moddle',\r\n  'modeling',\r\n  'sheet'\r\n];"],"mappings":"AAAA,SAASA,GAAG,EAAEC,GAAG,QAAQ,oBAAoB;AAE7C,SAASC,gBAAgB,QAAQ,mBAAmB;;AAEpD;AACA;AACA;AACA,eAAe,MAAMC,YAAY,CAAC;EAEhCC,WAAW,CACPC,SAAS,EACTC,UAAU,EACVC,cAAc,EACdC,eAAe,EACfC,QAAQ,EACRC,MAAM,EACNC,QAAQ,EACRC,KAAK,EACP;IACA,IAAI,CAACC,UAAU,GAAGR,SAAS;IAC3B,IAAI,CAACS,WAAW,GAAGR,UAAU;IAC7B,IAAI,CAACS,eAAe,GAAGR,cAAc;IACrC,IAAI,CAACS,gBAAgB,GAAGR,eAAe;IACvC,IAAI,CAACS,SAAS,GAAGR,QAAQ;IACzB,IAAI,CAACS,MAAM,GAAGR,MAAM;IACpB,IAAI,CAACS,SAAS,GAAGR,QAAQ;IACzB,IAAI,CAACS,MAAM,GAAGR,KAAK;EACrB;;EAGA;AACF;AACA;EACES,WAAW,CAACC,OAAO,EAAE;IACnB,IACEC,OAAO,GAELD,OAAO,CAFTC,OAAO;MACPC,KAAK,GACHF,OAAO,CADTE,KAAK;IAGP,MAAMC,IAAI,GAAG,IAAI,CAACZ,UAAU,CAACa,GAAG,EAAE;IAElC,IAAI,CAACD,IAAI,EAAE;MACT,MAAM,IAAIE,KAAK,CAAC,wBAAwB,CAAC;IAC3C;IAEA,MAAMC,IAAI,GAAG,IAAI,CAACR,MAAM,CAACS,OAAO,EAAE;;IAElC;IACA,MAAMC,QAAQ,GAAG5B,gBAAgB,CAACuB,IAAI,CAACK,QAAQ,EAAE;MAC/ChB,WAAW,EAAE,IAAI,CAACA,WAAW;MAC7BiB,QAAQ,EAAEN,IAAI,CAACO,OAAO;MACtBd,MAAM,EAAE,IAAI,CAACA;IACf,CAAC,CAAC,CAACU,IAAI;;IAEP;IACA,IAAIL,OAAO,YAAYvB,GAAG,EAAE;MAE1B,IAAIiC,KAAK,GAAGL,IAAI,CAACM,IAAI,CAACC,OAAO,CAACZ,OAAO,CAAC;MAEtC,IAAIU,KAAK,KAAK,CAAC,CAAC,EAAE;QAChB;MACF;MAEAH,QAAQ,CAACM,OAAO,CAACb,OAAO,IAAI;QAC1B,IAAIC,KAAK,EAAE;UACTS,KAAK,EAAE;QACT;QAEA,IAAI,CAACd,SAAS,CAACkB,MAAM,CAACd,OAAO,EAAEU,KAAK,CAAC;MACvC,CAAC,CAAC;IAEJ,CAAC,MAAM,IAAIV,OAAO,YAAYtB,GAAG,EAAE;MAEjC,IAAIgC,KAAK,GAAGL,IAAI,CAACU,IAAI,CAACH,OAAO,CAACZ,OAAO,CAAC;MAEtC,IAAIU,KAAK,KAAK,CAAC,CAAC,EAAE;QAChB;MACF;MAEAH,QAAQ,CAACM,OAAO,CAACb,OAAO,IAAI;QAC1B,IAAIC,KAAK,EAAE;UACTS,KAAK,EAAE;QACT;QAEA,IAAI,CAACd,SAAS,CAACoB,MAAM,CAAChB,OAAO,EAAEU,KAAK,CAAC;MACvC,CAAC,CAAC;IAEJ;IAEAX,OAAO,CAACkB,WAAW,GAAG,IAAI,CAAC3B,UAAU,CAACa,GAAG,EAAE;IAE3C,OAAO,IAAI,CAACN,MAAM,CAACS,OAAO,EAAE;EAC9B;;EAEA;AACF;AACA;EACEY,MAAM,CAACnB,OAAO,EAAE,CAEhB;AAEF;AAEAnB,YAAY,CAACuC,OAAO,GAAG,CACrB,WAAW,EACX,YAAY,EACZ,gBAAgB,EAChB,iBAAiB,EACjB,UAAU,EACV,QAAQ,EACR,UAAU,EACV,OAAO,CACR"}