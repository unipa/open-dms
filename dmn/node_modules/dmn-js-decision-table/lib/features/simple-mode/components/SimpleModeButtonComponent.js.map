{"version":3,"file":"SimpleModeButtonComponent.js","names":["Component","assign","closest","domClosest","inject","getNodeById","isInput","isOutput","OFFSET","SimpleModeButtonComponent","constructor","props","context","_translate","injector","get","state","top","left","isVisible","isDisabled","selection","debounceInput","onClick","bind","handleSelectionChanged","hideAndShowDebounced","showDebounced","updatePosition","componentDidMount","eventBus","on","componentWillUnmount","off","hide","show","setState","elementId","elementRegistry","expressionLanguages","simpleMode","canSimpleEdit","expressionLanguage","getExpressionLanguage","isDefaultExpressionLanguage","node","renderer","container","getContainer","containerBounds","getBoundingClientRect","cellNode","id","cellBounds","nodeBounds","getTableContainerScroll","scrollLeft","scrollTop","nodePosition","width","classList","remove","add","height","style","element","fire","_container","render","classes","push","join","$inject","cell","businessObject","getDefaultExpressionLanguage","col","getDefault","value","tableContainer"],"sources":["../../../../src/features/simple-mode/components/SimpleModeButtonComponent.js"],"sourcesContent":["import { Component } from 'inferno';\r\n\r\nimport { assign } from 'min-dash';\r\n\r\nimport { closest as domClosest } from 'min-dom';\r\n\r\nimport { inject } from 'table-js/lib/components';\r\n\r\nimport {\r\n  getNodeById\r\n} from '../../cell-selection/CellSelectionUtil';\r\n\r\nimport { isInput, isOutput } from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nconst OFFSET = 4;\r\n\r\nexport default class SimpleModeButtonComponent extends Component {\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    this._translate = context.injector.get('translate');\r\n    this.state = {\r\n      top: 0,\r\n      left: 0,\r\n      isVisible: false,\r\n      isDisabled: false,\r\n      selection: null\r\n    };\r\n\r\n    inject(this);\r\n\r\n    const { debounceInput } = this;\r\n\r\n    this.onClick = this.onClick.bind(this);\r\n\r\n    this.handleSelectionChanged = this.handleSelectionChanged.bind(this);\r\n    this.hideAndShowDebounced = this.hideAndShowDebounced.bind(this);\r\n    this.showDebounced = debounceInput(this.showDebounced.bind(this));\r\n    this.updatePosition = this.updatePosition.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { eventBus } = this;\r\n\r\n    eventBus.on('cellSelection.changed', this.handleSelectionChanged);\r\n\r\n    eventBus.on('commandStack.changed', this.updatePosition);\r\n\r\n    eventBus.on('sheet.scroll', this.hideAndShowDebounced);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { eventBus } = this;\r\n\r\n    eventBus.off('cellSelection.changed', this.handleSelectionChanged);\r\n\r\n    eventBus.off('commandStack.changed', this.updatePosition);\r\n\r\n    eventBus.off('sheet.scroll', this.hideAndShowDebounced);\r\n  }\r\n\r\n  hideAndShowDebounced() {\r\n    if (this.state.isVisible) {\r\n      this.hide();\r\n      this.showDebounced();\r\n    }\r\n  }\r\n\r\n  showDebounced() {\r\n    this.show();\r\n  }\r\n\r\n  hide(state = {}) {\r\n    this.setState({\r\n      ...state,\r\n      isVisible: false\r\n    });\r\n  }\r\n\r\n  show(state = {}) {\r\n    this.setState({\r\n      ...state,\r\n      isVisible: true\r\n    });\r\n\r\n    this.updatePosition();\r\n  }\r\n\r\n  handleSelectionChanged({ elementId }) {\r\n    const {\r\n      elementRegistry,\r\n      expressionLanguages,\r\n      simpleMode\r\n    } = this;\r\n\r\n    const selection = elementRegistry.get(elementId);\r\n\r\n    if (!selection || !simpleMode.canSimpleEdit(selection)) {\r\n      this.hide({\r\n        isDisabled: false,\r\n        selection: null\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    const expressionLanguage = getExpressionLanguage(selection);\r\n\r\n    const isDisabled = !isDefaultExpressionLanguage(\r\n      selection,\r\n      expressionLanguage,\r\n      expressionLanguages\r\n    );\r\n\r\n    this.show({\r\n      isDisabled,\r\n      selection\r\n    });\r\n  }\r\n\r\n  // position button always on opposite site of context menu\r\n  updatePosition() {\r\n    const { selection } = this.state;\r\n\r\n    const { node } = this;\r\n\r\n    if (!selection || !node) {\r\n      return;\r\n    }\r\n\r\n    const { renderer } = this;\r\n\r\n    const container = renderer.getContainer(),\r\n          containerBounds = container.getBoundingClientRect();\r\n\r\n    const cellNode = getNodeById(selection.id, container);\r\n\r\n    const cellBounds = cellNode.getBoundingClientRect();\r\n\r\n    const nodeBounds = this.node.getBoundingClientRect();\r\n\r\n    const { scrollLeft, scrollTop } = getTableContainerScroll(node);\r\n\r\n    const nodePosition = {};\r\n\r\n    if (cellBounds.left + (cellBounds.width / 2) > containerBounds.width / 2) {\r\n\r\n      // left\r\n      nodePosition.left =\r\n        (-containerBounds.left\r\n        + cellBounds.left\r\n        - nodeBounds.width\r\n        + OFFSET\r\n        + scrollLeft)\r\n        + 'px';\r\n\r\n      node.classList.remove('right');\r\n      node.classList.add('left');\r\n    } else {\r\n\r\n      // right\r\n      nodePosition.left =\r\n        (-containerBounds.left\r\n        + cellBounds.left\r\n        + cellBounds.width\r\n        - OFFSET\r\n        + scrollLeft)\r\n        + 'px';\r\n\r\n      node.classList.remove('left');\r\n      node.classList.add('right');\r\n    }\r\n\r\n    if (cellBounds.top + (cellBounds.height / 2) > containerBounds.height / 2) {\r\n\r\n      // bottom\r\n      nodePosition.top =\r\n        (-containerBounds.top\r\n        + cellBounds.top\r\n        - nodeBounds.height\r\n        + OFFSET\r\n        + scrollTop)\r\n        + 'px';\r\n\r\n      node.classList.remove('top');\r\n      node.classList.add('bottom');\r\n\r\n    } else {\r\n\r\n      // top\r\n      nodePosition.top =\r\n        (-containerBounds.top\r\n        + cellBounds.top\r\n        - OFFSET\r\n        + scrollTop)\r\n        + 'px';\r\n\r\n      node.classList.remove('bottom');\r\n      node.classList.add('top');\r\n    }\r\n\r\n    assign(this.node.style, nodePosition);\r\n  }\r\n\r\n  onClick() {\r\n    const { eventBus } = this;\r\n\r\n    const { isDisabled } = this.state;\r\n\r\n    if (isDisabled) {\r\n      return;\r\n    }\r\n\r\n    const { selection } = this;\r\n\r\n    const element = selection.get();\r\n\r\n    if (!element) {\r\n      return;\r\n    }\r\n\r\n    eventBus.fire('simpleMode.open', {\r\n      element,\r\n      node: getNodeById(element.id, this._container)\r\n    });\r\n\r\n    this.hide();\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      isDisabled,\r\n      isVisible,\r\n      top,\r\n      left\r\n    } = this.state;\r\n\r\n    const classes = [\r\n      'simple-mode-button',\r\n      'no-deselect'\r\n    ];\r\n\r\n    if (isDisabled) {\r\n      classes.push('disabled');\r\n    }\r\n\r\n    return (\r\n      isVisible\r\n        ? (\r\n          <div\r\n            className={ classes.join(' ') }\r\n            onClick={ this.onClick }\r\n            ref={ node => this.node = node }\r\n            style={ { top, left } }\r\n            title={ isDisabled\r\n              ? this._translate('Editing not supported for set expression language')\r\n              : this._translate('Edit') }><span className=\"dmn-icon-edit\"></span></div>\r\n        ) : null\r\n    );\r\n  }\r\n}\r\n\r\nSimpleModeButtonComponent.$inject = [\r\n  'debounceInput',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'expressionLanguages',\r\n  'renderer',\r\n  'selection',\r\n  'simpleMode'\r\n];\r\n\r\n// helpers //////////////////////\r\n\r\n/**\r\n * Return set expression language if found.\r\n *\r\n * @param {Cell} cell - Cell.\r\n */\r\nfunction getExpressionLanguage(cell) {\r\n  return cell.businessObject.expressionLanguage;\r\n}\r\n\r\nfunction isDefaultExpressionLanguage(cell, expressionLanguage, expressionLanguages) {\r\n  return !expressionLanguage ||\r\n    expressionLanguage === getDefaultExpressionLanguage(cell, expressionLanguages);\r\n}\r\n\r\nfunction getDefaultExpressionLanguage(cell, expressionLanguages) {\r\n  if (isInput(cell.col)) {\r\n    return expressionLanguages.getDefault('inputCell').value;\r\n  } else if (isOutput(cell.col)) {\r\n    return expressionLanguages.getDefault('outputCell').value;\r\n  }\r\n}\r\n\r\nfunction getTableContainerScroll(node) {\r\n  const tableContainer = domClosest(node, '.tjs-table-container');\r\n\r\n  if (!tableContainer) {\r\n    return {\r\n      scrollTop: 0,\r\n      scrollLeft: 0\r\n    };\r\n  }\r\n\r\n  const { scrollLeft, scrollTop } = tableContainer;\r\n\r\n  return {\r\n    scrollTop,\r\n    scrollLeft\r\n  };\r\n}"],"mappings":";;;;;;AAAA,SAASA,SAAS,QAAQ,SAAS;AAEnC,SAASC,MAAM,QAAQ,UAAU;AAEjC,SAASC,OAAO,IAAIC,UAAU,QAAQ,SAAS;AAE/C,SAASC,MAAM,QAAQ,yBAAyB;AAEhD,SACEC,WAAW,QACN,wCAAwC;AAE/C,SAASC,OAAO,EAAEC,QAAQ,QAAQ,kCAAkC;AAEpE,MAAMC,MAAM,GAAG,CAAC;AAEhB,eAAe,MAAMC,yBAAyB,SAAST,SAAS,CAAC;EAC/DU,WAAW,CAACC,KAAK,EAAEC,OAAO,EAAE;IAC1B,KAAK,CAACD,KAAK,EAAEC,OAAO,CAAC;IAErB,IAAI,CAACC,UAAU,GAAGD,OAAO,CAACE,QAAQ,CAACC,GAAG,CAAC,WAAW,CAAC;IACnD,IAAI,CAACC,KAAK,GAAG;MACXC,GAAG,EAAE,CAAC;MACNC,IAAI,EAAE,CAAC;MACPC,SAAS,EAAE,KAAK;MAChBC,UAAU,EAAE,KAAK;MACjBC,SAAS,EAAE;IACb,CAAC;IAEDjB,MAAM,CAAC,IAAI,CAAC;IAEZ,MAAQkB,aAAa,GAAK,IAAI,CAAtBA,aAAa;IAErB,IAAI,CAACC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACC,IAAI,CAAC,IAAI,CAAC;IAEtC,IAAI,CAACC,sBAAsB,GAAG,IAAI,CAACA,sBAAsB,CAACD,IAAI,CAAC,IAAI,CAAC;IACpE,IAAI,CAACE,oBAAoB,GAAG,IAAI,CAACA,oBAAoB,CAACF,IAAI,CAAC,IAAI,CAAC;IAChE,IAAI,CAACG,aAAa,GAAGL,aAAa,CAAC,IAAI,CAACK,aAAa,CAACH,IAAI,CAAC,IAAI,CAAC,CAAC;IACjE,IAAI,CAACI,cAAc,GAAG,IAAI,CAACA,cAAc,CAACJ,IAAI,CAAC,IAAI,CAAC;EACtD;EAEAK,iBAAiB,GAAG;IAClB,MAAQC,QAAQ,GAAK,IAAI,CAAjBA,QAAQ;IAEhBA,QAAQ,CAACC,EAAE,CAAC,uBAAuB,EAAE,IAAI,CAACN,sBAAsB,CAAC;IAEjEK,QAAQ,CAACC,EAAE,CAAC,sBAAsB,EAAE,IAAI,CAACH,cAAc,CAAC;IAExDE,QAAQ,CAACC,EAAE,CAAC,cAAc,EAAE,IAAI,CAACL,oBAAoB,CAAC;EACxD;EAEAM,oBAAoB,GAAG;IACrB,MAAQF,QAAQ,GAAK,IAAI,CAAjBA,QAAQ;IAEhBA,QAAQ,CAACG,GAAG,CAAC,uBAAuB,EAAE,IAAI,CAACR,sBAAsB,CAAC;IAElEK,QAAQ,CAACG,GAAG,CAAC,sBAAsB,EAAE,IAAI,CAACL,cAAc,CAAC;IAEzDE,QAAQ,CAACG,GAAG,CAAC,cAAc,EAAE,IAAI,CAACP,oBAAoB,CAAC;EACzD;EAEAA,oBAAoB,GAAG;IACrB,IAAI,IAAI,CAACV,KAAK,CAACG,SAAS,EAAE;MACxB,IAAI,CAACe,IAAI,EAAE;MACX,IAAI,CAACP,aAAa,EAAE;IACtB;EACF;EAEAA,aAAa,GAAG;IACd,IAAI,CAACQ,IAAI,EAAE;EACb;EAEAD,IAAI,GAAa;IAAA,IAAZlB,KAAK,uEAAG,CAAC,CAAC;IACb,IAAI,CAACoB,QAAQ,iCACRpB,KAAK;MACRG,SAAS,EAAE;IAAK,GAChB;EACJ;EAEAgB,IAAI,GAAa;IAAA,IAAZnB,KAAK,uEAAG,CAAC,CAAC;IACb,IAAI,CAACoB,QAAQ,iCACRpB,KAAK;MACRG,SAAS,EAAE;IAAI,GACf;IAEF,IAAI,CAACS,cAAc,EAAE;EACvB;EAEAH,sBAAsB,OAAgB;IAAA,IAAbY,SAAS,QAATA,SAAS;IAChC,MACEC,eAAe,GAGb,IAAI,CAHNA,eAAe;MACfC,mBAAmB,GAEjB,IAAI,CAFNA,mBAAmB;MACnBC,UAAU,GACR,IAAI,CADNA,UAAU;IAGZ,MAAMnB,SAAS,GAAGiB,eAAe,CAACvB,GAAG,CAACsB,SAAS,CAAC;IAEhD,IAAI,CAAChB,SAAS,IAAI,CAACmB,UAAU,CAACC,aAAa,CAACpB,SAAS,CAAC,EAAE;MACtD,IAAI,CAACa,IAAI,CAAC;QACRd,UAAU,EAAE,KAAK;QACjBC,SAAS,EAAE;MACb,CAAC,CAAC;MAEF;IACF;IAEA,MAAMqB,kBAAkB,GAAGC,qBAAqB,CAACtB,SAAS,CAAC;IAE3D,MAAMD,UAAU,GAAG,CAACwB,2BAA2B,CAC7CvB,SAAS,EACTqB,kBAAkB,EAClBH,mBAAmB,CACpB;IAED,IAAI,CAACJ,IAAI,CAAC;MACRf,UAAU;MACVC;IACF,CAAC,CAAC;EACJ;;EAEA;EACAO,cAAc,GAAG;IACf,MAAQP,SAAS,GAAK,IAAI,CAACL,KAAK,CAAxBK,SAAS;IAEjB,MAAQwB,IAAI,GAAK,IAAI,CAAbA,IAAI;IAEZ,IAAI,CAACxB,SAAS,IAAI,CAACwB,IAAI,EAAE;MACvB;IACF;IAEA,MAAQC,QAAQ,GAAK,IAAI,CAAjBA,QAAQ;IAEhB,MAAMC,SAAS,GAAGD,QAAQ,CAACE,YAAY,EAAE;MACnCC,eAAe,GAAGF,SAAS,CAACG,qBAAqB,EAAE;IAEzD,MAAMC,QAAQ,GAAG9C,WAAW,CAACgB,SAAS,CAAC+B,EAAE,EAAEL,SAAS,CAAC;IAErD,MAAMM,UAAU,GAAGF,QAAQ,CAACD,qBAAqB,EAAE;IAEnD,MAAMI,UAAU,GAAG,IAAI,CAACT,IAAI,CAACK,qBAAqB,EAAE;IAEpD,8BAAkCK,uBAAuB,CAACV,IAAI,CAAC;MAAvDW,UAAU,yBAAVA,UAAU;MAAEC,SAAS,yBAATA,SAAS;IAE7B,MAAMC,YAAY,GAAG,CAAC,CAAC;IAEvB,IAAIL,UAAU,CAACnC,IAAI,GAAImC,UAAU,CAACM,KAAK,GAAG,CAAE,GAAGV,eAAe,CAACU,KAAK,GAAG,CAAC,EAAE;MAExE;MACAD,YAAY,CAACxC,IAAI,GACd,CAAC+B,eAAe,CAAC/B,IAAI,GACpBmC,UAAU,CAACnC,IAAI,GACfoC,UAAU,CAACK,KAAK,GAChBnD,MAAM,GACNgD,UAAU,GACV,IAAI;MAERX,IAAI,CAACe,SAAS,CAACC,MAAM,CAAC,OAAO,CAAC;MAC9BhB,IAAI,CAACe,SAAS,CAACE,GAAG,CAAC,MAAM,CAAC;IAC5B,CAAC,MAAM;MAEL;MACAJ,YAAY,CAACxC,IAAI,GACd,CAAC+B,eAAe,CAAC/B,IAAI,GACpBmC,UAAU,CAACnC,IAAI,GACfmC,UAAU,CAACM,KAAK,GAChBnD,MAAM,GACNgD,UAAU,GACV,IAAI;MAERX,IAAI,CAACe,SAAS,CAACC,MAAM,CAAC,MAAM,CAAC;MAC7BhB,IAAI,CAACe,SAAS,CAACE,GAAG,CAAC,OAAO,CAAC;IAC7B;IAEA,IAAIT,UAAU,CAACpC,GAAG,GAAIoC,UAAU,CAACU,MAAM,GAAG,CAAE,GAAGd,eAAe,CAACc,MAAM,GAAG,CAAC,EAAE;MAEzE;MACAL,YAAY,CAACzC,GAAG,GACb,CAACgC,eAAe,CAAChC,GAAG,GACnBoC,UAAU,CAACpC,GAAG,GACdqC,UAAU,CAACS,MAAM,GACjBvD,MAAM,GACNiD,SAAS,GACT,IAAI;MAERZ,IAAI,CAACe,SAAS,CAACC,MAAM,CAAC,KAAK,CAAC;MAC5BhB,IAAI,CAACe,SAAS,CAACE,GAAG,CAAC,QAAQ,CAAC;IAE9B,CAAC,MAAM;MAEL;MACAJ,YAAY,CAACzC,GAAG,GACb,CAACgC,eAAe,CAAChC,GAAG,GACnBoC,UAAU,CAACpC,GAAG,GACdT,MAAM,GACNiD,SAAS,GACT,IAAI;MAERZ,IAAI,CAACe,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC;MAC/BhB,IAAI,CAACe,SAAS,CAACE,GAAG,CAAC,KAAK,CAAC;IAC3B;IAEA7D,MAAM,CAAC,IAAI,CAAC4C,IAAI,CAACmB,KAAK,EAAEN,YAAY,CAAC;EACvC;EAEAnC,OAAO,GAAG;IACR,MAAQO,QAAQ,GAAK,IAAI,CAAjBA,QAAQ;IAEhB,MAAQV,UAAU,GAAK,IAAI,CAACJ,KAAK,CAAzBI,UAAU;IAElB,IAAIA,UAAU,EAAE;MACd;IACF;IAEA,MAAQC,SAAS,GAAK,IAAI,CAAlBA,SAAS;IAEjB,MAAM4C,OAAO,GAAG5C,SAAS,CAACN,GAAG,EAAE;IAE/B,IAAI,CAACkD,OAAO,EAAE;MACZ;IACF;IAEAnC,QAAQ,CAACoC,IAAI,CAAC,iBAAiB,EAAE;MAC/BD,OAAO;MACPpB,IAAI,EAAExC,WAAW,CAAC4D,OAAO,CAACb,EAAE,EAAE,IAAI,CAACe,UAAU;IAC/C,CAAC,CAAC;IAEF,IAAI,CAACjC,IAAI,EAAE;EACb;EAEAkC,MAAM,GAAG;IACP,oBAKI,IAAI,CAACpD,KAAK;MAJZI,UAAU,eAAVA,UAAU;MACVD,SAAS,eAATA,SAAS;MACTF,GAAG,eAAHA,GAAG;MACHC,IAAI,eAAJA,IAAI;IAGN,MAAMmD,OAAO,GAAG,CACd,oBAAoB,EACpB,aAAa,CACd;IAED,IAAIjD,UAAU,EAAE;MACdiD,OAAO,CAACC,IAAI,CAAC,UAAU,CAAC;IAC1B;IAEA,OACEnD,SAAS,yBAGSkD,OAAO,CAACE,IAAI,CAAC,GAAG,CAAC,yBAMiB,eAAe;MAAA,WALnD,IAAI,CAAChD,OAAO;MAAA,SAEd;QAAEN,GAAG;QAAEC;MAAK,CAAC;MAAA,SACbE,UAAU,GACd,IAAI,CAACP,UAAU,CAAC,mDAAmD,CAAC,GACpE,IAAI,CAACA,UAAU,CAAC,MAAM;IAAC,SAJrBgC,IAAI,IAAI,IAAI,CAACA,IAAI,GAAGA,IAAI,IAK9B,IAAI;EAEd;AACF;AAEApC,yBAAyB,CAAC+D,OAAO,GAAG,CAClC,eAAe,EACf,iBAAiB,EACjB,UAAU,EACV,qBAAqB,EACrB,UAAU,EACV,WAAW,EACX,YAAY,CACb;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS7B,qBAAqB,CAAC8B,IAAI,EAAE;EACnC,OAAOA,IAAI,CAACC,cAAc,CAAChC,kBAAkB;AAC/C;AAEA,SAASE,2BAA2B,CAAC6B,IAAI,EAAE/B,kBAAkB,EAAEH,mBAAmB,EAAE;EAClF,OAAO,CAACG,kBAAkB,IACxBA,kBAAkB,KAAKiC,4BAA4B,CAACF,IAAI,EAAElC,mBAAmB,CAAC;AAClF;AAEA,SAASoC,4BAA4B,CAACF,IAAI,EAAElC,mBAAmB,EAAE;EAC/D,IAAIjC,OAAO,CAACmE,IAAI,CAACG,GAAG,CAAC,EAAE;IACrB,OAAOrC,mBAAmB,CAACsC,UAAU,CAAC,WAAW,CAAC,CAACC,KAAK;EAC1D,CAAC,MAAM,IAAIvE,QAAQ,CAACkE,IAAI,CAACG,GAAG,CAAC,EAAE;IAC7B,OAAOrC,mBAAmB,CAACsC,UAAU,CAAC,YAAY,CAAC,CAACC,KAAK;EAC3D;AACF;AAEA,SAASvB,uBAAuB,CAACV,IAAI,EAAE;EACrC,MAAMkC,cAAc,GAAG5E,UAAU,CAAC0C,IAAI,EAAE,sBAAsB,CAAC;EAE/D,IAAI,CAACkC,cAAc,EAAE;IACnB,OAAO;MACLtB,SAAS,EAAE,CAAC;MACZD,UAAU,EAAE;IACd,CAAC;EACH;EAEA,MAAQA,UAAU,GAAgBuB,cAAc,CAAxCvB,UAAU;IAAEC,SAAS,GAAKsB,cAAc,CAA5BtB,SAAS;EAE7B,OAAO;IACLA,SAAS;IACTD;EACF,CAAC;AACH"}