{"version":3,"file":"Viewer.js","names":["BaseViewer","assign","domify","remove","domRemove","TranslateModule","CoreModule","DecisionPropertiesModule","LiteralExpressionPropertiesModule","PoweredByModule","TextareaModule","ViewDrdModule","Viewer","constructor","options","container","_createContainer","renderer","_container","open","decision","self","Promise","resolve","reject","err","_decision","clear","get","fire","e","warnings","_init","modules","additionalModules","config","baseModules","getModules","extraModules","staticModules","viewer","allModules","on","event","priority","callback","target","off","_emit","type","getDecision","attachTo","parentNode","Error","detach","appendChild","destroy","_getModules"],"sources":["../src/Viewer.js"],"sourcesContent":["import BaseViewer from 'dmn-js-shared/lib/base/viewer/Viewer';\r\n\r\nimport {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  domify,\r\n  remove as domRemove\r\n} from 'min-dom';\r\n\r\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\r\n\r\nimport CoreModule from './core';\r\nimport DecisionPropertiesModule from './features/decision-properties';\r\nimport LiteralExpressionPropertiesModule from './features/literal-expression-properties';\r\nimport PoweredByModule from './features/powered-by';\r\nimport TextareaModule from './features/textarea';\r\nimport ViewDrdModule from './features/view-drd';\r\n\r\n/**\r\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\r\n */\r\n\r\n/**\r\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\r\n */\r\n\r\n\r\nexport default class Viewer extends BaseViewer {\r\n\r\n  constructor(options = {}) {\r\n    const container = Viewer._createContainer();\r\n\r\n    super(assign(options, {\r\n      renderer: {\r\n        container\r\n      }\r\n    }));\r\n\r\n    this._container = container;\r\n  }\r\n\r\n  /**\r\n   * Open diagram element.\r\n   *\r\n   * @param  {ModdleElement} decision\r\n   * @returns {Promise} Resolves with {OpenResult} when successful\r\n   * or rejects with {OpenError}\r\n   */\r\n  open(decision) {\r\n    var self = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      var err;\r\n\r\n      // use try/catch to not swallow synchronous exceptions\r\n      // that may be raised during model parsing\r\n      try {\r\n\r\n        if (self._decision) {\r\n\r\n          // clear existing literal expression\r\n          self.clear();\r\n\r\n          // unmount first\r\n          self.get('eventBus').fire('renderer.unmount');\r\n        }\r\n\r\n        // update literal expression\r\n        self._decision = decision;\r\n\r\n        // let others know about import\r\n        self.get('eventBus').fire('import', decision);\r\n\r\n        self.get('eventBus').fire('renderer.mount');\r\n      } catch (e) {\r\n        err = e;\r\n      }\r\n\r\n      // handle synchronously thrown exception\r\n      if (err) {\r\n        err.warnings = err.warnings || [];\r\n        reject(err);\r\n      } else {\r\n        resolve({ warnings: [] });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the literal expression, returning { modules: [], config }.\r\n   *\r\n   * @param  {Object} options\r\n   *\r\n   * @return {Object} init config\r\n   */\r\n  _init(options) {\r\n\r\n    let {\r\n      modules,\r\n      additionalModules,\r\n      ...config\r\n    } = options;\r\n\r\n    let baseModules = modules || this.getModules();\r\n    let extraModules = additionalModules || [];\r\n    let staticModules = [\r\n      {\r\n        viewer: [ 'value', this ]\r\n      }\r\n    ];\r\n\r\n    let allModules = [\r\n      ...baseModules,\r\n      ...extraModules,\r\n      ...staticModules\r\n    ];\r\n\r\n    return {\r\n      modules: allModules,\r\n      config\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register an event listener\r\n   *\r\n   * Remove a previously added listener via {@link #off(event, callback)}.\r\n   *\r\n   * @param {string} event\r\n   * @param {number} [priority]\r\n   * @param {Function} callback\r\n   * @param {Object} [that]\r\n   */\r\n  on(event, priority, callback, target) {\r\n    return this.get('eventBus').on(event, priority, callback, target);\r\n  }\r\n\r\n  /**\r\n   * De-register an event listener\r\n   *\r\n   * @param {string} event\r\n   * @param {Function} callback\r\n   */\r\n  off(event, callback) {\r\n    this.get('eventBus').off(event, callback);\r\n  }\r\n\r\n  /**\r\n   * Emit an event on the underlying {@link EventBus}\r\n   *\r\n   * @param  {string} type\r\n   * @param  {Object} event\r\n   *\r\n   * @return {Object} event processing result (if any)\r\n   */\r\n  _emit(type, event) {\r\n    return this.get('eventBus').fire(type, event);\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed decision.\r\n   *\r\n   * @return {ModdleElement}\r\n   */\r\n  getDecision() {\r\n    return this._decision;\r\n  }\r\n\r\n  /**\r\n   * Attach viewer to given parent node.\r\n   *\r\n   * @param  {Element} parentNode\r\n   */\r\n  attachTo(parentNode) {\r\n\r\n    if (!parentNode) {\r\n      throw new Error('parentNode required');\r\n    }\r\n\r\n    // ensure we detach from the\r\n    // previous, old parent\r\n    this.detach();\r\n\r\n    parentNode.appendChild(this._container);\r\n\r\n    this._emit('attach', {});\r\n  }\r\n\r\n  /**\r\n   * Detach viewer from parent node, if attached.\r\n   */\r\n  detach() {\r\n\r\n    const container = this._container,\r\n          parentNode = container.parentNode;\r\n\r\n    if (!parentNode) {\r\n      return;\r\n    }\r\n\r\n    this._emit('detach', {});\r\n\r\n    domRemove(container);\r\n  }\r\n\r\n  destroy() {\r\n    super.destroy();\r\n\r\n    this.detach();\r\n  }\r\n\r\n  getModules() {\r\n    return Viewer._getModules();\r\n  }\r\n\r\n  static _getModules() {\r\n    return [\r\n      CoreModule,\r\n      TranslateModule,\r\n      DecisionPropertiesModule,\r\n      LiteralExpressionPropertiesModule,\r\n      PoweredByModule,\r\n      TextareaModule,\r\n      ViewDrdModule\r\n    ];\r\n  }\r\n\r\n  static _createContainer() {\r\n    return domify(\r\n      '<div class=\"dmn-literal-expression-container\"></div>'\r\n    );\r\n  }\r\n\r\n}\r\n"],"mappings":"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"}