{"version":3,"file":"DrdRenderer.js","names":["inherits","Ids","isObject","assign","attr","domAttr","query","domQuery","append","svgAppend","svgAttr","create","svgCreate","BaseRenderer","createLine","is","getName","RENDERER_IDS","black","DrdRenderer","config","eventBus","pathMap","styles","textRenderer","canvas","call","rendererId","next","computeStyle","markers","defaultFillColor","defaultStrokeColor","defaultLabelColor","marker","type","fill","stroke","id","colorEscape","createMarker","addMarker","options","attrs","strokeWidth","strokeLinecap","strokeDasharray","ref","x","y","scale","element","viewBox","refX","refY","markerWidth","markerHeight","orient","defs","_svg","associationStart","d","associationEnd","informationRequirementEnd","knowledgeRequirementEnd","authorityRequirementEnd","cx","cy","r","drawRect","p","width","height","offset","rect","rx","ry","renderLabel","label","text","createText","renderEmbeddedLabel","align","name","box","padding","style","getLabelColor","drawPath","path","handlers","getStrokeColor","getFillColor","pathData","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","containerHeight","position","mx","my","knowledgeSource","businessKnowledge","textElement","textPathData","getSemantic","semantic","strokeLinejoin","associationDirection","markerEnd","markerStart","drawLine","waypoints","drawShape","parent","h","prototype","apply","drawConnection","line","canRender","$inject","businessObject","str","replace","defaultColor"],"sources":["../../src/draw/DrdRenderer.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport Ids from 'ids';\n\nimport {\n  isObject,\n  assign\n} from 'min-dash';\n\nimport {\n  attr as domAttr,\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';\n\nimport {\n  createLine\n} from 'diagram-js/lib/util/RenderUtil';\n\nimport {\n  is,\n  getName\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nvar RENDERER_IDS = new Ids();\n\nvar black = 'hsl(225, 10%, 15%)';\n\n/**\n * Renderer for the DRD view. The default colors are configurable.\n * When default label color is not provided, it will take the default\n * stroke color.\n *\n * @example\n * ```javascript\n * // for simple DRD viewer\n * const viewer = new DrdViewer({\n *   drdRenderer: {\n *     defaultFillColor: '#ffd700',\n *     defaultStrokeColor: '#0057b8',\n *     defaultLabelColor: '#0057b8'\n *   }\n * });\n *\n * // in dmn-js\n * const modeler = new DmnModeler({\n *   drd: {\n *     drdRenderer: {\n *       defaultFillColor: '#ffd700',\n *       defaultStrokeColor: '#0057b8',\n *       defaultLabelColor: '#0057b8'\n *     }\n *   }\n * });\n * ```\n */\nexport default function DrdRenderer(\n    config, eventBus, pathMap, styles, textRenderer, canvas) {\n\n  BaseRenderer.call(this, eventBus);\n\n  var rendererId = RENDERER_IDS.next();\n\n  var computeStyle = styles.computeStyle;\n\n  var markers = {};\n\n  var defaultFillColor = config && config.defaultFillColor || 'white',\n      defaultStrokeColor = config && config.defaultStrokeColor || black,\n      defaultLabelColor = config && config.defaultLabelColor;\n\n  function marker(type, fill, stroke) {\n    var id = type + '-' + colorEscape(fill) +\n      '-' + colorEscape(stroke) + '-' + rendererId;\n\n    if (!markers[id]) {\n      createMarker(id, type, fill, stroke);\n    }\n\n    return 'url(#' + id + ')';\n  }\n\n  function addMarker(id, options) {\n    var attrs = assign({\n      strokeWidth: 1,\n      strokeLinecap: 'round',\n      strokeDasharray: 'none'\n    }, options.attrs);\n\n    var ref = options.ref || { x: 0, y: 0 };\n\n    var scale = options.scale || 1;\n\n    // fix for safari / chrome / firefox bug not correctly\n    // resetting stroke dash array\n    if (attrs.strokeDasharray === 'none') {\n      attrs.strokeDasharray = [ 10000, 1 ];\n    }\n\n    var marker = svgCreate('marker');\n\n    svgAttr(options.element, attrs);\n\n    svgAppend(marker, options.element);\n\n    svgAttr(marker, {\n      id: id,\n      viewBox: '0 0 20 20',\n      refX: ref.x,\n      refY: ref.y,\n      markerWidth: 20 * scale,\n      markerHeight: 20 * scale,\n      orient: 'auto'\n    });\n\n    var defs = domQuery('defs', canvas._svg);\n\n    if (!defs) {\n      defs = svgCreate('defs');\n\n      svgAppend(canvas._svg, defs);\n    }\n\n    svgAppend(defs, marker);\n\n    markers[id] = marker;\n  }\n\n  function createMarker(id, type, fill, stroke) {\n\n    if (type === 'association-start') {\n      var associationStart = svgCreate('path');\n      svgAttr(associationStart, { d: 'M 11 5 L 1 10 L 11 15' });\n\n      addMarker(id, {\n        element: associationStart,\n        attrs: {\n          fill: 'none',\n          stroke: stroke,\n          strokeWidth: 1.5\n        },\n        ref: { x: 1, y: 10 },\n        scale: 0.5\n      });\n\n    } else if (type === 'association-end') {\n      var associationEnd = svgCreate('path');\n      svgAttr(associationEnd, { d: 'M 1 5 L 11 10 L 1 15' });\n\n      addMarker(id, {\n        element: associationEnd,\n        attrs: {\n          fill: 'none',\n          stroke: stroke,\n          strokeWidth: 1.5\n        },\n        ref: { x: 12, y: 10 },\n        scale: 0.5\n      });\n    } else if (type === 'information-requirement-end') {\n      var informationRequirementEnd = svgCreate('path');\n      svgAttr(informationRequirementEnd, { d: 'M 1 5 L 11 10 L 1 15 Z' });\n\n      addMarker(id, {\n        element: informationRequirementEnd,\n        attrs: {\n          fill: stroke,\n          stroke: 'none'\n        },\n        ref: { x: 11, y: 10 },\n        scale: 1\n      });\n    } else if (type === 'knowledge-requirement-end') {\n      var knowledgeRequirementEnd = svgCreate('path');\n      svgAttr(knowledgeRequirementEnd, { d: 'M 1 3 L 11 10 L 1 17' });\n\n      addMarker(id, {\n        element: knowledgeRequirementEnd,\n        attrs: {\n          fill: 'none',\n          stroke: stroke,\n          strokeWidth: 2\n        },\n        ref: { x: 11, y: 10 },\n        scale: 0.8\n      });\n    } else if (type === 'authority-requirement-end') {\n      var authorityRequirementEnd = svgCreate('circle');\n      svgAttr(authorityRequirementEnd, { cx: 3, cy: 3, r: 3 });\n\n      addMarker(id, {\n        element: authorityRequirementEnd,\n        attrs: {\n          fill: stroke,\n          stroke: 'none'\n        },\n        ref: { x: 3, y: 3 },\n        scale: 0.9\n      });\n    }\n  }\n\n  function drawRect(p, width, height, r, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = computeStyle(attrs, {\n      stroke: black,\n      strokeWidth: 2,\n      fill: 'white'\n    });\n\n    var rect = svgCreate('rect');\n    svgAttr(rect, {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r\n    });\n    svgAttr(rect, attrs);\n\n    svgAppend(p, rect);\n\n    return rect;\n  }\n\n  function renderLabel(p, label, options) {\n    var text = textRenderer.createText(label || '', options);\n\n    domAttr(text, 'class', 'djs-label');\n\n    svgAppend(p, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(p, element, align, options) {\n    var name = getName(element);\n\n    options = assign({\n      box: element,\n      align: align,\n      padding: 5,\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor)\n      }\n    }, options);\n\n    return renderLabel(p, name, options);\n  }\n\n  function drawPath(p, d, attrs) {\n\n    attrs = computeStyle(attrs, [ 'no-fill' ], {\n      strokeWidth: 2,\n      stroke: black\n    });\n\n    var path = svgCreate('path');\n    svgAttr(path, { d: d });\n    svgAttr(path, attrs);\n\n    svgAppend(p, path);\n\n    return path;\n  }\n\n\n  var handlers = {\n    'dmn:Decision': function(p, element) {\n      var rect = drawRect(p, element.width, element.height, 0, {\n        stroke: getStrokeColor(element, defaultStrokeColor),\n        fill: getFillColor(element, defaultFillColor)\n      });\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return rect;\n    },\n    'dmn:KnowledgeSource': function(p, element) {\n\n      var pathData = pathMap.getScaledPath('KNOWLEDGE_SOURCE', {\n        xScaleFactor: 1.021,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.075\n        }\n      });\n\n      var knowledgeSource = drawPath(p, pathData, {\n        strokeWidth: 2,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor)\n      });\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return knowledgeSource;\n    },\n    'dmn:BusinessKnowledgeModel': function(p, element) {\n\n      var pathData = pathMap.getScaledPath('BUSINESS_KNOWLEDGE_MODEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.3\n        }\n      });\n\n      var businessKnowledge = drawPath(p, pathData, {\n        strokeWidth: 2,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor)\n      });\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return businessKnowledge;\n    },\n    'dmn:InputData': function(p, element) {\n\n      var rect = drawRect(p, element.width, element.height, 22, {\n        stroke: getStrokeColor(element, defaultStrokeColor),\n        fill: getFillColor(element, defaultFillColor)\n      });\n\n      renderEmbeddedLabel(p, element, 'center-middle');\n\n      return rect;\n    },\n    'dmn:TextAnnotation': function(p, element) {\n      var style = {\n        'fill': 'none',\n        'stroke': 'none'\n      };\n\n      var textElement = drawRect(p, element.width, element.height, 0, 0, style);\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      drawPath(p, textPathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      var text = getSemantic(element).text || '';\n\n      renderLabel(p, text, {\n        style: {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor)\n        },\n        box: element,\n        align: 'left-top',\n        padding: 5\n      });\n\n      return textElement;\n    },\n    'dmn:Association': function(p, element) {\n      var semantic = getSemantic(element);\n\n      var fill = getFillColor(element, defaultFillColor),\n          stroke = getStrokeColor(element, defaultStrokeColor),\n          attrs = {\n            stroke: stroke,\n            strokeDasharray: '0.5, 5',\n            strokeLinecap: 'round',\n            strokeLinejoin: 'round',\n            fill: 'none'\n          };\n\n      if (semantic.associationDirection === 'One' ||\n          semantic.associationDirection === 'Both') {\n        attrs.markerEnd = marker('association-end', fill, stroke);\n      }\n\n      if (semantic.associationDirection === 'Both') {\n        attrs.markerStart = marker('association-start', fill, stroke);\n      }\n\n      return drawLine(p, element.waypoints, attrs);\n    },\n    'dmn:InformationRequirement': function(p, element) {\n\n      var fill = getFillColor(element, defaultFillColor),\n          stroke = getStrokeColor(element, defaultStrokeColor),\n          attrs = {\n            stroke: stroke,\n            strokeWidth: 1,\n            strokeLinecap: 'round',\n            strokeLinejoin: 'round',\n            markerEnd: marker('information-requirement-end', fill, stroke)\n          };\n\n      return drawLine(p, element.waypoints, attrs);\n    },\n    'dmn:KnowledgeRequirement': function(p, element) {\n\n      var fill = getFillColor(element, defaultFillColor),\n          stroke = getStrokeColor(element, defaultStrokeColor);\n      var attrs = {\n        stroke: stroke,\n        strokeWidth: 1,\n        strokeDasharray: 5,\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        markerEnd: marker('knowledge-requirement-end', fill, stroke)\n      };\n\n      return drawLine(p, element.waypoints, attrs);\n    },\n    'dmn:AuthorityRequirement': function(p, element) {\n\n      var fill = getFillColor(element, defaultFillColor),\n          stroke = getStrokeColor(element, defaultStrokeColor),\n          attrs = {\n            stroke: stroke,\n            strokeWidth: 1.5,\n            strokeDasharray: 5,\n            strokeLinecap: 'round',\n            strokeLinejoin: 'round',\n            markerEnd: marker('authority-requirement-end', fill, stroke)\n          };\n\n      return drawLine(p, element.waypoints, attrs);\n    }\n  };\n\n\n  // draw shape and connection //////////////////\n\n  function drawShape(parent, element) {\n    var h = handlers[element.type];\n\n    if (!h) {\n      return BaseRenderer.prototype.drawShape.apply(this, [ parent, element ]);\n    } else {\n      return h(parent, element);\n    }\n  }\n\n  function drawConnection(parent, element) {\n    var type = element.type;\n    var h = handlers[type];\n\n    if (!h) {\n      return BaseRenderer.prototype.drawConnection.apply(this, [ parent, element ]);\n    } else {\n      return h(parent, element);\n    }\n  }\n\n  function drawLine(p, waypoints, attrs) {\n    attrs = computeStyle(attrs, [ 'no-fill' ], {\n      stroke: black,\n      strokeWidth: 2,\n      fill: 'none'\n    });\n\n    var line = createLine(waypoints, attrs);\n\n    svgAppend(p, line);\n\n    return line;\n  }\n\n  this.canRender = function(element) {\n    return is(element, 'dmn:DMNElement') ||\n           is(element, 'dmn:InformationRequirement') ||\n           is(element, 'dmn:KnowledgeRequirement') ||\n           is(element, 'dmn:AuthorityRequirement');\n  };\n\n  this.drawShape = drawShape;\n  this.drawConnection = drawConnection;\n}\n\ninherits(DrdRenderer, BaseRenderer);\n\nDrdRenderer.$inject = [\n  'config.drdRenderer',\n  'eventBus',\n  'pathMap',\n  'styles',\n  'textRenderer',\n  'canvas'\n];\n\n\n// helper functions //////////////////////\n\nfunction getSemantic(element) {\n  return element.businessObject;\n}\n\nfunction colorEscape(str) {\n\n  // only allow characters and numbers\n  return str.replace(/[^0-9a-zA-z]+/g, '_');\n}\n\nfunction getStrokeColor(element, defaultColor) {\n  return defaultColor;\n}\n\nfunction getFillColor(element, defaultColor) {\n  return defaultColor;\n}\n\nfunction getLabelColor(element, defaultColor, defaultStrokeColor) {\n  return defaultColor || getStrokeColor(element, defaultStrokeColor);\n}"],"mappings":"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"}