{"version":3,"file":"PathMap.js","names":["PathMap","pathMap","d","width","height","widthElements","heightElements","getRawPath","pathId","getScaledPath","param","rawPath","mx","my","abspos","x","y","containerWidth","position","containerHeight","coordinates","heightRatio","yScaleFactor","widthRatio","xScaleFactor","heightIndex","length","widthIndex","path","format","e","tokenRegex","objNotationRegex","replacer","all","key","obj","res","replace","name","quote","quotedName","isFunc","str","String"],"sources":["../../src/draw/PathMap.js"],"sourcesContent":["/* eslint-disable max-len */\n\n/**\n * Map containing SVG paths needed by BpmnRenderer.\n */\n\nexport default function PathMap() {\n\n  /**\n   * Contains a map of path elements\n   *\n   * <h1>Path definition</h1>\n   * A parameterized path is defined like this:\n   * <pre>\n   * 'GATEWAY_PARALLEL': {\n   *   d: 'm {mx},{my} {e.x0},0 0,{e.x1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n          '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n   *   height: 17.5,\n   *   width:  17.5,\n   *   heightElements: [2.5, 7.5],\n   *   widthElements: [2.5, 7.5]\n   * }\n   * </pre>\n   * <p>It's important to specify a correct <b>height and width</b> for the path as the scaling\n   * is based on the ratio between the specified height and width in this object and the\n   * height and width that is set as scale target (Note x,y coordinates will be scaled with\n   * individual ratios).</p>\n   * <p>The '<b>heightElements</b>' and '<b>widthElements</b>' array must contain the values that will be scaled.\n   * The scaling is based on the computed ratios.\n   * Coordinates on the y axis should be in the <b>heightElement</b>'s array, they will be scaled using\n   * the computed ratio coefficient.\n   * In the parameterized path the scaled values can be accessed through the 'e' object in {} brackets.\n   *   <ul>\n   *    <li>The values for the y axis can be accessed in the path string using {e.y0}, {e.y1}, ....</li>\n   *    <li>The values for the x axis can be accessed in the path string using {e.x0}, {e.x1}, ....</li>\n   *   </ul>\n   *   The numbers x0, x1 respectively y0, y1, ... map to the corresponding array index.\n   * </p>\n    m1,1\n    l 0,55.3\n    c 29.8,19.7 48.4,-4.2 67.2,-6.7\n    c 12.2,-2.3 19.8,1.6 30.8,6.2\n    l 0,-54.6\n    z\n    */\n  this.pathMap = {\n    'KNOWLEDGE_SOURCE': {\n      d: 'm {mx},{my} ' +\n         'l 0,{e.y0} ' +\n         'c {e.x0},{e.y1} {e.x1},-{e.y2} {e.x2},-{e.y3} ' +\n         'c {e.x3},-{e.y4} {e.x4},{e.y5} {e.x5},{e.y6} ' +\n         'l 0,-{e.y7}z',\n      width:  100,\n      height: 65,\n      widthElements: [ 29.8, 48.4, 67.2, 12.2, 19.8, 30.8 ],\n      heightElements: [ 55.3, 19.7, 4.2, 6.7, 2.3, 1.6, 6.2, 54.6 ]\n    },\n    'BUSINESS_KNOWLEDGE_MODEL': {\n      d: 'm {mx},{my} l {e.x0},-{e.y0} l {e.x1},0 l 0,{e.y1} l -{e.x2},{e.y2} l -{e.x3},0z',\n      width:  125,\n      height: 45,\n      widthElements: [ 13.8, 109.2, 13.8, 109.1 ],\n      heightElements: [ 13.2, 29.8, 13.2 ]\n    },\n    'TEXT_ANNOTATION': {\n      d: 'm {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0',\n      width: 10,\n      height: 30,\n      widthElements: [ 10 ],\n      heightElements: [ 30 ]\n    }\n  };\n\n  this.getRawPath = function getRawPath(pathId) {\n    return this.pathMap[pathId].d;\n  };\n\n  /**\n   * Scales the path to the given height and width.\n   * <h1>Use case</h1>\n   * <p>Use case is to scale the content of elements (event, gateways) based\n   * on the element bounding box's size.\n   * </p>\n   * <h1>Why not transform</h1>\n   * <p>Scaling a path with transform() will also scale the stroke and IE does not support\n   * the option 'non-scaling-stroke' to prevent this.\n   * Also there are use cases where only some parts of a path should be\n   * scaled.</p>\n   *\n   * @param {string} pathId The ID of the path.\n   * @param {Object} param <p>\n   *   Example param object scales the path to 60% size of the container (data.width, data.height).\n   *   <pre>\n   *   {\n   *     xScaleFactor: 0.6,\n   *     yScaleFactor:0.6,\n   *     containerWidth: data.width,\n   *     containerHeight: data.height,\n   *     position: {\n   *       mx: 0.46,\n   *       my: 0.2,\n   *     }\n   *   }\n   *   </pre>\n   *   <ul>\n   *    <li>targetpathwidth = xScaleFactor * containerWidth</li>\n   *    <li>targetpathheight = yScaleFactor * containerHeight</li>\n   *    <li>Position is used to set the starting coordinate of the path. M is computed:\n    *    <ul>\n    *      <li>position.x * containerWidth</li>\n    *      <li>position.y * containerHeight</li>\n    *    </ul>\n    *    Center of the container <pre> position: {\n   *       mx: 0.5,\n   *       my: 0.5,\n   *     }</pre>\n   *     Upper left corner of the container\n   *     <pre> position: {\n   *       mx: 0.0,\n   *       my: 0.0,\n   *     }</pre>\n   *    </li>\n   *   </ul>\n   * </p>\n   *\n   */\n  this.getScaledPath = function getScaledPath(pathId, param) {\n    var rawPath = this.pathMap[pathId];\n\n    // positioning\n    // compute the start point of the path\n    var mx, my;\n\n    if (param.abspos) {\n      mx = param.abspos.x;\n      my = param.abspos.y;\n    } else {\n      mx = param.containerWidth * param.position.mx;\n      my = param.containerHeight * param.position.my;\n    }\n\n    var coordinates = {}; // map for the scaled coordinates\n    if (param.position) {\n\n      // path\n      var heightRatio = (param.containerHeight / rawPath.height) * param.yScaleFactor;\n      var widthRatio = (param.containerWidth / rawPath.width) * param.xScaleFactor;\n\n\n      // Apply height ratio\n      for (var heightIndex = 0; heightIndex < rawPath.heightElements.length; heightIndex++) {\n        coordinates['y' + heightIndex] = rawPath.heightElements[heightIndex] * heightRatio;\n      }\n\n      // Apply width ratio\n      for (var widthIndex = 0; widthIndex < rawPath.widthElements.length; widthIndex++) {\n        coordinates['x' + widthIndex] = rawPath.widthElements[widthIndex] * widthRatio;\n      }\n    }\n\n    // Apply value to raw path\n    var path = format(\n      rawPath.d, {\n        mx: mx,\n        my: my,\n        e: coordinates\n      }\n    );\n    return path;\n  };\n}\n\n\n// helpers //////////////////////\n\n// copied and adjusted from https://github.com/adobe-webplatform/Snap.svg/blob/master/src/svg.js\nvar tokenRegex = /\\{([^{}]+)\\}/g,\n    objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g; // matches .xxxxx or [\"xxxxx\"] to run over object properties\n\nfunction replacer(all, key, obj) {\n  var res = obj;\n  key.replace(objNotationRegex, function(all, name, quote, quotedName, isFunc) {\n    name = name || quotedName;\n    if (res) {\n      if (name in res) {\n        res = res[name];\n      }\n      typeof res == 'function' && isFunc && (res = res());\n    }\n  });\n  res = (res == null || res == obj ? all : res) + '';\n\n  return res;\n}\n\nfunction format(str, obj) {\n  return String(str).replace(tokenRegex, function(all, key) {\n    return replacer(all, key, obj);\n  });\n}\n"],"mappings":"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"}