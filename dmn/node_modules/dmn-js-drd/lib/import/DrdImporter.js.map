{"version":3,"file":"DrdImporter.js","names":["assign","map","is","DrdImporter","eventBus","canvas","elementFactory","elementRegistry","_eventBus","_canvas","_elementRegistry","_elementFactory","$inject","prototype","root","semantic","element","createRoot","elementData","setRootElement","add","di","waypoints","source","target","elementDefinition","bounds","$instanceOf","x","Math","round","y","width","height","createShape","addShape","fire","collectWaypoints","_getSource","_getTarget","hidden","createConnection","addConnection","Error","id","href","elementReference","sourceRef","requiredDecision","requiredInput","requiredKnowledge","requiredAuthority","_getShape","getIdFromHref","targetRef","$parent","get","attrs","type","$type","businessObject","edge","waypoint","position","original","split","pop"],"sources":["../../src/import/DrdImporter.js"],"sourcesContent":["import {\n  assign,\n  map\n} from 'min-dash';\n\nimport {\n  is\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\n\nexport default function DrdImporter(\n    eventBus,\n    canvas,\n    elementFactory,\n    elementRegistry) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementRegistry = elementRegistry;\n  this._elementFactory = elementFactory;\n}\n\nDrdImporter.$inject = [\n  'eventBus',\n  'canvas',\n  'elementFactory',\n  'elementRegistry'\n];\n\n\nDrdImporter.prototype.root = function(semantic) {\n  var element = this._elementFactory.createRoot(elementData(semantic));\n\n  this._canvas.setRootElement(element);\n\n  return element;\n};\n\n/**\n * Add drd element (semantic) to the canvas.\n */\nDrdImporter.prototype.add = function(semantic) {\n  var elementFactory = this._elementFactory,\n      canvas = this._canvas,\n      eventBus = this._eventBus,\n      di = semantic.di;\n\n  var element, waypoints, source, target, elementDefinition, bounds;\n\n  if (di.$instanceOf('dmndi:DMNShape')) {\n    bounds = di.bounds;\n\n    elementDefinition = elementData(semantic, {\n      x: Math.round(bounds.x),\n      y: Math.round(bounds.y),\n      width: Math.round(bounds.width),\n      height: Math.round(bounds.height)\n    });\n\n    element = elementFactory.createShape(elementDefinition);\n\n    canvas.addShape(element);\n\n    eventBus.fire('drdElement.added', { element: element, di: di });\n\n  } else if (di.$instanceOf('dmndi:DMNEdge')) {\n    waypoints = collectWaypoints(di);\n\n    source = this._getSource(semantic);\n    target = this._getTarget(semantic);\n\n    if (source && target) {\n      elementDefinition = elementData(semantic, {\n        hidden: false,\n        source: source,\n        target: target,\n        waypoints: waypoints\n      });\n\n      element = elementFactory.createConnection(elementDefinition);\n\n      canvas.addConnection(element);\n\n      eventBus.fire('drdElement.added', { element: element, di: di });\n    }\n\n  } else {\n    throw new Error('unknown di for element ' + semantic.id);\n  }\n\n  return element;\n};\n\nDrdImporter.prototype._getSource = function(semantic) {\n  var href, elementReference;\n\n  if (is(semantic, 'dmn:Association')) {\n    elementReference = semantic.sourceRef;\n  } else if (is(semantic, 'dmn:InformationRequirement')) {\n    elementReference = semantic.requiredDecision || semantic.requiredInput;\n  } else if (is(semantic, 'dmn:KnowledgeRequirement')) {\n    elementReference = semantic.requiredKnowledge;\n  } else if (is(semantic, 'dmn:AuthorityRequirement')) {\n    elementReference = semantic.requiredDecision ||\n      semantic.requiredInput || semantic.requiredAuthority;\n  }\n\n  if (elementReference) {\n    href = elementReference.href;\n  }\n\n  if (href) {\n    return this._getShape(getIdFromHref(href));\n  }\n};\n\nDrdImporter.prototype._getTarget = function(semantic) {\n  if (is(semantic, 'dmn:Association')) {\n    return semantic.targetRef && this._getShape(getIdFromHref(semantic.targetRef.href));\n  }\n\n  return this._getShape(semantic.$parent.id);\n};\n\nDrdImporter.prototype._getShape = function(id) {\n  return this._elementRegistry.get(id);\n};\n\n\n\n// helper /////\nfunction elementData(semantic, attrs) {\n  return assign({\n    id: semantic.id,\n    type: semantic.$type,\n    businessObject: semantic\n  }, attrs);\n}\n\nfunction collectWaypoints(edge) {\n  var waypoints = edge.waypoint;\n\n  if (waypoints) {\n    return map(waypoints, function(waypoint) {\n      var position = { x: waypoint.x, y: waypoint.y };\n\n      return assign({ original: position }, position);\n    });\n  }\n}\n\nfunction getIdFromHref(href) {\n  return href.split('#').pop();\n}\n"],"mappings":"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"}