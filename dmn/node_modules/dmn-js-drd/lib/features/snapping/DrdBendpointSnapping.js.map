{"version":3,"file":"DrdBendpointSnapping.js","names":["asTRBL","getMid","getOrientation","isAny","RECONNECT_START","RECONNECT_END","HIGH_PRIORITY","DrdBendpointSnapping","eventBus","on","event","context","allowed","hover","source","target","type","hints","connectionStart","connectionEnd","reconnect","orientation","snapToSource","getConnectionEnd","getConnectionStart","snapToTarget","$inject","sourceTrbl","includes","y","top","bottom","x","left","right","targetTrbl","dx","dy"],"sources":["../../../src/features/snapping/DrdBendpointSnapping.js"],"sourcesContent":["import {\r\n  asTRBL,\r\n  getMid,\r\n  getOrientation\r\n} from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\nimport {\r\n  isAny\r\n} from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nvar RECONNECT_START = 'reconnectStart',\r\n    RECONNECT_END = 'reconnectEnd';\r\n\r\nvar HIGH_PRIORITY = 2000;\r\n\r\n\r\nexport default function DrdBendpointSnapping(eventBus) {\r\n  eventBus.on([\r\n    'bendpoint.move.move',\r\n    'bendpoint.move.end'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        allowed = context.allowed,\r\n        hover = context.hover,\r\n        source = context.source,\r\n        target = context.target,\r\n        type = context.type;\r\n\r\n    if (!context.hints) {\r\n      context.hints = {};\r\n    }\r\n\r\n    delete context.hints.connectionStart;\r\n    delete context.hints.connectionEnd;\r\n\r\n    if (allowed && allowed.type !== 'dmn:InformationRequirement') {\r\n      return;\r\n    }\r\n\r\n    if (!hover || !isAny(hover, [ 'dmn:Decision', 'dmn:InputData' ])) {\r\n      return;\r\n    }\r\n\r\n    if (source === target) {\r\n      return;\r\n    }\r\n\r\n    var reconnect = type === RECONNECT_START || type === RECONNECT_END;\r\n\r\n    var orientation = getOrientation(source, target);\r\n\r\n    if (reconnect && hover === source) {\r\n\r\n      // (1) snap event to source\r\n      snapToSource(event, orientation);\r\n\r\n      // (2) set connection end to target\r\n      context.hints.connectionEnd = getConnectionEnd(target, orientation);\r\n    } else if (reconnect && hover === target) {\r\n\r\n      // (1) set connection start to source\r\n      context.hints.connectionStart = getConnectionStart(source, orientation);\r\n\r\n      // (2) snap event to target\r\n      snapToTarget(event, orientation);\r\n    }\r\n  });\r\n}\r\n\r\nDrdBendpointSnapping.$inject = [ 'eventBus' ];\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction getConnectionStart(source, orientation) {\r\n  var sourceTrbl = asTRBL(source);\r\n\r\n  var connectionStart = getMid(source);\r\n\r\n  if (orientation.includes('bottom')) {\r\n    connectionStart.y = sourceTrbl.top;\r\n  } else if (orientation.includes('top')) {\r\n    connectionStart.y = sourceTrbl.bottom;\r\n  } else if (orientation.includes('right')) {\r\n    connectionStart.x = sourceTrbl.left;\r\n  } else {\r\n    connectionStart.x = sourceTrbl.right;\r\n  }\r\n\r\n  return connectionStart;\r\n}\r\n\r\nfunction getConnectionEnd(target, orientation) {\r\n  var targetTrbl = asTRBL(target);\r\n\r\n  var connectionEnd = getMid(target);\r\n\r\n  if (orientation.includes('bottom')) {\r\n    connectionEnd.y = targetTrbl.bottom;\r\n  } else if (orientation.includes('top')) {\r\n    connectionEnd.y = targetTrbl.top;\r\n  } else if (orientation.includes('right')) {\r\n    connectionEnd.x = targetTrbl.right;\r\n  } else {\r\n    connectionEnd.x = targetTrbl.left;\r\n  }\r\n\r\n  return connectionEnd;\r\n}\r\n\r\nfunction snapToSource(event, orientation) {\r\n  var context = event.context,\r\n      source = context.source;\r\n\r\n  var connectionStart = getConnectionStart(source, orientation);\r\n\r\n  var dx = event.x - connectionStart.x,\r\n      dy = event.y - connectionStart.y;\r\n\r\n  event.x -= dx;\r\n  event.y -= dy;\r\n\r\n  event.dx -= dx;\r\n  event.dy -= dy;\r\n}\r\n\r\nfunction snapToTarget(event, orientation) {\r\n  var context = event.context,\r\n      target = context.target;\r\n\r\n  var connectionEnd = getConnectionEnd(target, orientation);\r\n\r\n  var dx = 0,\r\n      dy = 0;\r\n\r\n  if (orientation.includes('top') || orientation.includes('bottom')) {\r\n    dy = event.y - connectionEnd.y;\r\n  } else {\r\n    dx = event.x - connectionEnd.x;\r\n  }\r\n\r\n  event.x -= dx;\r\n  event.y -= dy;\r\n\r\n  event.dx -= dx;\r\n  event.dy -= dy;\r\n}"],"mappings":"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"}