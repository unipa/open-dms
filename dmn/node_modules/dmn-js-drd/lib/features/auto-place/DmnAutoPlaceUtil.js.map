{"version":3,"file":"DmnAutoPlaceUtil.js","names":["is","findFreePosition","generateGetNextPosition","getConnectedDistance","asTRBL","getMid","DECISION_SIZE","DIRECTION_LEFT","DIRECTION_RIGHT","DRG_ELEMENT_MARGIN","DRG_ELEMENT_ROW_SIZE","width","getNewShapePosition","source","element","getTextAnnotationPosition","getDRGElementPosition","sourceTrbl","position","x","right","y","top","height","nextPositionDirection","margin","minDistance","sourceMid","getWeight","connection","target","verticalDistance","defaultDistance","direction","filter","reference","bottom","generateGetNextDRGElementPosition","getHorizontalDistance","a","b","Math","abs","connectedAtPositionLeft","connectedAtPositionRight","previousPosition","connectedAtPreviousPosition","min","left","max"],"sources":["../../../src/features/auto-place/DmnAutoPlaceUtil.js"],"sourcesContent":["import { is } from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nimport {\r\n  findFreePosition,\r\n  generateGetNextPosition,\r\n  getConnectedDistance\r\n} from 'diagram-js/lib/features/auto-place/AutoPlaceUtil';\r\n\r\nimport {\r\n  asTRBL,\r\n  getMid\r\n} from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\nimport { DECISION_SIZE } from '../modeling/ElementFactory';\r\n\r\nvar DIRECTION_LEFT = 'left',\r\n    DIRECTION_RIGHT = 'right';\r\n\r\nvar DRG_ELEMENT_MARGIN = 60,\r\n    DRG_ELEMENT_ROW_SIZE = DECISION_SIZE.width;\r\n\r\n\r\nexport function getNewShapePosition(source, element) {\r\n  if (is(element, 'dmn:TextAnnotation')) {\r\n    return getTextAnnotationPosition(source, element);\r\n  }\r\n\r\n  if (is(element, 'dmn:DRGElement')) {\r\n    return getDRGElementPosition(source, element);\r\n  }\r\n}\r\n\r\n/**\r\n * Always try to place text annotations top right of source.\r\n */\r\nfunction getTextAnnotationPosition(source, element) {\r\n\r\n  var sourceTrbl = asTRBL(source);\r\n\r\n  var position = {\r\n    x: sourceTrbl.right + element.width / 2,\r\n    y: sourceTrbl.top - 50 - element.height / 2\r\n  };\r\n\r\n  var nextPositionDirection = {\r\n    y: {\r\n      margin: -30,\r\n      minDistance: 20\r\n    }\r\n  };\r\n\r\n  return findFreePosition(\r\n    source,\r\n    element,\r\n    position,\r\n    generateGetNextPosition(nextPositionDirection)\r\n  );\r\n}\r\n\r\n/**\r\n * Get position for DRG elements.\r\n *\r\n * @param {djs.model.Shape} source\r\n * @param {djs.model.Shape} element\r\n *\r\n * @returns {Point}\r\n */\r\nfunction getDRGElementPosition(source, element) {\r\n  var sourceTrbl = asTRBL(source),\r\n      sourceMid = getMid(source);\r\n\r\n  function getWeight(connection) {\r\n    return connection.target === source ? 1 : -1;\r\n  }\r\n\r\n  var verticalDistance = getConnectedDistance(source, {\r\n    defaultDistance: 180,\r\n    direction: 's',\r\n    getWeight: getWeight,\r\n    filter: filter,\r\n    reference: 'center'\r\n  });\r\n\r\n  var position = {\r\n    x: sourceMid.x,\r\n    y: sourceTrbl.bottom + verticalDistance\r\n  };\r\n\r\n  return findFreePosition(\r\n    source,\r\n    element,\r\n    position,\r\n    generateGetNextDRGElementPosition(source)\r\n  );\r\n}\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction filter(connection) {\r\n  return !is(connection, 'dmn:Association');\r\n}\r\n\r\nfunction getHorizontalDistance(a, b) {\r\n  return Math.abs(b.x - a.x);\r\n}\r\n\r\nfunction generateGetNextDRGElementPosition(source) {\r\n  var sourceMid = getMid(source);\r\n\r\n  var connectedAtPositionLeft,\r\n      connectedAtPositionRight;\r\n\r\n  return function(element, previousPosition, connectedAtPreviousPosition) {\r\n    var direction;\r\n\r\n    // (1) get direction\r\n    if (!connectedAtPositionLeft) {\r\n      connectedAtPositionLeft = connectedAtPreviousPosition;\r\n      connectedAtPositionRight = connectedAtPreviousPosition;\r\n\r\n      if (getMid(connectedAtPreviousPosition).x - sourceMid.x > 0) {\r\n        direction = DIRECTION_LEFT;\r\n      } else {\r\n        direction = DIRECTION_RIGHT;\r\n      }\r\n    } else {\r\n      if (previousPosition.x < sourceMid.x) {\r\n        connectedAtPositionLeft = connectedAtPreviousPosition;\r\n      } else {\r\n        connectedAtPositionRight = connectedAtPreviousPosition;\r\n      }\r\n\r\n      if (getHorizontalDistance(sourceMid, getMid(connectedAtPositionLeft))\r\n        < getHorizontalDistance(sourceMid, getMid(connectedAtPositionRight))) {\r\n        direction = DIRECTION_LEFT;\r\n      } else {\r\n        direction = DIRECTION_RIGHT;\r\n      }\r\n    }\r\n\r\n    // (2) get next position\r\n    if (direction === DIRECTION_LEFT) {\r\n      return {\r\n        x: Math.min(\r\n          getMid(connectedAtPositionLeft).x - DRG_ELEMENT_ROW_SIZE - DRG_ELEMENT_MARGIN,\r\n          asTRBL(connectedAtPositionLeft).left - DRG_ELEMENT_MARGIN - element.width / 2\r\n        ),\r\n        y: previousPosition.y\r\n      };\r\n    } else {\r\n      return {\r\n        x: Math.max(\r\n          getMid(connectedAtPositionRight).x + DRG_ELEMENT_ROW_SIZE + DRG_ELEMENT_MARGIN,\r\n          asTRBL(connectedAtPositionRight).right + DRG_ELEMENT_MARGIN + element.width / 2\r\n        ),\r\n        y: previousPosition.y\r\n      };\r\n    }\r\n  };\r\n}"],"mappings":"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"}