{"version":3,"file":"DefinitionPropertiesEdit.js","names":["debounce","DEBOUNCE_DELAY","domify","classes","domClasses","query","domQuery","getBusinessObject","validateId","DefinitionIdEdit","eventBus","modeling","canvas","definitionPropertiesView","translate","_eventBus","_modeling","_canvas","_definitionPropertiesView","_translate","on","event","_container","html","nameElement","idElement","_setup","$inject","prototype","update","type","newValue","element","getRootElement","newProperties","errorMessage","_addErrorMessage","_clearErrorMessage","updateProperties","node","self","setAttribute","addEventListener","evt","value","target","textContent","trim","keyCode","blur","window","getSelection","removeAllRanges","errorHTML","add","parentElement","appendChild","has","remove","errorLabel","parentNode","removeChild"],"sources":["../../../src/features/definition-properties/DefinitionPropertiesEdit.js"],"sourcesContent":["import {\n  debounce\n} from 'min-dash';\n\nvar DEBOUNCE_DELAY = 300;\n\nimport {\n  domify,\n  classes as domClasses,\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  getBusinessObject\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport {\n  validateId\n} from 'dmn-js-shared/lib/util/IdsUtil';\n\n\nexport default function DefinitionIdEdit(\n    eventBus, modeling, canvas, definitionPropertiesView, translate) {\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._canvas = canvas;\n  this._definitionPropertiesView = definitionPropertiesView;\n  this._translate = translate;\n\n  eventBus.on('definitionIdView.create', function(event) {\n    this._container = event.html;\n    var nameElement = domQuery('.dmn-definitions-name', this._container),\n        idElement = domQuery('.dmn-definitions-id', this._container);\n\n    this._setup(nameElement, 'name');\n    this._setup(idElement, 'id');\n  }, this);\n}\n\nDefinitionIdEdit.$inject = [\n  'eventBus',\n  'modeling',\n  'canvas',\n  'definitionPropertiesView',\n  'translate'\n];\n\n\nDefinitionIdEdit.prototype.update = function(type, newValue) {\n  var element = this._canvas.getRootElement();\n  var newProperties = {};\n  newProperties[type] = newValue;\n\n  if (type === 'id') {\n    var errorMessage = validateId(getBusinessObject(element), newValue);\n\n    if (errorMessage) {\n      this._addErrorMessage(errorMessage);\n\n      return;\n    }\n\n    this._clearErrorMessage();\n  }\n\n  this._modeling.updateProperties(element, newProperties);\n};\n\nDefinitionIdEdit.prototype._setup = function(node, type) {\n  var self = this;\n\n  node.setAttribute('contenteditable', true);\n\n  node.addEventListener('input', debounce(function(evt) {\n    var value = evt.target.value || evt.target.textContent;\n\n    self.update(type, value.trim());\n  }, DEBOUNCE_DELAY));\n\n  node.addEventListener('keydown', function(evt) {\n    if (evt.keyCode === 13) {\n      node.blur();\n      window.getSelection().removeAllRanges();\n    }\n  });\n\n  node.addEventListener('blur', function() {\n    self._clearErrorMessage();\n\n    self._definitionPropertiesView.update();\n  });\n};\n\nDefinitionIdEdit.prototype._addErrorMessage = function(errorMessage) {\n  const errorHTML =\n    '<span class=\"dmn-definitions-error-message\">' +\n    this._translate(errorMessage) +\n    '</span>';\n\n  var idElement = domQuery('.dmn-definitions-id', this._container);\n\n  // clear previous error message\n  this._clearErrorMessage();\n\n  // add current error message\n  domClasses(idElement).add('dmn-definitions-error');\n  idElement.parentElement.appendChild(domify(errorHTML));\n};\n\nDefinitionIdEdit.prototype._clearErrorMessage = function() {\n  var idElement = domQuery('.dmn-definitions-id', this._container);\n\n  if (domClasses(idElement).has('dmn-definitions-error')) {\n    domClasses(idElement).remove('dmn-definitions-error');\n\n    const errorLabel = domQuery('.dmn-definitions-error-message', this._container);\n    idElement.parentNode.removeChild(errorLabel);\n  }\n};\n"],"mappings":"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"}