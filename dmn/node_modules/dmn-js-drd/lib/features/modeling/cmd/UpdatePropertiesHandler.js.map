{"version":3,"file":"UpdatePropertiesHandler.js","names":["reduce","keys","forEach","NAME","ID","UpdatePropertiesHandler","elementRegistry","moddle","_elementRegistry","_moddle","$inject","prototype","execute","context","element","changed","Error","ids","businessObject","properties","oldProperties","getProperties","isIdChange","unclaim","updateId","claim","label","push","setProperties","revert","propertyNames","result","key","get","value","set"],"sources":["../../../../src/features/modeling/cmd/UpdatePropertiesHandler.js"],"sourcesContent":["import {\n  reduce,\n  keys,\n  forEach\n} from 'min-dash';\n\nvar NAME = 'name',\n    ID = 'id';\n\n\n/**\n * A handler that implements a DMN property update.\n *\n * This should be used to set simple properties on elements with\n * an underlying DMN business object.\n *\n * Use respective diagram-js provided handlers if you would\n * like to perform automated modeling.\n */\nexport default function UpdatePropertiesHandler(elementRegistry, moddle) {\n  this._elementRegistry = elementRegistry;\n  this._moddle = moddle;\n}\n\nUpdatePropertiesHandler.$inject = [ 'elementRegistry', 'moddle' ];\n\n\n/**\n * Updates a DMN element with a list of new properties\n *\n * @param {Object} context\n * @param {djs.model.Base} context.element the element to update\n * @param {Object} context.properties a list of properties to set on the element's\n *                                    businessObject (the DMN model element)\n *\n * @return {Array<djs.model.Base>} the updated element\n */\nUpdatePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      changed = [ element ];\n\n  if (!element) {\n    throw new Error('element required');\n  }\n\n  var elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  var businessObject = element.businessObject,\n      properties = context.properties,\n      oldProperties = (\n        context.oldProperties ||\n        getProperties(businessObject, keys(properties))\n      );\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(businessObject[ID]);\n\n    elementRegistry.updateId(element, properties[ID]);\n\n    ids.claim(properties[ID], businessObject);\n  }\n\n  if (NAME in properties && element.label) {\n    changed.push(element.label);\n  }\n\n  // update properties\n  setProperties(businessObject, properties);\n\n  // store old values\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  // indicate changed on objects affected by the update\n  return changed;\n};\n\n\n/**\n * Reverts the update on a DMN elements properties.\n *\n * @param  {Object} context\n *\n * @return {djs.model.Base} the updated element\n */\nUpdatePropertiesHandler.prototype.revert = function(context) {\n\n  var element = context.element,\n      properties = context.properties,\n      oldProperties = context.oldProperties,\n      businessObject = element.businessObject,\n      elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  // update properties\n  setProperties(businessObject, oldProperties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(properties[ID]);\n\n    elementRegistry.updateId(element, oldProperties[ID]);\n\n    ids.claim(oldProperties[ID], businessObject);\n  }\n\n  return context.changed;\n};\n\n\nfunction isIdChange(properties, businessObject) {\n  return ID in properties && properties[ID] !== businessObject[ID];\n}\n\n\nfunction getProperties(businessObject, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = businessObject.get(key);\n    return result;\n  }, {});\n}\n\n\nfunction setProperties(businessObject, properties) {\n  forEach(properties, function(value, key) {\n    businessObject.set(key, value);\n  });\n}\n"],"mappings":"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"}