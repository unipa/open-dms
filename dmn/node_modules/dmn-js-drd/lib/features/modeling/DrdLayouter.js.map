{"version":3,"file":"DrdLayouter.js","names":["inherits","BaseLayouter","getMid","getOrientation","is","assign","ADDITIONAL_WAYPOINT_DISTANCE","DrdLayouter","connectionDocking","_connectionDocking","$inject","prototype","layoutConnection","connection","hints","source","target","waypoints","connectionStart","connectionEnd","orientation","getConnectionDocking","length","croppedWaypoints","getCroppedWaypoints","pop","additionalWaypoint","x","y","includes","concat","point","shape","original"],"sources":["../../../src/features/modeling/DrdLayouter.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport BaseLayouter from 'diagram-js/lib/layout/BaseLayouter';\n\nimport {\n  getMid,\n  getOrientation\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport { assign } from 'min-dash';\n\nvar ADDITIONAL_WAYPOINT_DISTANCE = 20;\n\n\nexport default function DrdLayouter(connectionDocking) {\n  this._connectionDocking = connectionDocking;\n}\n\ninherits(DrdLayouter, BaseLayouter);\n\nDrdLayouter.$inject = [ 'connectionDocking' ];\n\n\nDrdLayouter.prototype.layoutConnection = function(connection, hints) {\n  var connectionDocking = this._connectionDocking;\n\n  if (!hints) {\n    hints = {};\n  }\n\n  var source = hints.source || connection.source,\n      target = hints.target || connection.target,\n      waypoints = hints.waypoints || connection.waypoints || [],\n      connectionStart = hints.connectionStart,\n      connectionEnd = hints.connectionEnd,\n      orientation = getOrientation(source, target);\n\n  if (!connectionStart) {\n    connectionStart = getConnectionDocking(waypoints[ 0 ], source);\n  }\n\n  if (!connectionEnd) {\n    connectionEnd = getConnectionDocking(waypoints[ waypoints.length - 1 ], target);\n  }\n\n  if (is(connection, 'dmn:InformationRequirement')) {\n    waypoints = [ connectionStart, connectionEnd ];\n\n    var croppedWaypoints = connectionDocking.getCroppedWaypoints(\n      assign({}, connection, {\n        waypoints: waypoints\n      }),\n      source,\n      target\n    );\n\n    connectionEnd = croppedWaypoints.pop();\n\n    var additionalWaypoint = {\n      x: connectionEnd.x,\n      y: connectionEnd.y\n    };\n\n    if (orientation.includes('bottom')) {\n      additionalWaypoint.y += ADDITIONAL_WAYPOINT_DISTANCE;\n    } else if (orientation.includes('top')) {\n      additionalWaypoint.y -= ADDITIONAL_WAYPOINT_DISTANCE;\n    } else if (orientation.includes('right')) {\n      additionalWaypoint.x += ADDITIONAL_WAYPOINT_DISTANCE;\n    } else {\n      additionalWaypoint.x -= ADDITIONAL_WAYPOINT_DISTANCE;\n    }\n\n    waypoints = croppedWaypoints.concat([ additionalWaypoint, connectionEnd ]);\n\n    return waypoints;\n  }\n\n  return [ connectionStart, connectionEnd ];\n};\n\nfunction getConnectionDocking(point, shape) {\n  return point ? (point.original || point) : getMid(shape);\n}\n"],"mappings":"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"}