{"version":3,"file":"DrdRules.js","names":["is","isAny","inherits","RuleProvider","every","isArray","DrdRules","injector","invoke","$inject","prototype","init","addRule","context","source","target","canConnect","connection","type","businessObject","shapes","position","canMove","shape","canCreate","isLabel","elements","element","labelTarget"],"sources":["../../../src/features/rules/DrdRules.js"],"sourcesContent":["import {\n  is,\n  isAny\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport inherits from 'inherits-browser';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\n\nimport {\n  every,\n  isArray\n} from 'min-dash';\n\n\n/**\n * DRD modeling rules.\n */\nexport default function DrdRules(injector) {\n  injector.invoke(RuleProvider, this);\n}\n\ninherits(DrdRules, RuleProvider);\n\nDrdRules.$inject = [ 'injector' ];\n\nDrdRules.prototype.init = function() {\n\n  this.addRule('connection.create', function(context) {\n    var source = context.source,\n        target = context.target;\n\n    return canConnect(source, target);\n  });\n\n  this.addRule('connection.reconnect', function(context) {\n    var connection = context.connection,\n        source = context.source,\n        target = context.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule('connection.updateWaypoints', function(context) {\n    const connection = context.connection;\n\n    return {\n      type: connection.type,\n      businessObject: connection.businessObject\n    };\n  });\n\n  this.addRule('elements.move', function(context) {\n    var target = context.target,\n        shapes = context.shapes,\n        position = context.position;\n\n    return canMove(shapes, target, position);\n  });\n\n  this.addRule('shape.create', function(context) {\n    var shape = context.shape,\n        target = context.target;\n\n    return canCreate(shape, target);\n  });\n\n  this.addRule('shape.resize', function(context) {\n    var shape = context.shape;\n\n    return is(shape, 'dmn:TextAnnotation');\n  });\n\n};\n\nDrdRules.prototype.canConnect = canConnect;\n\nDrdRules.prototype.canCreate = canCreate;\n\nDrdRules.prototype.canMove = canMove;\n\n\nfunction canConnect(source, target) {\n  if (!source || isLabel(source) || !target || isLabel(target)) {\n    return null;\n  }\n\n  if (source === target) {\n    return false;\n  }\n\n  if (is(source, 'dmn:BusinessKnowledgeModel') &&\n      isAny(target, [\n        'dmn:BusinessKnowledgeModel',\n        'dmn:Decision'\n      ])) {\n    return { type: 'dmn:KnowledgeRequirement' };\n  }\n\n  if (is(source, 'dmn:Decision')) {\n\n    if (is(target, 'dmn:Decision')) {\n      return { type: 'dmn:InformationRequirement' };\n    }\n\n    if (is(target, 'dmn:KnowledgeSource')) {\n      return { type: 'dmn:AuthorityRequirement' };\n    }\n\n  }\n\n  if (is(source, 'dmn:Definitions') || is(target, 'dmn:Definitions')) {\n    return false;\n  }\n\n  if (is(source, 'dmn:InputData')) {\n\n    if (is(target, 'dmn:Decision')) {\n      return { type: 'dmn:InformationRequirement' };\n    }\n\n    if (is(target, 'dmn:KnowledgeSource')) {\n      return { type: 'dmn:AuthorityRequirement' };\n    }\n\n  }\n\n  if (is(source, 'dmn:KnowledgeSource') &&\n      isAny(target, [\n        'dmn:BusinessKnowledgeModel',\n        'dmn:Decision',\n        'dmn:KnowledgeSource'\n      ])) {\n    return { type: 'dmn:AuthorityRequirement' };\n  }\n\n  if ((is(source, 'dmn:TextAnnotation') && !is(target, 'dmn:TextAnnotation'))\n  || (!is(source, 'dmn:TextAnnotation') && is(target, 'dmn:TextAnnotation'))) {\n    return { type: 'dmn:Association' };\n  }\n\n  return false;\n}\n\nfunction canCreate(shape, target) {\n  return isAny(shape, [\n    'dmn:BusinessKnowledgeModel',\n    'dmn:Decision',\n    'dmn:InputData',\n    'dmn:KnowledgeSource',\n    'dmn:TextAnnotation'\n  ]) && is(target, 'dmn:Definitions');\n}\n\nfunction canMove(elements, target) {\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  if (every(elements, function(element) {\n    return isAny(element, [\n      'dmn:BusinessKnowledgeModel',\n      'dmn:Decision',\n      'dmn:InputData',\n      'dmn:KnowledgeSource',\n      'dmn:TextAnnotation',\n      'dmn:InformationRequirement',\n      'dmn:AuthorityRequirement',\n      'dmn:KnowledgeRequirement',\n      'dmn:Association'\n    ]);\n  }) && is(target, 'dmn:Definitions')) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function isLabel(element) {\n  return !!element.labelTarget;\n}"],"mappings":"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"}