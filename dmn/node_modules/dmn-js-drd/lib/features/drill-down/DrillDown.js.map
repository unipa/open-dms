{"version":3,"file":"DrillDown.js","names":["is","domify","classes","domClasses","delegate","domDelegate","PROVIDERS","className","matches","el","businessObject","decisionLogic","DrillDown","constructor","injector","eventBus","overlays","config","_injector","_eventBus","_overlays","_config","enabled","on","element","i","length","editable","addOverlay","html","overlayId","add","position","top","left","bindEventListener","overlay","id","overlaysRoot","_overlayRoot","bind","triggerDefault","fire","drillDown","parent","get","view","getView","open","$inject"],"sources":["../../../src/features/drill-down/DrillDown.js"],"sourcesContent":["import { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport {\n  domify,\n  classes as domClasses,\n  delegate as domDelegate\n} from 'min-dom';\n\n\nvar PROVIDERS = [\n  {\n    className: 'dmn-icon-decision-table',\n    matches: function(el) {\n      var businessObject = el.businessObject;\n\n      return (\n        is(businessObject, 'dmn:Decision') &&\n        is(businessObject.decisionLogic, 'dmn:DecisionTable')\n      );\n    }\n  },\n  {\n    className: 'dmn-icon-literal-expression',\n    matches: function(el) {\n      var businessObject = el.businessObject;\n\n      return (\n        is(businessObject, 'dmn:Decision') &&\n        is(businessObject.decisionLogic, 'dmn:LiteralExpression')\n      );\n    }\n  }\n];\n\n\n/**\n * Displays overlays that can be clicked in order to drill\n * down into a DMN element.\n */\nexport default class DrillDown {\n\n  constructor(injector, eventBus, overlays, config) {\n    this._injector = injector;\n    this._eventBus = eventBus;\n    this._overlays = overlays;\n\n    this._config = config || { enabled: true };\n\n    eventBus.on([ 'shape.added' ], ({ element }) => {\n\n      for (let i = 0; i < PROVIDERS.length; i++) {\n\n        const { matches, className } = PROVIDERS[i];\n\n        var editable = matches && matches(element);\n\n        if (editable) {\n          this.addOverlay(element, className);\n        }\n      }\n    });\n  }\n\n  /**\n   * Add overlay to an element that enables drill down.\n   *\n   * @param {Object} element Element to add overlay to.\n   * @param {string} className\n   *        CSS class that will be added to overlay in order to display icon.\n   */\n  addOverlay(element, className) {\n    const html = domify(`\n      <div class=\"drill-down-overlay\">\n        <span class=\"${className}\"></span>\n      </div>\n    `);\n\n    const overlayId = this._overlays.add(element, {\n      position: {\n        top: 2,\n        left: 2\n      },\n      html\n    });\n\n    // TODO(nikku): can we remove renamed to drillDown.enabled\n    if (this._config.enabled !== false) {\n      domClasses(html).add('interactive');\n\n      this.bindEventListener(element, html, overlayId);\n    }\n  }\n\n  /**\n   * @param {Object} element\n   * @param {Object} overlay\n   * @param {string} id\n   */\n  bindEventListener(element, overlay, id) {\n    const overlays = this._overlays,\n          eventBus = this._eventBus;\n\n    const overlaysRoot = overlays._overlayRoot;\n\n    domDelegate.bind(overlaysRoot, '[data-overlay-id=\"' + id + '\"]', 'click', () => {\n\n      const triggerDefault = eventBus.fire('drillDown.click', {\n        element\n      });\n\n      if (triggerDefault === false) {\n        return;\n      }\n\n      this.drillDown(element);\n    });\n  }\n\n\n  /**\n   * Drill down into the specific element.\n   *\n   * @param  {djs.model.Base} element\n   *\n   * @return {boolean} whether drill down was executed\n   */\n  drillDown(element) {\n\n    const parent = this._injector.get('_parent', false);\n\n    // no parent; skip drill down\n    if (!parent) {\n      return false;\n    }\n\n    const view = parent.getView(element.businessObject);\n\n    // no view to drill down to\n    if (!view) {\n      return false;\n    }\n\n    parent.open(view);\n\n    return true;\n  }\n\n}\n\nDrillDown.$inject = [\n  'injector',\n  'eventBus',\n  'overlays',\n  'config.drillDown'\n];"],"mappings":"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"}