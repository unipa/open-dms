{"version":3,"file":"ContextMenuComponent.js","names":["Component","assign","isFunction","inject","closest","domClosest","query","domQuery","setRange","DEFAULT_STYLE","position","ContextMenuComponent","constructor","props","context","close","setState","isOpen","x","y","state","undefined","eventBus","fire","componentDidMount","on","open","componentWillUnmount","off","render","components","getComponents","length","offset","autoFocus","autoClose","triggerClose","$inject","ContextMenu","event","checkClose","target","keyCode","which","stopPropagation","preventDefault","node","updatePosition","ensureFocus","onClose","focusTarget","contains","document","addEventListener","onFocusChanged","onGlobalKey","onGlobalMouseDown","removeEventListener","bounds","getBoundingClientRect","width","height","container","renderer","getContainer","containerBounds","classList","add","remove","scrollLeft","scrollTop","getTableContainerScroll","style","alignment","align","split","left","top","horizontalAlignment","clampNumber","verticalAlignment","overflowY","maxHeight","className","map","idx","e","setNode","number","min","max","Math","SELECTABLE_ELEMENTS","el","focusEl","focus","selectionStart","type","start","end","tableContainer"],"sources":["../../../../src/features/context-menu/components/ContextMenuComponent.js"],"sourcesContent":["import { Component } from 'inferno';\r\n\r\nimport {\r\n  assign,\r\n  isFunction\r\n} from 'min-dash';\r\n\r\nimport {\r\n  inject\r\n} from '../../../components';\r\n\r\nimport {\r\n  closest as domClosest,\r\n  query as domQuery\r\n} from 'min-dom';\r\n\r\nimport {\r\n  setRange\r\n} from 'selection-ranges';\r\n\r\nconst DEFAULT_STYLE = {\r\n  position: 'absolute'\r\n};\r\n\r\n/**\r\n * @typedef ContextMenuPosition\r\n * @property {number} x\r\n * @property {number} y\r\n * @property {number} [width=0]\r\n * @property {number} [height=0]\r\n * @property {'bottom-left'|'bottom-right'|'top-left'|'top-right'} [align]\r\n */\r\n\r\nexport default class ContextMenuComponent extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      position: {\r\n        x: 0,\r\n        y: 0\r\n      }\r\n    };\r\n\r\n    inject(this);\r\n  }\r\n\r\n  /**\r\n   * Open the context menu with given position and context.\r\n   *\r\n   * The menu itself will figure out the best position, taking the optional\r\n   * positioning parameter into account. Position can also contain indicator\r\n   * in which direction to open context menu.\r\n   *\r\n   * @param {ContextMenuPosition} position\r\n   * @param {Object} [context]\r\n   */\r\n  open = ({ position, context }) => {\r\n\r\n    // always close first\r\n    this.close();\r\n\r\n    this.setState({\r\n      isOpen: true,\r\n      position: position || { x: 0, y: 0 },\r\n      context: context || {}\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Closes context menu and resets state.\r\n   */\r\n  close = () => {\r\n\r\n    if (this.state.isOpen) {\r\n      this.setState({\r\n        context: undefined,\r\n        isOpen: false,\r\n        position: {\r\n          x: 0,\r\n          y: 0\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  triggerClose = () => {\r\n    this.eventBus.fire('contextMenu.close');\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.eventBus.on('contextMenu.open', this.open);\r\n    this.eventBus.on('contextMenu.close', this.close);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.eventBus.off('contextMenu.open', this.open);\r\n    this.eventBus.off('contextMenu.close', this.close);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      isOpen,\r\n      context,\r\n      position\r\n    } = this.state;\r\n\r\n    if (!isOpen) {\r\n      return null;\r\n    }\r\n\r\n    const components = this.components.getComponents('context-menu', context);\r\n\r\n    if (!components.length) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <ContextMenu\r\n        className=\"context-menu no-deselect\"\r\n        context={ context }\r\n        position={ position }\r\n        offset={ context.offset || { x: 0, y: 0 } }\r\n        autoFocus={ context.autoFocus !== false }\r\n        autoClose={ context.autoClose !== false }\r\n        components={ components }\r\n        onClose={ this.triggerClose } />\r\n    );\r\n  }\r\n}\r\n\r\nContextMenuComponent.$inject = [\r\n  'eventBus',\r\n  'components'\r\n];\r\n\r\n\r\n/**\r\n * Low-level, stateless context menu holder.\r\n */\r\nclass ContextMenu extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    inject(this);\r\n  }\r\n\r\n  close() {\r\n\r\n    const {\r\n      onClose\r\n    } = this.props;\r\n\r\n    if (isFunction(onClose)) {\r\n      onClose();\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Check whether closing the context menu is necessary\r\n   * after selecting the given element.\r\n   */\r\n  checkClose(focusTarget) {\r\n\r\n    const {\r\n      autoClose\r\n    } = this.props;\r\n\r\n    if (!autoClose) {\r\n      return;\r\n    }\r\n\r\n    var node = this.node;\r\n\r\n    if (!node) {\r\n      return;\r\n    }\r\n\r\n    if (node === focusTarget) {\r\n      return;\r\n    }\r\n\r\n    if (node.contains(focusTarget)) {\r\n      return;\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * Handle global (window) mousedown event.\r\n   */\r\n  onGlobalMouseDown = (event) => {\r\n    this.checkClose(event.target);\r\n  };\r\n\r\n  /**\r\n   * Handle global key event.\r\n   */\r\n  onGlobalKey = (event) => {\r\n\r\n    var keyCode = event.which;\r\n\r\n    // ENTER or ESC\r\n    if (keyCode === 13 || keyCode === 27) {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      this.close();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handle global (document) focus changed event.\r\n   */\r\n  onFocusChanged = (event) => {\r\n    this.checkClose(event.target);\r\n  };\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('focusin', this.onFocusChanged);\r\n    document.addEventListener('keydown', this.onGlobalKey);\r\n    document.addEventListener('mousedown', this.onGlobalMouseDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('focusin', this.onFocusChanged);\r\n    document.removeEventListener('keydown', this.onGlobalKey);\r\n    document.removeEventListener('mousedown', this.onGlobalMouseDown);\r\n  }\r\n\r\n  setNode = (node) => {\r\n    this.node = node;\r\n\r\n    const {\r\n      autoFocus\r\n    } = this.props;\r\n\r\n    if (node) {\r\n      this.updatePosition();\r\n\r\n      if (autoFocus) {\r\n        ensureFocus(node);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Find best context menu position and re-layout accordingly.\r\n   */\r\n  updatePosition() {\r\n    const {\r\n      position,\r\n      offset\r\n    } = this.props;\r\n\r\n    const { node } = this;\r\n\r\n    const bounds = node.getBoundingClientRect();\r\n\r\n    if (!position.width) {\r\n      position.width = 0;\r\n    }\r\n\r\n    if (!position.height) {\r\n      position.height = 0;\r\n    }\r\n\r\n    const container = this.renderer.getContainer(),\r\n          containerBounds = container.getBoundingClientRect();\r\n\r\n    if (containerBounds.width > containerBounds.height) {\r\n      this.node.classList.add('horizontal');\r\n      this.node.classList.remove('vertical');\r\n    } else {\r\n      this.node.classList.add('vertical');\r\n      this.node.classList.remove('horizontal');\r\n    }\r\n\r\n    const { scrollLeft, scrollTop } = getTableContainerScroll(node);\r\n\r\n    const style = {};\r\n\r\n    let alignment;\r\n\r\n    if (position.align) {\r\n      alignment = position.align.split('-');\r\n    }\r\n\r\n    let left, top;\r\n\r\n    const horizontalAlignment = alignment && alignment[1] || (\r\n      position.x + (position.width / 2) > containerBounds.width / 2\r\n        ? 'left'\r\n        : 'right'\r\n    );\r\n\r\n    if (horizontalAlignment === 'left') {\r\n      left = position.x\r\n        - containerBounds.left\r\n        - bounds.width\r\n        + offset.x\r\n        + scrollLeft;\r\n\r\n      node.classList.remove('right');\r\n      node.classList.add('left');\r\n    } else {\r\n      left = -containerBounds.left\r\n        + position.x\r\n        + position.width\r\n        - offset.x\r\n        + scrollLeft;\r\n\r\n      node.classList.remove('left');\r\n      node.classList.add('right');\r\n    }\r\n    left = alignment ? left : clampNumber(\r\n      left,\r\n      0 + scrollLeft,\r\n      containerBounds.width - bounds.width + scrollLeft\r\n    );\r\n    style.left = left + 'px';\r\n\r\n    const verticalAlignment = alignment && alignment[0] || (\r\n      position.y + (position.height / 2) > containerBounds.height / 2\r\n        ? 'top'\r\n        : 'bottom'\r\n    );\r\n\r\n    if (verticalAlignment === 'top') {\r\n      top = position.y\r\n        - containerBounds.top\r\n        - bounds.height\r\n        + offset.y\r\n        + scrollTop;\r\n\r\n      node.classList.remove('bottom');\r\n      node.classList.add('top');\r\n    } else {\r\n      top = -containerBounds.top\r\n        + position.y\r\n        - offset.y\r\n        + scrollTop;\r\n\r\n      node.classList.remove('top');\r\n      node.classList.add('bottom');\r\n    }\r\n    top = alignment ? top : clampNumber(\r\n      top,\r\n      0 + scrollTop,\r\n      containerBounds.height - bounds.height + scrollTop\r\n    );\r\n    style.top = top + 'px';\r\n\r\n    // ensure context menu will always be accessible\r\n    style.overflowY = 'auto';\r\n    style.maxHeight = (containerBounds.height - top + scrollTop) + 'px';\r\n\r\n    assign(this.node.style, DEFAULT_STYLE, style);\r\n  }\r\n\r\n\r\n  render() {\r\n\r\n    const {\r\n      context,\r\n      components,\r\n      className\r\n    } = this.props;\r\n\r\n    return (\r\n      <div\r\n        ref={ this.setNode }\r\n        onContextMenu={ e => e.preventDefault() }\r\n        className={ className }>\r\n        {\r\n          components.map(\r\n            (Component, idx) => <Component key={ idx } context={ context } />\r\n          )\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nContextMenu.$inject = [\r\n  'renderer'\r\n];\r\n\r\n\r\n// helpers /////////////\r\n\r\nfunction clampNumber(number, min, max) {\r\n  return Math.max(min, Math.min(max, number));\r\n}\r\n\r\nconst SELECTABLE_ELEMENTS = `\r\n  input[type=text],\r\n  input[type=number],\r\n  input[type=button],\r\n  input[type=submit],\r\n  [contenteditable],\r\n  [tabindex],\r\n  a[href],\r\n  textarea,\r\n  button\r\n`;\r\n\r\nfunction ensureFocus(el) {\r\n\r\n  var focusEl = domQuery(SELECTABLE_ELEMENTS, el);\r\n\r\n  if (focusEl) {\r\n    focusEl.focus();\r\n\r\n    // inputs\r\n    if (focusEl.selectionStart && focusEl.type === 'text') {\r\n      focusEl.selectionStart = 100000;\r\n    } else\r\n\r\n    // content editable elements\r\n    if ('contentEditable' in focusEl) {\r\n      setRange(focusEl, { start: 100000, end: 100000 });\r\n    }\r\n  }\r\n}\r\n\r\nfunction getTableContainerScroll(node) {\r\n  const tableContainer = domClosest(node, '.tjs-container');\r\n\r\n  if (!tableContainer) {\r\n    return {\r\n      scrollTop: 0,\r\n      scrollLeft: 0\r\n    };\r\n  }\r\n\r\n  const { scrollLeft, scrollTop } = tableContainer;\r\n\r\n  return {\r\n    scrollTop,\r\n    scrollLeft\r\n  };\r\n}"],"mappings":";;;;AAAA,SAASA,SAAT,QAA0B,SAA1B;AAEA,SACEC,MADF,EAEEC,UAFF,QAGO,UAHP;AAKA,SACEC,MADF,QAEO,qBAFP;AAIA,SACEC,OAAO,IAAIC,UADb,EAEEC,KAAK,IAAIC,QAFX,QAGO,SAHP;AAKA,SACEC,QADF,QAEO,kBAFP;AAIA,MAAMC,aAAa,GAAG;EACpBC,QAAQ,EAAE;AADU,CAAtB;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,MAAMC,oBAAN,SAAmCX,SAAnC,CAA6C;EAE1DY,WAAW,CAACC,KAAD,EAAQC,QAAR,EAAiB;IAC1B,MAAMD,KAAN,EAAaC,QAAb;;IAD0B,8BAwBrB,CAAC;MAAEJ,QAAF;MAAYI;IAAZ,CAAD,KAA2B;MAEhC;MACA,KAAKC,KAAL;MAEA,KAAKC,QAAL,CAAc;QACZC,MAAM,EAAE,IADI;QAEZP,QAAQ,EAAEA,QAAQ,IAAI;UAAEQ,CAAC,EAAE,CAAL;UAAQC,CAAC,EAAE;QAAX,CAFV;QAGZL,OAAO,EAAEA,OAAO,IAAI;MAHR,CAAd;IAKD,CAlC2B;;IAAA,+BAuCpB,MAAM;MAEZ,IAAI,KAAKM,KAAL,CAAWH,MAAf,EAAuB;QACrB,KAAKD,QAAL,CAAc;UACZF,OAAO,EAAEO,SADG;UAEZJ,MAAM,EAAE,KAFI;UAGZP,QAAQ,EAAE;YACRQ,CAAC,EAAE,CADK;YAERC,CAAC,EAAE;UAFK;QAHE,CAAd;MAQD;IACF,CAnD2B;;IAAA,sCAqDb,MAAM;MACnB,KAAKG,QAAL,CAAcC,IAAd,CAAmB,mBAAnB;IACD,CAvD2B;;IAG1B,KAAKH,KAAL,GAAa;MACXH,MAAM,EAAE,KADG;MAEXP,QAAQ,EAAE;QACRQ,CAAC,EAAE,CADK;QAERC,CAAC,EAAE;MAFK;IAFC,CAAb;IAQAhB,MAAM,CAAC,IAAD,CAAN;EACD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EAkCEqB,iBAAiB,GAAG;IAClB,KAAKF,QAAL,CAAcG,EAAd,CAAiB,kBAAjB,EAAqC,KAAKC,IAA1C;IACA,KAAKJ,QAAL,CAAcG,EAAd,CAAiB,mBAAjB,EAAsC,KAAKV,KAA3C;EACD;;EAEDY,oBAAoB,GAAG;IACrB,KAAKL,QAAL,CAAcM,GAAd,CAAkB,kBAAlB,EAAsC,KAAKF,IAA3C;IACA,KAAKJ,QAAL,CAAcM,GAAd,CAAkB,mBAAlB,EAAuC,KAAKb,KAA5C;EACD;;EAEDc,MAAM,GAAG;IACP,MAAM;MACJZ,MADI;MAEJH,OAFI;MAGJJ;IAHI,IAIF,KAAKU,KAJT;;IAMA,IAAI,CAACH,MAAL,EAAa;MACX,OAAO,IAAP;IACD;;IAED,MAAMa,UAAU,GAAG,KAAKA,UAAL,CAAgBC,aAAhB,CAA8B,cAA9B,EAA8CjB,OAA9C,CAAnB;;IAEA,IAAI,CAACgB,UAAU,CAACE,MAAhB,EAAwB;MACtB,OAAO,IAAP;IACD;;IAED;MAAA,aAEc,0BAFd;MAAA,WAGclB,OAHd;MAAA,YAIeJ,QAJf;MAAA,UAKaI,OAAO,CAACmB,MAAR,IAAkB;QAAEf,CAAC,EAAE,CAAL;QAAQC,CAAC,EAAE;MAAX,CAL/B;MAAA,aAMgBL,OAAO,CAACoB,SAAR,KAAsB,KANtC;MAAA,aAOgBpB,OAAO,CAACqB,SAAR,KAAsB,KAPtC;MAAA,cAQiBL,UARjB;MAAA,WASc,KAAKM;IATnB;EAWD;;AAjGyD;AAoG5DzB,oBAAoB,CAAC0B,OAArB,GAA+B,CAC7B,UAD6B,EAE7B,YAF6B,CAA/B;AAMA;AACA;AACA;;AACA,MAAMC,WAAN,SAA0BtC,SAA1B,CAAoC;EAElCY,WAAW,CAACC,KAAD,EAAQC,OAAR,EAAiB;IAC1B,MAAMD,KAAN,EAAaC,OAAb;;IAD0B,2CAoDPyB,KAAD,IAAW;MAC7B,KAAKC,UAAL,CAAgBD,KAAK,CAACE,MAAtB;IACD,CAtD2B;;IAAA,qCA2DbF,KAAD,IAAW;MAEvB,IAAIG,OAAO,GAAGH,KAAK,CAACI,KAApB,CAFuB,CAIvB;;MACA,IAAID,OAAO,KAAK,EAAZ,IAAkBA,OAAO,KAAK,EAAlC,EAAsC;QACpCH,KAAK,CAACK,eAAN;QACAL,KAAK,CAACM,cAAN;QAEA,KAAK9B,KAAL;MACD;IACF,CAtE2B;;IAAA,wCA2EVwB,KAAD,IAAW;MAC1B,KAAKC,UAAL,CAAgBD,KAAK,CAACE,MAAtB;IACD,CA7E2B;;IAAA,iCA2FjBK,IAAD,IAAU;MAClB,KAAKA,IAAL,GAAYA,IAAZ;MAEA,MAAM;QACJZ;MADI,IAEF,KAAKrB,KAFT;;MAIA,IAAIiC,IAAJ,EAAU;QACR,KAAKC,cAAL;;QAEA,IAAIb,SAAJ,EAAe;UACbc,WAAW,CAACF,IAAD,CAAX;QACD;MACF;IACF,CAzG2B;;IAG1B3C,MAAM,CAAC,IAAD,CAAN;EACD;;EAEDY,KAAK,GAAG;IAEN,MAAM;MACJkC;IADI,IAEF,KAAKpC,KAFT;;IAIA,IAAIX,UAAU,CAAC+C,OAAD,CAAd,EAAyB;MACvBA,OAAO;IACR;EACF;EAGD;AACF;AACA;AACA;;;EACET,UAAU,CAACU,WAAD,EAAc;IAEtB,MAAM;MACJf;IADI,IAEF,KAAKtB,KAFT;;IAIA,IAAI,CAACsB,SAAL,EAAgB;MACd;IACD;;IAED,IAAIW,IAAI,GAAG,KAAKA,IAAhB;;IAEA,IAAI,CAACA,IAAL,EAAW;MACT;IACD;;IAED,IAAIA,IAAI,KAAKI,WAAb,EAA0B;MACxB;IACD;;IAED,IAAIJ,IAAI,CAACK,QAAL,CAAcD,WAAd,CAAJ,EAAgC;MAC9B;IACD;;IAED,KAAKnC,KAAL;EACD;EAED;AACF;AACA;;;EA4BES,iBAAiB,GAAG;IAClB4B,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqC,KAAKC,cAA1C;IACAF,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqC,KAAKE,WAA1C;IACAH,QAAQ,CAACC,gBAAT,CAA0B,WAA1B,EAAuC,KAAKG,iBAA5C;EACD;;EAED7B,oBAAoB,GAAG;IACrByB,QAAQ,CAACK,mBAAT,CAA6B,SAA7B,EAAwC,KAAKH,cAA7C;IACAF,QAAQ,CAACK,mBAAT,CAA6B,SAA7B,EAAwC,KAAKF,WAA7C;IACAH,QAAQ,CAACK,mBAAT,CAA6B,WAA7B,EAA0C,KAAKD,iBAA/C;EACD;;EAkBD;AACF;AACA;EACET,cAAc,GAAG;IACf,MAAM;MACJrC,QADI;MAEJuB;IAFI,IAGF,KAAKpB,KAHT;IAKA,MAAM;MAAEiC;IAAF,IAAW,IAAjB;IAEA,MAAMY,MAAM,GAAGZ,IAAI,CAACa,qBAAL,EAAf;;IAEA,IAAI,CAACjD,QAAQ,CAACkD,KAAd,EAAqB;MACnBlD,QAAQ,CAACkD,KAAT,GAAiB,CAAjB;IACD;;IAED,IAAI,CAAClD,QAAQ,CAACmD,MAAd,EAAsB;MACpBnD,QAAQ,CAACmD,MAAT,GAAkB,CAAlB;IACD;;IAED,MAAMC,SAAS,GAAG,KAAKC,QAAL,CAAcC,YAAd,EAAlB;IAAA,MACMC,eAAe,GAAGH,SAAS,CAACH,qBAAV,EADxB;;IAGA,IAAIM,eAAe,CAACL,KAAhB,GAAwBK,eAAe,CAACJ,MAA5C,EAAoD;MAClD,KAAKf,IAAL,CAAUoB,SAAV,CAAoBC,GAApB,CAAwB,YAAxB;MACA,KAAKrB,IAAL,CAAUoB,SAAV,CAAoBE,MAApB,CAA2B,UAA3B;IACD,CAHD,MAGO;MACL,KAAKtB,IAAL,CAAUoB,SAAV,CAAoBC,GAApB,CAAwB,UAAxB;MACA,KAAKrB,IAAL,CAAUoB,SAAV,CAAoBE,MAApB,CAA2B,YAA3B;IACD;;IAED,MAAM;MAAEC,UAAF;MAAcC;IAAd,IAA4BC,uBAAuB,CAACzB,IAAD,CAAzD;IAEA,MAAM0B,KAAK,GAAG,EAAd;IAEA,IAAIC,SAAJ;;IAEA,IAAI/D,QAAQ,CAACgE,KAAb,EAAoB;MAClBD,SAAS,GAAG/D,QAAQ,CAACgE,KAAT,CAAeC,KAAf,CAAqB,GAArB,CAAZ;IACD;;IAED,IAAIC,IAAJ,EAAUC,GAAV;IAEA,MAAMC,mBAAmB,GAAGL,SAAS,IAAIA,SAAS,CAAC,CAAD,CAAtB,KAC1B/D,QAAQ,CAACQ,CAAT,GAAcR,QAAQ,CAACkD,KAAT,GAAiB,CAA/B,GAAoCK,eAAe,CAACL,KAAhB,GAAwB,CAA5D,GACI,MADJ,GAEI,OAHsB,CAA5B;;IAMA,IAAIkB,mBAAmB,KAAK,MAA5B,EAAoC;MAClCF,IAAI,GAAGlE,QAAQ,CAACQ,CAAT,GACH+C,eAAe,CAACW,IADb,GAEHlB,MAAM,CAACE,KAFJ,GAGH3B,MAAM,CAACf,CAHJ,GAIHmD,UAJJ;MAMAvB,IAAI,CAACoB,SAAL,CAAeE,MAAf,CAAsB,OAAtB;MACAtB,IAAI,CAACoB,SAAL,CAAeC,GAAf,CAAmB,MAAnB;IACD,CATD,MASO;MACLS,IAAI,GAAG,CAACX,eAAe,CAACW,IAAjB,GACHlE,QAAQ,CAACQ,CADN,GAEHR,QAAQ,CAACkD,KAFN,GAGH3B,MAAM,CAACf,CAHJ,GAIHmD,UAJJ;MAMAvB,IAAI,CAACoB,SAAL,CAAeE,MAAf,CAAsB,MAAtB;MACAtB,IAAI,CAACoB,SAAL,CAAeC,GAAf,CAAmB,OAAnB;IACD;;IACDS,IAAI,GAAGH,SAAS,GAAGG,IAAH,GAAUG,WAAW,CACnCH,IADmC,EAEnC,IAAIP,UAF+B,EAGnCJ,eAAe,CAACL,KAAhB,GAAwBF,MAAM,CAACE,KAA/B,GAAuCS,UAHJ,CAArC;IAKAG,KAAK,CAACI,IAAN,GAAaA,IAAI,GAAG,IAApB;IAEA,MAAMI,iBAAiB,GAAGP,SAAS,IAAIA,SAAS,CAAC,CAAD,CAAtB,KACxB/D,QAAQ,CAACS,CAAT,GAAcT,QAAQ,CAACmD,MAAT,GAAkB,CAAhC,GAAqCI,eAAe,CAACJ,MAAhB,GAAyB,CAA9D,GACI,KADJ,GAEI,QAHoB,CAA1B;;IAMA,IAAImB,iBAAiB,KAAK,KAA1B,EAAiC;MAC/BH,GAAG,GAAGnE,QAAQ,CAACS,CAAT,GACF8C,eAAe,CAACY,GADd,GAEFnB,MAAM,CAACG,MAFL,GAGF5B,MAAM,CAACd,CAHL,GAIFmD,SAJJ;MAMAxB,IAAI,CAACoB,SAAL,CAAeE,MAAf,CAAsB,QAAtB;MACAtB,IAAI,CAACoB,SAAL,CAAeC,GAAf,CAAmB,KAAnB;IACD,CATD,MASO;MACLU,GAAG,GAAG,CAACZ,eAAe,CAACY,GAAjB,GACFnE,QAAQ,CAACS,CADP,GAEFc,MAAM,CAACd,CAFL,GAGFmD,SAHJ;MAKAxB,IAAI,CAACoB,SAAL,CAAeE,MAAf,CAAsB,KAAtB;MACAtB,IAAI,CAACoB,SAAL,CAAeC,GAAf,CAAmB,QAAnB;IACD;;IACDU,GAAG,GAAGJ,SAAS,GAAGI,GAAH,GAASE,WAAW,CACjCF,GADiC,EAEjC,IAAIP,SAF6B,EAGjCL,eAAe,CAACJ,MAAhB,GAAyBH,MAAM,CAACG,MAAhC,GAAyCS,SAHR,CAAnC;IAKAE,KAAK,CAACK,GAAN,GAAYA,GAAG,GAAG,IAAlB,CAtGe,CAwGf;;IACAL,KAAK,CAACS,SAAN,GAAkB,MAAlB;IACAT,KAAK,CAACU,SAAN,GAAmBjB,eAAe,CAACJ,MAAhB,GAAyBgB,GAAzB,GAA+BP,SAAhC,GAA6C,IAA/D;IAEArE,MAAM,CAAC,KAAK6C,IAAL,CAAU0B,KAAX,EAAkB/D,aAAlB,EAAiC+D,KAAjC,CAAN;EACD;;EAGD3C,MAAM,GAAG;IAEP,MAAM;MACJf,OADI;MAEJgB,UAFI;MAGJqD;IAHI,IAIF,KAAKtE,KAJT;IAMA,6BAIgBsE,SAJhB,EAMMrD,UAAU,CAACsD,GAAX,CACE,CAACpF,SAAD,EAAYqF,GAAZ;MAAA,WAAqDvE;IAArD,GAAqCuE,GAArC,CADF,CANN;MAAA,iBAGoBC,CAAC,IAAIA,CAAC,CAACzC,cAAF;IAHzB,SAEU,KAAK0C,OAFf;EAYD;;AApPiC;;AAuPpCjD,WAAW,CAACD,OAAZ,GAAsB,CACpB,UADoB,CAAtB,C,CAKA;;AAEA,SAAS0C,WAAT,CAAqBS,MAArB,EAA6BC,GAA7B,EAAkCC,GAAlC,EAAuC;EACrC,OAAOC,IAAI,CAACD,GAAL,CAASD,GAAT,EAAcE,IAAI,CAACF,GAAL,CAASC,GAAT,EAAcF,MAAd,CAAd,CAAP;AACD;;AAED,MAAMI,mBAAmB,GAAI;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAVA;;AAYA,SAAS5C,WAAT,CAAqB6C,EAArB,EAAyB;EAEvB,IAAIC,OAAO,GAAGvF,QAAQ,CAACqF,mBAAD,EAAsBC,EAAtB,CAAtB;;EAEA,IAAIC,OAAJ,EAAa;IACXA,OAAO,CAACC,KAAR,GADW,CAGX;;IACA,IAAID,OAAO,CAACE,cAAR,IAA0BF,OAAO,CAACG,IAAR,KAAiB,MAA/C,EAAuD;MACrDH,OAAO,CAACE,cAAR,GAAyB,MAAzB;IACD,CAFD,MAIA;MACA,IAAI,qBAAqBF,OAAzB,EAAkC;QAChCtF,QAAQ,CAACsF,OAAD,EAAU;UAAEI,KAAK,EAAE,MAAT;UAAiBC,GAAG,EAAE;QAAtB,CAAV,CAAR;MACD;EACF;AACF;;AAED,SAAS5B,uBAAT,CAAiCzB,IAAjC,EAAuC;EACrC,MAAMsD,cAAc,GAAG/F,UAAU,CAACyC,IAAD,EAAO,gBAAP,CAAjC;;EAEA,IAAI,CAACsD,cAAL,EAAqB;IACnB,OAAO;MACL9B,SAAS,EAAE,CADN;MAELD,UAAU,EAAE;IAFP,CAAP;EAID;;EAED,MAAM;IAAEA,UAAF;IAAcC;EAAd,IAA4B8B,cAAlC;EAEA,OAAO;IACL9B,SADK;IAELD;EAFK,CAAP;AAID"}