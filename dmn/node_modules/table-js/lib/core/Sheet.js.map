{"version":3,"file":"Sheet.js","names":["Sheet","constructor","elementRegistry","eventBus","_elementRegistry","_eventBus","_root","on","setRoot","root","oldRoot","fire","getRoot","id","rows","cols","addRow","row","index","length","cells","Error","addAtIndex","add","forEach","cell","idx","col","removeRow","get","indexOf","removeAtIndex","undefined","remove","addCol","removeCol","resized","$inject","array","value","splice"],"sources":["../../src/core/Sheet.js"],"sourcesContent":["export default class Sheet {\n  constructor(elementRegistry, eventBus) {\n    this._elementRegistry = elementRegistry;\n    this._eventBus = eventBus;\n\n    this._root = null;\n\n    eventBus.on('table.clear', () => {\n      this.setRoot(null);\n    });\n  }\n\n  setRoot(root) {\n    if (this._root) {\n      const oldRoot = this._root;\n\n      this._eventBus.fire('root.remove', { root: oldRoot });\n\n      this._root = null;\n\n      this._eventBus.fire('root.removed', { root: oldRoot });\n    }\n\n    if (root) {\n      this._eventBus.fire('root.add', { root });\n    }\n\n    this._root = root;\n\n    if (root) {\n      this._eventBus.fire('root.added', { root });\n    }\n  }\n\n  getRoot() {\n    if (!this._root) {\n      this.setRoot({\n        id: '__implicitroot',\n        rows: [],\n        cols: []\n      });\n    }\n\n    return this._root;\n  }\n\n\n  /**\n   * Add row to sheet.\n   *\n   * @param {Object} row - Row.\n   */\n  addRow(row, index) {\n    const root = this.getRoot();\n\n    if (root.cols.length != row.cells.length) {\n      throw new Error('number of cells is not equal to number of cols');\n    }\n\n    if (typeof index === 'undefined') {\n      index = root.rows.length;\n    }\n\n    addAtIndex(index, root.rows, row);\n    row.root = root;\n\n    this._elementRegistry.add(row);\n\n    row.cells.forEach((cell, idx) => {\n      this._elementRegistry.add(cell);\n\n      cell.row = row;\n      cell.col = root.cols[idx];\n\n      addAtIndex(index, root.cols[idx].cells, cell);\n    });\n\n    this._eventBus.fire('row.add', { row });\n\n    return row;\n  }\n\n\n  /**\n   * Remove row from sheet.\n   *\n   * @param {Object|string} row - Row or row ID.\n   */\n  removeRow(row) {\n    const root = this.getRoot();\n\n    if (typeof row === 'string') {\n      row = this._elementRegistry.get(row);\n    }\n\n    const index = root.rows.indexOf(row);\n\n    if (index === -1) {\n      return;\n    }\n\n    removeAtIndex(index, root.rows);\n    row.root = undefined;\n\n    this._elementRegistry.remove(row);\n\n    row.cells.forEach((cell, idx) => {\n      this._elementRegistry.remove(cell);\n\n      cell.col = undefined;\n\n      removeAtIndex(index, root.cols[idx].cells);\n    });\n\n    this._eventBus.fire('row.remove', { row });\n  }\n\n  /**\n   * Add col to sheet.\n   *\n   * @param {Object} col\n   * @param {Number} [index]\n   */\n  addCol(col, index) {\n    const root = this.getRoot();\n\n    this._elementRegistry.add(col);\n\n    if (root.rows.length != col.cells.length) {\n      throw new Error('number of cells is not equal to number of rows');\n    }\n\n    if (typeof index === 'undefined') {\n      index = root.cols.length;\n    }\n\n    addAtIndex(index, root.cols, col);\n    col.root = root;\n\n    col.cells.forEach((cell, idx) => {\n      this._elementRegistry.add(cell);\n\n      cell.col = col;\n      cell.row = root.rows[idx];\n\n      addAtIndex(index, root.rows[idx].cells, cell);\n    });\n\n    this._eventBus.fire('col.add', { col });\n\n    return col;\n  }\n\n  /**\n   * Remove col from sheet.\n   *\n   * @param {Object|string} col - Col or col ID.\n   */\n  removeCol(col) {\n\n    const root = this.getRoot();\n\n    if (typeof col === 'string') {\n      col = this._elementRegistry.get(col);\n    }\n\n    const index = root.cols.indexOf(col);\n\n    if (index === -1) {\n      return;\n    }\n\n    removeAtIndex(index, root.cols);\n    col.root = undefined;\n\n    this._elementRegistry.remove(col);\n\n    col.cells.forEach((cell, idx) => {\n      this._elementRegistry.remove(cell);\n\n      cell.row = undefined;\n\n      removeAtIndex(index, root.rows[idx].cells);\n    });\n\n    this._eventBus.fire('col.remove', { col });\n  }\n\n  resized() {\n    this._eventBus.fire('sheet.resized');\n  }\n\n}\n\nSheet.$inject = [ 'elementRegistry', 'eventBus' ];\n\n\n// helpers /////////////\n\n/**\n * Insert value\n *\n * @param {number} index - Index to insert value at.\n * @param {Array} array - Array to insert value into.\n * @param {*} value - Value to insert.\n */\nfunction addAtIndex(index, array, value) {\n  return array.splice(index, 0, value);\n}\n\n/**\n *\n * @param {number} index - Index to remove.\n * @param {Array} array - Array to remove from.\n */\nfunction removeAtIndex(index, array) {\n  return array.splice(index, 1);\n}"],"mappings":"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"}