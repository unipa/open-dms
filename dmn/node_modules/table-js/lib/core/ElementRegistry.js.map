{"version":3,"file":"ElementRegistry.js","names":["ElementRegistry","constructor","eventBus","_eventBus","_elements","on","clear","bind","add","element","type","id","remove","get","getAll","values","forEach","fn","filter","updateId","newId","_validateId","fire","Error","$inject","obj","Object","keys","map","k"],"sources":["../../src/core/ElementRegistry.js"],"sourcesContent":["export default class ElementRegistry {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    this._elements = {};\n\n    eventBus.on('table.clear', this.clear.bind(this));\n  }\n\n  add(element, type) {\n    const { id } = element;\n\n    this._elements[id] = element;\n  }\n\n  remove(element) {\n    const id = element.id || element;\n\n    delete this._elements[id];\n  }\n\n  get(id) {\n    return this._elements[id];\n  }\n\n  getAll() {\n    return values(this._elements);\n  }\n\n  forEach(fn) {\n    values(this._elements).forEach(element => fn(element));\n  }\n\n  filter(fn) {\n    return values(this._elements).filter(element => fn(element));\n  }\n\n  clear() {\n    this._elements = {};\n  }\n\n  updateId(element, newId) {\n\n    this._validateId(newId);\n\n    if (typeof element === 'string') {\n      element = this.get(element);\n    }\n\n    this._eventBus.fire('element.updateId', {\n      element: element,\n      newId: newId\n    });\n\n    this.remove(element);\n\n    element.id = newId;\n\n    this.add(element);\n  }\n\n  /**\n * Validate the suitability of the given id and signals a problem\n * with an exception.\n *\n * @param {String} id\n *\n * @throws {Error} if id is empty or already assigned\n */\n  _validateId(id) {\n    if (!id) {\n      throw new Error('element must have an id');\n    }\n\n    if (this._elements[id]) {\n      throw new Error('element with id ' + id + ' already added');\n    }\n  }\n}\n\nElementRegistry.$inject = [ 'eventBus' ];\n\n\n// helpers\n\nfunction values(obj) {\n  return Object.keys(obj).map(function(k) {\n    return obj[k];\n  });\n}"],"mappings":"AAAA,eAAe,MAAMA,eAAN,CAAsB;EACnCC,WAAW,CAACC,QAAD,EAAW;IACpB,KAAKC,SAAL,GAAiBD,QAAjB;IAEA,KAAKE,SAAL,GAAiB,EAAjB;IAEAF,QAAQ,CAACG,EAAT,CAAY,aAAZ,EAA2B,KAAKC,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAA3B;EACD;;EAEDC,GAAG,CAACC,OAAD,EAAUC,IAAV,EAAgB;IACjB,MAAM;MAAEC;IAAF,IAASF,OAAf;IAEA,KAAKL,SAAL,CAAeO,EAAf,IAAqBF,OAArB;EACD;;EAEDG,MAAM,CAACH,OAAD,EAAU;IACd,MAAME,EAAE,GAAGF,OAAO,CAACE,EAAR,IAAcF,OAAzB;IAEA,OAAO,KAAKL,SAAL,CAAeO,EAAf,CAAP;EACD;;EAEDE,GAAG,CAACF,EAAD,EAAK;IACN,OAAO,KAAKP,SAAL,CAAeO,EAAf,CAAP;EACD;;EAEDG,MAAM,GAAG;IACP,OAAOC,MAAM,CAAC,KAAKX,SAAN,CAAb;EACD;;EAEDY,OAAO,CAACC,EAAD,EAAK;IACVF,MAAM,CAAC,KAAKX,SAAN,CAAN,CAAuBY,OAAvB,CAA+BP,OAAO,IAAIQ,EAAE,CAACR,OAAD,CAA5C;EACD;;EAEDS,MAAM,CAACD,EAAD,EAAK;IACT,OAAOF,MAAM,CAAC,KAAKX,SAAN,CAAN,CAAuBc,MAAvB,CAA8BT,OAAO,IAAIQ,EAAE,CAACR,OAAD,CAA3C,CAAP;EACD;;EAEDH,KAAK,GAAG;IACN,KAAKF,SAAL,GAAiB,EAAjB;EACD;;EAEDe,QAAQ,CAACV,OAAD,EAAUW,KAAV,EAAiB;IAEvB,KAAKC,WAAL,CAAiBD,KAAjB;;IAEA,IAAI,OAAOX,OAAP,KAAmB,QAAvB,EAAiC;MAC/BA,OAAO,GAAG,KAAKI,GAAL,CAASJ,OAAT,CAAV;IACD;;IAED,KAAKN,SAAL,CAAemB,IAAf,CAAoB,kBAApB,EAAwC;MACtCb,OAAO,EAAEA,OAD6B;MAEtCW,KAAK,EAAEA;IAF+B,CAAxC;;IAKA,KAAKR,MAAL,CAAYH,OAAZ;IAEAA,OAAO,CAACE,EAAR,GAAaS,KAAb;IAEA,KAAKZ,GAAL,CAASC,OAAT;EACD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;EACEY,WAAW,CAACV,EAAD,EAAK;IACd,IAAI,CAACA,EAAL,EAAS;MACP,MAAM,IAAIY,KAAJ,CAAU,yBAAV,CAAN;IACD;;IAED,IAAI,KAAKnB,SAAL,CAAeO,EAAf,CAAJ,EAAwB;MACtB,MAAM,IAAIY,KAAJ,CAAU,qBAAqBZ,EAArB,GAA0B,gBAApC,CAAN;IACD;EACF;;AA7EkC;AAgFrCX,eAAe,CAACwB,OAAhB,GAA0B,CAAE,UAAF,CAA1B,C,CAGA;;AAEA,SAAST,MAAT,CAAgBU,GAAhB,EAAqB;EACnB,OAAOC,MAAM,CAACC,IAAP,CAAYF,GAAZ,EAAiBG,GAAjB,CAAqB,UAASC,CAAT,EAAY;IACtC,OAAOJ,GAAG,CAACI,CAAD,CAAV;EACD,CAFM,CAAP;AAGD"}