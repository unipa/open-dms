!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).SelectionRanges={})}(this,function(t){"use strict";var f=function(t,e){return t^e};var s=/\b(Array|Date|Object|Math|JSON)\b/g,n=function(t,e){var n,r,i,o=function(t){for(var e=[],n=0;n<t.length;n++)~e.indexOf(t[n])||e.push(t[n]);return e}(t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(s,"").match(/[a-zA-Z_]\w*/g)||[]);return e&&"string"==typeof e&&(n=e,e=function(t){return n+t}),e?(r=o,i=e,t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g,function(t){return"("==t[t.length-1]?i(t):~r.indexOf(t)?i(t):t})):o};var d=r;function r(t,e){if(!(this instanceof r))return new r(t,e);if(this.node=this.start=this.peeked=t,this.root=e,this.closingTag=!1,this._revisit=!0,this._selects=[],this._rejects=[],t&&this.higher(t))throw new Error("root must be a parent or ancestor to node")}function e(s,u){var a="nextSibling"==s;return function(t,e,n){t=this.compile(t),e=e&&0<e?e:1;for(var r=this.node,i=this.closingTag,o=this._revisit;r;){if(f(a,i)&&r[u])r=r[u],i=!a;else if(1==r.nodeType&&!r[u]&&f(a,i)){if(i=a,!o)continue}else if(r[s])r=r[s],i=!a;else if(r=r.parentNode,i=a,!o)continue;if(!r||this.higher(r,this.root))break;if(t(r)&&this.selects(r,n)&&this.rejects(r,n)){if(--e)continue;return n||(this.node=r),this.closingTag=i,r}}return null}}r.prototype.reset=function(t){return this.node=t||this.start,this},r.prototype.revisit=function(t){return this._revisit=null==t||t,this},r.prototype.opening=function(){return 1==this.node.nodeType&&(this.closingTag=!1),this},r.prototype.atOpening=function(){return!this.closingTag},r.prototype.closing=function(){return 1==this.node.nodeType&&(this.closingTag=!0),this},r.prototype.atClosing=function(){return this.closingTag},r.prototype.next=e("nextSibling","firstChild"),r.prototype.previous=r.prototype.prev=e("previousSibling","lastChild"),r.prototype.select=function(t){return t=this.compile(t),this._selects.push(t),this},r.prototype.selects=function(t,e){var n=this._selects,r=n.length;if(!r)return!0;for(var i=0;i<r;i++)if(n[i].call(this,t,e))return!0;return!1},r.prototype.reject=function(t){return t=this.compile(t),this._rejects.push(t),this},r.prototype.rejects=function(t,e){var n=this._rejects,r=n.length;if(!r)return!0;for(var i=0;i<r;i++)if(n[i].call(this,t,e))return!1;return!0},r.prototype.higher=function(t){var e=this.root;if(!e)return!1;for(t=t.parentNode;t&&t!=e;)t=t.parentNode;return t!=e},r.prototype.compile=function(e){switch(typeof e){case"number":return function(t){return e==t.nodeType};case"string":return new Function("node","return "+n(e,"node."));case"function":return e;default:return function(){return!0}}},r.prototype.peak=r.prototype.peek=function(t,e){return 1==arguments.length&&(e=t,t=!0),(e=null==e?1:e)?0<e?this.next(t,e,!0):this.prev(t,Math.abs(e),!0):this.node},r.prototype.use=function(t){return t(this),this};var g=window.getSelection();function i(t){g.removeAllRanges(),g.addRange(t)}function y(t){if(!g.rangeCount)return null;var e=g.focusNode;return v(e)&&(e=e.parentNode),t==e||t.contains(e)}function v(t){return 3===t.nodeType}function b(t){return 1===t.nodeType&&"BR"===t.nodeName}function S(t){return 1===t.nodeType&&"DIV"===t.nodeName}function T(t){return 1===t.nodeType&&"P"===t.nodeName}t.applyRange=i,t.getWindowSelection=function(){return g},t.isSelected=y,t.setRange=function(t,e){i(function(t,e){for(var n,r=e.start,i=e.end,o=document.createRange(),s=d(t.firstChild,t),u=s.node,a=!1,f=0;u;){if(f===r&&(a?o.setStartAfter(u):o.setStartBefore(u)),f===i)return a?o.setEndAfter(u):o.setEndBefore(u),o;if(a||(b(u)||u.previousSibling&&(S(u)||T(u)))&&f++,v(u)){if(n=u.textContent.length,f<=r&&r<f+n&&o.setStart(u,r-f),i<f+n)return o.setEnd(u,i-f),o;f+=n}u=s.next(),a=s.closingTag}return f<=r&&(t.lastChild?o.setStartAfter(t.lastChild):o.setStart(t,0)),t.lastChild?o.setEndAfter(t.lastChild):o.setEnd(t,0),o}(t,e))},t.getRange=function(t){if(!y(t))return null;var e,n,r=g.getRangeAt(0),i=r.startContainer,o=r.endContainer,s=r.startOffset,u=r.endOffset,a=d(t.firstChild,t),f=a.node,c=!1,l=0;function h(t,e){return 1===arguments.length&&(e=t),t.parentNode===o&&e==o.childNodes[u]}function p(t,e){return 1===arguments.length&&(e=t),t.parentNode===i&&e==i.childNodes[s]}for(;f&&(p(f)&&(n=l),!h(f));){if(c||(b(f)||e&&e.nextSibling==f&&(S(f)||T(f)))&&l++,v(f)){if(i===f&&(n=l+s),o===f){l+=u;break}l+=f.textContent.length}if((v(f)||c)&&(p(f,f.nextSibling)&&(n=l),h(f,f.nextSibling)))break;e=f,f=a.next(),c=a.closingTag}return{start:void 0===n?l:n,end:l}},t.annotateRange=function(t,e){return e.start===e.end?t.substring(0,e.start)+"|"+t.substring(e.start):t.substring(0,e.start)+"<"+t.substring(e.start,e.end)+">"+t.substring(e.end)},Object.defineProperty(t,"__esModule",{value:!0})});
