/*! bpmn-js - bpmn-modeler v16.3.2 | Copyright (c) 2014-present, camunda Services GmbH | bpmn.io/license */
!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (e = "undefined" != typeof globalThis ? globalThis : e || self).BpmnJS = t() }(this, (function () {
    "use strict"; function e(e, t) { t && (e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } })) } var t = function (e, t) { return e(t = { exports: {} }, t.exports), t.exports }((function (e) { var t = e.exports = function (e, n) { if (n || (n = 16), void 0 === e && (e = 128), e <= 0) return "0"; for (var i = Math.log(Math.pow(2, e)) / Math.log(n), r = 2; i === 1 / 0; r *= 2)i = Math.log(Math.pow(2, e / r)) / Math.log(n) * r; var o = i - Math.floor(i), a = ""; for (r = 0; r < Math.floor(i); r++) { a = Math.floor(Math.random() * n).toString(n) + a } if (o) { var s = Math.pow(n, o); a = Math.floor(Math.random() * s).toString(n) + a } var c = parseInt(a, n); return c !== 1 / 0 && c >= Math.pow(2, e) ? t(e, n) : a }; t.rack = function (e, n, i) { var r = function (r) { var a = 0; do { if (a++ > 10) { if (!i) throw new Error("too many ID collisions, use more bits"); e += i } var s = t(e, n) } while (Object.hasOwnProperty.call(o, s)); return o[s] = r, s }, o = r.hats = {}; return r.get = function (e) { return r.hats[e] }, r.set = function (e, t) { return r.hats[e] = t, r }, r.bits = e || 128, r.base = n || 16, r } })); function n(e) { if (!(this instanceof n)) return new n(e); e = e || [128, 36, 1], this._seed = e.length ? t.rack(e[0], e[1], e[2]) : e } function i(e) { return Array.prototype.concat.apply([], e) } n.prototype.next = function (e) { return this._seed(e || !0) }, n.prototype.nextPrefixed = function (e, t) { var n; do { n = e + this.next(!0) } while (this.assigned(n)); return this.claim(n, t), n }, n.prototype.claim = function (e, t) { this._seed.set(e, t || !0) }, n.prototype.assigned = function (e) { return this._seed.get(e) || !1 }, n.prototype.unclaim = function (e) { delete this._seed.hats[e] }, n.prototype.clear = function () { var e, t = this._seed.hats; for (e in t) this.unclaim(e) }; const r = Object.prototype.toString, o = Object.prototype.hasOwnProperty; function a(e) { return void 0 === e } function s(e) { return void 0 !== e } function c(e) { return null == e } function p(e) { return "[object Array]" === r.call(e) } function l(e) { return "[object Object]" === r.call(e) } function u(e) { return "[object Number]" === r.call(e) } function h(e) { const t = r.call(e); return "[object Function]" === t || "[object AsyncFunction]" === t || "[object GeneratorFunction]" === t || "[object AsyncGeneratorFunction]" === t || "[object Proxy]" === t } function d(e) { return "[object String]" === r.call(e) } function f(e, t) { return o.call(e, t) } function m(e, t) { const n = D(t); let i; return g(e, (function (e, t) { if (n(e, t)) return i = e, !1 })), i } function v(e, t) { const n = D(t); let i = p(e) ? -1 : void 0; return g(e, (function (e, t) { if (n(e, t)) return i = t, !1 })), i } function y(e, t) { const n = D(t); let i = []; return g(e, (function (e, t) { n(e, t) && i.push(e) })), i } function g(e, t) { let n, i; if (a(e)) return; const r = p(e) ? N : B; for (let o in e) if (f(e, o) && (n = e[o], i = t(n, r(o)), !1 === i)) return n } function _(e, t) { if (a(e)) return []; !function (e) { if (!p(e)) throw new Error("must supply array") }(e); const n = D(t); return e.filter((function (e, t) { return !n(e, t) })) } function b(e, t, n) { return g(e, (function (e, i) { n = t(n, e, i) })), n } function x(e, t) { return !!b(e, (function (e, n, i) { return e && t(n, i) }), !0) } function w(e, t) { return !!m(e, t) } function E(e, t) { let n = []; return g(e, (function (e, i) { n.push(t(e, i)) })), n } function S(e) { return e && Object.keys(e) || [] } function C(e) { return E(e, (e => e)) } function k(e, t, n = {}) { return t = M(t), g(e, (function (e) { let i = t(e) || "_", r = n[i]; r || (r = n[i] = []), r.push(e) })), n } function R(e, ...t) { e = M(e); let n = {}; return g(t, (t => k(t, e, n))), E(n, (function (e, t) { return e[0] })) } const P = R; function T(e, t) { t = M(t); let n = []; return g(e, (function (e, i) { let r = t(e, i), o = { d: r, v: e }; for (var a = 0; a < n.length; a++) { let { d: e } = n[a]; if (r < e) return void n.splice(a, 0, o) } n.push(o) })), E(n, (e => e.v)) } function A(e) { return function (t) { return x(e, (function (e, n) { return t[n] === e })) } } function M(e) { return h(e) ? e : t => t[e] } function D(e) { return h(e) ? e : t => t === e } function B(e) { return e } function N(e) { return Number(e) } function O(e, t) { let n, i, r, o; function a(n) { let a = Date.now(), p = n ? 0 : o + t - a; if (p > 0) return s(p); e.apply(r, i), c() } function s(e) { n = setTimeout(a, e) } function c() { n && clearTimeout(n), n = o = i = r = void 0 } function p(...e) { o = Date.now(), i = e, r = this, n || s(t) } return p.flush = function () { n && a(!0), c() }, p.cancel = c, p } function j(e, t) { return e.bind(t) } function L(e, ...t) { return Object.assign(e, ...t) } function I(e, t) { let n = {}, i = Object(e); return g(t, (function (t) { t in i && (n[t] = e[t]) })), n } function $(e, t) { let n = {}; return g(Object(e), (function (e, i) { -1 === t.indexOf(i) && (n[i] = e) })), n } function F(e, t) { return t.forEach((function (t) { t && "string" != typeof t && !Array.isArray(t) && Object.keys(t).forEach((function (n) { if ("default" !== n && !(n in e)) { var i = Object.getOwnPropertyDescriptor(t, n); Object.defineProperty(e, n, i.get ? i : { enumerable: !0, get: function () { return t[n] } }) } })) })), Object.freeze(e) } const z = Object.prototype.toString, H = Object.prototype.hasOwnProperty; function V(e, t) { return H.call(e, t) } function W(e, t) { let n, i; if (void 0 === e) return; const r = function (e) { return "[object Array]" === z.call(e) }(e) ? U : G; for (let o in e) if (V(e, o) && (n = e[o], i = t(n, r(o)), !1 === i)) return n } function G(e) { return e } function U(e) { return Number(e) } function q(e, ...t) { const n = e.style; return W(t, (function (e) { e && W(e, (function (e, t) { n[t] = e })) })), e } function K(e, t, n) { return 2 == arguments.length ? e.getAttribute(t) : null === n ? e.removeAttribute(t) : (e.setAttribute(t, n), e) } const Y = Object.prototype.toString; function X(e) { return new Z(e) } function Z(e) { if (!e || !e.nodeType) throw new Error("A DOM element reference is required"); this.el = e, this.list = e.classList } function Q(e) { for (var t; e.childNodes.length;)t = e.childNodes[0], e.removeChild(t); return e } function J(e, t) { return e && "function" == typeof e.matches && e.matches(t) } function ee(e, t, n) { for (var i = n ? e : e.parentNode; i && i.nodeType !== document.DOCUMENT_NODE && i.nodeType !== document.DOCUMENT_FRAGMENT_NODE;) { if (J(i, t)) return i; i = i.parentNode } return J(i, t) ? i : null } Z.prototype.add = function (e) { return this.list.add(e), this }, Z.prototype.remove = function (e) { return "[object RegExp]" == Y.call(e) ? this.removeMatching(e) : (this.list.remove(e), this) }, Z.prototype.removeMatching = function (e) { const t = this.array(); for (let n = 0; n < t.length; n++)e.test(t[n]) && this.remove(t[n]); return this }, Z.prototype.toggle = function (e, t) { return void 0 !== t ? t !== this.list.toggle(e, t) && this.list.toggle(e) : this.list.toggle(e), this }, Z.prototype.array = function () { return Array.from(this.list) }, Z.prototype.has = Z.prototype.contains = function (e) { return this.list.contains(e) }; var te, ne, ie, re = {}; function oe() { te = window.addEventListener ? "addEventListener" : "attachEvent", ne = window.removeEventListener ? "removeEventListener" : "detachEvent", ie = "addEventListener" !== te ? "on" : "" } var ae = F({ __proto__: null, bind: re.bind = function (e, t, n, i) { return te || oe(), e[te](ie + t, n, i || !1), n }, unbind: re.unbind = function (e, t, n, i) { return ne || oe(), e[ne](ie + t, n, i || !1), n }, default: re }, [re]), se = ["focus", "blur"]; var ce, pe = { bind: function (e, t, n, i, r) { return -1 !== se.indexOf(n) && (r = !0), ae.bind(e, n, (function (n) { var r = n.target || n.srcElement; n.delegateTarget = ee(r, t, !0), n.delegateTarget && i.call(e, n) }), r) }, unbind: function (e, t, n, i) { return -1 !== se.indexOf(t) && (i = !0), ae.unbind(e, t, n, i) } }, le = function (e, t) { if ("string" != typeof e) throw new TypeError("String expected"); t || (t = document); var n = /<([\w:]+)/.exec(e); if (!n) return t.createTextNode(e); e = e.replace(/^\s+|\s+$/g, ""); var i = n[1]; if ("body" == i) { return (r = t.createElement("html")).innerHTML = e, r.removeChild(r.lastChild) } var r, o = Object.prototype.hasOwnProperty.call(he, i) ? he[i] : he._default, a = o[0], s = o[1], c = o[2]; (r = t.createElement("div")).innerHTML = s + e + c; for (; a--;)r = r.lastChild; if (r.firstChild == r.lastChild) return r.removeChild(r.firstChild); var p = t.createDocumentFragment(); for (; r.firstChild;)p.appendChild(r.removeChild(r.firstChild)); return p }, ue = !1; "undefined" != typeof document && ((ce = document.createElement("div")).innerHTML = '  <link/><table></table><a href="/a">a</a><input type="checkbox"/>', ue = !ce.getElementsByTagName("link").length, ce = void 0); var he = { legend: [1, "<fieldset>", "</fieldset>"], tr: [2, "<table><tbody>", "</tbody></table>"], col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"], _default: ue ? [1, "X<div>", "</div>"] : [0, "", ""] }; he.td = he.th = [3, "<table><tbody><tr>", "</tr></tbody></table>"], he.option = he.optgroup = [1, '<select multiple="multiple">', "</select>"], he.thead = he.tbody = he.colgroup = he.caption = he.tfoot = [1, "<table>", "</table>"], he.polyline = he.ellipse = he.polygon = he.circle = he.text = he.line = he.path = he.rect = he.g = [1, '<svg xmlns="http://www.w3.org/2000/svg" version="1.1">', "</svg>"]; var de = le; function fe(e, t) { return (t = t || document).querySelector(e) } function me(e, t) { return (t = t || document).querySelectorAll(e) } function ve(e) { e.parentNode && e.parentNode.removeChild(e) } function ye(e, t) { return t.appendChild(function (e, t) { if (e.ownerDocument !== t.ownerDocument) try { return t.ownerDocument.importNode(e, !0) } catch (e) { } return e }(e, t)) } function ge(e, t) { return ye(t, e), e } var _e = 2, be = { "alignment-baseline": 1, "baseline-shift": 1, clip: 1, "clip-path": 1, "clip-rule": 1, color: 1, "color-interpolation": 1, "color-interpolation-filters": 1, "color-profile": 1, "color-rendering": 1, cursor: 1, direction: 1, display: 1, "dominant-baseline": 1, "enable-background": 1, fill: 1, "fill-opacity": 1, "fill-rule": 1, filter: 1, "flood-color": 1, "flood-opacity": 1, font: 1, "font-family": 1, "font-size": _e, "font-size-adjust": 1, "font-stretch": 1, "font-style": 1, "font-variant": 1, "font-weight": 1, "glyph-orientation-horizontal": 1, "glyph-orientation-vertical": 1, "image-rendering": 1, kerning: 1, "letter-spacing": 1, "lighting-color": 1, marker: 1, "marker-end": 1, "marker-mid": 1, "marker-start": 1, mask: 1, opacity: 1, overflow: 1, "pointer-events": 1, "shape-rendering": 1, "stop-color": 1, "stop-opacity": 1, stroke: 1, "stroke-dasharray": 1, "stroke-dashoffset": 1, "stroke-linecap": 1, "stroke-linejoin": 1, "stroke-miterlimit": 1, "stroke-opacity": 1, "stroke-width": _e, "text-anchor": 1, "text-decoration": 1, "text-rendering": 1, "unicode-bidi": 1, visibility: 1, "word-spacing": 1, "writing-mode": 1 }; function xe(e, t, n) { var i = t.replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase(), r = be[i]; r ? (r === _e && "number" == typeof n && (n = String(n) + "px"), e.style[i] = n) : e.setAttributeNS(null, t, n) } function we(e, t, n) { if ("string" == typeof t) { if (void 0 === n) return function (e, t) { return be[t] ? e.style[t] : e.getAttributeNS(null, t) }(e, t); xe(e, t, n) } else !function (e, t) { var n, i, r = Object.keys(t); for (n = 0; i = r[n]; n++)xe(e, i, t[i]) }(e, t); return e } const Ee = Object.prototype.toString; function Se(e) { return new Ce(e) } function Ce(e) { if (!e || !e.nodeType) throw new Error("A DOM element reference is required"); this.el = e, this.list = e.classList } function ke(e) { var t = e.parentNode; return t && t.removeChild(e), e } function Re(e) { for (var t; t = e.firstChild;)ke(t); return e } function Pe(e) { return e.cloneNode(!0) } Ce.prototype.add = function (e) { return this.list.add(e), this }, Ce.prototype.remove = function (e) { return "[object RegExp]" == Ee.call(e) ? this.removeMatching(e) : (this.list.remove(e), this) }, Ce.prototype.removeMatching = function (e) { const t = this.array(); for (let n = 0; n < t.length; n++)e.test(t[n]) && this.remove(t[n]); return this }, Ce.prototype.toggle = function (e, t) { return void 0 !== t ? t !== this.list.toggle(e, t) && this.list.toggle(e) : this.list.toggle(e), this }, Ce.prototype.array = function () { return Array.from(this.list) }, Ce.prototype.has = Ce.prototype.contains = function (e) { return this.list.contains(e) }; var Te = { svg: "http://www.w3.org/2000/svg" }, Ae = '<svg xmlns="' + Te.svg + '"'; function Me(e) { var t = !1; "<svg" === e.substring(0, 4) ? -1 === e.indexOf(Te.svg) && (e = Ae + e.substring(4)) : (e = Ae + ">" + e + "</svg>", t = !0); var n = function (e) { var t; return (t = new DOMParser).async = !1, t.parseFromString(e, "text/xml") }(e); if (!t) return n; for (var i = document.createDocumentFragment(), r = n.firstChild; r.firstChild;)i.appendChild(r.firstChild); return i } function De(e, t) { var n; return "<" === e.charAt(0) ? (n = Me(e).firstChild, n = document.importNode(n, !0)) : n = document.createElementNS(Te.svg, e), t && we(n, t), n } var Be = null; function Ne() { return null === Be && (Be = De("svg")), Be } function Oe(e, t) { var n, i, r = Object.keys(t); for (n = 0; i = r[n]; n++)e[i] = t[i]; return e } function je(e) { return e ? Ne().createSVGTransformFromMatrix(e) : Ne().createSVGTransform() } var Le = /([&<>]{1})/g, Ie = /([\n\r"]{1})/g, $e = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "'" }; function Fe(e, t) { return e.replace(t, (function (e, t) { return $e[t] || t })) } function ze(e, t) { var n, i, r, o, a; switch (e.nodeType) { case 3: t.push(Fe(e.textContent, Le)); break; case 1: if (t.push("<", e.tagName), e.hasAttributes()) for (n = 0, i = (r = e.attributes).length; n < i; ++n)o = r.item(n), t.push(" ", o.name, '="', Fe(o.value, Ie), '"'); if (e.hasChildNodes()) { for (t.push(">"), n = 0, i = (a = e.childNodes).length; n < i; ++n)ze(a.item(n), t); t.push("</", e.tagName, ">") } else t.push("/>"); break; case 8: t.push("\x3c!--", Fe(e.nodeValue, Le), "--\x3e"); break; case 4: t.push("<![CDATA[", e.nodeValue, "]]>"); break; default: throw new Error("unable to handle node " + e.nodeType) }return t } function He(e, t) { var n = Me(t); if (Re(e), t) { (function (e) { return "#document-fragment" === e.nodeName })(n) || (n = n.documentElement); for (var i, r = (i = n.childNodes, Array.prototype.slice.call(i)), o = 0; o < r.length; o++)ye(r[o], e) } } function Ve(e, t) { if (void 0 !== t) { try { He(e, t) } catch (e) { throw new Error("error parsing SVG: " + e.message) } return e } return function (e) { for (var t = e.firstChild, n = []; t;)ze(t, n), t = t.nextSibling; return n.join("") }(e) } function We(e, t) { return t instanceof SVGMatrix ? e.createSVGTransformFromMatrix(t) : t } function Ge(e, t) { var n = e.transform.baseVal; return t && (Array.isArray(t) || (t = [t]), function (e, t) { var n, i; for (e.clear(), n = 0; i = t[n]; n++)e.appendItem(We(e, i)) }(n, t)), n.consolidate() } const Ue = /^class[ {]/; function qe(e) { return Array.isArray(e) } function Ke(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } function Ye(...e) { 1 === e.length && qe(e[0]) && (e = e[0]); const t = (e = [...e]).pop(); return t.$inject = e, t } const Xe = /constructor\s*[^(]*\(\s*([^)]*)\)/m, Ze = /^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m, Qe = /\/\*([^*]*)\*\//m; function Je(e) { if ("function" != typeof e) throw new Error(`Cannot annotate "${e}". Expected a function!`); const t = e.toString().match(function (e) { return Ue.test(e.toString()) }(e) ? Xe : Ze); if (!t) return []; const n = t[1] || t[2]; return n && n.split(",").map((e => { const t = e.match(Qe); return (t && t[1] || e).trim() })) || [] } function et(e, t) { t = t || { get: function (e, t) { if (n.push(e), !1 === t) return null; throw a(`No provider for "${e}"!`) } }; const n = [], i = this._providers = Object.create(t._providers || null), r = this._instances = Object.create(null), o = r.injector = this, a = function (e) { const t = n.join(" -> "); return n.length = 0, new Error(t ? `${e} (Resolving: ${t})` : e) }; function s(e, o) { if (!i[e] && -1 !== e.indexOf(".")) { const t = e.split("."); let n = s(t.shift()); for (; t.length;)n = n[t.shift()]; return n } if (Ke(r, e)) return r[e]; if (Ke(i, e)) { if (-1 !== n.indexOf(e)) throw n.push(e), a("Cannot resolve circular dependency!"); return n.push(e), r[e] = i[e][0](i[e][1]), n.pop(), r[e] } return t.get(e, o) } function c(e, t) { if (void 0 === t && (t = {}), "function" != typeof e) { if (!qe(e)) throw a(`Cannot invoke "${e}". Expected a function!`); e = Ye(e.slice()) } return { fn: e, dependencies: (e.$inject || Je(e)).map((e => Ke(t, e) ? t[e] : s(e))) } } function p(e) { const { fn: t, dependencies: n } = c(e); return new (Function.prototype.bind.apply(t, [null].concat(n))) } function l(e, t, n) { const { fn: i, dependencies: r } = c(e, n); return i.apply(t, r) } function u(e) { return Ye((t => e.get(t))) } function h(e, t) { if (t && t.length) { const n = Object.create(null), r = Object.create(null), o = [], a = [], s = []; let c, p, l, h; for (let e in i) c = i[e], -1 !== t.indexOf(e) && ("private" === c[2] ? (p = o.indexOf(c[3]), -1 === p ? (l = c[3].createChild([], t), h = u(l), o.push(c[3]), a.push(l), s.push(h), n[e] = [h, e, "private", l]) : n[e] = [s[p], e, "private", a[p]]) : n[e] = [c[2], c[1]], r[e] = !0), "factory" !== c[2] && "type" !== c[2] || !c[1].$scope || t.forEach((t => { -1 !== c[1].$scope.indexOf(t) && (n[e] = [c[2], c[1]], r[t] = !0) })); t.forEach((e => { if (!r[e]) throw new Error('No provider for "' + e + '". Cannot use provider from the parent!') })), e.unshift(n) } return new et(e, o) } const d = { factory: l, type: p, value: function (e) { return e } }; function f(e, t) { const n = e.__init__ || []; return function () { n.forEach((e => { "string" == typeof e ? t.get(e) : t.invoke(e) })) } } function m(e) { const t = e.__exports__; if (t) { const n = e.__modules__, r = Object.keys(e).reduce(((t, n) => ("__exports__" !== n && "__modules__" !== n && "__init__" !== n && "__depends__" !== n && (t[n] = e[n]), t)), Object.create(null)), o = h((n || []).concat(r)), a = Ye((function (e) { return o.get(e) })); t.forEach((function (e) { i[e] = [a, e, "private", o] })); const s = (e.__init__ || []).slice(); return s.unshift((function () { o.init() })), f(e = Object.assign({}, e, { __init__: s }), o) } return Object.keys(e).forEach((function (t) { if ("__init__" === t || "__depends__" === t) return; if ("private" === e[t][2]) return void (i[t] = e[t]); const n = e[t][0], r = e[t][1]; i[t] = [d[n], tt(n, r), n] })), f(e, o) } function v(e, t) { return -1 !== e.indexOf(t) || -1 !== (e = (t.__depends__ || []).reduce(v, e)).indexOf(t) ? e : e.concat(t) } this.get = s, this.invoke = l, this.instantiate = p, this.createChild = h, this.init = function (e) { const t = e.reduce(v, []).map(m); let n = !1; return function () { n || (n = !0, t.forEach((e => e()))) } }(e) } function tt(e, t) { return "value" !== e && qe(t) && (t = Ye(t.slice())), t } var nt = 1e3; function it(e, t) { var n = this; t = t || nt, e.on(["render.shape", "render.connection"], t, (function (e, t) { var i = e.type, r = t.element, o = t.gfx, a = t.attrs; if (n.canRender(r)) return "render.shape" === i ? n.drawShape(o, r, a) : n.drawConnection(o, r, a) })), e.on(["render.getShapePath", "render.getConnectionPath"], t, (function (e, t) { if (n.canRender(t)) return "render.getShapePath" === e.type ? n.getShapePath(t) : n.getConnectionPath(t) })) } function rt(e) { return e.flat().join(",").replace(/,?([A-z]),?/g, "$1") } function ot(e) { return ["L", e.x, e.y] } function at(e, t) { const n = e.length, i = [(r = e[0], ["M", r.x, r.y])]; var r, o, a, s; for (let r = 1; r < n; r++) { const n = e[r - 1], c = e[r], p = e[r + 1]; if (!p || !t) { i.push(ot(c)); continue } const l = Math.min(t, ct(c.x - n.x, c.y - n.y), ct(p.x - c.x, p.y - c.y)); if (!l) { i.push(ot(c)); continue } const u = st(c, n, l), h = st(c, n, .5 * l), d = st(c, p, l), f = st(c, p, .5 * l); i.push(ot(u)), i.push((a = f, s = d, ["C", (o = h).x, o.y, a.x, a.y, s.x, s.y])) } return i } function st(e, t, n) { const i = t.x - e.x, r = t.y - e.y, o = n / ct(i, r); return { x: e.x + i * o, y: e.y + r * o } } function ct(e, t) { return Math.sqrt(Math.pow(e, 2) + Math.pow(t, 2)) } function pt(e, t, n) { u(t) && (n = t, t = null), t || (t = {}); const i = De("path", t); return u(n) && (i.dataset.cornerRadius = String(n)), lt(i, e) } function lt(e, t) { return we(e, { d: rt(at(t, parseInt(e.dataset.cornerRadius, 10) || 0)) }), e } function ut(e) { return y(e, (function (t) { return !m(e, (function (e) { return e !== t && ht(t, e) })) })) } function ht(e, t) { if (t) { if (e === t) return t; if (e.parent) return ht(e.parent, t) } } function dt(e, t, n) { var i = !n || -1 === e.indexOf(t); return i && e.push(t), i } function ft(e, t, n) { n = n || 0, p(e) || (e = [e]), g(e, (function (e, i) { var r = t(e, i, n); p(r) && r.length && ft(r, t, n + 1) })) } function mt(e, t) { return function (e, t, n) { var i = [], r = []; return ft(e, (function (e, o, a) { dt(i, e, t); var s = e.children; if ((-1 === n || a < n) && s && dt(r, s, t)) return s })), i }(e, !t, -1) } function vt(e, t) { var n, i, r, o; return t = !!t, p(e) || (e = [e]), g(e, (function (e) { var a = e; e.waypoints && !t && (a = vt(e.waypoints, !0)); var s = a.x, c = a.y, p = a.height || 0, l = a.width || 0; (s < n || void 0 === n) && (n = s), (c < i || void 0 === i) && (i = c), (s + l > r || void 0 === r) && (r = s + l), (c + p > o || void 0 === o) && (o = c + p) })), { x: n, y: i, height: o - i, width: r - n } } function yt(e) { return "waypoints" in e ? "connection" : "x" in e ? "shape" : "root" } function gt(e) { return !(!e || !e.isFrame) } function _t(e, t) { return L({}, e || {}, t || {}) } it.prototype.canRender = function (e) { }, it.prototype.drawShape = function (e, t) { }, it.prototype.drawConnection = function (e, t) { }, it.prototype.getShapePath = function (e) { }, it.prototype.getConnectionPath = function (e) { }; function bt(e, t) { it.call(this, e, 1), this.CONNECTION_STYLE = t.style(["no-fill"], { strokeWidth: 5, stroke: "fuchsia" }), this.SHAPE_STYLE = t.style({ fill: "white", stroke: "fuchsia", strokeWidth: 2 }), this.FRAME_STYLE = t.style(["no-fill"], { stroke: "fuchsia", strokeDasharray: 4, strokeWidth: 2 }) } e(bt, it), bt.prototype.canRender = function () { return !0 }, bt.prototype.drawShape = function (e, t, n) { var i = De("rect"); return we(i, { x: 0, y: 0, width: t.width || 0, height: t.height || 0 }), gt(t) ? we(i, L({}, this.FRAME_STYLE, n || {})) : we(i, L({}, this.SHAPE_STYLE, n || {})), ge(e, i), i }, bt.prototype.drawConnection = function (e, t, n) { var i = pt(t.waypoints, L({}, this.CONNECTION_STYLE, n || {})); return ge(e, i), i }, bt.prototype.getShapePath = function (e) { var t = e.x, n = e.y, i = e.width; return rt([["M", t, n], ["l", i, 0], ["l", 0, e.height], ["l", -i, 0], ["z"]]) }, bt.prototype.getConnectionPath = function (e) { var t, n, i = e.waypoints, r = []; for (t = 0; n = i[t]; t++)n = n.original || n, r.push([0 === t ? "M" : "L", n.x, n.y]); return rt(r) }, bt.$inject = ["eventBus", "styles"]; var xt = { __init__: ["defaultRenderer"], defaultRenderer: ["type", bt], styles: ["type", function () { var e = { "no-fill": { fill: "none" }, "no-border": { strokeOpacity: 0 }, "no-events": { pointerEvents: "none" } }, t = this; this.cls = function (e, t, n) { return L(this.style(t, n), { class: e }) }, this.style = function (t, n) { p(t) || n || (n = t, t = []); var i = b(t, (function (t, n) { return L(t, e[n] || {}) }), {}); return n ? L(i, n) : i }, this.computeStyle = function (e, n, i) { return p(n) || (i = n, n = []), t.style(n || [], L({}, i, e || {})) } }] }; function wt(e, t) { if (!e || !t) return -1; var n = e.indexOf(t); return -1 !== n && e.splice(n, 1), n } function Et(e, t, n) { if (e && t) { "number" != typeof n && (n = -1); var i = e.indexOf(t); if (-1 !== i) { if (i === n) return; if (-1 === n) return; e.splice(i, 1) } -1 !== n ? e.splice(n, 0, t) : e.push(t) } } function St(e, t) { return e && t ? e.indexOf(t) : -1 } function Ct(e, t) { return e && t ? Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2)) : -1 } function kt(e, t, n, i) { if (void 0 === i && (i = 5), !e || !t || !n) return !1; var r = (t.x - e.x) * (n.y - e.y) - (t.y - e.y) * (n.x - e.x), o = Ct(e, t); return Math.abs(r / o) <= i } var Rt = 2; function Pt(e, t) { var n = Array.from(arguments).flat(); const i = { x: "v", y: "h" }; for (const [e, t] of Object.entries(i)) if (Tt(e, n)) return t; return !1 } function Tt(e, t) { const n = t[0]; return x(t, (function (t) { return Math.abs(n[e] - t[e]) <= Rt })) } function At(e, t, n) { return n = n || 0, e.x > t.x - n && e.y > t.y - n && e.x < t.x + t.width + n && e.y < t.y + t.height + n } function Mt(e, t) { return { x: Math.round(e.x + (t.x - e.x) / 2), y: Math.round(e.y + (t.y - e.y) / 2) } }
/**
   * This file contains source code adapted from Snap.svg (licensed Apache-2.0).
   *
   * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js
   */var Dt = /,?([a-z]),?/gi, Bt = parseFloat, Nt = Math, Ot = Nt.PI, jt = Nt.min, Lt = Nt.max, It = Nt.pow, $t = Nt.abs, Ft = /([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi, zt = /(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi, Ht = Array.isArray || function (e) { return e instanceof Array }; function Vt(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } function Wt(e) { if ("function" == typeof e || Object(e) !== e) return e; var t = new e.constructor; for (var n in e) Vt(e, n) && (t[n] = Wt(e[n])); return t } function Gt(e) { var t = Gt.ps = Gt.ps || {}; return t[e] ? t[e].sleep = 100 : t[e] = { sleep: 100 }, setTimeout((function () { for (var n in t) Vt(t, n) && n != e && (t[n].sleep--, !t[n].sleep && delete t[n]) })), t[e] } function Ut(e, t, n, i) { return 1 === arguments.length && (t = e.y, n = e.width, i = e.height, e = e.x), { x: e, y: t, width: n, height: i, x2: e + n, y2: t + i } } function qt() { return this.join(",").replace(Dt, "$1") } function Kt(e) { var t = Wt(e); return t.toString = qt, t } function Yt(e, t, n, i, r, o, a, s, c) { var p = 1 - c, l = It(p, 3), u = It(p, 2), h = c * c * c, d = l * t + 3 * u * c * i + 3 * p * c * c * o + h * s; return { x: tn(l * e + 3 * u * c * n + 3 * p * c * c * r + h * a), y: tn(d) } } function Xt(e) { var t = function (e, t, n, i, r, o, a, s) { for (var c, p, l, u, h, d, f, m, v = [], y = [[], []], g = 0; g < 2; ++g)if (0 == g ? (p = 6 * e - 12 * n + 6 * r, c = -3 * e + 9 * n - 9 * r + 3 * a, l = 3 * n - 3 * e) : (p = 6 * t - 12 * i + 6 * o, c = -3 * t + 9 * i - 9 * o + 3 * s, l = 3 * i - 3 * t), $t(c) < 1e-12) { if ($t(p) < 1e-12) continue; 0 < (u = -l / p) && u < 1 && v.push(u) } else f = p * p - 4 * l * c, m = Nt.sqrt(f), f < 0 || (0 < (h = (-p + m) / (2 * c)) && h < 1 && v.push(h), 0 < (d = (-p - m) / (2 * c)) && d < 1 && v.push(d)); var _, b = v.length, x = b; for (; b--;)_ = 1 - (u = v[b]), y[0][b] = _ * _ * _ * e + 3 * _ * _ * u * n + 3 * _ * u * u * r + u * u * u * a, y[1][b] = _ * _ * _ * t + 3 * _ * _ * u * i + 3 * _ * u * u * o + u * u * u * s; return y[0][x] = e, y[1][x] = t, y[0][x + 1] = a, y[1][x + 1] = s, y[0].length = y[1].length = x + 2, { x0: jt(...y[0]), y0: jt(...y[1]), x1: Lt(...y[0]), y1: Lt(...y[1]) } }(...e); return Ut(t.x0, t.y0, t.x1 - t.x0, t.y1 - t.y0) } function Zt(e, t, n) { return t >= e.x && t <= e.x + e.width && n >= e.y && n <= e.y + e.height } function Qt(e, t, n, i, r) { return e * (e * (-3 * t + 9 * n - 9 * i + 3 * r) + 6 * t - 12 * n + 6 * i) - 3 * t + 3 * n } function Jt(e, t, n, i, r, o, a, s, c) { null == c && (c = 1); for (var p = (c = c > 1 ? 1 : c < 0 ? 0 : c) / 2, l = [-.1252, .1252, -.3678, .3678, -.5873, .5873, -.7699, .7699, -.9041, .9041, -.9816, .9816], u = [.2491, .2491, .2335, .2335, .2032, .2032, .1601, .1601, .1069, .1069, .0472, .0472], h = 0, d = 0; d < 12; d++) { var f = p * l[d] + p, m = Qt(f, e, n, r, a), v = Qt(f, t, i, o, s), y = m * m + v * v; h += u[d] * Nt.sqrt(y) } return p * h } function en(e, t, n, i, r, o, a, s) { if (!(Lt(e, n) < jt(r, a) || jt(e, n) > Lt(r, a) || Lt(t, i) < jt(o, s) || jt(t, i) > Lt(o, s))) { var c = (e * i - t * n) * (o - s) - (t - i) * (r * s - o * a), p = (e - n) * (o - s) - (t - i) * (r - a); if (p) { var l = tn(((e * i - t * n) * (r - a) - (e - n) * (r * s - o * a)) / p), u = tn(c / p), h = +l.toFixed(2), d = +u.toFixed(2); if (!(h < +jt(e, n).toFixed(2) || h > +Lt(e, n).toFixed(2) || h < +jt(r, a).toFixed(2) || h > +Lt(r, a).toFixed(2) || d < +jt(t, i).toFixed(2) || d > +Lt(t, i).toFixed(2) || d < +jt(o, s).toFixed(2) || d > +Lt(o, s).toFixed(2))) return { x: l, y: u } } } } function tn(e) { return Math.round(1e11 * e) / 1e11 } function nn(e, t, n) { if (!function (e, t) { return e = Ut(e), Zt(t = Ut(t), e.x, e.y) || Zt(t, e.x2, e.y) || Zt(t, e.x, e.y2) || Zt(t, e.x2, e.y2) || Zt(e, t.x, t.y) || Zt(e, t.x2, t.y) || Zt(e, t.x, t.y2) || Zt(e, t.x2, t.y2) || (e.x < t.x2 && e.x > t.x || t.x < e.x2 && t.x > e.x) && (e.y < t.y2 && e.y > t.y || t.y < e.y2 && t.y > e.y) }(Xt(e), Xt(t))) return n ? 0 : []; for (var i = Jt(...e), r = Jt(...t), o = an(e) ? 1 : ~~(i / 5) || 1, a = an(t) ? 1 : ~~(r / 5) || 1, s = [], c = [], p = {}, l = n ? 0 : [], u = 0; u < o + 1; u++) { var h = Yt(...e, u / o); s.push({ x: h.x, y: h.y, t: u / o }) } for (u = 0; u < a + 1; u++)h = Yt(...t, u / a), c.push({ x: h.x, y: h.y, t: u / a }); for (u = 0; u < o; u++)for (var d = 0; d < a; d++) { var f, m = s[u], v = s[u + 1], y = c[d], g = c[d + 1], _ = $t(v.x - m.x) < .01 ? "y" : "x", b = $t(g.x - y.x) < .01 ? "y" : "x", x = en(m.x, m.y, v.x, v.y, y.x, y.y, g.x, g.y); if (x) { if (p[f = x.x.toFixed(9) + "#" + x.y.toFixed(9)]) continue; p[f] = !0; var w = m.t + $t((x[_] - m[_]) / (v[_] - m[_])) * (v.t - m.t), E = y.t + $t((x[b] - y[b]) / (g[b] - y[b])) * (g.t - y.t); w >= 0 && w <= 1 && E >= 0 && E <= 1 && (n ? l++ : l.push({ x: x.x, y: x.y, t1: w, t2: E })) } } return l } function rn(e, t, n) { e = ln(e), t = ln(t); for (var i, r, o, a, s, c, p, l, u, h, d = n ? 0 : [], f = 0, m = e.length; f < m; f++) { var v = e[f]; if ("M" == v[0]) i = s = v[1], r = c = v[2]; else { "C" == v[0] ? (i = (u = [i, r, ...v.slice(1)])[6], r = u[7]) : (u = [i, r, i, r, s, c, s, c], i = s, r = c); for (var y = 0, g = t.length; y < g; y++) { var _ = t[y]; if ("M" == _[0]) o = p = _[1], a = l = _[2]; else { "C" == _[0] ? (o = (h = [o, a, ..._.slice(1)])[6], a = h[7]) : (h = [o, a, o, a, p, l, p, l], o = p, a = l); var b = nn(u, h, n); if (n) d += b; else { for (var x = 0, w = b.length; x < w; x++)b[x].segment1 = f, b[x].segment2 = y, b[x].bez1 = u, b[x].bez2 = h; d = d.concat(b) } } } } } return d } function on(e) { var t = Gt(e); if (t.abs) return Kt(t.abs); if (Ht(e) && Ht(e && e[0]) || (e = function (e) { if (!e) return null; var t = Gt(e); if (t.arr) return Wt(t.arr); var n = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 }, i = []; return Ht(e) && Ht(e[0]) && (i = Wt(e)), i.length || String(e).replace(Ft, (function (e, t, r) { var o = [], a = t.toLowerCase(); for (r.replace(zt, (function (e, t) { t && o.push(+t) })), "m" == a && o.length > 2 && (i.push([t, ...o.splice(0, 2)]), a = "l", t = "m" == t ? "l" : "L"); o.length >= n[a] && (i.push([t, ...o.splice(0, n[a])]), n[a]);); })), i.toString = Gt.toString, t.arr = Wt(i), i }(e)), !e || !e.length) return [["M", 0, 0]]; var n, i = [], r = 0, o = 0, a = 0, s = 0, c = 0; "M" == e[0][0] && (a = r = +e[0][1], s = o = +e[0][2], c++, i[0] = ["M", r, o]); for (var p, l, u = c, h = e.length; u < h; u++) { if (i.push(p = []), (n = (l = e[u])[0]) != n.toUpperCase()) switch (p[0] = n.toUpperCase(), p[0]) { case "A": p[1] = l[1], p[2] = l[2], p[3] = l[3], p[4] = l[4], p[5] = l[5], p[6] = +l[6] + r, p[7] = +l[7] + o; break; case "V": p[1] = +l[1] + o; break; case "H": p[1] = +l[1] + r; break; case "M": a = +l[1] + r, s = +l[2] + o; default: for (var d = 1, f = l.length; d < f; d++)p[d] = +l[d] + (d % 2 ? r : o) } else for (var m = 0, v = l.length; m < v; m++)p[m] = l[m]; switch (n = n.toUpperCase(), p[0]) { case "Z": r = +a, o = +s; break; case "H": r = p[1]; break; case "V": o = p[1]; break; case "M": a = p[p.length - 2], s = p[p.length - 1]; default: r = p[p.length - 2], o = p[p.length - 1] } } return i.toString = qt, t.abs = Kt(i), i } function an(e) { return e[0] === e[2] && e[1] === e[3] && e[4] === e[6] && e[5] === e[7] } function sn(e, t, n, i) { return [e, t, n, i, n, i] } function cn(e, t, n, i, r, o) { var a = 1 / 3, s = 2 / 3; return [a * e + s * n, a * t + s * i, a * r + s * n, a * o + s * i, r, o] } function pn(e, t, n, i, r, o, a, s, c, p) { var l, u = 120 * Ot / 180, h = Ot / 180 * (+r || 0), d = [], f = function (e) { return function t() { var n = Array.prototype.slice.call(arguments, 0).join("␀"), i = t.cache = t.cache || {}, r = t.count = t.count || []; return Vt(i, n) ? (function (e, t) { for (var n = 0, i = e.length; n < i; n++)if (e[n] === t) return e.push(e.splice(n, 1)[0]) }(r, n), i[n]) : (r.length >= 1e3 && delete i[r.shift()], r.push(n), i[n] = e(...arguments), i[n]) } }((function (e, t, n) { return { x: e * Nt.cos(n) - t * Nt.sin(n), y: e * Nt.sin(n) + t * Nt.cos(n) } })); if (p) E = p[0], S = p[1], x = p[2], w = p[3]; else { e = (l = f(e, t, -h)).x, t = l.y; var m = (e - (s = (l = f(s, c, -h)).x)) / 2, v = (t - (c = l.y)) / 2, y = m * m / (n * n) + v * v / (i * i); y > 1 && (n *= y = Nt.sqrt(y), i *= y); var g = n * n, _ = i * i, b = (o == a ? -1 : 1) * Nt.sqrt($t((g * _ - g * v * v - _ * m * m) / (g * v * v + _ * m * m))), x = b * n * v / i + (e + s) / 2, w = b * -i * m / n + (t + c) / 2, E = Nt.asin(((t - w) / i).toFixed(9)), S = Nt.asin(((c - w) / i).toFixed(9)); (E = e < x ? Ot - E : E) < 0 && (E = 2 * Ot + E), (S = s < x ? Ot - S : S) < 0 && (S = 2 * Ot + S), a && E > S && (E -= 2 * Ot), !a && S > E && (S -= 2 * Ot) } var C = S - E; if ($t(C) > u) { var k = S, R = s, P = c; S = E + u * (a && S > E ? 1 : -1), d = pn(s = x + n * Nt.cos(S), c = w + i * Nt.sin(S), n, i, r, 0, a, R, P, [S, k, x, w]) } C = S - E; var T = Nt.cos(E), A = Nt.sin(E), M = Nt.cos(S), D = Nt.sin(S), B = Nt.tan(C / 4), N = 4 / 3 * n * B, O = 4 / 3 * i * B, j = [e, t], L = [e + N * A, t - O * T], I = [s + N * D, c - O * M], $ = [s, c]; if (L[0] = 2 * j[0] - L[0], L[1] = 2 * j[1] - L[1], p) return [L, I, $].concat(d); for (var F = [], z = 0, H = (d = [L, I, $].concat(d).join().split(",")).length; z < H; z++)F[z] = z % 2 ? f(d[z - 1], d[z], h).y : f(d[z], d[z + 1], h).x; return F } function ln(e) { var t = Gt(e); if (t.curve) return Kt(t.curve); for (var n = on(e), i = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null }, r = function (e, t, n) { var i, r; if (!e) return ["C", t.x, t.y, t.x, t.y, t.x, t.y]; switch (!(e[0] in { T: 1, Q: 1 }) && (t.qx = t.qy = null), e[0]) { case "M": t.X = e[1], t.Y = e[2]; break; case "A": e = ["C", ...pn(t.x, t.y, ...e.slice(1))]; break; case "S": "C" == n || "S" == n ? (i = 2 * t.x - t.bx, r = 2 * t.y - t.by) : (i = t.x, r = t.y), e = ["C", i, r, ...e.slice(1)]; break; case "T": "Q" == n || "T" == n ? (t.qx = 2 * t.x - t.qx, t.qy = 2 * t.y - t.qy) : (t.qx = t.x, t.qy = t.y), e = ["C", ...cn(t.x, t.y, t.qx, t.qy, e[1], e[2])]; break; case "Q": t.qx = e[1], t.qy = e[2], e = ["C", ...cn(t.x, t.y, e[1], e[2], e[3], e[4])]; break; case "L": e = ["C", ...sn(t.x, t.y, e[1], e[2])]; break; case "H": e = ["C", ...sn(t.x, t.y, e[1], t.y)]; break; case "V": e = ["C", ...sn(t.x, t.y, t.x, e[1])]; break; case "Z": e = ["C", ...sn(t.x, t.y, t.X, t.Y)] }return e }, o = function (e, t) { if (e[t].length > 7) { e[t].shift(); for (var i = e[t]; i.length;)a[t] = "A", e.splice(t++, 0, ["C", ...i.splice(0, 6)]); e.splice(t, 1), l = n.length } }, a = [], s = "", c = "", p = 0, l = n.length; p < l; p++) { n[p] && (s = n[p][0]), "C" != s && (a[p] = s, p && (c = a[p - 1])), n[p] = r(n[p], i, c), "A" != a[p] && "C" == s && (a[p] = "C"), o(n, p); var u = n[p], h = u.length; i.x = u[h - 2], i.y = u[h - 1], i.bx = Bt(u[h - 4]) || i.x, i.by = Bt(u[h - 3]) || i.y } return t.curve = Kt(n), n } function un(e) { return l(e) && f(e, "waypoints") } function hn(e) { return l(e) && f(e, "labelTarget") } function dn(e) { return { x: Math.round(e.x), y: Math.round(e.y), width: Math.round(e.width), height: Math.round(e.height) } } function fn(e) { return { x: Math.round(e.x), y: Math.round(e.y) } } function mn(e) { return { top: e.y, right: e.x + (e.width || 0), bottom: e.y + (e.height || 0), left: e.x } } function vn(e) { return { x: e.left, y: e.top, width: e.right - e.left, height: e.bottom - e.top } } function yn(e) { for (var t = e.waypoints, n = t.reduce((function (e, n, i) { var r = t[i - 1]; if (r) { var o = e[e.length - 1], a = o && o.endLength || 0, s = function (e, t) { return Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2)) }(r, n); e.push({ start: r, end: n, startLength: a, endLength: a + s, length: s }) } return e }), []), i = n.reduce((function (e, t) { return e + t.length }), 0), r = i / 2, o = 0, a = n[o]; a.endLength < r;)a = n[++o]; var s = (r - a.startLength) / a.length; return { x: a.start.x + (a.end.x - a.start.x) * s, y: a.start.y + (a.end.y - a.start.y) * s } } function gn(e) { return un(e) ? yn(e) : fn({ x: (t = e).x + (t.width || 0) / 2, y: t.y + (t.height || 0) / 2 }); var t } function _n(e, t, n) { l(n = n || 0) || (n = { x: n, y: n }); var i = mn(e), r = mn(t), o = i.bottom + n.y <= r.top, a = i.left - n.x >= r.right, s = i.top - n.y >= r.bottom, c = o ? "top" : s ? "bottom" : null, p = i.right + n.x <= r.left ? "left" : a ? "right" : null; return p && c ? c + "-" + p : p || c || "intersect" } function bn(e, t, n) { var i = function (e, t) { return rn(e, t) }(e, t); return 1 === i.length || 2 === i.length && Ct(i[0], i[1]) < 1 ? fn(i[0]) : i.length > 1 ? (i = T(i, (function (e) { var t = Math.floor(100 * e.t2) || 1; return t = ((t = 100 - t) < 10 ? "0" : "") + t, e.segment2 + "#" + t })), fn(i[n ? 0 : i.length - 1])) : null } function xn(e, t) { return Math.round(e * t) / t } function wn(e) { return u(e) ? e + "px" : e } function En(e, t, n) { const i = De("g"); Se(i).add(t); const r = void 0 !== n ? n : e.childNodes.length - 1; return e.insertBefore(i, e.childNodes[r] || null), i } const Sn = { shape: ["x", "y", "width", "height"], connection: ["waypoints"] }; function Cn(e, t, n, i) { this._eventBus = t, this._elementRegistry = i, this._graphicsFactory = n, this._rootsIdx = 0, this._layers = {}, this._planes = [], this._rootElement = null, this._init(e || {}) } function kn(e, t) { const n = "matrix(" + t.a + "," + t.b + "," + t.c + "," + t.d + "," + t.e + "," + t.f + ")"; e.setAttribute("transform", n) } Cn.$inject = ["config.canvas", "eventBus", "graphicsFactory", "elementRegistry"], Cn.prototype._init = function (e) { const t = this._eventBus, n = this._container = function (e) { const t = (e = L({}, { width: "100%", height: "100%" }, e)).container || document.body, n = document.createElement("div"); return n.setAttribute("class", "djs-container djs-parent"), q(n, { position: "relative", overflow: "hidden", width: wn(e.width), height: wn(e.height) }), t.appendChild(n), n }(e), i = this._svg = De("svg"); we(i, { width: "100%", height: "100%" }), ge(n, i); const r = this._viewport = En(i, "viewport"); e.deferUpdate && (this._viewboxChanged = O(j(this._viewboxChanged, this), 300)), t.on("diagram.init", (() => { t.fire("canvas.init", { svg: i, viewport: r }) })), t.on(["shape.added", "connection.added", "shape.removed", "connection.removed", "elements.changed", "root.set"], (() => { delete this._cachedViewbox })), t.on("diagram.destroy", 500, this._destroy, this), t.on("diagram.clear", 500, this._clear, this) }, Cn.prototype._destroy = function () { this._eventBus.fire("canvas.destroy", { svg: this._svg, viewport: this._viewport }); const e = this._container.parentNode; e && e.removeChild(this._container), delete this._svg, delete this._container, delete this._layers, delete this._planes, delete this._rootElement, delete this._viewport }, Cn.prototype._clear = function () { this._elementRegistry.getAll().forEach((e => { const t = yt(e); "root" === t ? this.removeRootElement(e) : this._removeElement(e, t) })), this._planes = [], this._rootElement = null, delete this._cachedViewbox }, Cn.prototype.getDefaultLayer = function () { return this.getLayer("base", 0) }, Cn.prototype.getLayer = function (e, t) { if (!e) throw new Error("must specify a name"); let n = this._layers[e]; if (n || (n = this._layers[e] = this._createLayer(e, t)), void 0 !== t && n.index !== t) throw new Error("layer <" + e + "> already created at index <" + t + ">"); return n.group }, Cn.prototype._getChildIndex = function (e) { return b(this._layers, (function (t, n) { return n.visible && e >= n.index && t++, t }), 0) }, Cn.prototype._createLayer = function (e, t) { void 0 === t && (t = 1); const n = this._getChildIndex(t); return { group: En(this._viewport, "layer-" + e, n), index: t, visible: !0 } }, Cn.prototype.showLayer = function (e) { if (!e) throw new Error("must specify a name"); const t = this._layers[e]; if (!t) throw new Error("layer <" + e + "> does not exist"); const n = this._viewport, i = t.group, r = t.index; if (t.visible) return i; const o = this._getChildIndex(r); return n.insertBefore(i, n.childNodes[o] || null), t.visible = !0, i }, Cn.prototype.hideLayer = function (e) { if (!e) throw new Error("must specify a name"); const t = this._layers[e]; if (!t) throw new Error("layer <" + e + "> does not exist"); const n = t.group; return t.visible ? (ke(n), t.visible = !1, n) : n }, Cn.prototype._removeLayer = function (e) { const t = this._layers[e]; t && (delete this._layers[e], ke(t.group)) }, Cn.prototype.getActiveLayer = function () { const e = this._findPlaneForRoot(this.getRootElement()); return e ? e.layer : null }, Cn.prototype.findRoot = function (e) { if ("string" == typeof e && (e = this._elementRegistry.get(e)), !e) return; const t = this._findPlaneForRoot(function (e) { for (; e.parent;)e = e.parent; return e }(e)) || {}; return t.rootElement }, Cn.prototype.getRootElements = function () { return this._planes.map((function (e) { return e.rootElement })) }, Cn.prototype._findPlaneForRoot = function (e) { return m(this._planes, (function (t) { return t.rootElement === e })) }, Cn.prototype.getContainer = function () { return this._container }, Cn.prototype._updateMarker = function (e, t, n) { let i; e.id || (e = this._elementRegistry.get(e)), i = this._elementRegistry._elements[e.id], i && (g([i.gfx, i.secondaryGfx], (function (e) { e && (n ? Se(e).add(t) : Se(e).remove(t)) })), this._eventBus.fire("element.marker.update", { element: e, gfx: i.gfx, marker: t, add: !!n })) }, Cn.prototype.addMarker = function (e, t) { this._updateMarker(e, t, !0) }, Cn.prototype.removeMarker = function (e, t) { this._updateMarker(e, t, !1) }, Cn.prototype.hasMarker = function (e, t) { e.id || (e = this._elementRegistry.get(e)); return Se(this.getGraphics(e)).has(t) }, Cn.prototype.toggleMarker = function (e, t) { this.hasMarker(e, t) ? this.removeMarker(e, t) : this.addMarker(e, t) }, Cn.prototype.getRootElement = function () { const e = this._rootElement; return e || this._planes.length ? e : this.setRootElement(this.addRootElement(null)) }, Cn.prototype.addRootElement = function (e) { const t = this._rootsIdx++; e || (e = { id: "__implicitroot_" + t, children: [], isImplicit: !0 }); const n = e.layer = "root-" + t; this._ensureValid("root", e); const i = this.getLayer(n, 0); return this.hideLayer(n), this._addRoot(e, i), this._planes.push({ rootElement: e, layer: i }), e }, Cn.prototype.removeRootElement = function (e) { "string" == typeof e && (e = this._elementRegistry.get(e)); if (this._findPlaneForRoot(e)) return this._removeRoot(e), this._removeLayer(e.layer), this._planes = this._planes.filter((function (t) { return t.rootElement !== e })), this._rootElement === e && (this._rootElement = null), e }, Cn.prototype.setRootElement = function (e) { if (e === this._rootElement) return; let t; if (!e) throw new Error("rootElement required"); return t = this._findPlaneForRoot(e), t || (e = this.addRootElement(e)), this._setRoot(e), e }, Cn.prototype._removeRoot = function (e) { const t = this._elementRegistry, n = this._eventBus; n.fire("root.remove", { element: e }), n.fire("root.removed", { element: e }), t.remove(e) }, Cn.prototype._addRoot = function (e, t) { const n = this._elementRegistry, i = this._eventBus; i.fire("root.add", { element: e }), n.add(e, t), i.fire("root.added", { element: e, gfx: t }) }, Cn.prototype._setRoot = function (e, t) { const n = this._rootElement; n && (this._elementRegistry.updateGraphics(n, null, !0), this.hideLayer(n.layer)), e && (t || (t = this._findPlaneForRoot(e).layer), this._elementRegistry.updateGraphics(e, this._svg, !0), this.showLayer(e.layer)), this._rootElement = e, this._eventBus.fire("root.set", { element: e }) }, Cn.prototype._ensureValid = function (e, t) { if (!t.id) throw new Error("element must have an id"); if (this._elementRegistry.get(t.id)) throw new Error("element <" + t.id + "> already exists"); const n = Sn[e], i = x(n, (function (e) { return void 0 !== t[e] })); if (!i) throw new Error("must supply { " + n.join(", ") + " } with " + e) }, Cn.prototype._setParent = function (e, t, n) { Et(t.children, e, n), e.parent = t }, Cn.prototype._addElement = function (e, t, n, i) { n = n || this.getRootElement(); const r = this._eventBus, o = this._graphicsFactory; this._ensureValid(e, t), r.fire(e + ".add", { element: t, parent: n }), this._setParent(t, n, i); const a = o.create(e, t, i); return this._elementRegistry.add(t, a), o.update(e, t, a), r.fire(e + ".added", { element: t, gfx: a }), t }, Cn.prototype.addShape = function (e, t, n) { return this._addElement("shape", e, t, n) }, Cn.prototype.addConnection = function (e, t, n) { return this._addElement("connection", e, t, n) }, Cn.prototype._removeElement = function (e, t) { const n = this._elementRegistry, i = this._graphicsFactory, r = this._eventBus; if (e = n.get(e.id || e)) return r.fire(t + ".remove", { element: e }), i.remove(e), wt(e.parent && e.parent.children, e), e.parent = null, r.fire(t + ".removed", { element: e }), n.remove(e), e }, Cn.prototype.removeShape = function (e) { return this._removeElement(e, "shape") }, Cn.prototype.removeConnection = function (e) { return this._removeElement(e, "connection") }, Cn.prototype.getGraphics = function (e, t) { return this._elementRegistry.getGraphics(e, t) }, Cn.prototype._changeViewbox = function (e) { this._eventBus.fire("canvas.viewbox.changing"), e.apply(this), this._cachedViewbox = null, this._viewboxChanged() }, Cn.prototype._viewboxChanged = function () { this._eventBus.fire("canvas.viewbox.changed", { viewbox: this.viewbox() }) }, Cn.prototype.viewbox = function (e) { if (void 0 === e && this._cachedViewbox) return this._cachedViewbox; const t = this._viewport, n = this.getSize(); let i, r, o, a, s, c, p; return e ? (this._changeViewbox((function () { s = Math.min(n.width / e.width, n.height / e.height); const i = this._svg.createSVGMatrix().scale(s).translate(-e.x, -e.y); Ge(t, i) })), e) : (o = this._rootElement ? this.getActiveLayer() : null, i = o && o.getBBox() || {}, a = Ge(t), r = a ? a.matrix : function (e, t, n, i, r, o) { var a = Ne().createSVGMatrix(); switch (arguments.length) { case 0: return a; case 1: return Oe(a, e); case 6: return Oe(a, { a: e, b: t, c: n, d: i, e: r, f: o }) } }(), s = xn(r.a, 1e3), c = xn(-r.e || 0, 1e3), p = xn(-r.f || 0, 1e3), e = this._cachedViewbox = { x: c ? c / s : 0, y: p ? p / s : 0, width: n.width / s, height: n.height / s, scale: s, inner: { width: i.width || 0, height: i.height || 0, x: i.x || 0, y: i.y || 0 }, outer: n }) }, Cn.prototype.scroll = function (e) { const t = this._viewport; let n = t.getCTM(); return e && this._changeViewbox((function () { e = L({ dx: 0, dy: 0 }, e || {}), n = this._svg.createSVGMatrix().translate(e.dx, e.dy).multiply(n), kn(t, n) })), { x: n.e, y: n.f } }, Cn.prototype.scrollToElement = function (e, t) { let n = 100; "string" == typeof e && (e = this._elementRegistry.get(e)); const i = this.findRoot(e); if (i !== this.getRootElement() && this.setRootElement(i), i === e) return; t || (t = {}), "number" == typeof t && (n = t), t = { top: t.top || n, right: t.right || n, bottom: t.bottom || n, left: t.left || n }; const r = vt(e), o = mn(r), a = this.viewbox(), s = this.zoom(); let c, p; a.y += t.top / s, a.x += t.left / s, a.width -= (t.right + t.left) / s, a.height -= (t.bottom + t.top) / s; const l = mn(a); if (r.width < a.width && r.height < a.height) { const e = Math.max(0, o.right - l.right), t = Math.min(0, o.left - l.left), n = Math.max(0, o.bottom - l.bottom), i = Math.min(0, o.top - l.top); c = e || t, p = n || i } else c = r.x - a.x, p = r.y - a.y; this.scroll({ dx: -c * s, dy: -p * s }) }, Cn.prototype.zoom = function (e, t) { if (!e) return this.viewbox(e).scale; if ("fit-viewport" === e) return this._fitViewport(t); let n, i; return this._changeViewbox((function () { "object" != typeof t && (n = this.viewbox().outer, t = { x: n.width / 2, y: n.height / 2 }), i = this._setZoom(e, t) })), xn(i.a, 1e3) }, Cn.prototype._fitViewport = function (e) { const t = this.viewbox(), n = t.outer, i = t.inner; let r, o; return i.x >= 0 && i.y >= 0 && i.x + i.width <= n.width && i.y + i.height <= n.height && !e ? o = { x: 0, y: 0, width: Math.max(i.width + i.x, n.width), height: Math.max(i.height + i.y, n.height) } : (r = Math.min(1, n.width / i.width, n.height / i.height), o = { x: i.x + (e ? i.width / 2 - n.width / r / 2 : 0), y: i.y + (e ? i.height / 2 - n.height / r / 2 : 0), width: n.width / r, height: n.height / r }), this.viewbox(o), this.viewbox(!1).scale }, Cn.prototype._setZoom = function (e, t) { const n = this._svg, i = this._viewport, r = n.createSVGMatrix(), o = n.createSVGPoint(); let a, s, c, p, l; c = i.getCTM(); const u = c.a; return t ? (a = L(o, t), s = a.matrixTransform(c.inverse()), p = r.translate(s.x, s.y).scale(1 / u * e).translate(-s.x, -s.y), l = c.multiply(p)) : l = r.scale(e), kn(this._viewport, l), l }, Cn.prototype.getSize = function () { return { width: this._container.clientWidth, height: this._container.clientHeight } }, Cn.prototype.getAbsoluteBBox = function (e) { const t = this.viewbox(); let n; if (e.waypoints) { n = this.getGraphics(e).getBBox() } else n = e; return { x: n.x * t.scale - t.x * t.scale, y: n.y * t.scale - t.y * t.scale, width: n.width * t.scale, height: n.height * t.scale } }, Cn.prototype.resized = function () { delete this._cachedViewbox, this._eventBus.fire("canvas.resized") }; var Rn = "data-element-id"; function Pn(e) { this._elements = {}, this._eventBus = e } function Tn(e, t, n) { var i = function (e, t, n, i) { var r = n.inverse; return Object.defineProperty(e, "remove", { value: function (e) { var n = this.indexOf(e); return -1 !== n && (this.splice(n, 1), t.unset(e, r, i)), e } }), Object.defineProperty(e, "contains", { value: function (e) { return -1 !== this.indexOf(e) } }), Object.defineProperty(e, "add", { value: function (e, n) { var o = this.indexOf(e); if (void 0 === n) { if (-1 !== o) return; n = this.length } -1 !== o && this.splice(o, 1), this.splice(n, 0, e), -1 === o && t.set(e, r, i) } }), Object.defineProperty(e, "__refs_collection", { value: !0 }), e }(n[t.name] || [], e, t, n); Object.defineProperty(n, t.name, { enumerable: t.enumerable, value: i }), i.length && i.forEach((function (i) { e.set(i, t.inverse, n) })) } function An(e, t) { if (!(this instanceof An)) return new An(e, t); e.inverse = t, t.inverse = e, this.props = {}, this.props[e.name] = e, this.props[t.name] = t } Pn.$inject = ["eventBus"], Pn.prototype.add = function (e, t, n) { var i = e.id; this._validateId(i), we(t, Rn, i), n && we(n, Rn, i), this._elements[i] = { element: e, gfx: t, secondaryGfx: n } }, Pn.prototype.remove = function (e) { var t = this._elements, n = e.id || e, i = n && t[n]; i && (we(i.gfx, Rn, ""), i.secondaryGfx && we(i.secondaryGfx, Rn, ""), delete t[n]) }, Pn.prototype.updateId = function (e, t) { this._validateId(t), "string" == typeof e && (e = this.get(e)), this._eventBus.fire("element.updateId", { element: e, newId: t }); var n = this.getGraphics(e), i = this.getGraphics(e, !0); this.remove(e), e.id = t, this.add(e, n, i) }, Pn.prototype.updateGraphics = function (e, t, n) { var i = e.id || e, r = this._elements[i]; return n ? r.secondaryGfx = t : r.gfx = t, t && we(t, Rn, i), t }, Pn.prototype.get = function (e) { var t; t = "string" == typeof e ? e : e && we(e, Rn); var n = this._elements[t]; return n && n.element }, Pn.prototype.filter = function (e) { var t = []; return this.forEach((function (n, i) { e(n, i) && t.push(n) })), t }, Pn.prototype.find = function (e) { for (var t = this._elements, n = Object.keys(t), i = 0; i < n.length; i++) { var r = t[n[i]], o = r.element; if (e(o, r.gfx)) return o } }, Pn.prototype.getAll = function () { return this.filter((function (e) { return e })) }, Pn.prototype.forEach = function (e) { var t = this._elements; Object.keys(t).forEach((function (n) { var i = t[n], r = i.element, o = i.gfx; return e(r, o) })) }, Pn.prototype.getGraphics = function (e, t) { var n = e.id || e, i = this._elements[n]; return i && (t ? i.secondaryGfx : i.gfx) }, Pn.prototype._validateId = function (e) { if (!e) throw new Error("element must have an id"); if (this._elements[e]) throw new Error("element with id " + e + " already added") }, An.prototype.bind = function (e, t) { if ("string" == typeof t) { if (!this.props[t]) throw new Error("no property <" + t + "> in ref"); t = this.props[t] } t.collection ? Tn(this, t, e) : function (e, t, n) { var i = t.inverse, r = n[t.name]; Object.defineProperty(n, t.name, { configurable: t.configurable, enumerable: t.enumerable, get: function () { return r }, set: function (t) { if (t !== r) { var o = r; r = null, o && e.unset(o, i, n), r = t, e.set(r, i, n) } } }) }(this, t, e) }, An.prototype.ensureRefsCollection = function (e, t) { var n = e[t.name]; return function (e) { return !0 === e.__refs_collection }(n) || Tn(this, t, e), n }, An.prototype.ensureBound = function (e, t) { (function (e, t) { return Object.prototype.hasOwnProperty.call(e, t.name || t) })(e, t) || this.bind(e, t) }, An.prototype.unset = function (e, t, n) { e && (this.ensureBound(e, t), t.collection ? this.ensureRefsCollection(e, t).remove(n) : e[t.name] = void 0) }, An.prototype.set = function (e, t, n) { e && (this.ensureBound(e, t), t.collection ? this.ensureRefsCollection(e, t).add(n) : e[t.name] = n) }; var Mn = new An({ name: "children", enumerable: !0, collection: !0 }, { name: "parent" }), Dn = new An({ name: "labels", enumerable: !0, collection: !0 }, { name: "labelTarget" }), Bn = new An({ name: "attachers", collection: !0 }, { name: "host" }), Nn = new An({ name: "outgoing", collection: !0 }, { name: "source" }), On = new An({ name: "incoming", collection: !0 }, { name: "target" }); function jn() { Object.defineProperty(this, "businessObject", { writable: !0 }), Object.defineProperty(this, "label", { get: function () { return this.labels[0] }, set: function (e) { var t = this.label, n = this.labels; !e && t ? n.remove(t) : n.add(e, 0) } }), Mn.bind(this, "parent"), Dn.bind(this, "labels"), Nn.bind(this, "outgoing"), On.bind(this, "incoming") } function Ln() { jn.call(this), Mn.bind(this, "children"), Bn.bind(this, "host"), Bn.bind(this, "attachers") } function In() { jn.call(this), Mn.bind(this, "children") } function $n() { Ln.call(this), Dn.bind(this, "labelTarget") } function Fn() { jn.call(this), Nn.bind(this, "source"), On.bind(this, "target") } e(Ln, jn), e(In, Ln), e($n, Ln), e(Fn, jn); var zn = { connection: Fn, shape: Ln, label: $n, root: In }; function Hn() { this._uid = 12 } Hn.prototype.createRoot = function (e) { return this.create("root", e) }, Hn.prototype.createLabel = function (e) { return this.create("label", e) }, Hn.prototype.createShape = function (e) { return this.create("shape", e) }, Hn.prototype.createConnection = function (e) { return this.create("connection", e) }, Hn.prototype.create = function (e, t) { return (t = L({}, t || {})).id || (t.id = e + "_" + this._uid++), function (e, t) { var n = zn[e]; if (!n) throw new Error("unknown type: <" + e + ">"); return L(new n, t) }(e, t) }; var Vn = "__fn", Wn = Array.prototype.slice; function Gn() { this._listeners = {}, this.on("diagram.destroy", 1, this._destroy, this) } function Un() { } function qn(e) { return e.childNodes[0] } function Kn(e, t, n, i, r) { var o = je(); o.setTranslate(t, n); var a = je(); a.setRotate(i || 0, 0, 0); var s = je(); s.setScale(r || 1, r || 1), Ge(e, [o, a, s]) } function Yn(e, t, n) { var i = je(); i.setTranslate(t, n), Ge(e, i) } function Xn(e, t) { var n = je(); n.setRotate(t, 0, 0), Ge(e, n) } function Zn(e, t) { this._eventBus = e, this._elementRegistry = t } function Qn(e, t, n) { var i = n || t.firstChild; e !== i && t.insertBefore(e, i) } Gn.prototype.on = function (e, t, n, i) { if (e = p(e) ? e : [e], h(t) && (i = n, n = t, t = 1e3), !u(t)) throw new Error("priority must be a number"); var r = n; i && ((r = j(n, i))[Vn] = n[Vn] || n); var o = this; e.forEach((function (e) { o._addListener(e, { priority: t, callback: r, next: null }) })) }, Gn.prototype.once = function (e, t, n, i) { var r = this; if (h(t) && (i = n, n = t, t = 1e3), !u(t)) throw new Error("priority must be a number"); function o() { o.__isTomb = !0; var t = n.apply(i, arguments); return r.off(e, o), t } o[Vn] = n, this.on(e, t, o) }, Gn.prototype.off = function (e, t) { e = p(e) ? e : [e]; var n = this; e.forEach((function (e) { n._removeListener(e, t) })) }, Gn.prototype.createEvent = function (e) { var t = new Un; return t.init(e), t }, Gn.prototype.fire = function (e, t) { var n, i, r, o; if (o = Wn.call(arguments), "object" == typeof e && (e = (t = e).type), !e) throw new Error("no event type specified"); if (i = this._listeners[e]) { n = t instanceof Un ? t : this.createEvent(t), o[0] = n; var a = n.type; e !== a && (n.type = e); try { r = this._invokeListeners(n, o, i) } finally { e !== a && (n.type = a) } return void 0 === r && n.defaultPrevented && (r = !1), r } }, Gn.prototype.handleError = function (e) { return !1 === this.fire("error", { error: e }) }, Gn.prototype._destroy = function () { this._listeners = {} }, Gn.prototype._invokeListeners = function (e, t, n) { for (var i; n && !e.cancelBubble;)i = this._invokeListener(e, t, n), n = n.next; return i }, Gn.prototype._invokeListener = function (e, t, n) { var i; if (n.callback.__isTomb) return i; try { i = function (e, t) { return e.apply(null, t) }(n.callback, t), void 0 !== i && (e.returnValue = i, e.stopPropagation()), !1 === i && e.preventDefault() } catch (e) { if (!this.handleError(e)) throw console.error("unhandled error in event listener", e), e } return i }, Gn.prototype._addListener = function (e, t) { var n, i = this._getListeners(e); if (i) { for (; i;) { if (i.priority < t.priority) return t.next = i, void (n ? n.next = t : this._setListeners(e, t)); n = i, i = i.next } n.next = t } else this._setListeners(e, t) }, Gn.prototype._getListeners = function (e) { return this._listeners[e] }, Gn.prototype._setListeners = function (e, t) { this._listeners[e] = t }, Gn.prototype._removeListener = function (e, t) { var n, i, r, o = this._getListeners(e); if (t) for (; o;)n = o.next, (r = o.callback) !== t && r[Vn] !== t || (i ? i.next = n : this._setListeners(e, n)), i = o, o = n; else this._setListeners(e, null) }, Un.prototype.stopPropagation = function () { this.cancelBubble = !0 }, Un.prototype.preventDefault = function () { this.defaultPrevented = !0 }, Un.prototype.init = function (e) { L(this, e || {}) }, Zn.$inject = ["eventBus", "elementRegistry"], Zn.prototype._getChildrenContainer = function (e) { var t, n = this._elementRegistry.getGraphics(e); return e.parent ? (t = function (e) { return e.parentNode.childNodes[1] }(n), t || (Se(t = De("g")).add("djs-children"), ge(n.parentNode, t))) : t = n, t }, Zn.prototype._clear = function (e) { var t = qn(e); return Q(t), t }, Zn.prototype._createContainer = function (e, t, n, i) { var r = De("g"); Se(r).add("djs-group"), void 0 !== n ? Qn(r, t, t.childNodes[n]) : ge(t, r); var o = De("g"); Se(o).add("djs-element"), Se(o).add("djs-" + e), i && Se(o).add("djs-frame"), ge(r, o); var a = De("g"); return Se(a).add("djs-visual"), ge(o, a), o }, Zn.prototype.create = function (e, t, n) { var i = this._getChildrenContainer(t.parent); return this._createContainer(e, i, n, gt(t)) }, Zn.prototype.updateContainments = function (e) { var t, n = this, i = this._elementRegistry; t = b(e, (function (e, t) { return t.parent && (e[t.parent.id] = t.parent), e }), {}), g(t, (function (e) { var t = e.children; if (t) { var r = n._getChildrenContainer(e); g(t.slice().reverse(), (function (e) { Qn(i.getGraphics(e).parentNode, r) })) } })) }, Zn.prototype.drawShape = function (e, t, n = {}) { return this._eventBus.fire("render.shape", { gfx: e, element: t, attrs: n }) }, Zn.prototype.getShapePath = function (e) { return this._eventBus.fire("render.getShapePath", e) }, Zn.prototype.drawConnection = function (e, t, n = {}) { return this._eventBus.fire("render.connection", { gfx: e, element: t, attrs: n }) }, Zn.prototype.getConnectionPath = function (e) { return this._eventBus.fire("render.getConnectionPath", e) }, Zn.prototype.update = function (e, t, n) { if (t.parent) { var i = this._clear(n); if ("shape" === e) this.drawShape(i, t), Yn(n, t.x, t.y); else { if ("connection" !== e) throw new Error("unknown type: " + e); this.drawConnection(i, t) } t.hidden ? we(n, "display", "none") : we(n, "display", "block") } }, Zn.prototype.remove = function (e) { ke(this._elementRegistry.getGraphics(e).parentNode) }; var Jn = { __depends__: [xt], __init__: ["canvas"], canvas: ["type", Cn], elementRegistry: ["type", Pn], elementFactory: ["type", Hn], eventBus: ["type", Gn], graphicsFactory: ["type", Zn] }; function ei(e) { return function (e) { var t = new et(e); return t.init(), t }([{ config: ["value", e = e || {}] }, Jn].concat(e.modules || [])) } function ti(e, t) { this._injector = t = t || ei(e), this.get = t.get, this.invoke = t.invoke, this.get("eventBus").fire("diagram.init") } function ni() { } function ii(e, t) { this.model = e, this.properties = t } ti.prototype.destroy = function () { this.get("eventBus").fire("diagram.destroy") }, ti.prototype.clear = function () { this.get("eventBus").fire("diagram.clear") }, ni.prototype.get = function (e) { return this.$model.properties.get(this, e) }, ni.prototype.set = function (e, t) { this.$model.properties.set(this, e, t) }, ii.prototype.createType = function (e) { var t = this.model, n = this.properties, i = Object.create(ni.prototype); g(e.properties, (function (e) { e.isMany || void 0 === e.default || (i[e.name] = e.default) })), n.defineModel(i, t), n.defineDescriptor(i, e); var r = e.ns.name; function o(e) { n.define(this, "$type", { value: r, enumerable: !0 }), n.define(this, "$attrs", { value: {} }), n.define(this, "$parent", { writable: !0 }), g(e, j((function (e, t) { this.set(t, e) }), this)) } return o.prototype = i, o.hasType = i.$instanceOf = this.model.hasType, n.defineModel(o, t), n.defineDescriptor(o, e), o }; var ri = { String: !0, Boolean: !0, Integer: !0, Real: !0, Element: !0 }, oi = { String: function (e) { return e }, Boolean: function (e) { return "true" === e }, Integer: function (e) { return parseInt(e, 10) }, Real: function (e) { return parseFloat(e) } }; function ai(e, t) { var n = oi[e]; return n ? n(t) : t } function si(e) { return !!ri[e] } function ci(e) { return !!oi[e] } function pi(e, t) { var n, i, r = e.split(/:/); if (1 === r.length) n = e, i = t; else { if (2 !== r.length) throw new Error("expected <prefix:localName> or <localName>, got " + e); n = r[1], i = r[0] } return { name: e = (i ? i + ":" : "") + n, prefix: i, localName: n } } function li(e) { this.ns = e, this.name = e.name, this.allTypes = [], this.allTypesByName = {}, this.properties = [], this.propertiesByName = {} } function ui(e, t) { this.packageMap = {}, this.typeMap = {}, this.packages = [], this.properties = t, g(e, j(this.registerPackage, this)) } function hi(e, t, n) { var i = t[n]; if (i in e) throw new Error("package with " + n + " <" + i + "> already defined") } function di(e) { this.model = e } function fi(e, t, n) { Object.defineProperty(e, t.name, { enumerable: !t.isReference, writable: !0, value: n, configurable: !0 }) } function mi(e) { return e.replace(/^:/, "") } function vi(e, t = {}) { this.properties = new di(this), this.factory = new ii(this, this.properties), this.registry = new ui(e, this.properties), this.typeCache = {}, this.config = t } li.prototype.build = function () { return I(this, ["ns", "name", "allTypes", "allTypesByName", "properties", "propertiesByName", "bodyProperty", "idProperty"]) }, li.prototype.addProperty = function (e, t, n) { "boolean" == typeof t && (n = t, t = void 0), this.addNamedProperty(e, !1 !== n); var i = this.properties; void 0 !== t ? i.splice(t, 0, e) : i.push(e) }, li.prototype.replaceProperty = function (e, t, n) { var i = e.ns, r = this.properties, o = this.propertiesByName, a = e.name !== t.name; if (e.isId) { if (!t.isId) throw new Error("property <" + t.ns.name + "> must be id property to refine <" + e.ns.name + ">"); this.setIdProperty(t, !1) } if (e.isBody) { if (!t.isBody) throw new Error("property <" + t.ns.name + "> must be body property to refine <" + e.ns.name + ">"); this.setBodyProperty(t, !1) } var s = r.indexOf(e); if (-1 === s) throw new Error("property <" + i.name + "> not found in property list"); r.splice(s, 1), this.addProperty(t, n ? void 0 : s, a), o[i.name] = o[i.localName] = t }, li.prototype.redefineProperty = function (e, t, n) { var i = e.ns.prefix, r = t.split("#"), o = pi(r[0], i), a = pi(r[1], o.prefix).name, s = this.propertiesByName[a]; if (!s) throw new Error("refined property <" + a + "> not found"); this.replaceProperty(s, e, n), delete e.redefines }, li.prototype.addNamedProperty = function (e, t) { var n = e.ns, i = this.propertiesByName; t && (this.assertNotDefined(e, n.name), this.assertNotDefined(e, n.localName)), i[n.name] = i[n.localName] = e }, li.prototype.removeNamedProperty = function (e) { var t = e.ns, n = this.propertiesByName; delete n[t.name], delete n[t.localName] }, li.prototype.setBodyProperty = function (e, t) { if (t && this.bodyProperty) throw new Error("body property defined multiple times (<" + this.bodyProperty.ns.name + ">, <" + e.ns.name + ">)"); this.bodyProperty = e }, li.prototype.setIdProperty = function (e, t) { if (t && this.idProperty) throw new Error("id property defined multiple times (<" + this.idProperty.ns.name + ">, <" + e.ns.name + ">)"); this.idProperty = e }, li.prototype.assertNotTrait = function (e) { if ((e.extends || []).length) throw new Error(`cannot create <${e.name}> extending <${e.extends}>`) }, li.prototype.assertNotDefined = function (e, t) { var n = e.name, i = this.propertiesByName[n]; if (i) throw new Error("property <" + n + "> already defined; override of <" + i.definedBy.ns.name + "#" + i.ns.name + "> by <" + e.definedBy.ns.name + "#" + e.ns.name + "> not allowed without redefines") }, li.prototype.hasProperty = function (e) { return this.propertiesByName[e] }, li.prototype.addTrait = function (e, t) { t && this.assertNotTrait(e); var n = this.allTypesByName, i = this.allTypes, r = e.name; r in n || (g(e.properties, j((function (n) { n = L({}, n, { name: n.ns.localName, inherited: t }), Object.defineProperty(n, "definedBy", { value: e }); var i = n.replaces, r = n.redefines; i || r ? this.redefineProperty(n, i || r, i) : (n.isBody && this.setBodyProperty(n), n.isId && this.setIdProperty(n), this.addProperty(n)) }), this)), i.push(e), n[r] = e) }, ui.prototype.getPackage = function (e) { return this.packageMap[e] }, ui.prototype.getPackages = function () { return this.packages }, ui.prototype.registerPackage = function (e) { e = L({}, e); var t = this.packageMap; hi(t, e, "prefix"), hi(t, e, "uri"), g(e.types, j((function (t) { this.registerType(t, e) }), this)), t[e.uri] = t[e.prefix] = e, this.packages.push(e) }, ui.prototype.registerType = function (e, t) { var n = pi((e = L({}, e, { superClass: (e.superClass || []).slice(), extends: (e.extends || []).slice(), properties: (e.properties || []).slice(), meta: L(e.meta || {}) })).name, t.prefix), i = n.name, r = {}; g(e.properties, j((function (e) { var t = pi(e.name, n.prefix), i = t.name; si(e.type) || (e.type = pi(e.type, t.prefix).name), L(e, { ns: t, name: i }), r[i] = e }), this)), L(e, { ns: n, name: i, propertiesByName: r }), g(e.extends, j((function (e) { var t = pi(e, n.prefix), r = this.typeMap[t.name]; r.traits = r.traits || [], r.traits.push(i) }), this)), this.definePackage(e, t), this.typeMap[i] = e }, ui.prototype.mapTypes = function (e, t, n) { var i = si(e.name) ? { name: e.name } : this.typeMap[e.name], r = this; function o(n, i) { var o = pi(n, si(n) ? "" : e.prefix); r.mapTypes(o, t, i) } function a(e) { return o(e, !0) } if (!i) throw new Error("unknown type <" + e.name + ">"); g(i.superClass, n ? a : function (e) { return o(e, !1) }), t(i, !n), g(i.traits, a) }, ui.prototype.getEffectiveDescriptor = function (e) { var t = pi(e), n = new li(t); this.mapTypes(t, (function (e, t) { n.addTrait(e, t) })); var i = n.build(); return this.definePackage(i, i.allTypes[i.allTypes.length - 1].$pkg), i }, ui.prototype.definePackage = function (e, t) { this.properties.define(e, "$pkg", { value: t }) }, di.prototype.set = function (e, t, n) { if (!d(t) || !t.length) throw new TypeError("property name must be a non-empty string"); var i = this.getProperty(e, t), r = i && i.name; void 0 === n ? i ? delete e[r] : delete e.$attrs[mi(t)] : i ? r in e ? e[r] = n : fi(e, i, n) : e.$attrs[mi(t)] = n }, di.prototype.get = function (e, t) { var n = this.getProperty(e, t); if (!n) return e.$attrs[mi(t)]; var i = n.name; return !e[i] && n.isMany && fi(e, n, []), e[i] }, di.prototype.define = function (e, t, n) { if (!n.writable) { var i = n.value; delete (n = L({}, n, { get: function () { return i } })).value } Object.defineProperty(e, t, n) }, di.prototype.defineDescriptor = function (e, t) { this.define(e, "$descriptor", { value: t }) }, di.prototype.defineModel = function (e, t) { this.define(e, "$model", { value: t }) }, di.prototype.getProperty = function (e, t) { var n = this.model, i = n.getPropertyDescriptor(e, t); if (i) return i; if (t.includes(":")) return null; const r = n.config.strict; if (void 0 !== r) { const n = new TypeError(`unknown property <${t}> on <${e.$type}>`); if (r) throw n; "undefined" != typeof console && console.warn(n) } return null }, vi.prototype.create = function (e, t) { var n = this.getType(e); if (!n) throw new Error("unknown type <" + e + ">"); return new n(t) }, vi.prototype.getType = function (e) { var t = this.typeCache, n = d(e) ? e : e.ns.name, i = t[n]; return i || (e = this.registry.getEffectiveDescriptor(n), i = t[n] = this.factory.createType(e)), i }, vi.prototype.createAny = function (e, t, n) { var i = pi(e), r = { $type: e, $instanceOf: function (e) { return e === this.$type }, get: function (e) { return this[e] }, set: function (e, t) { !function (e, t, n) { let i = e; g(t, (function (e, r) { if ("number" != typeof e && "string" != typeof e) throw new Error("illegal key type: " + typeof e + ". Key should be of type number or string."); if ("constructor" === e) throw new Error("illegal key: constructor"); if ("__proto__" === e) throw new Error("illegal key: __proto__"); let o = t[r + 1], p = i[e]; s(o) && c(p) && (p = i[e] = isNaN(+o) ? {} : []), a(o) ? a(n) ? delete i[e] : i[e] = n : i = p })) }(this, [e], t) } }, o = { name: e, isGeneric: !0, ns: { prefix: i.prefix, localName: i.localName, uri: t } }; return this.properties.defineDescriptor(r, o), this.properties.defineModel(r, this), this.properties.define(r, "get", { enumerable: !1, writable: !0 }), this.properties.define(r, "set", { enumerable: !1, writable: !0 }), this.properties.define(r, "$parent", { enumerable: !1, writable: !0 }), this.properties.define(r, "$instanceOf", { enumerable: !1, writable: !0 }), g(n, (function (e, t) { l(e) && void 0 !== e.value ? r[e.name] = e.value : r[t] = e })), r }, vi.prototype.getPackage = function (e) { return this.registry.getPackage(e) }, vi.prototype.getPackages = function () { return this.registry.getPackages() }, vi.prototype.getElementDescriptor = function (e) { return e.$descriptor }, vi.prototype.hasType = function (e, t) { return void 0 === t && (t = e, e = this), t in e.$model.getElementDescriptor(e).allTypesByName }, vi.prototype.getPropertyDescriptor = function (e, t) { return this.getElementDescriptor(e).propertiesByName[t] }, vi.prototype.getTypeDescriptor = function (e) { return this.registry.typeMap[e] }; var yi = String.fromCharCode, gi = Object.prototype.hasOwnProperty, _i = /&#(\d+);|&#x([0-9a-f]+);|&(\w+);/gi, bi = { amp: "&", apos: "'", gt: ">", lt: "<", quot: '"' }; function xi(e, t, n, i) { return i ? gi.call(bi, i) ? bi[i] : "&" + i + ";" : yi(t || parseInt(n, 16)) } function wi(e) { return e.length > 3 && -1 !== e.indexOf("&") ? e.replace(_i, xi) : e } Object.keys(bi).forEach((function (e) { bi[e.toUpperCase()] = bi[e] })); var Ei = "xsi:type", Si = "non-whitespace outside of root node"; function Ci(e) { return new Error(e) } function ki(e) { return "missing namespace for prefix <" + e + ">" } function Ri(e) { return { get: e, enumerable: !0 } } function Pi(e) { var t, n = {}; for (t in e) n[t] = e[t]; return n } function Ti(e) { return e + "$uri" } function Ai() { return { line: 0, column: 0 } } function Mi(e) { throw e } function Di(e) { if (!this) return new Di(e); var t, n, i, r, o, a, s, c, p, l = e && e.proxy, u = Mi, h = Ai, d = !1, f = !1, m = null, v = !1; function y(e) { e instanceof Error || (e = Ci(e)), m = e, u(e, h) } function g(e) { o && (e instanceof Error || (e = Ci(e)), o(e, h)) } this.on = function (e, p) { if ("function" != typeof p) throw Ci("required args <name, cb>"); switch (e) { case "openTag": n = p; break; case "text": t = p; break; case "closeTag": i = p; break; case "error": u = p; break; case "warn": o = p; break; case "cdata": r = p; break; case "attention": c = p; break; case "question": s = p; break; case "comment": a = p; break; default: throw Ci("unsupported event: " + e) }return this }, this.ns = function (e) { if (void 0 === e && (e = {}), "object" != typeof e) throw Ci("required args <nsMap={}>"); var t, n = {}; for (t in e) n[t] = e[t]; return n["http://www.w3.org/2001/XMLSchema-instance"] = "xsi", f = !0, p = n, this }, this.parse = function (e) { if ("string" != typeof e) throw Ci("required args <xml=string>"); return m = null, function (e) { var o, u, m, _, b, x, w, E, S, C, k, R = f ? [] : null, P = f ? function (e) { var t, n, i = {}; for (t in e) i[n = e[t]] = n, i[Ti(n)] = t; return i }(p) : null, T = [], A = 0, M = !1, D = !1, B = 0, N = 0, O = "", j = 0; function L() { if (null !== k) return k; var e, t, n, i, r, o, a, s, c, l, u, h = f && P.xmlns, m = f && d ? [] : null, v = j, y = O, _ = y.length, b = {}, x = {}; e: for (; v < _; v++)if (c = !1, !(32 === (l = y.charCodeAt(v)) || l < 14 && l > 8)) { for ((l < 65 || l > 122 || l > 90 && l < 97) && 95 !== l && 58 !== l && (g("illegal first char attribute name"), c = !0), u = v + 1; u < _; u++)if (!((l = y.charCodeAt(u)) > 96 && l < 123 || l > 64 && l < 91 || l > 47 && l < 59 || 46 === l || 45 === l || 95 === l)) { if (32 === l || l < 14 && l > 8) { g("missing attribute value"), v = u; continue e } if (61 === l) break; g("illegal attribute name char"), c = !0 } if ("xmlns:xmlns" === (s = y.substring(v, u)) && (g("illegal declaration of xmlns"), c = !0), 34 === (l = y.charCodeAt(u + 1))) -1 === (u = y.indexOf('"', v = u + 2)) && -1 !== (u = y.indexOf("'", v)) && (g("attribute value quote missmatch"), c = !0); else if (39 === l) -1 === (u = y.indexOf("'", v = u + 2)) && -1 !== (u = y.indexOf('"', v)) && (g("attribute value quote missmatch"), c = !0); else for (g("missing attribute value quotes"), c = !0, u += 1; u < _ && !(32 === (l = y.charCodeAt(u + 1)) || l < 14 && l > 8); u++); for (-1 === u && (g("missing closing quotes"), u = _, c = !0), c || (o = y.substring(v, u)), v = u; u + 1 < _ && !(32 === (l = y.charCodeAt(u + 1)) || l < 14 && l > 8); u++)v === u && (g("illegal character after attribute end"), c = !0); if (v = u + 1, !c) if (s in x) g("attribute <" + s + "> already defined"); else if (x[s] = !0, f) if (d) { if (null !== (r = "xmlns" === s ? "xmlns" : 120 === s.charCodeAt(0) && "xmlns:" === s.substr(0, 6) ? s.substr(6) : null)) { if (e = wi(o), t = Ti(r), !(a = p[e])) { if ("xmlns" === r || t in P && P[t] !== e) do { a = "ns" + A++ } while (void 0 !== P[a]); else a = r; p[e] = a } P[r] !== a && (i || (P = Pi(P), i = !0), P[r] = a, "xmlns" === r && (P[Ti(a)] = e, h = a), P[t] = e), b[s] = o; continue } m.push(s, o) } else -1 !== (l = s.indexOf(":")) ? (n = P[s.substring(0, l)]) ? ((s = h === n ? s.substr(l + 1) : n + s.substr(l)) === Ei && (-1 !== (l = o.indexOf(":")) ? (n = o.substring(0, l), o = (n = P[n] || n) + o.substring(l)) : o = h + ":" + o), b[s] = o) : g(ki(s.substring(0, l))) : b[s] = o; else b[s] = o } if (d) for (v = 0, _ = m.length; v < _; v++) { if (s = m[v++], o = m[v], -1 !== (l = s.indexOf(":"))) { if (!(n = P[s.substring(0, l)])) { g(ki(s.substring(0, l))); continue } (s = h === n ? s.substr(l + 1) : n + s.substr(l)) === Ei && (-1 !== (l = o.indexOf(":")) ? (n = o.substring(0, l), o = (n = P[n] || n) + o.substring(l)) : o = h + ":" + o) } b[s] = o } return k = b } function I() { for (var t, n, i = /(\r\n|\r|\n)/g, r = 0, o = 0, a = 0, s = N; B >= a && (t = i.exec(e)) && !((s = t[0].length + t.index) > B);)r += 1, a = s; return -1 == B ? (o = s, n = e.substring(N)) : 0 === N ? n = e.substring(N, B) : (o = B - a, n = -1 == N ? e.substring(B) : e.substring(B, N + 1)), { data: n, line: r, column: o } } h = I, l && (C = Object.create({}, { name: Ri((function () { return E })), originalName: Ri((function () { return S })), attrs: Ri(L), ns: Ri((function () { return P })) })); for (; -1 !== N;) { if (-1 === (B = 60 === e.charCodeAt(N) ? N : e.indexOf("<", N))) return T.length ? y("unexpected end of file") : 0 === N ? y("missing start tag") : void (N < e.length && e.substring(N).trim() && g(Si)); if (N !== B) if (T.length) { if (t && (t(e.substring(N, B), wi, h), v)) return } else if (e.substring(N, B).trim() && (g(Si), v)) return; if (33 === (b = e.charCodeAt(B + 1))) { if (91 === (_ = e.charCodeAt(B + 2)) && "CDATA[" === e.substr(B + 3, 6)) { if (-1 === (N = e.indexOf("]]>", B))) return y("unclosed cdata"); if (r && (r(e.substring(B + 9, N), h), v)) return; N += 3; continue } if (45 === _ && 45 === e.charCodeAt(B + 3)) { if (-1 === (N = e.indexOf("--\x3e", B))) return y("unclosed comment"); if (a && (a(e.substring(B + 4, N), wi, h), v)) return; N += 3; continue } } if (63 !== b) { for (u = B + 1; ; u++) { if (x = e.charCodeAt(u), isNaN(x)) return N = -1, y("unclosed tag"); if (34 === x) u = -1 !== (_ = e.indexOf('"', u + 1)) ? _ : u; else if (39 === x) u = -1 !== (_ = e.indexOf("'", u + 1)) ? _ : u; else if (62 === x) { N = u; break } } if (33 !== b) { if (k = {}, 47 === b) { if (M = !1, D = !0, !T.length) return y("missing open tag"); if (u = E = T.pop(), _ = B + 2 + u.length, e.substring(B + 2, _) !== u) return y("closing tag mismatch"); for (; _ < N; _++)if (!(32 === (b = e.charCodeAt(_)) || b > 8 && b < 14)) return y("close tag") } else { if (47 === e.charCodeAt(N - 1) ? (u = E = e.substring(B + 1, N - 1), M = !0, D = !0) : (u = E = e.substring(B + 1, N), M = !0, D = !1), !(b > 96 && b < 123 || b > 64 && b < 91 || 95 === b || 58 === b)) return y("illegal first char nodeName"); for (_ = 1, m = u.length; _ < m; _++)if (!((b = u.charCodeAt(_)) > 96 && b < 123 || b > 64 && b < 91 || b > 47 && b < 59 || 45 === b || 95 === b || 46 == b)) { if (32 === b || b < 14 && b > 8) { E = u.substring(0, _), k = null; break } return y("invalid nodeName") } D || T.push(E) } if (f) { if (o = P, M && (D || R.push(o), null === k && (d = -1 !== u.indexOf("xmlns", _)) && (j = _, O = u, L(), d = !1)), S = E, -1 !== (b = E.indexOf(":"))) { if (!(w = P[E.substring(0, b)])) return y("missing namespace on <" + S + ">"); E = E.substr(b + 1) } else w = P.xmlns; w && (E = w + ":" + E) } if (M && (j = _, O = u, n && (l ? n(C, wi, D, h) : n(E, L, wi, D, h), v))) return; if (D) { if (i && (i(l ? C : E, wi, M, h), v)) return; f && (P = M ? o : R.pop()) } N += 1 } else { if (c && (c(e.substring(B, N + 1), wi, h), v)) return; N += 1 } } else { if (-1 === (N = e.indexOf("?>", B))) return y("unclosed question"); if (s && (s(e.substring(B, N + 2), h), v)) return; N += 2 } } }(e), h = Ai, v = !1, m }, this.stop = function () { v = !0 } } function Bi(e) { return e.xml && "lowerCase" === e.xml.tagAlias } var Ni = { xsi: "http://www.w3.org/2001/XMLSchema-instance", xml: "http://www.w3.org/XML/1998/namespace" }, Oi = "xsi:type"; function ji(e) { return e.xml && e.xml.serialize } function Li(e) { return ji(e) === Oi } function Ii(e, t) { return Bi(t) ? e.prefix + ":" + ((n = e.localName).charAt(0).toUpperCase() + n.slice(1)) : e.name; var n } function $i(e) { return new Error(e) } function Fi(e) { return e.$descriptor } function zi(e) { L(this, e), this.elementsById = {}, this.references = [], this.warnings = [], this.addReference = function (e) { this.references.push(e) }, this.addElement = function (e) { if (!e) throw $i("expected element"); var t, n = this.elementsById, i = Fi(e).idProperty; if (i && (t = e.get(i.name))) { if (!/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i.test(t)) throw new Error("illegal ID <" + t + ">"); if (n[t]) throw $i("duplicate ID <" + t + ">"); n[t] = e } }, this.addWarning = function (e) { this.warnings.push(e) } } function Hi() { } function Vi() { } function Wi() { } function Gi(e, t) { this.property = e, this.context = t } function Ui(e, t) { this.element = t, this.propertyDesc = e } function qi() { } function Ki(e, t, n) { this.model = e, this.type = e.getType(t), this.context = n } function Yi(e, t, n) { Ki.call(this, e, t, n) } function Xi(e, t, n) { this.model = e, this.context = n } function Zi(e) { e instanceof vi && (e = { model: e }), L(this, { lax: !1 }, e) } Hi.prototype.handleEnd = function () { }, Hi.prototype.handleText = function () { }, Hi.prototype.handleNode = function () { }, Vi.prototype = Object.create(Hi.prototype), Vi.prototype.handleNode = function () { return this }, Wi.prototype = Object.create(Hi.prototype), Wi.prototype.handleText = function (e) { this.body = (this.body || "") + e }, Gi.prototype = Object.create(Wi.prototype), Gi.prototype.handleNode = function (e) { if (this.element) throw $i("expected no sub nodes"); return this.element = this.createReference(e), this }, Gi.prototype.handleEnd = function () { this.element.id = this.body }, Gi.prototype.createReference = function (e) { return { property: this.property.ns.name, id: "" } }, Ui.prototype = Object.create(Wi.prototype), Ui.prototype.handleEnd = function () { var e = this.body || "", t = this.element, n = this.propertyDesc; e = ai(n.type, e), n.isMany ? t.get(n.name).push(e) : t.set(n.name, e) }, qi.prototype = Object.create(Wi.prototype), qi.prototype.handleNode = function (e) { var t = this, n = this.element; return n ? t = this.handleChild(e) : (n = this.element = this.createElement(e), this.context.addElement(n)), t }, Ki.prototype = Object.create(qi.prototype), Ki.prototype.addReference = function (e) { this.context.addReference(e) }, Ki.prototype.handleText = function (e) { if (!Fi(this.element).bodyProperty) throw $i("unexpected body text <" + e + ">"); Wi.prototype.handleText.call(this, e) }, Ki.prototype.handleEnd = function () { var e = this.body, t = this.element, n = Fi(t).bodyProperty; n && void 0 !== e && (e = ai(n.type, e), t.set(n.name, e)) }, Ki.prototype.createElement = function (e) { var t, n = e.attributes, i = this.type, r = Fi(i), o = this.context, a = new i({}), s = this.model; return g(n, (function (e, n) { var i = r.propertiesByName[n]; i && i.isReference ? i.isMany ? g(e.split(" "), (function (e) { o.addReference({ element: a, property: i.ns.name, id: e }) })) : o.addReference({ element: a, property: i.ns.name, id: e }) : (i ? e = ai(i.type, e) : "xmlns" !== n && (t = pi(n, r.ns.prefix), s.getPackage(t.prefix) && o.addWarning({ message: "unknown attribute <" + n + ">", element: a, property: n, value: e })), a.set(n, e)) })), a }, Ki.prototype.getPropertyForNode = function (e) { var t, n, i = pi(e.name), r = this.type, o = this.model, a = Fi(r), s = i.name, c = a.propertiesByName[s]; if (c && !c.isAttr) return Li(c) && (t = e.attributes[Oi]) ? (t = function (e, t) { var n = pi(e); return function (e, t) { var n = e.name, i = e.localName, r = t.xml && t.xml.typePrefix; return r && 0 === i.indexOf(r) ? e.prefix + ":" + i.slice(r.length) : n }(n, t.getPackage(n.prefix)) }(t, o), L({}, c, { effectiveType: Fi(n = o.getType(t)).name })) : c; var p = o.getPackage(i.prefix); if (p) { if (t = Ii(i, p), n = o.getType(t), c = m(a.properties, (function (e) { return !e.isVirtual && !e.isReference && !e.isAttribute && n.hasType(e.type) })), c) return L({}, c, { effectiveType: Fi(n).name }) } else if (c = m(a.properties, (function (e) { return !e.isReference && !e.isAttribute && "Element" === e.type })), c) return c; throw $i("unrecognized element <" + i.name + ">") }, Ki.prototype.toString = function () { return "ElementDescriptor[" + Fi(this.type).name + "]" }, Ki.prototype.valueHandler = function (e, t) { return new Ui(e, t) }, Ki.prototype.referenceHandler = function (e) { return new Gi(e, this.context) }, Ki.prototype.handler = function (e) { return "Element" === e ? new Xi(this.model, e, this.context) : new Ki(this.model, e, this.context) }, Ki.prototype.handleChild = function (e) { var t, n, i, r; if (t = this.getPropertyForNode(e), i = this.element, ci(n = t.effectiveType || t.type)) return this.valueHandler(t, i); var o = (r = t.isReference ? this.referenceHandler(t).handleNode(e) : this.handler(n).handleNode(e)).element; return void 0 !== o && (t.isMany ? i.get(t.name).push(o) : i.set(t.name, o), t.isReference ? (L(o, { element: i }), this.context.addReference(o)) : o.$parent = i), r }, Yi.prototype = Object.create(Ki.prototype), Yi.prototype.createElement = function (e) { var t = e.name, n = pi(t), i = this.model, r = this.type, o = i.getPackage(n.prefix), a = o && Ii(n, o) || t; if (!r.hasType(a)) throw $i("unexpected element <" + e.originalName + ">"); return Ki.prototype.createElement.call(this, e) }, Xi.prototype = Object.create(qi.prototype), Xi.prototype.createElement = function (e) { var t = e.name, n = pi(t).prefix, i = e.ns[n + "$uri"], r = e.attributes; return this.model.createAny(t, i, r) }, Xi.prototype.handleChild = function (e) { var t = new Xi(this.model, "Element", this.context).handleNode(e), n = this.element, i = t.element; return void 0 !== i && ((n.$children = n.$children || []).push(i), i.$parent = n), t }, Xi.prototype.handleEnd = function () { this.body && (this.element.$body = this.body) }, Zi.prototype.fromXML = function (e, t, n) { var i = t.rootHandler; t instanceof Ki ? (i = t, t = {}) : "string" == typeof t ? (i = this.handler(t), t = {}) : "string" == typeof i && (i = this.handler(i)); var r = this.model, o = this.lax, a = new zi(L({}, t, { rootHandler: i })), s = new Di({ proxy: !0 }), c = function () { var e = []; return Object.defineProperty(e, "peek", { value: function () { return this[this.length - 1] } }), e }(); function p(e, t, n) { var i = t(), r = i.line, o = i.column, s = i.data; "<" === s.charAt(0) && -1 !== s.indexOf(" ") && (s = s.slice(0, s.indexOf(" ")) + ">"); var c = "unparsable content " + (s ? s + " " : "") + "detected\n\tline: " + r + "\n\tcolumn: " + o + "\n\tnested error: " + e.message; if (n) return a.addWarning({ message: c, error: e }), !0; throw $i(c) } function l(e, t) { return p(e, t, !0) } i.context = a, c.push(i); var u = /^<\?xml /i, h = / encoding="([^"]+)"/i, d = /^utf-8$/i; function f(e, t) { try { c.peek().handleText(e) } catch (e) { l(e, t) } } var m = r.getPackages().reduce((function (e, t) { return e[t.uri] = t.prefix, e }), { "http://www.w3.org/XML/1998/namespace": "xml" }); return s.ns(m).on("openTag", (function (e, t, n, i) { var r = e.attrs || {}, a = Object.keys(r).reduce((function (e, n) { var i = t(r[n]); return e[n] = i, e }), {}); !function (e, t) { var n = c.peek(); try { c.push(n.handleNode(e)) } catch (e) { p(e, t, o) && c.push(new Vi) } }({ name: e.name, originalName: e.originalName, attributes: a, ns: e.ns }, i) })).on("question", (function (e) { if (u.test(e)) { var t = h.exec(e), n = t && t[1]; n && !d.test(n) && a.addWarning({ message: "unsupported document encoding <" + n + ">, falling back to UTF-8" }) } })).on("closeTag", (function () { c.pop().handleEnd() })).on("cdata", f).on("text", (function (e, t, n) { !function (e, t) { e.trim() && f(e, t) }(t(e), n) })).on("error", p).on("warn", l), new Promise((function (t, n) { var r; try { s.parse(e), function () { var e, t, n = a.elementsById, i = a.references; for (e = 0; t = i[e]; e++) { var r = t.element, o = n[t.id], s = Fi(r).propertiesByName[t.property]; if (o || a.addWarning({ message: "unresolved reference <" + t.id + ">", element: t.element, property: t.property, value: t.id }), s.isMany) { var c = r.get(s.name), p = c.indexOf(t); -1 === p && (p = c.length), o ? c[p] = o : c.splice(p, 1) } else r.set(s.name, o) } }() } catch (e) { r = e } var o = i.element; r || o || (r = $i("failed to parse document as <" + i.type.$descriptor.name + ">")); var c = a.warnings, p = a.references, l = a.elementsById; return r ? (r.warnings = c, n(r)) : t({ rootElement: o, elementsById: l, references: p, warnings: c }) })) }, Zi.prototype.handler = function (e) { return new Yi(this.model, e) }; var Qi = /<|>|'|"|&|\n\r|\n/g, Ji = /<|>|&/g; function er(e) { var t = {}, n = {}, i = {}, r = [], o = []; this.byUri = function (t) { return n[t] || e && e.byUri(t) }, this.add = function (e, t) { n[e.uri] = e, t ? r.push(e) : o.push(e), this.mapPrefix(e.prefix, e.uri) }, this.uriByPrefix = function (e) { return t[e || "xmlns"] }, this.mapPrefix = function (e, n) { t[e || "xmlns"] = n }, this.getNSKey = function (e) { return void 0 !== e.prefix ? e.uri + "|" + e.prefix : e.uri }, this.logUsed = function (t) { var n = t.uri, r = this.getNSKey(t); i[r] = this.byUri(n), e && e.logUsed(t) }, this.getUsed = function (e) { var t = this; return [].concat(r, o).filter((function (e) { var n = t.getNSKey(e); return i[n] })) } } function tr(e, t) { return Bi(t) ? (n = e).charAt(0).toLowerCase() + n.slice(1) : e; var n } function nr(e, t) { e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }) } function ir(e) { return d(e) ? e : (e.prefix ? e.prefix + ":" : "") + e.localName } var rr = { "\n": "#10", "\n\r": "#10", '"': "#34", "'": "#39", "<": "#60", ">": "#62", "&": "#38" }, or = { "<": "lt", ">": "gt", "&": "amp" }; function ar(e, t, n) { return (e = d(e) ? e : "" + e).replace(t, (function (e) { return "&" + n[e] + ";" })) } function sr(e) { this.tagName = e } function cr() { } function pr(e) { this.tagName = e } function lr(e, t) { this.body = [], this.attrs = [], this.parent = e, this.propertyDescriptor = t } function ur(e, t) { lr.call(this, e, t) } function hr() { this.value = "", this.write = function (e) { this.value += e } } function dr(e, t) { var n = [""]; this.append = function (t) { return e.write(t), this }, this.appendNewLine = function () { return t && e.write("\n"), this }, this.appendIndent = function () { return t && e.write(n.join("  ")), this }, this.indent = function () { return n.push(""), this }, this.unindent = function () { return n.pop(), this } } function fr(e) { return e = L({ format: !1, preamble: !0 }, e || {}), { toXML: function (t, n) { var i = n || new hr, r = new dr(i, e.format); if (e.preamble && r.append('<?xml version="1.0" encoding="UTF-8"?>\n'), (new lr).build(t).serializeTo(r), !n) return i.value } } } function mr(e, t) { vi.call(this, e, t) } sr.prototype.build = function (e) { return this.element = e, this }, sr.prototype.serializeTo = function (e) { e.appendIndent().append("<" + this.tagName + ">" + this.element.id + "</" + this.tagName + ">").appendNewLine() }, cr.prototype.serializeValue = cr.prototype.serializeTo = function (e) { e.append(this.escape ? ar(this.value, Ji, or) : this.value) }, cr.prototype.build = function (e, t) { return this.value = t, "String" === e.type && -1 !== t.search(Ji) && (this.escape = !0), this }, nr(pr, cr), pr.prototype.serializeTo = function (e) { e.appendIndent().append("<" + this.tagName + ">"), this.serializeValue(e), e.append("</" + this.tagName + ">").appendNewLine() }, lr.prototype.build = function (e) { this.element = e; var t, n, i = e.$descriptor, r = this.propertyDescriptor, o = i.isGeneric; return t = o ? this.parseGeneric(e) : this.parseNsAttributes(e), this.ns = r ? this.nsPropertyTagName(r) : this.nsTagName(i), this.tagName = this.addTagName(this.ns), o || (n = function (e) { return y(e.$descriptor.properties, (function (t) { var n = t.name; if (t.isVirtual) return !1; if (!f(e, n)) return !1; var i = e[n]; return i !== t.default && null !== i && (!t.isMany || i.length) })) }(e), this.parseAttributes(y(n, (function (e) { return e.isAttr }))), this.parseContainments(function (e) { return y(e, (function (e) { return !e.isAttr })) }(n))), this.parseGenericAttributes(e, t), this }, lr.prototype.nsTagName = function (e) { return function (e, t) { return t.isGeneric ? L({ localName: t.ns.localName }, e) : L({ localName: tr(t.ns.localName, t.$pkg) }, e) }(this.logNamespaceUsed(e.ns), e) }, lr.prototype.nsPropertyTagName = function (e) { return function (e, t) { return L({ localName: t.ns.localName }, e) }(this.logNamespaceUsed(e.ns), e) }, lr.prototype.isLocalNs = function (e) { return e.uri === this.ns.uri }, lr.prototype.nsAttributeName = function (e) { var t; if (t = d(e) ? pi(e) : e.ns, e.inherited) return { localName: t.localName }; var n = this.logNamespaceUsed(t); return this.getNamespaces().logUsed(n), this.isLocalNs(n) ? { localName: t.localName } : L({ localName: t.localName }, n) }, lr.prototype.parseGeneric = function (e) { var t = this, n = this.body, i = []; return g(e, (function (r, o) { "$body" === o ? n.push((new cr).build({ type: "String" }, r)) : "$children" === o ? g(r, (function (e) { n.push(new lr(t).build(e)) })) : 0 !== o.indexOf("$") && t.parseNsAttribute(e, o, r) && i.push({ name: o, value: r }) })), i }, lr.prototype.parseNsAttribute = function (e, t, n) { var i, r = e.$model, o = pi(t); if ("xmlns" === o.prefix && (i = { prefix: o.localName, uri: n }), o.prefix || "xmlns" !== o.localName || (i = { uri: n }), !i) return { name: t, value: n }; if (r && r.getPackage(n)) this.logNamespace(i, !0, !0); else { var a = this.logNamespaceUsed(i, !0); this.getNamespaces().logUsed(a) } }, lr.prototype.parseNsAttributes = function (e, t) { var n = this, i = e.$attrs, r = []; return g(i, (function (t, i) { var o = n.parseNsAttribute(e, i, t); o && r.push(o) })), r }, lr.prototype.parseGenericAttributes = function (e, t) { var n = this; g(t, (function (t) { if (t.name !== Oi) try { n.addAttribute(n.nsAttributeName(t.name), t.value) } catch (n) { console.warn("missing namespace information for ", t.name, "=", t.value, "on", e, n) } })) }, lr.prototype.parseContainments = function (e) { var t = this, n = this.body, i = this.element; g(e, (function (e) { var r = i.get(e.name), o = e.isReference; if (e.isMany || (r = [r]), e.isBody) n.push((new cr).build(e, r[0])); else if (ci(e.type)) g(r, (function (i) { n.push(new pr(t.addTagName(t.nsPropertyTagName(e))).build(e, i)) })); else if (o) g(r, (function (i) { n.push(new sr(t.addTagName(t.nsPropertyTagName(e))).build(i)) })); else { var a = Li(e), s = function (e) { return "property" === ji(e) }(e); g(r, (function (i) { var r; r = a ? new ur(t, e) : s ? new lr(t, e) : new lr(t), n.push(r.build(i)) })) } })) }, lr.prototype.getNamespaces = function (e) { var t, n = this.namespaces, i = this.parent; return n || (t = i && i.getNamespaces(), e || !t ? this.namespaces = n = new er(t) : n = t), n }, lr.prototype.logNamespace = function (e, t, n) { var i = this.getNamespaces(n), r = e.uri, o = e.prefix; return i.byUri(r) && !n || i.add(e, t), i.mapPrefix(o, r), e }, lr.prototype.logNamespaceUsed = function (e, t) { var n, i, r, o = this.element.$model, a = this.getNamespaces(t), s = e.prefix, c = e.uri; if (!s && !c) return { localName: e.localName }; if (r = Ni[s] || o && (o.getPackage(s) || {}).uri, !(c = c || r || a.uriByPrefix(s))) throw new Error("no namespace uri given for prefix <" + s + ">"); if (!(e = a.byUri(c))) { for (n = s, i = 1; a.uriByPrefix(n);)n = s + "_" + i++; e = this.logNamespace({ prefix: n, uri: c }, r === c) } return s && a.mapPrefix(s, c), e }, lr.prototype.parseAttributes = function (e) { var t = this, n = this.element; g(e, (function (e) { var i = n.get(e.name); if (e.isReference) if (e.isMany) { var r = []; g(i, (function (e) { r.push(e.id) })), i = r.join(" ") } else i = i.id; t.addAttribute(t.nsAttributeName(e), i) })) }, lr.prototype.addTagName = function (e) { var t = this.logNamespaceUsed(e); return this.getNamespaces().logUsed(t), ir(e) }, lr.prototype.addAttribute = function (e, t) { var n = this.attrs; d(t) && (t = ar(t, Qi, rr)); var i = v(n, (function (t) { return t.name.localName === e.localName && t.name.uri === e.uri && t.name.prefix === e.prefix })), r = { name: e, value: t }; -1 !== i ? n.splice(i, 1, r) : n.push(r) }, lr.prototype.serializeAttributes = function (e) { var t = this.attrs, n = this.namespaces; n && (t = function (e) { return e.getUsed().filter((function (e) { return "xml" !== e.prefix })).map((function (e) { return { name: "xmlns" + (e.prefix ? ":" + e.prefix : ""), value: e.uri } })) }(n).concat(t)), g(t, (function (t) { e.append(" ").append(ir(t.name)).append('="').append(t.value).append('"') })) }, lr.prototype.serializeTo = function (e) { var t = this.body[0], n = t && t.constructor !== cr; e.appendIndent().append("<" + this.tagName), this.serializeAttributes(e), e.append(t ? ">" : " />"), t && (n && e.appendNewLine().indent(), g(this.body, (function (t) { t.serializeTo(e) })), n && e.unindent().appendIndent(), e.append("</" + this.tagName + ">")), e.appendNewLine() }, nr(ur, lr), ur.prototype.parseNsAttributes = function (e) { var t = lr.prototype.parseNsAttributes.call(this, e), n = e.$descriptor; if (n.name === this.propertyDescriptor.type) return t; var i = this.typeNs = this.nsTagName(n); this.getNamespaces().logUsed(this.typeNs); var r = e.$model.getPackage(i.uri), o = r.xml && r.xml.typePrefix || ""; return this.addAttribute(this.nsAttributeName(Oi), (i.prefix ? i.prefix + ":" : "") + o + n.ns.localName), t }, ur.prototype.isLocalNs = function (e) { return e.uri === (this.typeNs || this.ns).uri }, mr.prototype = Object.create(vi.prototype), mr.prototype.fromXML = function (e, t, n) { d(t) || (n = t, t = "bpmn:Definitions"); var i = new Zi(L({ model: this, lax: !0 }, n)), r = i.handler(t); return i.fromXML(e, r) }, mr.prototype.toXML = function (e, t) { var n = new fr(t); return new Promise((function (t, i) { try { return t({ xml: n.toXML(e) }) } catch (e) { return i(e) } })) }; var vr = { bpmn: { name: "BPMN20", uri: "http://www.omg.org/spec/BPMN/20100524/MODEL", prefix: "bpmn", associations: [], types: [{ name: "Interface", superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "operations", type: "Operation", isMany: !0 }, { name: "implementationRef", isAttr: !0, type: "String" }] }, { name: "Operation", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "inMessageRef", type: "Message", isReference: !0 }, { name: "outMessageRef", type: "Message", isReference: !0 }, { name: "errorRef", type: "Error", isMany: !0, isReference: !0 }, { name: "implementationRef", isAttr: !0, type: "String" }] }, { name: "EndPoint", superClass: ["RootElement"] }, { name: "Auditing", superClass: ["BaseElement"] }, { name: "GlobalTask", superClass: ["CallableElement"], properties: [{ name: "resources", type: "ResourceRole", isMany: !0 }] }, { name: "Monitoring", superClass: ["BaseElement"] }, { name: "Performer", superClass: ["ResourceRole"] }, { name: "Process", superClass: ["FlowElementsContainer", "CallableElement"], properties: [{ name: "processType", type: "ProcessType", isAttr: !0 }, { name: "isClosed", isAttr: !0, type: "Boolean" }, { name: "auditing", type: "Auditing" }, { name: "monitoring", type: "Monitoring" }, { name: "properties", type: "Property", isMany: !0 }, { name: "laneSets", isMany: !0, replaces: "FlowElementsContainer#laneSets", type: "LaneSet" }, { name: "flowElements", isMany: !0, replaces: "FlowElementsContainer#flowElements", type: "FlowElement" }, { name: "artifacts", type: "Artifact", isMany: !0 }, { name: "resources", type: "ResourceRole", isMany: !0 }, { name: "correlationSubscriptions", type: "CorrelationSubscription", isMany: !0 }, { name: "supports", type: "Process", isMany: !0, isReference: !0 }, { name: "definitionalCollaborationRef", type: "Collaboration", isAttr: !0, isReference: !0 }, { name: "isExecutable", isAttr: !0, type: "Boolean" }] }, { name: "LaneSet", superClass: ["BaseElement"], properties: [{ name: "lanes", type: "Lane", isMany: !0 }, { name: "name", isAttr: !0, type: "String" }] }, { name: "Lane", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "partitionElementRef", type: "BaseElement", isAttr: !0, isReference: !0 }, { name: "partitionElement", type: "BaseElement" }, { name: "flowNodeRef", type: "FlowNode", isMany: !0, isReference: !0 }, { name: "childLaneSet", type: "LaneSet", xml: { serialize: "xsi:type" } }] }, { name: "GlobalManualTask", superClass: ["GlobalTask"] }, { name: "ManualTask", superClass: ["Task"] }, { name: "UserTask", superClass: ["Task"], properties: [{ name: "renderings", type: "Rendering", isMany: !0 }, { name: "implementation", isAttr: !0, type: "String" }] }, { name: "Rendering", superClass: ["BaseElement"] }, { name: "HumanPerformer", superClass: ["Performer"] }, { name: "PotentialOwner", superClass: ["HumanPerformer"] }, { name: "GlobalUserTask", superClass: ["GlobalTask"], properties: [{ name: "implementation", isAttr: !0, type: "String" }, { name: "renderings", type: "Rendering", isMany: !0 }] }, { name: "Gateway", isAbstract: !0, superClass: ["FlowNode"], properties: [{ name: "gatewayDirection", type: "GatewayDirection", default: "Unspecified", isAttr: !0 }] }, { name: "EventBasedGateway", superClass: ["Gateway"], properties: [{ name: "instantiate", default: !1, isAttr: !0, type: "Boolean" }, { name: "eventGatewayType", type: "EventBasedGatewayType", isAttr: !0, default: "Exclusive" }] }, { name: "ComplexGateway", superClass: ["Gateway"], properties: [{ name: "activationCondition", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "default", type: "SequenceFlow", isAttr: !0, isReference: !0 }] }, { name: "ExclusiveGateway", superClass: ["Gateway"], properties: [{ name: "default", type: "SequenceFlow", isAttr: !0, isReference: !0 }] }, { name: "InclusiveGateway", superClass: ["Gateway"], properties: [{ name: "default", type: "SequenceFlow", isAttr: !0, isReference: !0 }] }, { name: "ParallelGateway", superClass: ["Gateway"] }, { name: "RootElement", isAbstract: !0, superClass: ["BaseElement"] }, { name: "Relationship", superClass: ["BaseElement"], properties: [{ name: "type", isAttr: !0, type: "String" }, { name: "direction", type: "RelationshipDirection", isAttr: !0 }, { name: "source", isMany: !0, isReference: !0, type: "Element" }, { name: "target", isMany: !0, isReference: !0, type: "Element" }] }, { name: "BaseElement", isAbstract: !0, properties: [{ name: "id", isAttr: !0, type: "String", isId: !0 }, { name: "documentation", type: "Documentation", isMany: !0 }, { name: "extensionDefinitions", type: "ExtensionDefinition", isMany: !0, isReference: !0 }, { name: "extensionElements", type: "ExtensionElements" }] }, { name: "Extension", properties: [{ name: "mustUnderstand", default: !1, isAttr: !0, type: "Boolean" }, { name: "definition", type: "ExtensionDefinition", isAttr: !0, isReference: !0 }] }, { name: "ExtensionDefinition", properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "extensionAttributeDefinitions", type: "ExtensionAttributeDefinition", isMany: !0 }] }, { name: "ExtensionAttributeDefinition", properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "type", isAttr: !0, type: "String" }, { name: "isReference", default: !1, isAttr: !0, type: "Boolean" }, { name: "extensionDefinition", type: "ExtensionDefinition", isAttr: !0, isReference: !0 }] }, { name: "ExtensionElements", properties: [{ name: "valueRef", isAttr: !0, isReference: !0, type: "Element" }, { name: "values", type: "Element", isMany: !0 }, { name: "extensionAttributeDefinition", type: "ExtensionAttributeDefinition", isAttr: !0, isReference: !0 }] }, { name: "Documentation", superClass: ["BaseElement"], properties: [{ name: "text", type: "String", isBody: !0 }, { name: "textFormat", default: "text/plain", isAttr: !0, type: "String" }] }, { name: "Event", isAbstract: !0, superClass: ["FlowNode", "InteractionNode"], properties: [{ name: "properties", type: "Property", isMany: !0 }] }, { name: "IntermediateCatchEvent", superClass: ["CatchEvent"] }, { name: "IntermediateThrowEvent", superClass: ["ThrowEvent"] }, { name: "EndEvent", superClass: ["ThrowEvent"] }, { name: "StartEvent", superClass: ["CatchEvent"], properties: [{ name: "isInterrupting", default: !0, isAttr: !0, type: "Boolean" }] }, { name: "ThrowEvent", isAbstract: !0, superClass: ["Event"], properties: [{ name: "dataInputs", type: "DataInput", isMany: !0 }, { name: "dataInputAssociations", type: "DataInputAssociation", isMany: !0 }, { name: "inputSet", type: "InputSet" }, { name: "eventDefinitions", type: "EventDefinition", isMany: !0 }, { name: "eventDefinitionRef", type: "EventDefinition", isMany: !0, isReference: !0 }] }, { name: "CatchEvent", isAbstract: !0, superClass: ["Event"], properties: [{ name: "parallelMultiple", isAttr: !0, type: "Boolean", default: !1 }, { name: "dataOutputs", type: "DataOutput", isMany: !0 }, { name: "dataOutputAssociations", type: "DataOutputAssociation", isMany: !0 }, { name: "outputSet", type: "OutputSet" }, { name: "eventDefinitions", type: "EventDefinition", isMany: !0 }, { name: "eventDefinitionRef", type: "EventDefinition", isMany: !0, isReference: !0 }] }, { name: "BoundaryEvent", superClass: ["CatchEvent"], properties: [{ name: "cancelActivity", default: !0, isAttr: !0, type: "Boolean" }, { name: "attachedToRef", type: "Activity", isAttr: !0, isReference: !0 }] }, { name: "EventDefinition", isAbstract: !0, superClass: ["RootElement"] }, { name: "CancelEventDefinition", superClass: ["EventDefinition"] }, { name: "ErrorEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "errorRef", type: "Error", isAttr: !0, isReference: !0 }] }, { name: "TerminateEventDefinition", superClass: ["EventDefinition"] }, { name: "EscalationEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "escalationRef", type: "Escalation", isAttr: !0, isReference: !0 }] }, { name: "Escalation", properties: [{ name: "structureRef", type: "ItemDefinition", isAttr: !0, isReference: !0 }, { name: "name", isAttr: !0, type: "String" }, { name: "escalationCode", isAttr: !0, type: "String" }], superClass: ["RootElement"] }, { name: "CompensateEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "waitForCompletion", isAttr: !0, type: "Boolean", default: !0 }, { name: "activityRef", type: "Activity", isAttr: !0, isReference: !0 }] }, { name: "TimerEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "timeDate", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "timeCycle", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "timeDuration", type: "Expression", xml: { serialize: "xsi:type" } }] }, { name: "LinkEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "target", type: "LinkEventDefinition", isReference: !0 }, { name: "source", type: "LinkEventDefinition", isMany: !0, isReference: !0 }] }, { name: "MessageEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "messageRef", type: "Message", isAttr: !0, isReference: !0 }, { name: "operationRef", type: "Operation", isAttr: !0, isReference: !0 }] }, { name: "ConditionalEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "condition", type: "Expression", xml: { serialize: "xsi:type" } }] }, { name: "SignalEventDefinition", superClass: ["EventDefinition"], properties: [{ name: "signalRef", type: "Signal", isAttr: !0, isReference: !0 }] }, { name: "Signal", superClass: ["RootElement"], properties: [{ name: "structureRef", type: "ItemDefinition", isAttr: !0, isReference: !0 }, { name: "name", isAttr: !0, type: "String" }] }, { name: "ImplicitThrowEvent", superClass: ["ThrowEvent"] }, { name: "DataState", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }] }, { name: "ItemAwareElement", superClass: ["BaseElement"], properties: [{ name: "itemSubjectRef", type: "ItemDefinition", isAttr: !0, isReference: !0 }, { name: "dataState", type: "DataState" }] }, { name: "DataAssociation", superClass: ["BaseElement"], properties: [{ name: "sourceRef", type: "ItemAwareElement", isMany: !0, isReference: !0 }, { name: "targetRef", type: "ItemAwareElement", isReference: !0 }, { name: "transformation", type: "FormalExpression", xml: { serialize: "property" } }, { name: "assignment", type: "Assignment", isMany: !0 }] }, { name: "DataInput", superClass: ["ItemAwareElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "isCollection", default: !1, isAttr: !0, type: "Boolean" }, { name: "inputSetRef", type: "InputSet", isMany: !0, isVirtual: !0, isReference: !0 }, { name: "inputSetWithOptional", type: "InputSet", isMany: !0, isVirtual: !0, isReference: !0 }, { name: "inputSetWithWhileExecuting", type: "InputSet", isMany: !0, isVirtual: !0, isReference: !0 }] }, { name: "DataOutput", superClass: ["ItemAwareElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "isCollection", default: !1, isAttr: !0, type: "Boolean" }, { name: "outputSetRef", type: "OutputSet", isMany: !0, isVirtual: !0, isReference: !0 }, { name: "outputSetWithOptional", type: "OutputSet", isMany: !0, isVirtual: !0, isReference: !0 }, { name: "outputSetWithWhileExecuting", type: "OutputSet", isMany: !0, isVirtual: !0, isReference: !0 }] }, { name: "InputSet", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "dataInputRefs", type: "DataInput", isMany: !0, isReference: !0 }, { name: "optionalInputRefs", type: "DataInput", isMany: !0, isReference: !0 }, { name: "whileExecutingInputRefs", type: "DataInput", isMany: !0, isReference: !0 }, { name: "outputSetRefs", type: "OutputSet", isMany: !0, isReference: !0 }] }, { name: "OutputSet", superClass: ["BaseElement"], properties: [{ name: "dataOutputRefs", type: "DataOutput", isMany: !0, isReference: !0 }, { name: "name", isAttr: !0, type: "String" }, { name: "inputSetRefs", type: "InputSet", isMany: !0, isReference: !0 }, { name: "optionalOutputRefs", type: "DataOutput", isMany: !0, isReference: !0 }, { name: "whileExecutingOutputRefs", type: "DataOutput", isMany: !0, isReference: !0 }] }, { name: "Property", superClass: ["ItemAwareElement"], properties: [{ name: "name", isAttr: !0, type: "String" }] }, { name: "DataInputAssociation", superClass: ["DataAssociation"] }, { name: "DataOutputAssociation", superClass: ["DataAssociation"] }, { name: "InputOutputSpecification", superClass: ["BaseElement"], properties: [{ name: "dataInputs", type: "DataInput", isMany: !0 }, { name: "dataOutputs", type: "DataOutput", isMany: !0 }, { name: "inputSets", type: "InputSet", isMany: !0 }, { name: "outputSets", type: "OutputSet", isMany: !0 }] }, { name: "DataObject", superClass: ["FlowElement", "ItemAwareElement"], properties: [{ name: "isCollection", default: !1, isAttr: !0, type: "Boolean" }] }, { name: "InputOutputBinding", properties: [{ name: "inputDataRef", type: "InputSet", isAttr: !0, isReference: !0 }, { name: "outputDataRef", type: "OutputSet", isAttr: !0, isReference: !0 }, { name: "operationRef", type: "Operation", isAttr: !0, isReference: !0 }] }, { name: "Assignment", superClass: ["BaseElement"], properties: [{ name: "from", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "to", type: "Expression", xml: { serialize: "xsi:type" } }] }, { name: "DataStore", superClass: ["RootElement", "ItemAwareElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "capacity", isAttr: !0, type: "Integer" }, { name: "isUnlimited", default: !0, isAttr: !0, type: "Boolean" }] }, { name: "DataStoreReference", superClass: ["ItemAwareElement", "FlowElement"], properties: [{ name: "dataStoreRef", type: "DataStore", isAttr: !0, isReference: !0 }] }, { name: "DataObjectReference", superClass: ["ItemAwareElement", "FlowElement"], properties: [{ name: "dataObjectRef", type: "DataObject", isAttr: !0, isReference: !0 }] }, { name: "ConversationLink", superClass: ["BaseElement"], properties: [{ name: "sourceRef", type: "InteractionNode", isAttr: !0, isReference: !0 }, { name: "targetRef", type: "InteractionNode", isAttr: !0, isReference: !0 }, { name: "name", isAttr: !0, type: "String" }] }, { name: "ConversationAssociation", superClass: ["BaseElement"], properties: [{ name: "innerConversationNodeRef", type: "ConversationNode", isAttr: !0, isReference: !0 }, { name: "outerConversationNodeRef", type: "ConversationNode", isAttr: !0, isReference: !0 }] }, { name: "CallConversation", superClass: ["ConversationNode"], properties: [{ name: "calledCollaborationRef", type: "Collaboration", isAttr: !0, isReference: !0 }, { name: "participantAssociations", type: "ParticipantAssociation", isMany: !0 }] }, { name: "Conversation", superClass: ["ConversationNode"] }, { name: "SubConversation", superClass: ["ConversationNode"], properties: [{ name: "conversationNodes", type: "ConversationNode", isMany: !0 }] }, { name: "ConversationNode", isAbstract: !0, superClass: ["InteractionNode", "BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "participantRef", type: "Participant", isMany: !0, isReference: !0 }, { name: "messageFlowRefs", type: "MessageFlow", isMany: !0, isReference: !0 }, { name: "correlationKeys", type: "CorrelationKey", isMany: !0 }] }, { name: "GlobalConversation", superClass: ["Collaboration"] }, { name: "PartnerEntity", superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "participantRef", type: "Participant", isMany: !0, isReference: !0 }] }, { name: "PartnerRole", superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "participantRef", type: "Participant", isMany: !0, isReference: !0 }] }, { name: "CorrelationProperty", superClass: ["RootElement"], properties: [{ name: "correlationPropertyRetrievalExpression", type: "CorrelationPropertyRetrievalExpression", isMany: !0 }, { name: "name", isAttr: !0, type: "String" }, { name: "type", type: "ItemDefinition", isAttr: !0, isReference: !0 }] }, { name: "Error", superClass: ["RootElement"], properties: [{ name: "structureRef", type: "ItemDefinition", isAttr: !0, isReference: !0 }, { name: "name", isAttr: !0, type: "String" }, { name: "errorCode", isAttr: !0, type: "String" }] }, { name: "CorrelationKey", superClass: ["BaseElement"], properties: [{ name: "correlationPropertyRef", type: "CorrelationProperty", isMany: !0, isReference: !0 }, { name: "name", isAttr: !0, type: "String" }] }, { name: "Expression", superClass: ["BaseElement"], isAbstract: !1, properties: [{ name: "body", isBody: !0, type: "String" }] }, { name: "FormalExpression", superClass: ["Expression"], properties: [{ name: "language", isAttr: !0, type: "String" }, { name: "evaluatesToTypeRef", type: "ItemDefinition", isAttr: !0, isReference: !0 }] }, { name: "Message", superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "itemRef", type: "ItemDefinition", isAttr: !0, isReference: !0 }] }, { name: "ItemDefinition", superClass: ["RootElement"], properties: [{ name: "itemKind", type: "ItemKind", isAttr: !0 }, { name: "structureRef", isAttr: !0, type: "String" }, { name: "isCollection", default: !1, isAttr: !0, type: "Boolean" }, { name: "import", type: "Import", isAttr: !0, isReference: !0 }] }, { name: "FlowElement", isAbstract: !0, superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "auditing", type: "Auditing" }, { name: "monitoring", type: "Monitoring" }, { name: "categoryValueRef", type: "CategoryValue", isMany: !0, isReference: !0 }] }, { name: "SequenceFlow", superClass: ["FlowElement"], properties: [{ name: "isImmediate", isAttr: !0, type: "Boolean" }, { name: "conditionExpression", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "sourceRef", type: "FlowNode", isAttr: !0, isReference: !0 }, { name: "targetRef", type: "FlowNode", isAttr: !0, isReference: !0 }] }, { name: "FlowElementsContainer", isAbstract: !0, superClass: ["BaseElement"], properties: [{ name: "laneSets", type: "LaneSet", isMany: !0 }, { name: "flowElements", type: "FlowElement", isMany: !0 }] }, { name: "CallableElement", isAbstract: !0, superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "ioSpecification", type: "InputOutputSpecification", xml: { serialize: "property" } }, { name: "supportedInterfaceRef", type: "Interface", isMany: !0, isReference: !0 }, { name: "ioBinding", type: "InputOutputBinding", isMany: !0, xml: { serialize: "property" } }] }, { name: "FlowNode", isAbstract: !0, superClass: ["FlowElement"], properties: [{ name: "incoming", type: "SequenceFlow", isMany: !0, isReference: !0 }, { name: "outgoing", type: "SequenceFlow", isMany: !0, isReference: !0 }, { name: "lanes", type: "Lane", isMany: !0, isVirtual: !0, isReference: !0 }] }, { name: "CorrelationPropertyRetrievalExpression", superClass: ["BaseElement"], properties: [{ name: "messagePath", type: "FormalExpression" }, { name: "messageRef", type: "Message", isAttr: !0, isReference: !0 }] }, { name: "CorrelationPropertyBinding", superClass: ["BaseElement"], properties: [{ name: "dataPath", type: "FormalExpression" }, { name: "correlationPropertyRef", type: "CorrelationProperty", isAttr: !0, isReference: !0 }] }, { name: "Resource", superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "resourceParameters", type: "ResourceParameter", isMany: !0 }] }, { name: "ResourceParameter", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "isRequired", isAttr: !0, type: "Boolean" }, { name: "type", type: "ItemDefinition", isAttr: !0, isReference: !0 }] }, { name: "CorrelationSubscription", superClass: ["BaseElement"], properties: [{ name: "correlationKeyRef", type: "CorrelationKey", isAttr: !0, isReference: !0 }, { name: "correlationPropertyBinding", type: "CorrelationPropertyBinding", isMany: !0 }] }, { name: "MessageFlow", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "sourceRef", type: "InteractionNode", isAttr: !0, isReference: !0 }, { name: "targetRef", type: "InteractionNode", isAttr: !0, isReference: !0 }, { name: "messageRef", type: "Message", isAttr: !0, isReference: !0 }] }, { name: "MessageFlowAssociation", superClass: ["BaseElement"], properties: [{ name: "innerMessageFlowRef", type: "MessageFlow", isAttr: !0, isReference: !0 }, { name: "outerMessageFlowRef", type: "MessageFlow", isAttr: !0, isReference: !0 }] }, { name: "InteractionNode", isAbstract: !0, properties: [{ name: "incomingConversationLinks", type: "ConversationLink", isMany: !0, isVirtual: !0, isReference: !0 }, { name: "outgoingConversationLinks", type: "ConversationLink", isMany: !0, isVirtual: !0, isReference: !0 }] }, { name: "Participant", superClass: ["InteractionNode", "BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "interfaceRef", type: "Interface", isMany: !0, isReference: !0 }, { name: "participantMultiplicity", type: "ParticipantMultiplicity" }, { name: "endPointRefs", type: "EndPoint", isMany: !0, isReference: !0 }, { name: "processRef", type: "Process", isAttr: !0, isReference: !0 }] }, { name: "ParticipantAssociation", superClass: ["BaseElement"], properties: [{ name: "innerParticipantRef", type: "Participant", isAttr: !0, isReference: !0 }, { name: "outerParticipantRef", type: "Participant", isAttr: !0, isReference: !0 }] }, { name: "ParticipantMultiplicity", properties: [{ name: "minimum", default: 0, isAttr: !0, type: "Integer" }, { name: "maximum", default: 1, isAttr: !0, type: "Integer" }], superClass: ["BaseElement"] }, { name: "Collaboration", superClass: ["RootElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "isClosed", isAttr: !0, type: "Boolean" }, { name: "participants", type: "Participant", isMany: !0 }, { name: "messageFlows", type: "MessageFlow", isMany: !0 }, { name: "artifacts", type: "Artifact", isMany: !0 }, { name: "conversations", type: "ConversationNode", isMany: !0 }, { name: "conversationAssociations", type: "ConversationAssociation" }, { name: "participantAssociations", type: "ParticipantAssociation", isMany: !0 }, { name: "messageFlowAssociations", type: "MessageFlowAssociation", isMany: !0 }, { name: "correlationKeys", type: "CorrelationKey", isMany: !0 }, { name: "choreographyRef", type: "Choreography", isMany: !0, isReference: !0 }, { name: "conversationLinks", type: "ConversationLink", isMany: !0 }] }, { name: "ChoreographyActivity", isAbstract: !0, superClass: ["FlowNode"], properties: [{ name: "participantRef", type: "Participant", isMany: !0, isReference: !0 }, { name: "initiatingParticipantRef", type: "Participant", isAttr: !0, isReference: !0 }, { name: "correlationKeys", type: "CorrelationKey", isMany: !0 }, { name: "loopType", type: "ChoreographyLoopType", default: "None", isAttr: !0 }] }, { name: "CallChoreography", superClass: ["ChoreographyActivity"], properties: [{ name: "calledChoreographyRef", type: "Choreography", isAttr: !0, isReference: !0 }, { name: "participantAssociations", type: "ParticipantAssociation", isMany: !0 }] }, { name: "SubChoreography", superClass: ["ChoreographyActivity", "FlowElementsContainer"], properties: [{ name: "artifacts", type: "Artifact", isMany: !0 }] }, { name: "ChoreographyTask", superClass: ["ChoreographyActivity"], properties: [{ name: "messageFlowRef", type: "MessageFlow", isMany: !0, isReference: !0 }] }, { name: "Choreography", superClass: ["Collaboration", "FlowElementsContainer"] }, { name: "GlobalChoreographyTask", superClass: ["Choreography"], properties: [{ name: "initiatingParticipantRef", type: "Participant", isAttr: !0, isReference: !0 }] }, { name: "TextAnnotation", superClass: ["Artifact"], properties: [{ name: "text", type: "String" }, { name: "textFormat", default: "text/plain", isAttr: !0, type: "String" }] }, { name: "Group", superClass: ["Artifact"], properties: [{ name: "categoryValueRef", type: "CategoryValue", isAttr: !0, isReference: !0 }] }, { name: "Association", superClass: ["Artifact"], properties: [{ name: "associationDirection", type: "AssociationDirection", isAttr: !0 }, { name: "sourceRef", type: "BaseElement", isAttr: !0, isReference: !0 }, { name: "targetRef", type: "BaseElement", isAttr: !0, isReference: !0 }] }, { name: "Category", superClass: ["RootElement"], properties: [{ name: "categoryValue", type: "CategoryValue", isMany: !0 }, { name: "name", isAttr: !0, type: "String" }] }, { name: "Artifact", isAbstract: !0, superClass: ["BaseElement"] }, { name: "CategoryValue", superClass: ["BaseElement"], properties: [{ name: "categorizedFlowElements", type: "FlowElement", isMany: !0, isVirtual: !0, isReference: !0 }, { name: "value", isAttr: !0, type: "String" }] }, { name: "Activity", isAbstract: !0, superClass: ["FlowNode"], properties: [{ name: "isForCompensation", default: !1, isAttr: !0, type: "Boolean" }, { name: "default", type: "SequenceFlow", isAttr: !0, isReference: !0 }, { name: "ioSpecification", type: "InputOutputSpecification", xml: { serialize: "property" } }, { name: "boundaryEventRefs", type: "BoundaryEvent", isMany: !0, isReference: !0 }, { name: "properties", type: "Property", isMany: !0 }, { name: "dataInputAssociations", type: "DataInputAssociation", isMany: !0 }, { name: "dataOutputAssociations", type: "DataOutputAssociation", isMany: !0 }, { name: "startQuantity", default: 1, isAttr: !0, type: "Integer" }, { name: "resources", type: "ResourceRole", isMany: !0 }, { name: "completionQuantity", default: 1, isAttr: !0, type: "Integer" }, { name: "loopCharacteristics", type: "LoopCharacteristics" }] }, { name: "ServiceTask", superClass: ["Task"], properties: [{ name: "implementation", isAttr: !0, type: "String" }, { name: "operationRef", type: "Operation", isAttr: !0, isReference: !0 }] }, { name: "SubProcess", superClass: ["Activity", "FlowElementsContainer", "InteractionNode"], properties: [{ name: "triggeredByEvent", default: !1, isAttr: !0, type: "Boolean" }, { name: "artifacts", type: "Artifact", isMany: !0 }] }, { name: "LoopCharacteristics", isAbstract: !0, superClass: ["BaseElement"] }, { name: "MultiInstanceLoopCharacteristics", superClass: ["LoopCharacteristics"], properties: [{ name: "isSequential", default: !1, isAttr: !0, type: "Boolean" }, { name: "behavior", type: "MultiInstanceBehavior", default: "All", isAttr: !0 }, { name: "loopCardinality", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "loopDataInputRef", type: "ItemAwareElement", isReference: !0 }, { name: "loopDataOutputRef", type: "ItemAwareElement", isReference: !0 }, { name: "inputDataItem", type: "DataInput", xml: { serialize: "property" } }, { name: "outputDataItem", type: "DataOutput", xml: { serialize: "property" } }, { name: "complexBehaviorDefinition", type: "ComplexBehaviorDefinition", isMany: !0 }, { name: "completionCondition", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "oneBehaviorEventRef", type: "EventDefinition", isAttr: !0, isReference: !0 }, { name: "noneBehaviorEventRef", type: "EventDefinition", isAttr: !0, isReference: !0 }] }, { name: "StandardLoopCharacteristics", superClass: ["LoopCharacteristics"], properties: [{ name: "testBefore", default: !1, isAttr: !0, type: "Boolean" }, { name: "loopCondition", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "loopMaximum", type: "Integer", isAttr: !0 }] }, { name: "CallActivity", superClass: ["Activity", "InteractionNode"], properties: [{ name: "calledElement", type: "String", isAttr: !0 }] }, { name: "Task", superClass: ["Activity", "InteractionNode"] }, { name: "SendTask", superClass: ["Task"], properties: [{ name: "implementation", isAttr: !0, type: "String" }, { name: "operationRef", type: "Operation", isAttr: !0, isReference: !0 }, { name: "messageRef", type: "Message", isAttr: !0, isReference: !0 }] }, { name: "ReceiveTask", superClass: ["Task"], properties: [{ name: "implementation", isAttr: !0, type: "String" }, { name: "instantiate", default: !1, isAttr: !0, type: "Boolean" }, { name: "operationRef", type: "Operation", isAttr: !0, isReference: !0 }, { name: "messageRef", type: "Message", isAttr: !0, isReference: !0 }] }, { name: "ScriptTask", superClass: ["Task"], properties: [{ name: "scriptFormat", isAttr: !0, type: "String" }, { name: "script", type: "String" }] }, { name: "BusinessRuleTask", superClass: ["Task"], properties: [{ name: "implementation", isAttr: !0, type: "String" }] }, { name: "AdHocSubProcess", superClass: ["SubProcess"], properties: [{ name: "completionCondition", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "ordering", type: "AdHocOrdering", isAttr: !0 }, { name: "cancelRemainingInstances", default: !0, isAttr: !0, type: "Boolean" }] }, { name: "Transaction", superClass: ["SubProcess"], properties: [{ name: "protocol", isAttr: !0, type: "String" }, { name: "method", isAttr: !0, type: "String" }] }, { name: "GlobalScriptTask", superClass: ["GlobalTask"], properties: [{ name: "scriptLanguage", isAttr: !0, type: "String" }, { name: "script", isAttr: !0, type: "String" }] }, { name: "GlobalBusinessRuleTask", superClass: ["GlobalTask"], properties: [{ name: "implementation", isAttr: !0, type: "String" }] }, { name: "ComplexBehaviorDefinition", superClass: ["BaseElement"], properties: [{ name: "condition", type: "FormalExpression" }, { name: "event", type: "ImplicitThrowEvent" }] }, { name: "ResourceRole", superClass: ["BaseElement"], properties: [{ name: "resourceRef", type: "Resource", isReference: !0 }, { name: "resourceParameterBindings", type: "ResourceParameterBinding", isMany: !0 }, { name: "resourceAssignmentExpression", type: "ResourceAssignmentExpression" }, { name: "name", isAttr: !0, type: "String" }] }, { name: "ResourceParameterBinding", properties: [{ name: "expression", type: "Expression", xml: { serialize: "xsi:type" } }, { name: "parameterRef", type: "ResourceParameter", isAttr: !0, isReference: !0 }], superClass: ["BaseElement"] }, { name: "ResourceAssignmentExpression", properties: [{ name: "expression", type: "Expression", xml: { serialize: "xsi:type" } }], superClass: ["BaseElement"] }, { name: "Import", properties: [{ name: "importType", isAttr: !0, type: "String" }, { name: "location", isAttr: !0, type: "String" }, { name: "namespace", isAttr: !0, type: "String" }] }, { name: "Definitions", superClass: ["BaseElement"], properties: [{ name: "name", isAttr: !0, type: "String" }, { name: "targetNamespace", isAttr: !0, type: "String" }, { name: "expressionLanguage", default: "http://www.w3.org/1999/XPath", isAttr: !0, type: "String" }, { name: "typeLanguage", default: "http://www.w3.org/2001/XMLSchema", isAttr: !0, type: "String" }, { name: "imports", type: "Import", isMany: !0 }, { name: "extensions", type: "Extension", isMany: !0 }, { name: "rootElements", type: "RootElement", isMany: !0 }, { name: "diagrams", isMany: !0, type: "bpmndi:BPMNDiagram" }, { name: "exporter", isAttr: !0, type: "String" }, { name: "relationships", type: "Relationship", isMany: !0 }, { name: "exporterVersion", isAttr: !0, type: "String" }] }], enumerations: [{ name: "ProcessType", literalValues: [{ name: "None" }, { name: "Public" }, { name: "Private" }] }, { name: "GatewayDirection", literalValues: [{ name: "Unspecified" }, { name: "Converging" }, { name: "Diverging" }, { name: "Mixed" }] }, { name: "EventBasedGatewayType", literalValues: [{ name: "Parallel" }, { name: "Exclusive" }] }, { name: "RelationshipDirection", literalValues: [{ name: "None" }, { name: "Forward" }, { name: "Backward" }, { name: "Both" }] }, { name: "ItemKind", literalValues: [{ name: "Physical" }, { name: "Information" }] }, { name: "ChoreographyLoopType", literalValues: [{ name: "None" }, { name: "Standard" }, { name: "MultiInstanceSequential" }, { name: "MultiInstanceParallel" }] }, { name: "AssociationDirection", literalValues: [{ name: "None" }, { name: "One" }, { name: "Both" }] }, { name: "MultiInstanceBehavior", literalValues: [{ name: "None" }, { name: "One" }, { name: "All" }, { name: "Complex" }] }, { name: "AdHocOrdering", literalValues: [{ name: "Parallel" }, { name: "Sequential" }] }], xml: { tagAlias: "lowerCase", typePrefix: "t" } }, bpmndi: { name: "BPMNDI", uri: "http://www.omg.org/spec/BPMN/20100524/DI", prefix: "bpmndi", types: [{ name: "BPMNDiagram", properties: [{ name: "plane", type: "BPMNPlane", redefines: "di:Diagram#rootElement" }, { name: "labelStyle", type: "BPMNLabelStyle", isMany: !0 }], superClass: ["di:Diagram"] }, { name: "BPMNPlane", properties: [{ name: "bpmnElement", isAttr: !0, isReference: !0, type: "bpmn:BaseElement", redefines: "di:DiagramElement#modelElement" }], superClass: ["di:Plane"] }, { name: "BPMNShape", properties: [{ name: "bpmnElement", isAttr: !0, isReference: !0, type: "bpmn:BaseElement", redefines: "di:DiagramElement#modelElement" }, { name: "isHorizontal", isAttr: !0, type: "Boolean" }, { name: "isExpanded", isAttr: !0, type: "Boolean" }, { name: "isMarkerVisible", isAttr: !0, type: "Boolean" }, { name: "label", type: "BPMNLabel" }, { name: "isMessageVisible", isAttr: !0, type: "Boolean" }, { name: "participantBandKind", type: "ParticipantBandKind", isAttr: !0 }, { name: "choreographyActivityShape", type: "BPMNShape", isAttr: !0, isReference: !0 }], superClass: ["di:LabeledShape"] }, { name: "BPMNEdge", properties: [{ name: "label", type: "BPMNLabel" }, { name: "bpmnElement", isAttr: !0, isReference: !0, type: "bpmn:BaseElement", redefines: "di:DiagramElement#modelElement" }, { name: "sourceElement", isAttr: !0, isReference: !0, type: "di:DiagramElement", redefines: "di:Edge#source" }, { name: "targetElement", isAttr: !0, isReference: !0, type: "di:DiagramElement", redefines: "di:Edge#target" }, { name: "messageVisibleKind", type: "MessageVisibleKind", isAttr: !0, default: "initiating" }], superClass: ["di:LabeledEdge"] }, { name: "BPMNLabel", properties: [{ name: "labelStyle", type: "BPMNLabelStyle", isAttr: !0, isReference: !0, redefines: "di:DiagramElement#style" }], superClass: ["di:Label"] }, { name: "BPMNLabelStyle", properties: [{ name: "font", type: "dc:Font" }], superClass: ["di:Style"] }], enumerations: [{ name: "ParticipantBandKind", literalValues: [{ name: "top_initiating" }, { name: "middle_initiating" }, { name: "bottom_initiating" }, { name: "top_non_initiating" }, { name: "middle_non_initiating" }, { name: "bottom_non_initiating" }] }, { name: "MessageVisibleKind", literalValues: [{ name: "initiating" }, { name: "non_initiating" }] }], associations: [] }, dc: { name: "DC", uri: "http://www.omg.org/spec/DD/20100524/DC", prefix: "dc", types: [{ name: "Boolean" }, { name: "Integer" }, { name: "Real" }, { name: "String" }, { name: "Font", properties: [{ name: "name", type: "String", isAttr: !0 }, { name: "size", type: "Real", isAttr: !0 }, { name: "isBold", type: "Boolean", isAttr: !0 }, { name: "isItalic", type: "Boolean", isAttr: !0 }, { name: "isUnderline", type: "Boolean", isAttr: !0 }, { name: "isStrikeThrough", type: "Boolean", isAttr: !0 }] }, { name: "Point", properties: [{ name: "x", type: "Real", default: "0", isAttr: !0 }, { name: "y", type: "Real", default: "0", isAttr: !0 }] }, { name: "Bounds", properties: [{ name: "x", type: "Real", default: "0", isAttr: !0 }, { name: "y", type: "Real", default: "0", isAttr: !0 }, { name: "width", type: "Real", isAttr: !0 }, { name: "height", type: "Real", isAttr: !0 }] }], associations: [] }, di: { name: "DI", uri: "http://www.omg.org/spec/DD/20100524/DI", prefix: "di", types: [{ name: "DiagramElement", isAbstract: !0, properties: [{ name: "id", isAttr: !0, isId: !0, type: "String" }, { name: "extension", type: "Extension" }, { name: "owningDiagram", type: "Diagram", isReadOnly: !0, isVirtual: !0, isReference: !0 }, { name: "owningElement", type: "DiagramElement", isReadOnly: !0, isVirtual: !0, isReference: !0 }, { name: "modelElement", isReadOnly: !0, isVirtual: !0, isReference: !0, type: "Element" }, { name: "style", type: "Style", isReadOnly: !0, isVirtual: !0, isReference: !0 }, { name: "ownedElement", type: "DiagramElement", isReadOnly: !0, isMany: !0, isVirtual: !0 }] }, { name: "Node", isAbstract: !0, superClass: ["DiagramElement"] }, { name: "Edge", isAbstract: !0, superClass: ["DiagramElement"], properties: [{ name: "source", type: "DiagramElement", isReadOnly: !0, isVirtual: !0, isReference: !0 }, { name: "target", type: "DiagramElement", isReadOnly: !0, isVirtual: !0, isReference: !0 }, { name: "waypoint", isUnique: !1, isMany: !0, type: "dc:Point", xml: { serialize: "xsi:type" } }] }, { name: "Diagram", isAbstract: !0, properties: [{ name: "id", isAttr: !0, isId: !0, type: "String" }, { name: "rootElement", type: "DiagramElement", isReadOnly: !0, isVirtual: !0 }, { name: "name", isAttr: !0, type: "String" }, { name: "documentation", isAttr: !0, type: "String" }, { name: "resolution", isAttr: !0, type: "Real" }, { name: "ownedStyle", type: "Style", isReadOnly: !0, isMany: !0, isVirtual: !0 }] }, { name: "Shape", isAbstract: !0, superClass: ["Node"], properties: [{ name: "bounds", type: "dc:Bounds" }] }, { name: "Plane", isAbstract: !0, superClass: ["Node"], properties: [{ name: "planeElement", type: "DiagramElement", subsettedProperty: "DiagramElement-ownedElement", isMany: !0 }] }, { name: "LabeledEdge", isAbstract: !0, superClass: ["Edge"], properties: [{ name: "ownedLabel", type: "Label", isReadOnly: !0, subsettedProperty: "DiagramElement-ownedElement", isMany: !0, isVirtual: !0 }] }, { name: "LabeledShape", isAbstract: !0, superClass: ["Shape"], properties: [{ name: "ownedLabel", type: "Label", isReadOnly: !0, subsettedProperty: "DiagramElement-ownedElement", isMany: !0, isVirtual: !0 }] }, { name: "Label", isAbstract: !0, superClass: ["Node"], properties: [{ name: "bounds", type: "dc:Bounds" }] }, { name: "Style", isAbstract: !0, properties: [{ name: "id", isAttr: !0, isId: !0, type: "String" }] }, { name: "Extension", properties: [{ name: "values", isMany: !0, type: "Element" }] }], associations: [], xml: { tagAlias: "lowerCase" } }, bioc: { name: "bpmn.io colors for BPMN", uri: "http://bpmn.io/schema/bpmn/biocolor/1.0", prefix: "bioc", types: [{ name: "ColoredShape", extends: ["bpmndi:BPMNShape"], properties: [{ name: "stroke", isAttr: !0, type: "String" }, { name: "fill", isAttr: !0, type: "String" }] }, { name: "ColoredEdge", extends: ["bpmndi:BPMNEdge"], properties: [{ name: "stroke", isAttr: !0, type: "String" }, { name: "fill", isAttr: !0, type: "String" }] }], enumerations: [], associations: [] }, color: { name: "BPMN in Color", uri: "http://www.omg.org/spec/BPMN/non-normative/color/1.0", prefix: "color", types: [{ name: "ColoredLabel", extends: ["bpmndi:BPMNLabel"], properties: [{ name: "color", isAttr: !0, type: "String" }] }, { name: "ColoredShape", extends: ["bpmndi:BPMNShape"], properties: [{ name: "background-color", isAttr: !0, type: "String" }, { name: "border-color", isAttr: !0, type: "String" }] }, { name: "ColoredEdge", extends: ["bpmndi:BPMNEdge"], properties: [{ name: "border-color", isAttr: !0, type: "String" }] }], enumerations: [], associations: [] } }; function yr(e, t) { return new mr(L({}, vr, e), t) } function gr(e) { return e ? "<" + e.$type + (e.id ? ' id="' + e.id : "") + '" />' : "<null>" } var _r = "Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472"; function br(e) { f(e, "di") || Object.defineProperty(e, "di", { enumerable: !1, get: function () { throw new Error(_r) } }) } function xr(e, t) { return e.$instanceOf(t) } function wr(e, t) { var n = {}, i = [], r = {}; function o(e, t) { return function (n) { e(n, t) } } function a(e) { n[e.id] = e } function s(n, i) { try { var o = r[n.id] && function (n, i) { if (n.gfx) throw new Error(t("already rendered {element}", { element: gr(n) })); return e.element(n, r[n.id], i) }(n, i); return a(n), o } catch (e) { c(e.message, { element: n, error: e }), console.error(t("failed to import {element}", { element: gr(n) })), console.error(e) } } function c(t, n) { e.error(t, n) } var p = this.registerDi = function (e) { var n = e.bpmnElement; n ? r[n.id] ? c(t("multiple DI elements defined for {element}", { element: gr(n) }), { element: n }) : (r[n.id] = e, br(n)) : c(t("no bpmnElement referenced in {element}", { element: gr(e) }), { element: e }) }; function l(e) { var t; t = e.plane, p(t), g(t.planeElement, u) } function u(e) { p(e) } this.handleDefinitions = function (a, s) { var u = a.diagrams; if (s && -1 === u.indexOf(s)) throw new Error(t("diagram not part of bpmn:Definitions")); if (!s && u && u.length && (s = u[0]), !s) throw new Error(t("no diagram to display")); r = {}, l(s); var v = s.plane; if (!v) throw new Error(t("no plane for {element}", { element: gr(s) })); var _ = v.bpmnElement; if (!_) { if (_ = function (e) { return m(e.rootElements, (function (e) { return xr(e, "bpmn:Process") || xr(e, "bpmn:Collaboration") })) }(a), !_) throw new Error(t("no process or collaboration to display")); c(t("correcting missing bpmnElement on {plane} to {rootElement}", { plane: gr(v), rootElement: gr(_) })), v.bpmnElement = _, p(v) } var b, x, E = function (t, n) { return e.root(t, r[t.id], n) }(_, v); if (xr(_, "bpmn:Process") || xr(_, "bpmn:SubProcess")) d(_, E); else { if (!xr(_, "bpmn:Collaboration")) throw new Error(t("unsupported bpmnElement for {plane}: {rootElement}", { plane: gr(v), rootElement: gr(_) })); x = E, g((b = _).participants, o(A, x)), w(b.artifacts, x), i.push((function () { !function (e, t) { g(e, o(f, t)) }(b.messageFlows, x) })), function (e, t) { var i = y(e, (function (e) { return !n[e.id] && xr(e, "bpmn:Process") && e.laneSets })); i.forEach(o(d, t)) }(a.rootElements, E) } h(i) }; var h = this.handleDeferred = function () { for (; i.length;)i.shift()() }; function d(e, t) { T(e, t), E(e.ioSpecification, t), w(e.artifacts, t), a(e) } function f(e, t) { s(e, t) } function v(e, t) { s(e, t) } function _(e, t) { s(e, t) } function b(e, t) { s(e, t) } function x(e, t) { s(e, t) } function w(e, t) { g(e, (function (e) { xr(e, "bpmn:Association") ? i.push((function () { x(e, t) })) : x(e, t) })) } function E(e, t) { e && (g(e.dataInputs, o(_, t)), g(e.dataOutputs, o(b, t))) } var S = this.handleSubProcess = function (e, t) { T(e, t), w(e.artifacts, t) }; function C(e, t) { var n = s(e, t); xr(e, "bpmn:SubProcess") && S(e, n || t), xr(e, "bpmn:Activity") && E(e.ioSpecification, t), i.push((function () { g(e.dataInputAssociations, o(v, t)), g(e.dataOutputAssociations, o(v, t)) })) } function k(e, t) { s(e, t) } function R(e, t) { i.push((function () { var n = s(e, t); e.childLaneSet && P(e.childLaneSet, n || t), function (e) { g(e.flowNodeRef, (function (t) { var n = t.get("lanes"); n && n.push(e) })) }(e) })) } function P(e, t) { g(e.lanes, o(R, t)) } function T(e, n) { !function (e, n) { g(e, (function (e) { xr(e, "bpmn:SequenceFlow") ? i.push((function () { !function (e, t) { s(e, t) }(e, n) })) : xr(e, "bpmn:BoundaryEvent") ? i.unshift((function () { C(e, n) })) : xr(e, "bpmn:FlowNode") ? C(e, n) : xr(e, "bpmn:DataObject") || (xr(e, "bpmn:DataStoreReference") || xr(e, "bpmn:DataObjectReference") ? k(e, n) : c(t("unrecognized flowElement {element} in context {context}", { element: gr(e), context: n ? gr(n.businessObject) : "null" }), { element: e, context: n })) })) }(e.flowElements, n), e.laneSets && function (e, t) { g(e, o(P, t)) }(e.laneSets, n) } function A(e, t) { var n = s(e, t), i = e.processRef; i && d(i, n || t) } } function Er(e, t) { var n = Cr(e); return n && "function" == typeof n.$instanceOf && n.$instanceOf(t) } function Sr(e, t) { return w(t, (function (t) { return Er(e, t) })) } function Cr(e) { return e && e.businessObject || e } function kr(e) { return e && e.di } function Rr(e, t, n) {
        var i, r, o, a, s = []; function c(e, t) {
            var n = new wr({ root: function (e, t) { return i.add(e, t) }, element: function (e, t, n) { return i.add(e, t, n) }, error: function (e, t) { s.push({ message: e, context: t }) } }, o); t = t || e.diagrams && e.diagrams[0]; var r = function (e, t) {
                if (!t) return; var n, i = t.plane.bpmnElement, r = i; Er(i, "bpmn:Process") || Er(i, "bpmn:Collaboration") || (r = function (e) { var t = e; for (; t;) { if (Er(t, "bpmn:Process")) return t; t = t.$parent } }
/**
   * This file must not be changed or exchanged.
   *
   * @see http://bpmn.io/license for more information.
   */(i)); n = Er(r, "bpmn:Collaboration") ? r : m(e.rootElements, (function (e) { if (Er(e, "bpmn:Collaboration")) return m(e.participants, (function (e) { return e.processRef === r })) })); var o = [r]; n && (o = E(n.participants, (function (e) { return e.processRef }))).push(n); var a = Pr(o), s = [t], c = [i]; return g(e.diagrams, (function (e) { var t = e.plane.bpmnElement; -1 !== a.indexOf(t) && -1 === c.indexOf(t) && (s.push(e), c.push(t)) })), s
            }(e, t); if (!r) throw new Error(o("no diagram to display")); g(r, (function (t) { n.handleDefinitions(e, t) })); var c = t.plane.bpmnElement.id; a.setRootElement(a.findRoot(c + "_plane") || a.findRoot(c))
        } return new Promise((function (p, l) { try { return i = e.get("bpmnImporter"), r = e.get("eventBus"), o = e.get("translate"), a = e.get("canvas"), r.fire("import.render.start", { definitions: t }), c(t, n), r.fire("import.render.complete", { error: undefined, warnings: s }), p({ warnings: s }) } catch (e) { return e.warnings = s, l(e) } }))
    } function Pr(e) { var t = []; return g(e, (function (e) { e && (t.push(e), t = t.concat(Pr(e.flowElements))) })), t } var Tr, Ar = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14.02 5.57" width="53" height="21"><path fill="currentColor" d="M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z"/><path fill="currentColor" d="M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z"/></svg>', Mr = { verticalAlign: "middle" }, Dr = { color: "#404040" }, Br = { zIndex: "1001", position: "fixed", top: "0", left: "0", right: "0", bottom: "0" }, Nr = { width: "100%", height: "100%", background: "rgba(40,40,40,0.2)" }, Or = { position: "absolute", left: "50%", top: "40%", transform: "translate(-50%)", width: "260px", padding: "10px", background: "white", boxShadow: "0 1px 4px rgba(0,0,0,0.3)", fontFamily: "Helvetica, Arial, sans-serif", fontSize: "14px", display: "flex", lineHeight: "1.3" }, jr = '<div class="bjs-powered-by-lightbox"><div class="backdrop"></div><div class="notice"><a href="https://bpmn.io" target="_blank" rel="noopener" class="link">' + Ar + '</a><span>Web-based tooling for BPMN, DMN and forms powered by <a href="https://bpmn.io" target="_blank" rel="noopener">bpmn.io</a>.</span></div></div>'; function Lr() { Tr || (q(Tr = de(jr), Br), q(fe("svg", Tr), Mr), q(fe(".backdrop", Tr), Nr), q(fe(".notice", Tr), Or), q(fe(".link", Tr), Dr, { margin: "15px 20px 15px 10px", alignSelf: "center" }), pe.bind(Tr, ".backdrop", "click", (function (e) { document.body.removeChild(Tr) }))), document.body.appendChild(Tr) }
/**
   * The code in the <project-logo></project-logo> area
   * must not be changed.
   *
   * @see http://bpmn.io/license for more information.
   */function Ir(e) {
        e = L({}, Fr, e), this._moddle = this._createModdle(e), this._container = this._createContainer(e),
        /**
           * Adds the project logo to the diagram container as
           * required by the bpmn.io license.
           *
           * @see http://bpmn.io/license
           *
           * @param {Element} container
           */
        function (e) { const t = de('<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" >' + Ar + "</a>"); q(fe("svg", t), Mr), q(t, Dr, { position: "absolute", bottom: "15px", right: "15px", zIndex: "100" }), e.appendChild(t), ae.bind(t, "click", (function (e) { Lr(), e.preventDefault() })) }(this._container), this._init(this._container, this._moddle, e)
    } function $r(e, t) { return e.warnings = t, e } e(Ir, ti), Ir.prototype.importXML = async function (e, t) { const n = this; let i = []; try { let o; e = this._emit("import.parse.start", { xml: e }) || e; try { o = await this._moddle.fromXML(e, "bpmn:Definitions") } catch (e) { throw this._emit("import.parse.complete", { error: e }), e } let a = o.rootElement; const s = o.references, c = o.warnings, p = o.elementsById; i = i.concat(c), a = this._emit("import.parse.complete", (r = { error: null, definitions: a, elementsById: p, references: s, warnings: i }, n.get("eventBus").createEvent(r))) || a; const l = await this.importDefinitions(a, t); return i = i.concat(l.warnings), this._emit("import.done", { error: null, warnings: i }), { warnings: i } } catch (e) { let t = e; throw i = i.concat(t.warnings || []), $r(t, i), t = function (e) { const t = /unparsable content <([^>]+)> detected([\s\S]*)$/.exec(e.message); t && (e.message = "unparsable content <" + t[1] + "> detected; this may indicate an invalid BPMN 2.0 diagram file" + t[2]); return e }(t), this._emit("import.done", { error: t, warnings: t.warnings }), t } var r }, Ir.prototype.importDefinitions = async function (e, t) { this._setDefinitions(e); return { warnings: (await this.open(t)).warnings } }, Ir.prototype.open = async function (e) { const t = this._definitions; let n = e; if (!t) { const e = new Error("no XML imported"); throw $r(e, []), e } if ("string" == typeof e && (n = function (e, t) { if (!t) return null; return m(e.diagrams, (function (e) { return e.id === t })) || null }(t, e), !n)) { const t = new Error("BPMNDiagram <" + e + "> not found"); throw $r(t, []), t } try { this.clear() } catch (e) { throw $r(e, []), e } const { warnings: i } = await Rr(this, t, n); return { warnings: i } }, Ir.prototype.saveXML = async function (e) { e = e || {}; let t, n, i = this._definitions; try { if (!i) throw new Error("no definitions loaded"); i = this._emit("saveXML.start", { definitions: i }) || i; n = (await this._moddle.toXML(i, e)).xml, n = this._emit("saveXML.serialized", { xml: n }) || n } catch (e) { t = e } const r = t ? { error: t } : { xml: n }; if (this._emit("saveXML.done", r), t) throw t; return r }, Ir.prototype.saveSVG = async function () { let e, t; this._emit("saveSVG.start"); try { const t = this.get("canvas"), n = t.getActiveLayer(), i = fe("defs", t._svg), r = Ve(n), o = i ? "<defs>" + Ve(i) + "</defs>" : "", a = n.getBBox(); e = '<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- created with bpmn-js / http://bpmn.io --\x3e\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="' + a.width + '" height="' + a.height + '" viewBox="' + a.x + " " + a.y + " " + a.width + " " + a.height + '" version="1.1">' + o + r + "</svg>" } catch (e) { t = e } if (this._emit("saveSVG.done", { error: t, svg: e }), t) throw t; return { svg: e } }, Ir.prototype._setDefinitions = function (e) { this._definitions = e }, Ir.prototype.getModules = function () { return this._modules }, Ir.prototype.clear = function () { this.getDefinitions() && ti.prototype.clear.call(this) }, Ir.prototype.destroy = function () { ti.prototype.destroy.call(this), ve(this._container) }, Ir.prototype.on = function (e, t, n, i) { return this.get("eventBus").on(e, t, n, i) }, Ir.prototype.off = function (e, t) { this.get("eventBus").off(e, t) }, Ir.prototype.attachTo = function (e) { if (!e) throw new Error("parentNode required"); this.detach(), e.get && e.constructor.prototype.jquery && (e = e.get(0)), "string" == typeof e && (e = fe(e)), e.appendChild(this._container), this._emit("attach", {}), this.get("canvas").resized() }, Ir.prototype.getDefinitions = function () { return this._definitions }, Ir.prototype.detach = function () { const e = this._container, t = e.parentNode; t && (this._emit("detach", {}), t.removeChild(e)) }, Ir.prototype._init = function (e, t, n) { const i = n.modules || this.getModules(n), r = n.additionalModules || [], o = [].concat([{ bpmnjs: ["value", this], moddle: ["value", t] }], i, r), a = L($(n, ["additionalModules"]), { canvas: L({}, n.canvas, { container: e }), modules: o }); ti.call(this, a), n && n.container && this.attachTo(n.container) }, Ir.prototype._emit = function (e, t) { return this.get("eventBus").fire(e, t) }, Ir.prototype._createContainer = function (e) { const t = de('<div class="bjs-container"></div>'); return q(t, { width: zr(e.width), height: zr(e.height), position: e.position }), t }, Ir.prototype._createModdle = function (e) { return new yr(L({}, this._moddleExtensions, e.moddleExtensions)) }, Ir.prototype._modules = []; const Fr = { width: "100%", height: "100%", position: "relative" }; function zr(e) { return e + (u(e) ? "px" : "") } function Hr(e) { Ir.call(this, e), this.on("import.parse.complete", (function (e) { e.error || this._collectIds(e.definitions, e.elementsById) }), this), this.on("diagram.destroy", (function () { this.get("moddle").ids.clear() }), this) } function Vr(e, t) { return !Er(e, "bpmn:CallActivity") && (Er(e, "bpmn:SubProcess") ? !(!(t = t || kr(e)) || !Er(t, "bpmndi:BPMNPlane")) || t && !!t.isExpanded : !Er(e, "bpmn:Participant") || !!Cr(e).processRef) } function Wr(e) { if (Er(e, "bpmn:Participant") || Er(e, "bpmn:Lane")) { var t = kr(e).isHorizontal; return void 0 === t || t } } function Gr(e) { return e && !!Cr(e).triggeredByEvent } function Ur(e, t) { return w(Cr(e).eventDefinitions, (function (e) { return Er(e, t) })) } e(Hr, Ir), Hr.prototype._createModdle = function (e) { var t = Ir.prototype._createModdle.call(this, e); return t.ids = new n([32, 36, 1]), t }, Hr.prototype._collectIds = function (e, t) { var n, i = e.$model.ids; for (n in i.clear(), t) i.claim(n, t[n]) }; var qr = { width: 90, height: 20 }, Kr = 15; function Yr(e) { return Er(e, "bpmn:Event") || Er(e, "bpmn:Gateway") || Er(e, "bpmn:DataStoreReference") || Er(e, "bpmn:DataObjectReference") || Er(e, "bpmn:DataInput") || Er(e, "bpmn:DataOutput") || Er(e, "bpmn:SequenceFlow") || Er(e, "bpmn:MessageFlow") || Er(e, "bpmn:Group") } function Xr(e) { return hn(e.label) } function Zr(e) { var t = e.length / 2 - 1, n = e[Math.floor(t)], i = e[Math.ceil(t + .01)], r = function (e) { var t = e.length / 2 - 1, n = e[Math.floor(t)], i = e[Math.ceil(t + .01)]; return { x: n.x + (i.x - n.x) / 2, y: n.y + (i.y - n.y) / 2 } }(e), o = Math.atan((i.y - n.y) / (i.x - n.x)), a = r.x, s = r.y; return Math.abs(o) < Math.PI / 2 ? s -= Kr : a += Kr, { x: a, y: s } } function Qr(e) { return e.waypoints ? Zr(e.waypoints) : Er(e, "bpmn:Group") ? { x: e.x + e.width / 2, y: e.y + qr.height / 2 } : { x: e.x + e.width / 2, y: e.y + e.height + qr.height / 2 } } function Jr(e) { return Er(e, "bpmn:FlowElement") || Er(e, "bpmn:Participant") || Er(e, "bpmn:Lane") || Er(e, "bpmn:SequenceFlow") || Er(e, "bpmn:MessageFlow") || Er(e, "bpmn:DataInput") || Er(e, "bpmn:DataOutput") ? "name" : Er(e, "bpmn:TextAnnotation") ? "text" : Er(e, "bpmn:Group") ? "categoryValueRef" : void 0 } function eo(e) { var t = e.businessObject, n = Jr(t); if (n) return "categoryValueRef" === n ? function (e) { var t = e.categoryValueRef; return t && t.value || "" }(t) : t[n] || "" } var to = "hsl(225, 10%, 15%)", no = "white"; function io(e, t) { return w(e.eventDefinitions, (function (e) { return e.$type === t })) } function ro(e, t, n) { var i = kr(e); return n || i.get("color:background-color") || i.get("bioc:fill") || t || no } function oo(e, t, n) { var i = kr(e); return n || i.get("color:border-color") || i.get("bioc:stroke") || t || to } function ao(e, t, n, i) { var r = kr(e).get("label"); return i || r && r.get("color:color") || t || oo(e, n) } function so(e, t = {}) { return { width: co(e, t), height: po(e, t) } } function co(e, t = {}) { return f(t, "width") ? t.width : e.width } function po(e, t = {}) { return f(t, "height") ? t.height : e.height } var lo = new n, uo = .95; function ho(e, t, n, i, r, o, a) { it.call(this, t, a); var s = e && e.defaultFillColor, c = e && e.defaultStrokeColor, p = e && e.defaultLabelColor, u = lo.next(), h = {}; function d(e) { return n.computeStyle(e, { strokeLinecap: "round", strokeLinejoin: "round", stroke: to, strokeWidth: 2, fill: "white" }) } function f(e) { return n.computeStyle(e, ["no-fill"], { strokeLinecap: "round", strokeLinejoin: "round", stroke: to, strokeWidth: 2 }) } function m(e, t) { var { ref: n = { x: 0, y: 0 }, scale: i = 1, element: o } = t, a = De("marker", { id: e, viewBox: "0 0 20 20", refX: n.x, refY: n.y, markerWidth: 20 * i, markerHeight: 20 * i, orient: "auto" }); ge(a, o); var s = fe("defs", r._svg); s || (s = De("defs"), ge(r._svg, s)), ge(s, a), h[e] = a } function v(e) { return e.replace(/[^0-9a-zA-Z]+/g, "_") } function y(e, t, n) { var i = e + "-" + v(t) + "-" + v(n) + "-" + u; return h[i] || function (e, t, n, i) { if ("sequenceflow-end" === t) { m(e, { element: De("path", { d: "M 1 5 L 11 10 L 1 15 Z", ...d({ fill: i, stroke: i, strokeWidth: 1 }) }), ref: { x: 11, y: 10 }, scale: .5 }) } if ("messageflow-start" === t) { m(e, { element: De("circle", { cx: 6, cy: 6, r: 3.5, ...d({ fill: n, stroke: i, strokeWidth: 1, strokeDasharray: [1e4, 1] }) }), ref: { x: 6, y: 6 } }) } if ("messageflow-end" === t) { m(e, { element: De("path", { d: "m 1 5 l 0 -3 l 7 3 l -7 3 z", ...d({ fill: n, stroke: i, strokeWidth: 1, strokeDasharray: [1e4, 1] }) }), ref: { x: 8.5, y: 5 } }) } if ("association-start" === t) { m(e, { element: De("path", { d: "M 11 5 L 1 10 L 11 15", ...f({ fill: "none", stroke: i, strokeWidth: 1.5, strokeDasharray: [1e4, 1] }) }), ref: { x: 1, y: 10 }, scale: .5 }) } if ("association-end" === t) { m(e, { element: De("path", { d: "M 1 5 L 11 10 L 1 15", ...f({ fill: "none", stroke: i, strokeWidth: 1.5, strokeDasharray: [1e4, 1] }) }), ref: { x: 11, y: 10 }, scale: .5 }) } if ("conditional-flow-marker" === t) { m(e, { element: De("path", { d: "M 0 10 L 8 6 L 16 10 L 8 14 Z", ...d({ fill: n, stroke: i }) }), ref: { x: -1, y: 10 }, scale: .5 }) } if ("conditional-default-flow-marker" === t) { m(e, { element: De("path", { d: "M 6 4 L 10 16", ...d({ stroke: i }) }), ref: { x: 0, y: 10 }, scale: .5 }) } }(i, e, t, n), "url(#" + i + ")" } function _(e, t, n, i, r = {}) { l(i) && (r = i, i = 0), i = i || 0, r = d(r); var o = De("circle", { cx: t / 2, cy: n / 2, r: Math.round((t + n) / 4 - i), ...r }); return ge(e, o), o } function b(e, t, n, i, r, o) { l(r) && (o = r, r = 0), r = r || 0, o = d(o); var a = De("rect", { x: r, y: r, width: t - 2 * r, height: n - 2 * r, rx: i, ry: i, ...o }); return ge(e, a), a } function x(e, t, n, i) { var r = pt(t, n = f(n), i); return ge(e, r), r } function w(e, t, n) { return x(e, t, n, 5) } function E(e, t, n) { n = f(n); var i = De("path", { ...n, d: t }); return ge(e, i), i } function S(e, t, n, i) { return E(t, n, L({ "data-marker": e }, i)) } function C(e) { return te[e] } function k(e) { return function (t, n, i) { return C(e)(t, n, i) } } var R = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_MESSAGE", { xScaleFactor: .9, yScaleFactor: .9, containerWidth: t.width, containerHeight: t.height, position: { mx: .235, my: .315 } }), { fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), stroke: r ? ro(t, s, n.fill) : oo(t, c, n.stroke), strokeWidth: 1 }) }, P = function (e, t, n = {}) { var r = _(e, t.width, t.height, .2 * t.height, { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 2 }); E(e, i.getScaledPath("EVENT_TIMER_WH", { xScaleFactor: .75, yScaleFactor: .75, containerWidth: t.width, containerHeight: t.height, position: { mx: .5, my: .5 } }), { stroke: oo(t, c, n.stroke), strokeWidth: 2 }); for (var o = 0; o < 12; o++) { var a = i.getScaledPath("EVENT_TIMER_LINE", { xScaleFactor: .75, yScaleFactor: .75, containerWidth: t.width, containerHeight: t.height, position: { mx: .5, my: .5 } }), p = t.width / 2, l = t.height / 2; E(e, a, { strokeWidth: 1, stroke: oo(t, c, n.stroke), transform: "rotate(" + 30 * o + "," + l + "," + p + ")" }) } return r }, T = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_ESCALATION", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .5, my: .2 } }), { fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }) }, A = function (e, t, n = {}) { return E(e, i.getScaledPath("EVENT_CONDITIONAL", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .5, my: .222 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }) }, M = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_LINK", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .57, my: .263 } }), { fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }) }, D = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_ERROR", { xScaleFactor: 1.1, yScaleFactor: 1.1, containerWidth: t.width, containerHeight: t.height, position: { mx: .2, my: .722 } }), { fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }) }, B = function (e, t, n = {}, r) { var o = E(e, i.getScaledPath("EVENT_CANCEL_45", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .638, my: -.055 } }), { fill: r ? oo(t, c, n.stroke) : "none", stroke: oo(t, c, n.stroke), strokeWidth: 1 }); return Xn(o, 45), o }, N = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_COMPENSATION", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .22, my: .5 } }), { fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }) }, O = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_SIGNAL", { xScaleFactor: .9, yScaleFactor: .9, containerWidth: t.width, containerHeight: t.height, position: { mx: .5, my: .2 } }), { strokeWidth: 1, fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) }, j = function (e, t, n = {}, r) { return E(e, i.getScaledPath("EVENT_MULTIPLE", { xScaleFactor: 1.1, yScaleFactor: 1.1, containerWidth: t.width, containerHeight: t.height, position: { mx: .222, my: .36 } }), { fill: r ? oo(t, c, n.stroke) : ro(t, s, n.fill), strokeWidth: 1 }) }, I = function (e, t, n = {}) { return E(e, i.getScaledPath("EVENT_PARALLEL_MULTIPLE", { xScaleFactor: 1.2, yScaleFactor: 1.2, containerWidth: t.width, containerHeight: t.height, position: { mx: .458, my: .194 } }), { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: 1 }) }, $ = function (e, t, n = {}) { return _(e, t.width, t.height, 8, { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: 4 }) }; function F(e, t, n = {}) { var i = Cr(e), r = function (e) { return "bpmn:IntermediateThrowEvent" === e.$type || "bpmn:EndEvent" === e.$type }(i); return i.get("eventDefinitions") && i.get("eventDefinitions").length > 1 ? i.get("parallelMultiple") ? I(t, e, n, r) : j(t, e, n, r) : io(i, "bpmn:MessageEventDefinition") ? R(t, e, n, r) : io(i, "bpmn:TimerEventDefinition") ? P(t, e, n, r) : io(i, "bpmn:ConditionalEventDefinition") ? A(t, e, n, r) : io(i, "bpmn:SignalEventDefinition") ? O(t, e, n, r) : io(i, "bpmn:EscalationEventDefinition") ? T(t, e, n, r) : io(i, "bpmn:LinkEventDefinition") ? M(t, e, n, r) : io(i, "bpmn:ErrorEventDefinition") ? D(t, e, n, r) : io(i, "bpmn:CancelEventDefinition") ? B(t, e, n, r) : io(i, "bpmn:CompensateEventDefinition") ? N(t, e, n, r) : io(i, "bpmn:TerminateEventDefinition") ? $(t, e, n, r) : null } var z = { ParticipantMultiplicityMarker: function (e, t, n = {}) { var r = co(t, n), o = po(t, n); S("participant-multiplicity", e, i.getScaledPath("MARKER_PARALLEL", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: r, containerHeight: o, position: { mx: (r / 2 - 6) / r, my: (o - 15) / o } }), { strokeWidth: 2, fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) }, SubProcessMarker: function (e, t, n = {}) { Yn(b(e, 14, 14, 0, { strokeWidth: 1, fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }), t.width / 2 - 7.5, t.height - 20), S("sub-process", e, i.getScaledPath("MARKER_SUB_PROCESS", { xScaleFactor: 1.5, yScaleFactor: 1.5, containerWidth: t.width, containerHeight: t.height, position: { mx: (t.width / 2 - 7.5) / t.width, my: (t.height - 20) / t.height } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) }, ParallelMarker: function (e, t, n) { var r = co(t, n), o = po(t, n); S("parallel", e, i.getScaledPath("MARKER_PARALLEL", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: r, containerHeight: o, position: { mx: (r / 2 + n.parallel) / r, my: (o - 20) / o } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) }, SequentialMarker: function (e, t, n) { S("sequential", e, i.getScaledPath("MARKER_SEQUENTIAL", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: (t.width / 2 + n.seq) / t.width, my: (t.height - 19) / t.height } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) }, CompensationMarker: function (e, t, n) { S("compensation", e, i.getScaledPath("MARKER_COMPENSATION", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: (t.width / 2 + n.compensation) / t.width, my: (t.height - 13) / t.height } }), { strokeWidth: 1, fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) }, LoopMarker: function (e, t, n) { var r = co(t, n), o = po(t, n); S("loop", e, i.getScaledPath("MARKER_LOOP", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: r, containerHeight: o, position: { mx: (r / 2 + n.loop) / r, my: (o - 7) / o } }), { strokeWidth: 1.5, fill: "none", stroke: oo(t, c, n.stroke), strokeMiterlimit: .5 }) }, AdhocMarker: function (e, t, n) { var r = co(t, n), o = po(t, n); S("adhoc", e, i.getScaledPath("MARKER_ADHOC", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: r, containerHeight: o, position: { mx: (r / 2 + n.adhoc) / r, my: (o - 15) / o } }), { strokeWidth: 1, fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke) }) } }; function H(e, t, n, i) { z[e](t, n, i) } function V(e, t, n, i = {}) { i = { fill: i.fill, stroke: i.stroke, width: co(t, i), height: po(t, i) }; var r = Cr(t), o = n && n.includes("SubProcessMarker"); i = o ? { ...i, seq: -21, parallel: -22, compensation: -42, loop: -18, adhoc: 10 } : { ...i, seq: -5, parallel: -6, compensation: -27, loop: 0, adhoc: 10 }, g(n, (function (n) { H(n, e, t, i) })), r.get("isForCompensation") && H("CompensationMarker", e, t, i), Er(r, "bpmn:AdHocSubProcess") && H("AdhocMarker", e, t, i); var a = r.get("loopCharacteristics"), s = a && a.get("isSequential"); a && (void 0 === s && H("LoopMarker", e, t, i), !1 === s && H("ParallelMarker", e, t, i), !0 === s && H("SequentialMarker", e, t, i)) } function W(e, t, n = {}) { n = L({ size: { width: 100 } }, n); var i = o.createText(t || "", n); return Se(i).add("djs-label"), ge(e, i), i } function G(e, t, n, i = {}) { var r = Cr(t), o = so({ x: t.x, y: t.y, width: t.width, height: t.height }, i); return W(e, r.name, { align: n, box: o, padding: 7, style: { fill: ao(t, p, c, i.stroke) } }) } function U(e, t, n, i = {}) { var r = Wr(n), o = W(e, t, { box: { height: 30, width: r ? po(n, i) : co(n, i) }, align: "center-middle", style: { fill: ao(n, p, c, i.stroke) } }); r && Kn(o, 0, -(-1 * po(n, i)), 270) } function q(e, t, n = {}) { var { width: i, height: r } = so(t, n); return b(e, i, r, 10, { ...n, fill: ro(t, s, n.fill), fillOpacity: uo, stroke: oo(t, c, n.stroke) }) } function K(e, t, n = {}) { var i = Cr(t), r = ro(t, s, n.fill), o = oo(t, c, n.stroke); return "One" !== i.get("associationDirection") && "Both" !== i.get("associationDirection") || (n.markerEnd = y("association-end", r, o)), "Both" === i.get("associationDirection") && (n.markerStart = y("association-start", r, o)), n = fo(n, ["markerStart", "markerEnd"]), w(e, t.waypoints, { ...n, stroke: o, strokeDasharray: "0, 5" }) } function Y(e, t, n = {}) { var r = ro(t, s, n.fill), o = oo(t, c, n.stroke), a = E(e, i.getScaledPath("DATA_OBJECT_PATH", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .474, my: .296 } }), { fill: r, fillOpacity: uo, stroke: o }); (function (e) { var t = e.dataObjectRef; return e.isCollection || t && t.isCollection })(Cr(t)) && E(e, i.getScaledPath("DATA_OBJECT_COLLECTION_PATH", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: .33, my: (t.height - 18) / t.height } }), { strokeWidth: 2, fill: r, stroke: o }); return a } function X(e, t, n = {}) { return _(e, t.width, t.height, { fillOpacity: uo, ...n, fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }) } function Z(e, t, n = {}) { return function (e, t, n, i) { var r = t / 2, o = n / 2, a = [{ x: r, y: 0 }, { x: t, y: o }, { x: r, y: n }, { x: 0, y: o }].map((function (e) { return e.x + "," + e.y })).join(" "); i = d(i); var s = De("polygon", { ...i, points: a }); return ge(e, s), s }(e, t.width, t.height, { fill: ro(t, s, n.fill), fillOpacity: uo, stroke: oo(t, c, n.stroke) }) } function Q(e, t, n = {}) { var i = b(e, co(t, n), po(t, n), 0, { fill: ro(t, s, n.fill), fillOpacity: n.fillOpacity || uo, stroke: oo(t, c, n.stroke), strokeWidth: 1.5 }), r = Cr(t); Er(r, "bpmn:Lane") && U(e, r.get("name"), t, n); return i } function J(e, t, n = {}) { var i = q(e, t, n); Gr(t) && we(i, { strokeDasharray: "0, 5.5", strokeWidth: 2.5 }); var r = Vr(t); return G(e, t, r ? "center-top" : "center-middle", n), V(e, t, r ? void 0 : ["SubProcessMarker"], n), i } function ee(e, t, n = {}) { var i = q(e, t, n); return G(e, t, "center-middle", n), V(e, t, void 0, n), i } var te = this.handlers = { "bpmn:AdHocSubProcess": function (e, t, n = {}) { return J(e, t, n = Vr(t) ? fo(n, ["fill", "stroke", "width", "height"]) : fo(n, ["fill", "stroke"])) }, "bpmn:Association": function (e, t, n = {}) { return K(e, t, n = fo(n, ["fill", "stroke"])) }, "bpmn:BoundaryEvent": function (e, t, n = {}) { var { renderIcon: i = !0 } = n; n = fo(n, ["fill", "stroke"]); var r = Cr(t).get("cancelActivity"); n = { strokeWidth: 1.5, fill: ro(t, s, n.fill), fillOpacity: 1, stroke: oo(t, c, n.stroke) }, r || (n.strokeDasharray = "6"); var o = X(e, t, n); return _(e, t.width, t.height, 3, { ...n, fill: "none" }), i && F(t, e, n), o }, "bpmn:BusinessRuleTask": function (e, t, n = {}) { var r = ee(e, t, n = fo(n, ["fill", "stroke"])); return we(E(e, i.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN", { abspos: { x: 8, y: 8 } })), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), we(E(e, i.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER", { abspos: { x: 8, y: 8 } })), { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r }, "bpmn:CallActivity": function (e, t, n = {}) { return n = fo(n, ["fill", "stroke"]), J(e, t, { strokeWidth: 5, ...n }) }, "bpmn:ComplexGateway": function (e, t, n = {}) { var r = Z(e, t, n = fo(n, ["fill", "stroke"])); return E(e, i.getScaledPath("GATEWAY_COMPLEX", { xScaleFactor: .5, yScaleFactor: .5, containerWidth: t.width, containerHeight: t.height, position: { mx: .46, my: .26 } }), { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r }, "bpmn:DataInput": function (e, t, n = {}) { n = fo(n, ["fill", "stroke"]); var r = i.getRawPath("DATA_ARROW"), o = Y(e, t, n); return E(e, r, { fill: "none", stroke: oo(t, c, n.stroke), strokeWidth: 1 }), o }, "bpmn:DataInputAssociation": function (e, t, n = {}) { return n = fo(n, ["fill", "stroke"]), K(e, t, { ...n, markerEnd: y("association-end", ro(t, s, n.fill), oo(t, c, n.stroke)) }) }, "bpmn:DataObject": function (e, t, n = {}) { return Y(e, t, n = fo(n, ["fill", "stroke"])) }, "bpmn:DataObjectReference": k("bpmn:DataObject"), "bpmn:DataOutput": function (e, t, n = {}) { n = fo(n, ["fill", "stroke"]); var r = i.getRawPath("DATA_ARROW"), o = Y(e, t, n); return E(e, r, { strokeWidth: 1, fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke) }), o }, "bpmn:DataOutputAssociation": function (e, t, n = {}) { return n = fo(n, ["fill", "stroke"]), K(e, t, { ...n, markerEnd: y("association-end", ro(t, s, n.fill), oo(t, c, n.stroke)) }) }, "bpmn:DataStoreReference": function (e, t, n = {}) { return n = fo(n, ["fill", "stroke"]), E(e, i.getScaledPath("DATA_STORE", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: t.width, containerHeight: t.height, position: { mx: 0, my: .133 } }), { fill: ro(t, s, n.fill), fillOpacity: uo, stroke: oo(t, c, n.stroke), strokeWidth: 2 }) }, "bpmn:EndEvent": function (e, t, n = {}) { var { renderIcon: i = !0 } = n; n = fo(n, ["fill", "stroke"]); var r = X(e, t, { ...n, strokeWidth: 4 }); return i && F(t, e, n), r }, "bpmn:EventBasedGateway": function (e, t, n = {}) { n = fo(n, ["fill", "stroke"]); var r = Cr(t), o = Z(e, t, n); _(e, t.width, t.height, .2 * t.height, { fill: ro(t, "none", n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }); var a = r.get("eventGatewayType"), s = !!r.get("instantiate"); if ("Parallel" === a) { var p = i.getScaledPath("GATEWAY_PARALLEL", { xScaleFactor: .4, yScaleFactor: .4, containerWidth: t.width, containerHeight: t.height, position: { mx: .474, my: .296 } }); E(e, p, { fill: "none", stroke: oo(t, c, n.stroke), strokeWidth: 1 }) } else "Exclusive" === a && (s || _(e, t.width, t.height, .26 * t.height, { fill: "none", stroke: oo(t, c, n.stroke), strokeWidth: 1 }), function () { var r = i.getScaledPath("GATEWAY_EVENT_BASED", { xScaleFactor: .18, yScaleFactor: .18, containerWidth: t.width, containerHeight: t.height, position: { mx: .36, my: .44 } }); E(e, r, { fill: "none", stroke: oo(t, c, n.stroke), strokeWidth: 2 }) }()); return o }, "bpmn:ExclusiveGateway": function (e, t, n = {}) { var r = Z(e, t, n = fo(n, ["fill", "stroke"])), o = i.getScaledPath("GATEWAY_EXCLUSIVE", { xScaleFactor: .4, yScaleFactor: .4, containerWidth: t.width, containerHeight: t.height, position: { mx: .32, my: .3 } }); return kr(t).get("isMarkerVisible") && E(e, o, { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r }, "bpmn:Gateway": function (e, t, n = {}) { return Z(e, t, n = fo(n, ["fill", "stroke"])) }, "bpmn:Group": function (e, t, n = {}) { return n = fo(n, ["fill", "stroke", "width", "height"]), b(e, t.width, t.height, 10, { stroke: oo(t, c, n.stroke), strokeWidth: 1.5, strokeDasharray: "10, 6, 0, 6", fill: "none", pointerEvents: "none", width: co(t, n), height: po(t, n) }) }, "bpmn:InclusiveGateway": function (e, t, n = {}) { var i = Z(e, t, n = fo(n, ["fill", "stroke"])); return _(e, t.width, t.height, .24 * t.height, { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 2.5 }), i }, "bpmn:IntermediateEvent": function (e, t, n = {}) { var { renderIcon: i = !0 } = n; n = fo(n, ["fill", "stroke"]); var r = X(e, t, { ...n, strokeWidth: 1.5 }); return _(e, t.width, t.height, 3, { fill: "none", stroke: oo(t, c, n.stroke), strokeWidth: 1.5 }), i && F(t, e, n), r }, "bpmn:IntermediateCatchEvent": k("bpmn:IntermediateEvent"), "bpmn:IntermediateThrowEvent": k("bpmn:IntermediateEvent"), "bpmn:Lane": function (e, t, n = {}) { return n = fo(n, ["fill", "stroke", "width", "height"]), Q(e, t, { ...n, fillOpacity: .25 }) }, "bpmn:ManualTask": function (e, t, n = {}) { var r = ee(e, t, n = fo(n, ["fill", "stroke"])); return E(e, i.getScaledPath("TASK_TYPE_MANUAL", { abspos: { x: 17, y: 15 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: .5 }), r }, "bpmn:MessageFlow": function (e, t, n = {}) { n = fo(n, ["fill", "stroke"]); var r = Cr(t), o = kr(t), a = ro(t, s, n.fill), p = oo(t, c, n.stroke), l = w(e, t.waypoints, { markerEnd: y("messageflow-end", a, p), markerStart: y("messageflow-start", a, p), stroke: p, strokeDasharray: "10, 11", strokeWidth: 1.5 }); if (r.get("messageRef")) { var u = l.getPointAtLength(l.getTotalLength() / 2), h = i.getScaledPath("MESSAGE_FLOW_MARKER", { abspos: { x: u.x, y: u.y } }), d = { strokeWidth: 1 }; "initiating" === o.get("messageVisibleKind") ? (d.fill = a, d.stroke = p) : (d.fill = p, d.stroke = a); var f = E(e, h, d), m = W(e, r.get("messageRef").get("name"), { align: "center-top", fitBox: !0, style: { fill: p } }), v = f.getBBox(), g = m.getBBox(); Kn(m, u.x - g.width / 2, u.y + v.height / 2 + 10, 0) } return l }, "bpmn:ParallelGateway": function (e, t, n = {}) { var r = Z(e, t, n = fo(n, ["fill", "stroke"])); return E(e, i.getScaledPath("GATEWAY_PARALLEL", { xScaleFactor: .6, yScaleFactor: .6, containerWidth: t.width, containerHeight: t.height, position: { mx: .46, my: .2 } }), { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r }, "bpmn:Participant": function (e, t, n = {}) { var i = Q(e, t, n = fo(n, ["fill", "stroke", "width", "height"])), r = Vr(t), o = Wr(t), a = Cr(t), s = a.get("name"); if (r) { x(e, o ? [{ x: 30, y: 0 }, { x: 30, y: po(t, n) }] : [{ x: 0, y: 30 }, { x: co(t, n), y: 30 }], { stroke: oo(t, c, n.stroke), strokeWidth: 1.5 }), U(e, s, t, n) } else { var l = so(t, n); o || (l.height = co(t, n), l.width = po(t, n)); var u = W(e, s, { box: l, align: "center-middle", style: { fill: ao(t, p, c, n.stroke) } }); if (!o) Kn(u, 0, -(-1 * po(t, n)), 270) } return a.get("participantMultiplicity") && H("ParticipantMultiplicityMarker", e, t, n), i }, "bpmn:ReceiveTask": function (e, t, n = {}) { n = fo(n, ["fill", "stroke"]); var r, o = Cr(t), a = ee(e, t, n); return o.get("instantiate") ? (_(e, 28, 28, 4.4, { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r = i.getScaledPath("TASK_TYPE_INSTANTIATING_SEND", { abspos: { x: 7.77, y: 9.52 } })) : r = i.getScaledPath("TASK_TYPE_SEND", { xScaleFactor: .9, yScaleFactor: .9, containerWidth: 21, containerHeight: 14, position: { mx: .3, my: .4 } }), E(e, r, { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), a }, "bpmn:ScriptTask": function (e, t, n = {}) { var r = ee(e, t, n = fo(n, ["fill", "stroke"])); return E(e, i.getScaledPath("TASK_TYPE_SCRIPT", { abspos: { x: 15, y: 20 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r }, "bpmn:SendTask": function (e, t, n = {}) { var r = ee(e, t, n = fo(n, ["fill", "stroke"])); return E(e, i.getScaledPath("TASK_TYPE_SEND", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: 21, containerHeight: 14, position: { mx: .285, my: .357 } }), { fill: oo(t, c, n.stroke), stroke: ro(t, s, n.fill), strokeWidth: 1 }), r }, "bpmn:SequenceFlow": function (e, t, n = {}) { n = fo(n, ["fill", "stroke"]); var i = ro(t, s, n.fill), r = oo(t, c, n.stroke), o = w(e, t.waypoints, { markerEnd: y("sequenceflow-end", i, r), stroke: r }), a = Cr(t), { source: p } = t; if (p) { var l = Cr(p); a.get("conditionExpression") && Er(l, "bpmn:Activity") && we(o, { markerStart: y("conditional-flow-marker", i, r) }), l.get("default") && (Er(l, "bpmn:Gateway") || Er(l, "bpmn:Activity")) && l.get("default") === a && we(o, { markerStart: y("conditional-default-flow-marker", i, r) }) } return o }, "bpmn:ServiceTask": function (e, t, n = {}) { var r = ee(e, t, n = fo(n, ["fill", "stroke"])); return _(e, 10, 10, { fill: ro(t, s, n.fill), stroke: "none", transform: "translate(6, 6)" }), E(e, i.getScaledPath("TASK_TYPE_SERVICE", { abspos: { x: 12, y: 18 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), _(e, 10, 10, { fill: ro(t, s, n.fill), stroke: "none", transform: "translate(11, 10)" }), E(e, i.getScaledPath("TASK_TYPE_SERVICE", { abspos: { x: 17, y: 22 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: 1 }), r }, "bpmn:StartEvent": function (e, t, n = {}) { var { renderIcon: i = !0 } = n; n = fo(n, ["fill", "stroke"]), Cr(t).get("isInterrupting") || (n = { ...n, strokeDasharray: "6" }); var r = X(e, t, n); return i && F(t, e, n), r }, "bpmn:SubProcess": function (e, t, n = {}) { return J(e, t, n = Vr(t) ? fo(n, ["fill", "stroke", "width", "height"]) : fo(n, ["fill", "stroke"])) }, "bpmn:Task": function (e, t, n = {}) { return ee(e, t, n = fo(n, ["fill", "stroke"])) }, "bpmn:TextAnnotation": function (e, t, n = {}) { n = fo(n, ["fill", "stroke", "width", "height"]); var { width: r, height: o } = so(t, n), a = b(e, r, o, 0, 0, { fill: "none", stroke: "none" }); return E(e, i.getScaledPath("TEXT_ANNOTATION", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: r, containerHeight: o, position: { mx: 0, my: 0 } }), { stroke: oo(t, c, n.stroke) }), W(e, Cr(t).get("text") || "", { align: "left-top", box: so(t, n), padding: 7, style: { fill: ao(t, p, c, n.stroke) } }), a }, "bpmn:Transaction": function (e, t, i = {}) { i = Vr(t) ? fo(i, ["fill", "stroke", "width", "height"]) : fo(i, ["fill", "stroke"]); var r = J(e, t, { strokeWidth: 1.5, ...i }), o = n.style(["no-fill", "no-events"], { stroke: oo(t, c, i.stroke), strokeWidth: 1.5 }); return Vr(t) || (i = {}), b(e, co(t, i), po(t, i), 7, 3, o), r }, "bpmn:UserTask": function (e, t, n = {}) { var r = ee(e, t, n = fo(n, ["fill", "stroke"])); return E(e, i.getScaledPath("TASK_TYPE_USER_1", { abspos: { x: 15, y: 12 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: .5 }), E(e, i.getScaledPath("TASK_TYPE_USER_2", { abspos: { x: 15, y: 12 } }), { fill: ro(t, s, n.fill), stroke: oo(t, c, n.stroke), strokeWidth: .5 }), E(e, i.getScaledPath("TASK_TYPE_USER_3", { abspos: { x: 15, y: 12 } }), { fill: oo(t, c, n.stroke), stroke: oo(t, c, n.stroke), strokeWidth: .5 }), r }, label: function (e, t, n = {}) { return function (e, t, n = {}) { var i = { width: 90, height: 30, x: t.width / 2 + t.x, y: t.height / 2 + t.y }; return W(e, eo(t), { box: i, fitBox: !0, style: L({}, o.getExternalStyle(), { fill: ao(t, p, c, n.stroke) }) }) }(e, t, n) } }; this._drawPath = E, this._renderer = C } function fo(e, t = []) { return t.reduce(((t, n) => (e[n] && (t[n] = e[n]), t)), {}) } e(ho, it), ho.$inject = ["config.bpmnRenderer", "eventBus", "styles", "pathMap", "canvas", "textRenderer"], ho.prototype.canRender = function (e) { return Er(e, "bpmn:BaseElement") }, ho.prototype.drawShape = function (e, t, n = {}) { var { type: i } = t; return this._renderer(i)(e, t, n) }, ho.prototype.drawConnection = function (e, t, n = {}) { var { type: i } = t; return this._renderer(i)(e, t, n) }, ho.prototype.getShapePath = function (e) { return Er(e, "bpmn:Event") ? (n = (t = e).x + t.width / 2, i = t.y + t.height / 2, r = t.width / 2, rt([["M", n, i], ["m", 0, -r], ["a", r, r, 0, 1, 1, 0, 2 * r], ["a", r, r, 0, 1, 1, 0, -2 * r], ["z"]])) : Er(e, "bpmn:Activity") ? function (e, t) { var n = e.x, i = e.y, r = e.width, o = e.height; return rt([["M", n + t, i], ["l", r - 2 * t, 0], ["a", t, t, 0, 0, 1, t, t], ["l", 0, o - 2 * t], ["a", t, t, 0, 0, 1, -t, t], ["l", 2 * t - r, 0], ["a", t, t, 0, 0, 1, -t, -t], ["l", 0, 2 * t - o], ["a", t, t, 0, 0, 1, t, -t], ["z"]]) }(e, 10) : Er(e, "bpmn:Gateway") ? function (e) { var t = e.width / 2, n = e.height / 2; return rt([["M", e.x + t, e.y], ["l", t, n], ["l", -t, n], ["l", -t, -n], ["z"]]) }(e) : function (e) { var t = e.x, n = e.y, i = e.width; return rt([["M", t, n], ["l", i, 0], ["l", 0, e.height], ["l", -i, 0], ["z"]]) }(e); var t, n, i, r }; var mo = 0, vo = { width: 150, height: 50 }; function yo(e, t) { var n; t.textContent = e; try { var i, r = "" === e; return t.textContent = r ? "dummy" : e, i = { width: (n = t.getBBox()).width + 2 * n.x, height: n.height }, r && (i.width = 0), i } catch (e) { return { width: 0, height: 0 } } } function go(e, t, n) { for (var i, r = e.shift(), o = r; ;) { if ((i = yo(o, n)).width = o ? i.width : 0, " " === o || "" === o || i.width < Math.round(t) || o.length < 2) return _o(e, o, r, i); o = xo(o, i.width, t) } } function _o(e, t, n, i) { if (t.length < n.length) { var r = n.slice(t.length).trim(); e.unshift(r) } return { width: i.width, height: i.height, text: t } } var bo = "­"; function xo(e, t, n) { var i = Math.max(e.length * (n / t), 1), r = function (e, t) { var n, i = e.split(/(\s|-|\u00AD)/g), r = [], o = 0; if (i.length > 1) for (; n = i.shift();) { if (!(n.length + o < t)) { "-" !== n && n !== bo || r.pop(); break } r.push(n), o += n.length } var a = r[r.length - 1]; return a && a === bo && (r[r.length - 1] = "-"), r.join("") }(e, i); return r || (r = e.slice(0, Math.max(Math.round(i - 1), 1))), r } function wo(e) { this._config = L({}, { size: vo, padding: mo, style: {}, align: "center-top" }, e || {}) } wo.prototype.createText = function (e, t) { return this.layoutText(e, t).element }, wo.prototype.getDimensions = function (e, t) { return this.layoutText(e, t).dimensions }, wo.prototype.layoutText = function (e, t) { var n = L({}, this._config.size, t.box), i = L({}, this._config.style, t.style), r = function (e) { var t = e.split("-"); return { horizontal: t[0] || "center", vertical: t[1] || "top" } }(t.align || this._config.align), o = function (e) { return l(e) ? L({ top: 0, left: 0, right: 0, bottom: 0 }, e) : { top: e, left: e, right: e, bottom: e } }(void 0 !== t.padding ? t.padding : this._config.padding), a = t.fitBox || !1, s = function (e) { if ("fontSize" in e && "lineHeight" in e) return e.lineHeight * parseInt(e.fontSize, 10) }(i), c = e.split(/\u00AD?\r?\n/), p = [], u = n.width - o.left - o.right, h = De("text"); for (we(h, { x: 0, y: 0 }), we(h, i), ge(function () { var e = document.getElementById("helper-svg"); return e || (we(e = De("svg"), { id: "helper-svg" }), q(e, { visibility: "hidden", position: "fixed", width: 0, height: 0 }), document.body.appendChild(e)), e }(), h); c.length;)p.push(go(c, u, h)); "middle" === r.vertical && (o.top = o.bottom = 0); var d = b(p, (function (e, t, n) { return e + (s || t.height) }), 0) + o.top + o.bottom, f = b(p, (function (e, t, n) { return t.width > e ? t.width : e }), 0), m = o.top; "middle" === r.vertical && (m += (n.height - d) / 2), m -= (s || p[0].height) / 4; var v = De("text"); return we(v, i), g(p, (function (e) { var t; switch (m += s || e.height, r.horizontal) { case "left": t = o.left; break; case "right": t = (a ? f : u) - o.right - e.width; break; default: t = Math.max(((a ? f : u) - e.width) / 2 + o.left, 0) }var n = De("tspan"); we(n, { x: t, y: m }), n.textContent = e.text, ge(v, n) })), ke(h), { dimensions: { width: f, height: d }, element: v } }; function Eo(e) { var t = L({ fontFamily: "Arial, sans-serif", fontSize: 12, fontWeight: "normal", lineHeight: 1.2 }, e && e.defaultStyle || {}), n = parseInt(t.fontSize, 10) - 1, i = L({}, t, { fontSize: n }, e && e.externalStyle || {}), r = new wo({ style: t }); this.getExternalLabelBounds = function (e, t) { var n = r.getDimensions(t, { box: { width: 90, height: 30 }, style: i }); return { x: Math.round(e.x + e.width / 2 - n.width / 2), y: Math.round(e.y), width: Math.ceil(n.width), height: Math.ceil(n.height) } }, this.getTextAnnotationBounds = function (e, n) { var i = r.getDimensions(n, { box: e, style: t, align: "left-top", padding: 5 }); return { x: e.x, y: e.y, width: e.width, height: Math.max(30, Math.round(i.height)) } }, this.createText = function (e, t) { return r.createText(e, t || {}) }, this.getDefaultStyle = function () { return t }, this.getExternalStyle = function () { return i } } Eo.$inject = ["config.textRenderer"]; var So = /\{([^{}]+)\}/g, Co = /(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g; var ko = { __init__: ["bpmnRenderer"], bpmnRenderer: ["type", ho], textRenderer: ["type", Eo], pathMap: ["type", function () { this.pathMap = { EVENT_MESSAGE: { d: "m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}", height: 36, width: 36, heightElements: [6, 14], widthElements: [10.5, 21] }, EVENT_SIGNAL: { d: "M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z", height: 36, width: 36, heightElements: [18], widthElements: [10, 20] }, EVENT_ESCALATION: { d: "M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z", height: 36, width: 36, heightElements: [20, 7], widthElements: [8] }, EVENT_CONDITIONAL: { d: "M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ", height: 36, width: 36, heightElements: [8.5, 14.5, 18, 11.5, 14.5, 17.5, 20.5, 23.5, 26.5], widthElements: [10.5, 14.5, 12.5] }, EVENT_LINK: { d: "m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z", height: 36, width: 36, heightElements: [4.4375, 6.75, 7.8125], widthElements: [9.84375, 13.5] }, EVENT_ERROR: { d: "m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z", height: 36, width: 36, heightElements: [.023, 8.737, 8.151, 16.564, 10.591, 8.714], widthElements: [.085, 6.672, 6.97, 4.273, 5.337, 6.636] }, EVENT_CANCEL_45: { d: "m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z", height: 36, width: 36, heightElements: [4.75, 8.5], widthElements: [4.75, 8.5] }, EVENT_COMPENSATION: { d: "m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z", height: 36, width: 36, heightElements: [6.5, 13, .4, 6.1], widthElements: [9, 9.3, 8.7] }, EVENT_TIMER_WH: { d: "M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ", height: 36, width: 36, heightElements: [10, 2], widthElements: [3, 7] }, EVENT_TIMER_LINE: { d: "M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ", height: 36, width: 36, heightElements: [10, 3], widthElements: [0, 0] }, EVENT_MULTIPLE: { d: "m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z", height: 36, width: 36, heightElements: [6.28099, 12.56199], widthElements: [3.1405, 9.42149, 12.56198] }, EVENT_PARALLEL_MULTIPLE: { d: "m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z", height: 36, width: 36, heightElements: [2.56228, 7.68683], widthElements: [2.56228, 7.68683] }, GATEWAY_EXCLUSIVE: { d: "m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z", height: 17.5, width: 17.5, heightElements: [8.5, 6.5312, -6.5312, -8.5], widthElements: [6.5, -6.5, 3, -3, 5, -5] }, GATEWAY_PARALLEL: { d: "m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z", height: 30, width: 30, heightElements: [5, 12.5], widthElements: [5, 12.5] }, GATEWAY_EVENT_BASED: { d: "m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z", height: 11, width: 11, heightElements: [-6, 6, 12, -12], widthElements: [9, -3, -12] }, GATEWAY_COMPLEX: { d: "m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z", height: 17.125, width: 17.125, heightElements: [4.875, 3.4375, 2.125, 3], widthElements: [3.4375, 2.125, 4.875, 3] }, DATA_OBJECT_PATH: { d: "m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0", height: 61, width: 51, heightElements: [10, 50, 60], widthElements: [10, 40, 50, 60] }, DATA_OBJECT_COLLECTION_PATH: { d: "m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10", height: 10, width: 10, heightElements: [], widthElements: [] }, DATA_ARROW: { d: "m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z", height: 61, width: 51, heightElements: [], widthElements: [] }, DATA_STORE: { d: "m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0", height: 61, width: 61, heightElements: [7, 10, 45], widthElements: [2, 58, 60] }, TEXT_ANNOTATION: { d: "m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0", height: 30, width: 10, heightElements: [30], widthElements: [10] }, MARKER_SUB_PROCESS: { d: "m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0", height: 10, width: 10, heightElements: [], widthElements: [] }, MARKER_PARALLEL: { d: "m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10", height: 10, width: 10, heightElements: [], widthElements: [] }, MARKER_SEQUENTIAL: { d: "m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0", height: 10, width: 10, heightElements: [], widthElements: [] }, MARKER_COMPENSATION: { d: "m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z", height: 10, width: 21, heightElements: [], widthElements: [] }, MARKER_LOOP: { d: "m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902", height: 13.9, width: 13.7, heightElements: [], widthElements: [] }, MARKER_ADHOC: { d: "m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z", height: 4, width: 15, heightElements: [], widthElements: [] }, TASK_TYPE_SEND: { d: "m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}", height: 14, width: 21, heightElements: [6, 14], widthElements: [10.5, 21] }, TASK_TYPE_SCRIPT: { d: "m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0", height: 15, width: 12.6, heightElements: [6, 14], widthElements: [10.5, 21] }, TASK_TYPE_USER_1: { d: "m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5" }, TASK_TYPE_USER_2: { d: "m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 " }, TASK_TYPE_USER_3: { d: "m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z" }, TASK_TYPE_MANUAL: { d: "m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z" }, TASK_TYPE_INSTANTIATING_SEND: { d: "m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6" }, TASK_TYPE_SERVICE: { d: "m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z" }, TASK_TYPE_SERVICE_FILL: { d: "m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z" }, TASK_TYPE_BUSINESS_RULE_HEADER: { d: "m {mx},{my} 0,4 20,0 0,-4 z" }, TASK_TYPE_BUSINESS_RULE_MAIN: { d: "m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8" }, MESSAGE_FLOW_MARKER: { d: "m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6" } }, this.getRawPath = function (e) { return this.pathMap[e].d }, this.getScaledPath = function (e, t) { var n, i, r = this.pathMap[e]; t.abspos ? (n = t.abspos.x, i = t.abspos.y) : (n = t.containerWidth * t.position.mx, i = t.containerHeight * t.position.my); var o = {}; if (t.position) { for (var a = t.containerHeight / r.height * t.yScaleFactor, s = t.containerWidth / r.width * t.xScaleFactor, c = 0; c < r.heightElements.length; c++)o["y" + c] = r.heightElements[c] * a; for (var p = 0; p < r.widthElements.length; p++)o["x" + p] = r.widthElements[p] * s } var l, u, h = (l = r.d, u = { mx: n, my: i, e: o }, String(l).replace(So, (function (e, t) { return function (e, t, n) { var i = n; return t.replace(Co, (function (e, t, n, r, o) { t = t || r, i && (t in i && (i = i[t]), "function" == typeof i && o && (i = i())) })), i = (null == i || i == n ? e : i) + "" }(e, t, u) }))); return h } }] }; var Ro = { translate: ["value", function (e, t) { return t = t || {}, e.replace(/{([^}]+)}/g, (function (e, n) { return t[n] || "{" + n + "}" })) }] }; function Po(e, t, n) { return L({ id: e.id, type: e.$type, businessObject: e, di: t }, n) } function To(e, t, n) { var i = e.waypoint; return !i || i.length < 2 ? [gn(t), gn(n)] : i.map((function (e) { return { x: e.x, y: e.y } })) } function Ao(e, t, n, i) { return new Error(e("element {element} referenced by {referenced}#{property} not yet drawn", { element: gr(n), referenced: gr(t), property: i })) } function Mo(e, t, n, i, r, o) { this._eventBus = e, this._canvas = t, this._elementFactory = n, this._elementRegistry = i, this._translate = r, this._textRenderer = o } Mo.$inject = ["eventBus", "canvas", "elementFactory", "elementRegistry", "translate", "textRenderer"], Mo.prototype.add = function (e, t, n) { var i, r, o, a = this._translate; if (Er(t, "bpmndi:BPMNPlane")) { var s = Er(e, "bpmn:SubProcess") ? { id: e.id + "_plane" } : {}; i = this._elementFactory.createRoot(Po(e, t, s)), this._canvas.addRootElement(i) } else if (Er(t, "bpmndi:BPMNShape")) { var c = !Vr(e, t), p = function (e) { return Er(e, "bpmn:Group") }(e); r = n && (n.hidden || n.collapsed); var l = t.bounds; i = this._elementFactory.createShape(Po(e, t, { collapsed: c, hidden: r, x: Math.round(l.x), y: Math.round(l.y), width: Math.round(l.width), height: Math.round(l.height), isFrame: p })), Er(e, "bpmn:BoundaryEvent") && this._attachBoundary(e, i), Er(e, "bpmn:Lane") && (o = 0), Er(e, "bpmn:DataStoreReference") && (function (e, t) { var n = t.x, i = t.y; return n >= e.x && n <= e.x + e.width && i >= e.y && i <= e.y + e.height }(n, gn(l)) || (n = this._canvas.findRoot(n))), this._canvas.addShape(i, n, o) } else { if (!Er(t, "bpmndi:BPMNEdge")) throw new Error(a("unknown di {di} for element {semantic}", { di: gr(t), semantic: gr(e) })); var u = this._getSource(e), h = this._getTarget(e); r = n && (n.hidden || n.collapsed), i = this._elementFactory.createConnection(Po(e, t, { hidden: r, source: u, target: h, waypoints: To(t, u, h) })), Er(e, "bpmn:DataAssociation") && (n = this._canvas.findRoot(n)), this._canvas.addConnection(i, n, o) } return Yr(e) && eo(i) && this.addLabel(e, t, i), this._eventBus.fire("bpmnElement.added", { element: i }), i }, Mo.prototype._attachBoundary = function (e, t) { var n = this._translate, i = e.attachedToRef; if (!i) throw new Error(n("missing {semantic}#attachedToRef", { semantic: gr(e) })); var r = this._elementRegistry.get(i.id), o = r && r.attachers; if (!r) throw Ao(n, e, i, "attachedToRef"); t.host = r, o || (r.attachers = o = []), -1 === o.indexOf(t) && o.push(t) }, Mo.prototype.addLabel = function (e, t, n) { var i, r, o; return i = function (e, t) { var n, i, r, o = e.label; return o && o.bounds ? (r = o.bounds, i = { width: Math.max(qr.width, r.width), height: r.height }, n = { x: r.x + r.width / 2, y: r.y + r.height / 2 }) : (n = Qr(t), i = qr), L({ x: n.x - i.width / 2, y: n.y - i.height / 2 }, i) }(t, n), (r = eo(n)) && (i = this._textRenderer.getExternalLabelBounds(i, r)), o = this._elementFactory.createLabel(Po(e, t, { id: e.id + "_label", labelTarget: n, type: "label", hidden: n.hidden || !eo(n), x: Math.round(i.x), y: Math.round(i.y), width: Math.round(i.width), height: Math.round(i.height) })), this._canvas.addShape(o, n.parent) }, Mo.prototype._getConnectedElement = function (e, t) { var n, i, r = e.$type, o = this._translate; if (i = e[t + "Ref"], "source" === t && "bpmn:DataInputAssociation" === r && (i = i && i[0]), ("source" === t && "bpmn:DataOutputAssociation" === r || "target" === t && "bpmn:DataInputAssociation" === r) && (i = e.$parent), n = i && this._getElement(i)) return n; throw i ? Ao(o, e, i, t + "Ref") : new Error(o("{semantic}#{side} Ref not specified", { semantic: gr(e), side: t })) }, Mo.prototype._getSource = function (e) { return this._getConnectedElement(e, "source") }, Mo.prototype._getTarget = function (e) { return this._getConnectedElement(e, "target") }, Mo.prototype._getElement = function (e) { return this._elementRegistry.get(e.id) }; var Do = { __depends__: [ko, { __depends__: [Ro], bpmnImporter: ["type", Mo] }] }; function Bo(e) { e && "function" == typeof e.stopPropagation && e.stopPropagation() } function No(e) { return e.originalEvent || e.srcEvent } function Oo(e) { Bo(e), Bo(No(e)) } function jo(e) { return e.pointers && e.pointers.length && (e = e.pointers[0]), e.touches && e.touches.length && (e = e.touches[0]), e ? { x: e.clientX, y: e.clientY } : null } function Lo() { return /mac/i.test(navigator.platform) } function Io(e, t) { return (No(e) || e).button === t } function $o(e) { return Io(e, 0) } function Fo(e) { var t = No(e) || e; return !!$o(e) && (Lo() ? t.metaKey : t.ctrlKey) } function zo(e) { var t = No(e) || e; return $o(e) && t.shiftKey } function Ho(e) { return !0 } function Vo(e) { return $o(e) || function (e) { return Io(e, 1) }(e) } function Wo(e, t, n) { var i = this; function r(n, i, r) { var o, a; (function (e, t) { var n = c[e] || $o; return !n(t) })(n, i) || (r ? a = t.getGraphics(r) : (o = i.delegateTarget || i.target) && (a = o, r = t.get(a)), a && r && !1 === e.fire(n, { element: r, gfx: a, originalEvent: i }) && (i.stopPropagation(), i.preventDefault())) } var o = {}; function a(e) { return o[e] } var s = { click: "element.click", contextmenu: "element.contextmenu", dblclick: "element.dblclick", mousedown: "element.mousedown", mousemove: "element.mousemove", mouseover: "element.hover", mouseout: "element.out", mouseup: "element.mouseup" }, c = { "element.contextmenu": Ho, "element.mousedown": Vo, "element.mouseup": Vo, "element.click": Vo, "element.dblclick": Vo }; var p = "svg, .djs-element"; function l(e, t, n, i) { var a = o[n] = function (e) { r(n, e) }; i && (c[n] = i), a.$delegate = pe.bind(e, p, t, a) } function u(e, t, n) { var i = a(n); i && pe.unbind(e, t, i.$delegate) } e.on("canvas.destroy", (function (e) { var t; t = e.svg, g(s, (function (e, n) { u(t, n, e) })) })), e.on("canvas.init", (function (e) { var t; t = e.svg, g(s, (function (e, n) { l(t, n, e) })) })), e.on(["shape.added", "connection.added"], (function (t) { var n = t.element, i = t.gfx; e.fire("interactionEvents.createHit", { element: n, gfx: i }) })), e.on(["shape.changed", "connection.changed"], 500, (function (t) { var n = t.element, i = t.gfx; e.fire("interactionEvents.updateHit", { element: n, gfx: i }) })), e.on("interactionEvents.createHit", 500, (function (e) { var t = e.element, n = e.gfx; i.createDefaultHit(t, n) })), e.on("interactionEvents.updateHit", (function (e) { var t = e.element, n = e.gfx; i.updateDefaultHit(t, n) })); var h = m("djs-hit djs-hit-stroke"), d = m("djs-hit djs-hit-click-stroke"), f = { all: m("djs-hit djs-hit-all"), "click-stroke": d, stroke: h, "no-move": m("djs-hit djs-hit-no-move") }; function m(e, t) { return t = L({ stroke: "white", strokeWidth: 15 }, t || {}), n.cls(e, ["no-fill", "no-border"], t) } function v(e, t) { var n = f[t]; if (!n) throw new Error("invalid hit type <" + t + ">"); return we(e, n), e } function y(e, t) { ge(e, t) } this.removeHits = function (e) { g(me(".djs-hit", e), ke) }, this.createDefaultHit = function (e, t) { var n, i = e.waypoints, r = e.isFrame; return i ? this.createWaypointsHit(t, i) : (n = r ? "stroke" : "all", this.createBoxHit(t, n, { width: e.width, height: e.height })) }, this.createWaypointsHit = function (e, t) { var n = pt(t); return v(n, "stroke"), y(e, n), n }, this.createBoxHit = function (e, t, n) { n = L({ x: 0, y: 0 }, n); var i = De("rect"); return v(i, t), we(i, n), y(e, i), i }, this.updateDefaultHit = function (e, t) { var n = fe(".djs-hit", t); if (n) return e.waypoints ? lt(n, e.waypoints) : we(n, { width: e.width, height: e.height }), n }, this.fire = r, this.triggerMouseEvent = function (e, t, n) { var i = s[e]; if (!i) throw new Error("unmapped DOM event name <" + e + ">"); return r(i, t, n) }, this.mouseHandler = a, this.registerEvent = l, this.unregisterEvent = u } Wo.$inject = ["eventBus", "elementRegistry", "styles"]; var Go = { __init__: ["interactionEvents"], interactionEvents: ["type", Wo] }; function Uo(e, t) { this._eventBus = e, this.offset = 5; var n = t.cls("djs-outline", ["no-fill"]), i = this; function r(e) { var t = De("rect"); return we(t, L({ x: 0, y: 0, rx: 4, width: 100, height: 100 }, n)), t } e.on(["shape.added", "shape.changed"], 500, (function (e) { var t = e.element, n = e.gfx, o = fe(".djs-outline", n); o || ge(n, o = i.getOutline(t) || r()), i.updateShapeOutline(o, t) })), e.on(["connection.added", "connection.changed"], (function (e) { var t = e.element, n = e.gfx, o = fe(".djs-outline", n); o || ge(n, o = r()), i.updateConnectionOutline(o, t) })) } Uo.prototype.updateShapeOutline = function (e, t) { var n = !1, i = this._getProviders(); i.length && g(i, (function (i) { n = n || i.updateOutline(t, e) })), n || we(e, { x: -this.offset, y: -this.offset, width: t.width + 2 * this.offset, height: t.height + 2 * this.offset }) }, Uo.prototype.updateConnectionOutline = function (e, t) { var n = vt(t); we(e, { x: n.x - this.offset, y: n.y - this.offset, width: n.width + 2 * this.offset, height: n.height + 2 * this.offset }) }, Uo.prototype.registerProvider = function (e, t) { t || (t = e, e = 1e3), this._eventBus.on("outline.getProviders", e, (function (e) { e.providers.push(t) })) }, Uo.prototype._getProviders = function () { var e = this._eventBus.createEvent({ type: "outline.getProviders", providers: [] }); return this._eventBus.fire(e), e.providers }, Uo.prototype.getOutline = function (e) { var t; return g(this._getProviders(), (function (n) { h(n.getOutline) && (t = t || n.getOutline(e)) })), t }, Uo.$inject = ["eventBus", "styles", "elementRegistry"]; var qo = { __init__: ["outline"], outline: ["type", Uo] }; function Ko(e, t) { this._eventBus = e, this._canvas = t, this._selectedElements = []; var n = this; e.on(["shape.remove", "connection.remove"], (function (e) { var t = e.element; n.deselect(t) })), e.on(["diagram.clear", "root.set"], (function (e) { n.select(null) })) } Ko.$inject = ["eventBus", "canvas"], Ko.prototype.deselect = function (e) { var t = this._selectedElements, n = t.indexOf(e); if (-1 !== n) { var i = t.slice(); t.splice(n, 1), this._eventBus.fire("selection.changed", { oldSelection: i, newSelection: t }) } }, Ko.prototype.get = function () { return this._selectedElements }, Ko.prototype.isSelected = function (e) { return -1 !== this._selectedElements.indexOf(e) }, Ko.prototype.select = function (e, t) { var n = this._selectedElements, i = n.slice(); p(e) || (e = e ? [e] : []); var r = this._canvas, o = r.getRootElement(); e = e.filter((function (e) { var t = r.findRoot(e); return o === t })), t ? g(e, (function (e) { -1 === n.indexOf(e) && n.push(e) })) : this._selectedElements = n = e.slice(), this._eventBus.fire("selection.changed", { oldSelection: i, newSelection: n }) }; var Yo = "hover", Xo = "selected"; function Zo(e, t, n) { this._canvas = e; var i = this; function r(t, n) { e.addMarker(t, n) } function o(t, n) { e.removeMarker(t, n) } this._multiSelectionBox = null, t.on("element.hover", (function (e) { r(e.element, Yo) })), t.on("element.out", (function (e) { o(e.element, Yo) })), t.on("selection.changed", (function (e) { var t = e.oldSelection, n = e.newSelection; g(t, (function (e) { -1 === n.indexOf(e) && function (e) { o(e, Xo) }(e) })), g(n, (function (e) { -1 === t.indexOf(e) && function (e) { r(e, Xo) }(e) })), i._updateSelectionOutline(n) })), t.on("element.changed", (function (e) { n.isSelected(e.element) && i._updateSelectionOutline(n.get()) })) } function Qo(e, t, n, i) { e.on("create.end", 500, (function (e) { var n = e.context, i = n.canExecute, r = n.elements, o = (n.hints || {}).autoSelect; if (i) { if (!1 === o) return; p(o) ? t.select(o) : t.select(r.filter(Jo)) } })), e.on("connect.end", 500, (function (e) { var n = e.context.connection; n && t.select(n) })), e.on("shape.move.end", 500, (function (e) { var n = e.previousSelection || [], r = i.get(e.context.shape.id); m(n, (function (e) { return r.id === e.id })) || t.select(r) })), e.on("element.click", (function (e) { if ($o(e)) { var i = e.element; i === n.getRootElement() && (i = null); var r = t.isSelected(i), o = t.get().length > 1, a = Fo(e) || zo(e); if (r && o) return a ? t.deselect(i) : t.select(i); r ? t.deselect(i) : t.select(i, a) } })) } function Jo(e) { return !e.hidden } Zo.$inject = ["canvas", "eventBus", "selection"], Zo.prototype._updateSelectionOutline = function (e) { var t = this._canvas.getLayer("selectionOutline"); Re(t); var n = e.length > 1; if (Se(this._canvas.getContainer())[n ? "add" : "remove"]("djs-multi-select"), n) { var i = function (e) { return { x: e.x - 6, y: e.y - 6, width: e.width + 12, height: e.height + 12 } }(vt(e)), r = De("rect"); we(r, L({ rx: 3 }, i)), Se(r).add("djs-selection-outline"), ge(t, r) } }, Qo.$inject = ["eventBus", "selection", "canvas", "elementRegistry"]; var ea = { __init__: ["selectionVisuals", "selectionBehavior"], __depends__: [Go, qo], selection: ["type", Ko], selectionVisuals: ["type", Zo], selectionBehavior: ["type", Qo] }; function ta(e) { this._counter = 0, this._prefix = (e ? e + "-" : "") + Math.floor(1e9 * Math.random()) + "-" } ta.prototype.next = function () { return this._prefix + ++this._counter }; var na = new ta("ov"); function ia(e, t, n, i) { var r, o; this._eventBus = t, this._canvas = n, this._elementRegistry = i, this._ids = na, this._overlayDefaults = L({ show: null, scale: !0 }, e && e.defaults), this._overlays = {}, this._overlayContainers = [], this._overlayRoot = (r = n.getContainer(), q(o = de('<div class="djs-overlay-container" />'), { position: "absolute", width: 0, height: 0 }), r.insertBefore(o, r.firstChild), o), this._init() } function ra(e, t, n) { q(e, { left: t + "px", top: n + "px" }) } function oa(e, t) { e.style.display = !1 === t ? "none" : "" } function aa(e, t) { e.style["transform-origin"] = "top left", ["", "-ms-", "-webkit-"].forEach((function (n) { e.style[n + "transform"] = t })) } ia.$inject = ["config.overlays", "eventBus", "canvas", "elementRegistry"], ia.prototype.get = function (e) { if (d(e) && (e = { id: e }), d(e.element) && (e.element = this._elementRegistry.get(e.element)), e.element) { var t = this._getOverlayContainer(e.element, !0); return t ? e.type ? y(t.overlays, A({ type: e.type })) : t.overlays.slice() : [] } return e.type ? y(this._overlays, A({ type: e.type })) : e.id ? this._overlays[e.id] : null }, ia.prototype.add = function (e, t, n) { if (l(t) && (n = t, t = null), e.id || (e = this._elementRegistry.get(e)), !n.position) throw new Error("must specifiy overlay position"); if (!n.html) throw new Error("must specifiy overlay html"); if (!e) throw new Error("invalid element specified"); var i = this._ids.next(); return n = L({}, this._overlayDefaults, n, { id: i, type: t, element: e, html: n.html }), this._addOverlay(n), i }, ia.prototype.remove = function (e) { var t = this.get(e) || []; p(t) || (t = [t]); var n = this; g(t, (function (e) { var t = n._getOverlayContainer(e.element, !0); if (e && (ve(e.html), ve(e.htmlContainer), delete e.htmlContainer, delete e.element, delete n._overlays[e.id]), t) { var i = t.overlays.indexOf(e); -1 !== i && t.overlays.splice(i, 1) } })) }, ia.prototype.isShown = function () { return "none" !== this._overlayRoot.style.display }, ia.prototype.show = function () { oa(this._overlayRoot) }, ia.prototype.hide = function () { oa(this._overlayRoot, !1) }, ia.prototype.clear = function () { this._overlays = {}, this._overlayContainers = [], Q(this._overlayRoot) }, ia.prototype._updateOverlayContainer = function (e) { var t = e.element, n = e.html, i = t.x, r = t.y; if (t.waypoints) { var o = vt(t); i = o.x, r = o.y } ra(n, i, r), K(e.html, "data-container-id", t.id) }, ia.prototype._updateOverlay = function (e) { var t, n, i = e.position, r = e.htmlContainer, o = e.element, a = i.left, s = i.top; void 0 !== i.right && (t = o.waypoints ? vt(o).width : o.width, a = -1 * i.right + t); void 0 !== i.bottom && (n = o.waypoints ? vt(o).height : o.height, s = -1 * i.bottom + n); ra(r, a || 0, s || 0), this._updateOverlayVisibilty(e, this._canvas.viewbox()) }, ia.prototype._createOverlayContainer = function (e) { var t = de('<div class="djs-overlays" />'); q(t, { position: "absolute" }), this._overlayRoot.appendChild(t); var n = { html: t, element: e, overlays: [] }; return this._updateOverlayContainer(n), this._overlayContainers.push(n), n }, ia.prototype._updateRoot = function (e) { var t = e.scale || 1, n = "matrix(" + [t, 0, 0, t, -1 * e.x * t, -1 * e.y * t].join(",") + ")"; aa(this._overlayRoot, n) }, ia.prototype._getOverlayContainer = function (e, t) { var n = m(this._overlayContainers, (function (t) { return t.element === e })); return n || t ? n : this._createOverlayContainer(e) }, ia.prototype._addOverlay = function (e) { var t, n, i = e.id, r = e.element, o = e.html; o.get && o.constructor.prototype.jquery && (o = o.get(0)), d(o) && (o = de(o)), n = this._getOverlayContainer(r), q(t = de('<div class="djs-overlay" data-overlay-id="' + i + '">'), { position: "absolute" }), t.appendChild(o), e.type && X(t).add("djs-overlay-" + e.type), oa(t, this._canvas.findRoot(r) === this._canvas.getRootElement()), e.htmlContainer = t, n.overlays.push(e), n.html.appendChild(t), this._overlays[i] = e, this._updateOverlay(e), this._updateOverlayVisibilty(e, this._canvas.viewbox()) }, ia.prototype._updateOverlayVisibilty = function (e, t) { var n = e.show, i = this._canvas.findRoot(e.element), r = n && n.minZoom, o = n && n.maxZoom, a = e.htmlContainer, c = !0; (i !== this._canvas.getRootElement() || n && (s(r) && r > t.scale || s(o) && o < t.scale)) && (c = !1), oa(a, c), this._updateOverlayScale(e, t) }, ia.prototype._updateOverlayScale = function (e, t) { var n, i, r, o = e.scale, a = e.htmlContainer, c = ""; !0 !== o && (!1 === o ? (n = 1, i = 1) : (n = o.min, i = o.max), s(n) && t.scale < n && (r = (1 / t.scale || 1) * n), s(i) && t.scale > i && (r = (1 / t.scale || 1) * i)), s(r) && (c = "scale(" + r + "," + r + ")"), aa(a, c) }, ia.prototype._updateOverlaysVisibilty = function (e) { var t = this; g(this._overlays, (function (n) { t._updateOverlayVisibilty(n, e) })) }, ia.prototype._init = function () { var e = this._eventBus, t = this; e.on("canvas.viewbox.changing", (function (e) { t.hide() })), e.on("canvas.viewbox.changed", (function (e) { var n; n = e.viewbox, t._updateRoot(n), t._updateOverlaysVisibilty(n), t.show() })), e.on(["shape.remove", "connection.remove"], (function (e) { var n = e.element; g(t.get({ element: n }), (function (e) { t.remove(e.id) })); var i = t._getOverlayContainer(n); if (i) { ve(i.html); var r = t._overlayContainers.indexOf(i); -1 !== r && t._overlayContainers.splice(r, 1) } })), e.on("element.changed", 500, (function (e) { var n = e.element, i = t._getOverlayContainer(n, !0); i && (g(i.overlays, (function (e) { t._updateOverlay(e) })), t._updateOverlayContainer(i)) })), e.on("element.marker.update", (function (e) { var n = t._getOverlayContainer(e.element, !0); n && X(n.html)[e.add ? "add" : "remove"](e.marker) })), e.on("root.set", (function () { t._updateOverlaysVisibilty(t._canvas.viewbox()) })), e.on("diagram.clear", this.clear, this) }; var sa = { __init__: ["overlays"], overlays: ["type", ia] }; function ca(e, t, n, i) { e.on("element.changed", (function (i) { var r = i.element; (r.parent || r === t.getRootElement()) && (i.gfx = n.getGraphics(r)), i.gfx && e.fire(yt(r) + ".changed", i) })), e.on("elements.changed", (function (t) { var n = t.elements; n.forEach((function (t) { e.fire("element.changed", { element: t }) })), i.updateContainments(n) })), e.on("shape.changed", (function (e) { i.update("shape", e.element, e.gfx) })), e.on("connection.changed", (function (e) { i.update("connection", e.element, e.gfx) })) } ca.$inject = ["eventBus", "canvas", "elementRegistry", "graphicsFactory"]; var pa = { __init__: ["changeSupport"], changeSupport: ["type", ca] }; function la(e) { this._eventBus = e } function ua(e) { return function (t, n, i, r, o) { (h(t) || u(t)) && (o = r, r = i, i = n, n = t, t = null), this.on(t, e, n, i, r, o) } } function ha(e, t) { t.invoke(la, this), this.executed((function (t) { var n = t.context; n.rootElement ? e.setRootElement(n.rootElement) : n.rootElement = e.getRootElement() })), this.revert((function (t) { var n = t.context; n.rootElement && e.setRootElement(n.rootElement) })) } la.$inject = ["eventBus"], la.prototype.on = function (e, t, n, i, r, o) { if ((h(t) || u(t)) && (o = r, r = i, i = n, n = t, t = null), h(n) && (o = r, r = i, i = n, n = 1e3), l(r) && (o = r, r = !1), !h(i)) throw new Error("handlerFn must be a function"); p(e) || (e = [e]); var a = this._eventBus; g(e, (function (e) { var s = ["commandStack", e, t].filter((function (e) { return e })).join("."); a.on(s, n, r ? function (e, t) { return function (n) { return e.call(t || null, n.context, n.command, n) } }(i, o) : i, o) })) }, la.prototype.canExecute = ua("canExecute"), la.prototype.preExecute = ua("preExecute"), la.prototype.preExecuted = ua("preExecuted"), la.prototype.execute = ua("execute"), la.prototype.executed = ua("executed"), la.prototype.postExecute = ua("postExecute"), la.prototype.postExecuted = ua("postExecuted"), la.prototype.revert = ua("revert"), la.prototype.reverted = ua("reverted"), e(ha, la), ha.$inject = ["canvas", "injector"]; var da = { __init__: ["rootElementsBehavior"], rootElementsBehavior: ["type", ha] }; function fa(e) { return CSS.escape(e) } var ma = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }; function va(e) { return (e = "" + e) && e.replace(/[&<>"']/g, (function (e) { return ma[e] })) } var ya = "_plane"; function ga(e) { return function (e) { return e.replace(new RegExp(ya + "$"), "") }(e.id) } function _a(e) { var t = e.id; return Er(e, "bpmn:SubProcess") ? wa(t) : t } function ba(e) { return wa(e) } function xa(e) { return Er(kr(e), "bpmndi:BPMNPlane") } function wa(e) { return e + ya } function Ea(e, t, n) { var i = de('<ul class="bjs-breadcrumbs"></ul>'), r = n.getContainer(), o = X(r); r.appendChild(i); var a = []; function s(e) { e && (a = function (e) { for (var t = Cr(e), n = [], i = t; i; i = i.$parent)(Er(i, "bpmn:SubProcess") || Er(i, "bpmn:Process")) && n.push(i); return n.reverse() }(e)); var r = a.map((function (e) { var i = va(e.name || e.id), r = de('<li><span class="bjs-crumb"><a title="' + i + '">' + i + "</a></span></li>"), o = n.findRoot(_a(e)) || n.findRoot(e.id); if (!o && Er(e, "bpmn:Process")) { var a = t.find((function (t) { var n = Cr(t); return n && n.get("processRef") && n.get("processRef") === e })); o = n.findRoot(a.id) } return r.addEventListener("click", (function () { n.setRootElement(o) })), r })); i.innerHTML = ""; var s = r.length > 1; o.toggle("bjs-breadcrumbs-shown", s), r.forEach((function (e) { i.appendChild(e) })) } e.on("element.changed", (function (e) { var t = Cr(e.element); m(a, (function (e) { return e === t })) && s() })), e.on("root.set", (function (e) { s(e.element) })) } function Sa(e, t) { var n = null, i = new Ca; e.on("root.set", (function (e) { var r = e.element, o = t.viewbox(), a = i.get(r); if (i.set(n, { x: o.x, y: o.y, zoom: o.scale }), n = r, !Er(r, "bpmn:Collaboration") || a) { a = a || { x: 0, y: 0, zoom: 1 }; var s = (o.x - a.x) * o.scale, c = (o.y - a.y) * o.scale; 0 === s && 0 === c || t.scroll({ dx: s, dy: c }), a.zoom !== o.scale && t.zoom(a.zoom, { x: 0, y: 0 }) } })), e.on("diagram.clear", (function () { i.clear(), n = null })) } function Ca() { this._entries = [], this.set = function (e, t) { var n = !1; for (var i in this._entries) if (this._entries[i][0] === e) { this._entries[i][1] = t, n = !0; break } n || this._entries.push([e, t]) }, this.get = function (e) { for (var t in this._entries) if (this._entries[t][0] === e) return this._entries[t][1]; return null }, this.clear = function () { this._entries.length = 0 }, this.remove = function (e) { var t = -1; for (var n in this._entries) if (this._entries[n][0] === e) { t = n; break } -1 !== t && this._entries.splice(t, 1) } } Ea.$inject = ["eventBus", "elementRegistry", "canvas"], Sa.$inject = ["eventBus", "canvas"]; var ka = 180, Ra = 160; function Pa(e, t) { this._eventBus = e, this._moddle = t; var n = this; e.on("import.render.start", 1500, (function (e, t) { n._handleImport(t.definitions) })) } function Ta(e) { return Er(e, "bpmndi:BPMNDiagram") ? e : Ta(e.$parent) } Pa.prototype._handleImport = function (e) { if (e.diagrams) { var t = this; this._definitions = e, this._processToDiagramMap = {}, e.diagrams.forEach((function (e) { e.plane && e.plane.bpmnElement && (t._processToDiagramMap[e.plane.bpmnElement.id] = e) })); var n = []; e.diagrams.forEach((function (e) { var i = t._createNewDiagrams(e.plane); Array.prototype.push.apply(n, i) })), n.forEach((function (e) { t._movePlaneElementsToOrigin(e.plane) })) } }, Pa.prototype._createNewDiagrams = function (e) { var t = this, n = [], i = []; e.get("planeElement").forEach((function (t) { var r = t.bpmnElement; if (r) { var o = r.$parent; Er(r, "bpmn:SubProcess") && !t.isExpanded && n.push(r), function (e, t) { var n = e.$parent; if (!Er(n, "bpmn:SubProcess") || n === t.bpmnElement) return !1; if (Sr(e, ["bpmn:DataInputAssociation", "bpmn:DataOutputAssociation"])) return !1; return !0 }(r, e) && i.push({ diElement: t, parent: o }) } })); var r = []; return n.forEach((function (e) { if (!t._processToDiagramMap[e.id]) { var n = t._createDiagram(e); t._processToDiagramMap[e.id] = n, r.push(n) } })), i.forEach((function (e) { for (var i = e.diElement, r = e.parent; r && -1 === n.indexOf(r);)r = r.$parent; if (r) { var o = t._processToDiagramMap[r.id]; t._moveToDiPlane(i, o.plane) } })), r }, Pa.prototype._movePlaneElementsToOrigin = function (e) { var t = e.get("planeElement"), n = function (e) { var t = { top: 1 / 0, right: -1 / 0, bottom: -1 / 0, left: 1 / 0 }; return e.planeElement.forEach((function (e) { if (e.bounds) { var n = mn(e.bounds); t.top = Math.min(n.top, t.top), t.left = Math.min(n.left, t.left) } })), vn(t) }(e), i = n.x - ka, r = n.y - Ra; t.forEach((function (e) { e.waypoint ? e.waypoint.forEach((function (e) { e.x = e.x - i, e.y = e.y - r })) : e.bounds && (e.bounds.x = e.bounds.x - i, e.bounds.y = e.bounds.y - r) })) }, Pa.prototype._moveToDiPlane = function (e, t) { var n = Ta(e).plane.get("planeElement"); n.splice(n.indexOf(e), 1), t.get("planeElement").push(e) }, Pa.prototype._createDiagram = function (e) { var t = this._moddle.create("bpmndi:BPMNPlane", { bpmnElement: e }), n = this._moddle.create("bpmndi:BPMNDiagram", { plane: t }); return t.$parent = n, t.bpmnElement = e, n.$parent = this._definitions, this._definitions.diagrams.push(n), n }, Pa.$inject = ["eventBus", "moddle"]; var Aa = 250; function Ma(e, t, n, i) { la.call(this, t), this._canvas = e, this._eventBus = t, this._elementRegistry = n, this._overlays = i; var r = this; this.executed("shape.toggleCollapse", Aa, (function (e) { var t = e.shape; r._canDrillDown(t) ? r._addOverlay(t) : r._removeOverlay(t) }), !0), this.reverted("shape.toggleCollapse", Aa, (function (e) { var t = e.shape; r._canDrillDown(t) ? r._addOverlay(t) : r._removeOverlay(t) }), !0), this.executed(["shape.create", "shape.move", "shape.delete"], Aa, (function (e) { var t = e.oldParent, n = e.newParent || e.parent, i = e.shape; r._canDrillDown(i) && r._addOverlay(i), r._updateDrilldownOverlay(t), r._updateDrilldownOverlay(n), r._updateDrilldownOverlay(i) }), !0), this.reverted(["shape.create", "shape.move", "shape.delete"], Aa, (function (e) { var t = e.oldParent, n = e.newParent || e.parent, i = e.shape; r._canDrillDown(i) && r._addOverlay(i), r._updateDrilldownOverlay(t), r._updateDrilldownOverlay(n), r._updateDrilldownOverlay(i) }), !0), t.on("import.render.complete", (function () { n.filter((function (e) { return r._canDrillDown(e) })).map((function (e) { r._addOverlay(e) })) })) } e(Ma, la), Ma.prototype._updateDrilldownOverlay = function (e) { var t = this._canvas; if (e) { var n = t.findRoot(e); n && this._updateOverlayVisibility(n) } }, Ma.prototype._canDrillDown = function (e) { var t = this._canvas; return Er(e, "bpmn:SubProcess") && t.findRoot(_a(e)) }, Ma.prototype._updateOverlayVisibility = function (e) { var t = this._overlays, n = Cr(e), i = t.get({ element: n.id, type: "drilldown" })[0]; if (i) { var r = n && n.get("flowElements") && n.get("flowElements").length; X(i.html).toggle("bjs-drilldown-empty", !r) } }, Ma.prototype._addOverlay = function (e) { var t = this._canvas, n = this._overlays; n.get({ element: e, type: "drilldown" }).length && this._removeOverlay(e); var i = de('<button class="bjs-drilldown"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z"/></svg></button>'); i.addEventListener("click", (function () { t.setRootElement(t.findRoot(_a(e))) })), n.add(e, "drilldown", { position: { bottom: -7, right: -8 }, html: i }), this._updateOverlayVisibility(e) }, Ma.prototype._removeOverlay = function (e) { this._overlays.remove({ element: e, type: "drilldown" }) }, Ma.$inject = ["canvas", "eventBus", "elementRegistry", "overlays"]; var Da = { __depends__: [sa, pa, da], __init__: ["drilldownBreadcrumbs", "drilldownOverlayBehavior", "drilldownCentering", "subprocessCompatibility"], drilldownBreadcrumbs: ["type", Ea], drilldownCentering: ["type", Sa], drilldownOverlayBehavior: ["type", Ma], subprocessCompatibility: ["type", Pa] }; function Ba(e) { Ir.call(this, e) } e(Ba, Ir), Ba.prototype._modules = [Do, Ro, ea, sa, Da], Ba.prototype._moddleExtensions = {}; var Na = ["c", "C"], Oa = ["v", "V"], ja = ["y", "Y"], La = ["z", "Z"]; function Ia(e) { return !e.altKey && (e.ctrlKey || e.metaKey) } function $a(e, t) { return -1 !== (e = p(e) ? e : [e]).indexOf(t.key) || -1 !== e.indexOf(t.code) } function Fa(e) { return e.shiftKey } var za = "keyboard.keydown", Ha = "input-handle-modified-keys"; function Va(e, t) { var n = this; this._config = e || {}, this._eventBus = t, this._keydownHandler = this._keydownHandler.bind(this), this._keyupHandler = this._keyupHandler.bind(this), t.on("diagram.destroy", (function () { n._fire("destroy"), n.unbind() })), t.on("diagram.init", (function () { n._fire("init") })), t.on("attach", (function () { e && e.bindTo && n.bind(e.bindTo) })), t.on("detach", (function () { n.unbind() })) } Va.$inject = ["config.keyboard", "eventBus"], Va.prototype._keydownHandler = function (e) { this._keyHandler(e, za) }, Va.prototype._keyupHandler = function (e) { this._keyHandler(e, "keyboard.keyup") }, Va.prototype._keyHandler = function (e, t) { if (!this._isEventIgnored(e)) { var n = { keyEvent: e }; this._eventBus.fire(t || za, n) && e.preventDefault() } }, Va.prototype._isEventIgnored = function (e) { return !!e.defaultPrevented || (t = e.target) && (J(t, "input, textarea") || "true" === t.contentEditable) && this._isModifiedKeyIgnored(e); var t }, Va.prototype._isModifiedKeyIgnored = function (e) { return !Ia(e) || -1 === this._getAllowedModifiers(e.target).indexOf(e.key) }, Va.prototype._getAllowedModifiers = function (e) { var t = ee(e, "[" + Ha + "]", !0); return !t || this._node && !this._node.contains(t) ? [] : t.getAttribute(Ha).split(",") }, Va.prototype.bind = function (e) { this.unbind(), this._node = e, ae.bind(e, "keydown", this._keydownHandler), ae.bind(e, "keyup", this._keyupHandler), this._fire("bind") }, Va.prototype.getBinding = function () { return this._node }, Va.prototype.unbind = function () { var e = this._node; e && (this._fire("unbind"), ae.unbind(e, "keydown", this._keydownHandler), ae.unbind(e, "keyup", this._keyupHandler)), this._node = null }, Va.prototype._fire = function (e) { this._eventBus.fire("keyboard." + e, { node: this._node }) }, Va.prototype.addListener = function (e, t, n) { h(e) && (n = t, t = e, e = 1e3), this._eventBus.on(n || za, e, t) }, Va.prototype.removeListener = function (e, t) { this._eventBus.off(t || za, e) }, Va.prototype.hasModifier = function (e) { return e.ctrlKey || e.metaKey || e.shiftKey || e.altKey }, Va.prototype.isCmd = Ia, Va.prototype.isShift = Fa, Va.prototype.isKey = $a; var Wa = 500; function Ga(e, t) { var n = this; e.on("editorActions.init", Wa, (function (e) { var i = e.editorActions; n.registerBindings(t, i) })) } Ga.$inject = ["eventBus", "keyboard"], Ga.prototype.registerBindings = function (e, t) { function n(n, i) { t.isRegistered(n) && e.addListener(i) } n("undo", (function (e) { if (function (e) { return Ia(e) && !Fa(e) && $a(La, e) }(e.keyEvent)) return t.trigger("undo"), !0 })), n("redo", (function (e) { if (function (e) { return Ia(e) && ($a(ja, e) || $a(La, e) && Fa(e)) }(e.keyEvent)) return t.trigger("redo"), !0 })), n("copy", (function (e) { if (function (e) { return Ia(e) && $a(Na, e) }(e.keyEvent)) return t.trigger("copy"), !0 })), n("paste", (function (e) { if (function (e) { return Ia(e) && $a(Oa, e) }(e.keyEvent)) return t.trigger("paste"), !0 })), n("stepZoom", (function (e) { var n = e.keyEvent; if ($a(["+", "Add", "="], n) && Ia(n)) return t.trigger("stepZoom", { value: 1 }), !0 })), n("stepZoom", (function (e) { var n = e.keyEvent; if ($a(["-", "Subtract"], n) && Ia(n)) return t.trigger("stepZoom", { value: -1 }), !0 })), n("zoom", (function (e) { var n = e.keyEvent; if ($a("0", n) && Ia(n)) return t.trigger("zoom", { value: 1 }), !0 })), n("removeSelection", (function (e) { if ($a(["Backspace", "Delete", "Del"], e.keyEvent)) return t.trigger("removeSelection"), !0 })) }; var Ua = { __init__: ["keyboard", "keyboardBindings"], keyboard: ["type", Va], keyboardBindings: ["type", Ga] }, qa = { moveSpeed: 50, moveSpeedAccelerated: 200 }; function Ka(e, t, n) { var i = this; this._config = L({}, qa, e || {}), t.addListener((function (e) { var n = e.keyEvent, r = i._config; if (!t.isCmd(n)) return; if (t.isKey(["ArrowLeft", "Left", "ArrowUp", "Up", "ArrowDown", "Down", "ArrowRight", "Right"], n)) { var o, a = t.isShift(n) ? r.moveSpeedAccelerated : r.moveSpeed; switch (n.key) { case "ArrowLeft": case "Left": o = "left"; break; case "ArrowUp": case "Up": o = "up"; break; case "ArrowRight": case "Right": o = "right"; break; case "ArrowDown": case "Down": o = "down" }return i.moveCanvas({ speed: a, direction: o }), !0 } })), this.moveCanvas = function (e) { var t = 0, i = 0, r = e.speed / Math.min(Math.sqrt(n.viewbox().scale), 1); switch (e.direction) { case "left": t = r; break; case "up": i = r; break; case "right": t = -r; break; case "down": i = -r }n.scroll({ dx: t, dy: i }) } } Ka.$inject = ["config.keyboardMove", "keyboard", "canvas"]; var Ya = { __depends__: [Ua], __init__: ["keyboardMove"], keyboardMove: ["type", Ka] }, Xa = /^djs-cursor-.*$/; function Za(e) { var t = X(document.body); t.removeMatching(Xa), e && t.add("djs-cursor-" + e) } function Qa() { Za(null) } var Ja = 5e3; function es(e, t) { function n() { return !1 } return t = t || "element.click", e.once(t, Ja, n), function () { e.off(t, n) } } function ts(e) { return { x: e.x + e.width / 2, y: e.y + e.height / 2 } } function ns(e, t) { return { x: e.x - t.x, y: e.y - t.y } } function is(e, t) { var n; function i(i) { var r, o = n.start, a = n.button, s = jo(i), c = ns(s, o); (!n.dragging && (r = c, Math.sqrt(Math.pow(r.x, 2) + Math.pow(r.y, 2)) > 15) && (n.dragging = !0, 0 === a && es(e), Za("grab")), n.dragging) && (c = ns(s, n.last || n.start), t.scroll({ dx: c.x, dy: c.y }), n.last = s); i.preventDefault() } function r(e) { ae.unbind(document, "mousemove", i), ae.unbind(document, "mouseup", r), n = null, Qa() } e.on("element.mousedown", 500, (function (e) { return function (e) { if (ee(e.target, ".djs-draggable")) return; var t = e.button; if (t >= 2 || e.ctrlKey || e.shiftKey || e.altKey) return; return n = { button: t, start: jo(e) }, ae.bind(document, "mousemove", i), ae.bind(document, "mouseup", r), !0 }(e.originalEvent) })), this.isActive = function () { return !!n } } is.$inject = ["eventBus", "canvas"]; var rs = { __init__: ["moveCanvas"], moveCanvas: ["type", is] }; function os(e) { return Math.log(e) / Math.log(10) } function as(e, t) { var n = os(e.min), i = os(e.max); return (Math.abs(n) + Math.abs(i)) / t } var ss = Math.sign || function (e) { return e >= 0 ? 1 : -1 }, cs = { min: .2, max: 4 }; function ps(e, t, n) { e = e || {}, this._enabled = !1, this._canvas = n, this._container = n._container, this._handleWheel = j(this._handleWheel, this), this._totalDelta = 0, this._scale = e.scale || .75; var i = this; t.on("canvas.init", (function (t) { i._init(!1 !== e.enabled) })) } ps.$inject = ["config.zoomScroll", "eventBus", "canvas"], ps.prototype.scroll = function (e) { this._canvas.scroll(e) }, ps.prototype.reset = function () { this._canvas.zoom("fit-viewport") }, ps.prototype.zoom = function (e, t) { var n = as(cs, 20); this._totalDelta += e, Math.abs(this._totalDelta) > .1 && (this._zoom(e, t, n), this._totalDelta = 0) }, ps.prototype._handleWheel = function (e) { if (!ee(e.target, ".djs-scrollable", !0)) { var t = this._container; e.preventDefault(); var n, i = e.ctrlKey || Lo() && e.metaKey, r = e.shiftKey, o = -1 * this._scale; if (o *= i ? 0 === e.deltaMode ? .02 : .32 : 0 === e.deltaMode ? 1 : 16, i) { var a = t.getBoundingClientRect(), s = { x: e.clientX - a.left, y: e.clientY - a.top }; n = Math.sqrt(Math.pow(e.deltaY, 2) + Math.pow(e.deltaX, 2)) * ss(e.deltaY) * o, this.zoom(n, s) } else n = r ? { dx: o * e.deltaY, dy: 0 } : { dx: o * e.deltaX, dy: o * e.deltaY }, this.scroll(n) } }, ps.prototype.stepZoom = function (e, t) { var n = as(cs, 10); this._zoom(e, t, n) }, ps.prototype._zoom = function (e, t, n) { var i = this._canvas, r = e > 0 ? 1 : -1, o = os(i.zoom()), a = Math.round(o / n) * n; a += n * r; var s, c, p = Math.pow(10, a); i.zoom((s = cs, c = p, Math.max(s.min, Math.min(s.max, c))), t) }, ps.prototype.toggle = function (e) { var t = this._container, n = this._handleWheel, i = this._enabled; return void 0 === e && (e = !i), i !== e && ae[e ? "bind" : "unbind"](t, "wheel", n, !1), this._enabled = e, e }, ps.prototype._init = function (e) { this.toggle(e) }; var ls = { __init__: ["zoomScroll"], zoomScroll: ["type", ps] }; function us(e) { Ba.call(this, e) } function hs(e) { return e && e.__esModule && Object.prototype.hasOwnProperty.call(e, "default") ? e.default : e } e(us, Ba), us.prototype._navigationModules = [Ya, rs, ls], us.prototype._modules = [].concat(Ba.prototype._modules, us.prototype._navigationModules); var ds = { exports: {} };
/*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */!function (e) { !function (t, n, i, r) { var o, a = ["", "webkit", "Moz", "MS", "ms", "o"], s = n.createElement("div"), c = "function", p = Math.round, l = Math.abs, u = Date.now; function h(e, t, n) { return setTimeout(_(e, n), t) } function d(e, t, n) { return !!Array.isArray(e) && (f(e, n[t], n), !0) } function f(e, t, n) { var i; if (e) if (e.forEach) e.forEach(t, n); else if (e.length !== r) for (i = 0; i < e.length;)t.call(n, e[i], i, e), i++; else for (i in e) e.hasOwnProperty(i) && t.call(n, e[i], i, e) } function m(e, n, i) { var r = "DEPRECATED METHOD: " + n + "\n" + i + " AT \n"; return function () { var n = new Error("get-stack-trace"), i = n && n.stack ? n.stack.replace(/^[^\(]+?[\n$]/gm, "").replace(/^\s+at\s+/gm, "").replace(/^Object.<anonymous>\s*\(/gm, "{anonymous}()@") : "Unknown Stack Trace", o = t.console && (t.console.warn || t.console.log); return o && o.call(t.console, r, i), e.apply(this, arguments) } } o = "function" != typeof Object.assign ? function (e) { if (e === r || null === e) throw new TypeError("Cannot convert undefined or null to object"); for (var t = Object(e), n = 1; n < arguments.length; n++) { var i = arguments[n]; if (i !== r && null !== i) for (var o in i) i.hasOwnProperty(o) && (t[o] = i[o]) } return t } : Object.assign; var v = m((function (e, t, n) { for (var i = Object.keys(t), o = 0; o < i.length;)(!n || n && e[i[o]] === r) && (e[i[o]] = t[i[o]]), o++; return e }), "extend", "Use `assign`."), y = m((function (e, t) { return v(e, t, !0) }), "merge", "Use `assign`."); function g(e, t, n) { var i, r = t.prototype; (i = e.prototype = Object.create(r)).constructor = e, i._super = r, n && o(i, n) } function _(e, t) { return function () { return e.apply(t, arguments) } } function b(e, t) { return typeof e == c ? e.apply(t && t[0] || r, t) : e } function x(e, t) { return e === r ? t : e } function w(e, t, n) { f(k(t), (function (t) { e.addEventListener(t, n, !1) })) } function E(e, t, n) { f(k(t), (function (t) { e.removeEventListener(t, n, !1) })) } function S(e, t) { for (; e;) { if (e == t) return !0; e = e.parentNode } return !1 } function C(e, t) { return e.indexOf(t) > -1 } function k(e) { return e.trim().split(/\s+/g) } function R(e, t, n) { if (e.indexOf && !n) return e.indexOf(t); for (var i = 0; i < e.length;) { if (n && e[i][n] == t || !n && e[i] === t) return i; i++ } return -1 } function P(e) { return Array.prototype.slice.call(e, 0) } function T(e, t, n) { for (var i = [], r = [], o = 0; o < e.length;) { var a = t ? e[o][t] : e[o]; R(r, a) < 0 && i.push(e[o]), r[o] = a, o++ } return n && (i = t ? i.sort((function (e, n) { return e[t] > n[t] })) : i.sort()), i } function A(e, t) { for (var n, i, o = t[0].toUpperCase() + t.slice(1), s = 0; s < a.length;) { if ((i = (n = a[s]) ? n + o : t) in e) return i; s++ } return r } var M = 1; function D(e) { var n = e.ownerDocument || e; return n.defaultView || n.parentWindow || t } var B = "ontouchstart" in t, N = A(t, "PointerEvent") !== r, O = B && /mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent), j = "touch", L = "mouse", I = 25, $ = 1, F = 4, z = 8, H = 1, V = 2, W = 4, G = 8, U = 16, q = V | W, K = G | U, Y = q | K, X = ["x", "y"], Z = ["clientX", "clientY"]; function Q(e, t) { var n = this; this.manager = e, this.callback = t, this.element = e.element, this.target = e.options.inputTarget, this.domHandler = function (t) { b(e.options.enable, [e]) && n.handler(t) }, this.init() } function J(e, t, n) { var i = n.pointers.length, o = n.changedPointers.length, a = t & $ && i - o == 0, s = t & (F | z) && i - o == 0; n.isFirst = !!a, n.isFinal = !!s, a && (e.session = {}), n.eventType = t, function (e, t) { var n = e.session, i = t.pointers, o = i.length; n.firstInput || (n.firstInput = ee(t)); o > 1 && !n.firstMultiple ? n.firstMultiple = ee(t) : 1 === o && (n.firstMultiple = !1); var a = n.firstInput, s = n.firstMultiple, c = s ? s.center : a.center, p = t.center = te(i); t.timeStamp = u(), t.deltaTime = t.timeStamp - a.timeStamp, t.angle = oe(c, p), t.distance = re(c, p), function (e, t) { var n = t.center, i = e.offsetDelta || {}, r = e.prevDelta || {}, o = e.prevInput || {}; t.eventType !== $ && o.eventType !== F || (r = e.prevDelta = { x: o.deltaX || 0, y: o.deltaY || 0 }, i = e.offsetDelta = { x: n.x, y: n.y }); t.deltaX = r.x + (n.x - i.x), t.deltaY = r.y + (n.y - i.y) }(n, t), t.offsetDirection = ie(t.deltaX, t.deltaY); var h = ne(t.deltaTime, t.deltaX, t.deltaY); t.overallVelocityX = h.x, t.overallVelocityY = h.y, t.overallVelocity = l(h.x) > l(h.y) ? h.x : h.y, t.scale = s ? (d = s.pointers, f = i, re(f[0], f[1], Z) / re(d[0], d[1], Z)) : 1, t.rotation = s ? function (e, t) { return oe(t[1], t[0], Z) + oe(e[1], e[0], Z) }(s.pointers, i) : 0, t.maxPointers = n.prevInput ? t.pointers.length > n.prevInput.maxPointers ? t.pointers.length : n.prevInput.maxPointers : t.pointers.length, function (e, t) { var n, i, o, a, s = e.lastInterval || t, c = t.timeStamp - s.timeStamp; if (t.eventType != z && (c > I || s.velocity === r)) { var p = t.deltaX - s.deltaX, u = t.deltaY - s.deltaY, h = ne(c, p, u); i = h.x, o = h.y, n = l(h.x) > l(h.y) ? h.x : h.y, a = ie(p, u), e.lastInterval = t } else n = s.velocity, i = s.velocityX, o = s.velocityY, a = s.direction; t.velocity = n, t.velocityX = i, t.velocityY = o, t.direction = a }(n, t); var d, f; var m = e.element; S(t.srcEvent.target, m) && (m = t.srcEvent.target); t.target = m }(e, n), e.emit("hammer.input", n), e.recognize(n), e.session.prevInput = n } function ee(e) { for (var t = [], n = 0; n < e.pointers.length;)t[n] = { clientX: p(e.pointers[n].clientX), clientY: p(e.pointers[n].clientY) }, n++; return { timeStamp: u(), pointers: t, center: te(t), deltaX: e.deltaX, deltaY: e.deltaY } } function te(e) { var t = e.length; if (1 === t) return { x: p(e[0].clientX), y: p(e[0].clientY) }; for (var n = 0, i = 0, r = 0; r < t;)n += e[r].clientX, i += e[r].clientY, r++; return { x: p(n / t), y: p(i / t) } } function ne(e, t, n) { return { x: t / e || 0, y: n / e || 0 } } function ie(e, t) { return e === t ? H : l(e) >= l(t) ? e < 0 ? V : W : t < 0 ? G : U } function re(e, t, n) { n || (n = X); var i = t[n[0]] - e[n[0]], r = t[n[1]] - e[n[1]]; return Math.sqrt(i * i + r * r) } function oe(e, t, n) { n || (n = X); var i = t[n[0]] - e[n[0]], r = t[n[1]] - e[n[1]]; return 180 * Math.atan2(r, i) / Math.PI } Q.prototype = { handler: function () { }, init: function () { this.evEl && w(this.element, this.evEl, this.domHandler), this.evTarget && w(this.target, this.evTarget, this.domHandler), this.evWin && w(D(this.element), this.evWin, this.domHandler) }, destroy: function () { this.evEl && E(this.element, this.evEl, this.domHandler), this.evTarget && E(this.target, this.evTarget, this.domHandler), this.evWin && E(D(this.element), this.evWin, this.domHandler) } }; var ae = { mousedown: $, mousemove: 2, mouseup: F }, se = "mousedown", ce = "mousemove mouseup"; function pe() { this.evEl = se, this.evWin = ce, this.pressed = !1, Q.apply(this, arguments) } g(pe, Q, { handler: function (e) { var t = ae[e.type]; t & $ && 0 === e.button && (this.pressed = !0), 2 & t && 1 !== e.which && (t = F), this.pressed && (t & F && (this.pressed = !1), this.callback(this.manager, t, { pointers: [e], changedPointers: [e], pointerType: L, srcEvent: e })) } }); var le = { pointerdown: $, pointermove: 2, pointerup: F, pointercancel: z, pointerout: z }, ue = { 2: j, 3: "pen", 4: L, 5: "kinect" }, he = "pointerdown", de = "pointermove pointerup pointercancel"; function fe() { this.evEl = he, this.evWin = de, Q.apply(this, arguments), this.store = this.manager.session.pointerEvents = [] } t.MSPointerEvent && !t.PointerEvent && (he = "MSPointerDown", de = "MSPointerMove MSPointerUp MSPointerCancel"), g(fe, Q, { handler: function (e) { var t = this.store, n = !1, i = e.type.toLowerCase().replace("ms", ""), r = le[i], o = ue[e.pointerType] || e.pointerType, a = o == j, s = R(t, e.pointerId, "pointerId"); r & $ && (0 === e.button || a) ? s < 0 && (t.push(e), s = t.length - 1) : r & (F | z) && (n = !0), s < 0 || (t[s] = e, this.callback(this.manager, r, { pointers: t, changedPointers: [e], pointerType: o, srcEvent: e }), n && t.splice(s, 1)) } }); var me = { touchstart: $, touchmove: 2, touchend: F, touchcancel: z }; function ve() { this.evTarget = "touchstart", this.evWin = "touchstart touchmove touchend touchcancel", this.started = !1, Q.apply(this, arguments) } function ye(e, t) { var n = P(e.touches), i = P(e.changedTouches); return t & (F | z) && (n = T(n.concat(i), "identifier", !0)), [n, i] } g(ve, Q, { handler: function (e) { var t = me[e.type]; if (t === $ && (this.started = !0), this.started) { var n = ye.call(this, e, t); t & (F | z) && n[0].length - n[1].length == 0 && (this.started = !1), this.callback(this.manager, t, { pointers: n[0], changedPointers: n[1], pointerType: j, srcEvent: e }) } } }); var ge = { touchstart: $, touchmove: 2, touchend: F, touchcancel: z }, _e = "touchstart touchmove touchend touchcancel"; function be() { this.evTarget = _e, this.targetIds = {}, Q.apply(this, arguments) } function xe(e, t) { var n = P(e.touches), i = this.targetIds; if (t & (2 | $) && 1 === n.length) return i[n[0].identifier] = !0, [n, n]; var r, o, a = P(e.changedTouches), s = [], c = this.target; if (o = n.filter((function (e) { return S(e.target, c) })), t === $) for (r = 0; r < o.length;)i[o[r].identifier] = !0, r++; for (r = 0; r < a.length;)i[a[r].identifier] && s.push(a[r]), t & (F | z) && delete i[a[r].identifier], r++; return s.length ? [T(o.concat(s), "identifier", !0), s] : void 0 } g(be, Q, { handler: function (e) { var t = ge[e.type], n = xe.call(this, e, t); n && this.callback(this.manager, t, { pointers: n[0], changedPointers: n[1], pointerType: j, srcEvent: e }) } }); var we = 2500; function Ee() { Q.apply(this, arguments); var e = _(this.handler, this); this.touch = new be(this.manager, e), this.mouse = new pe(this.manager, e), this.primaryTouch = null, this.lastTouches = [] } function Se(e, t) { e & $ ? (this.primaryTouch = t.changedPointers[0].identifier, Ce.call(this, t)) : e & (F | z) && Ce.call(this, t) } function Ce(e) { var t = e.changedPointers[0]; if (t.identifier === this.primaryTouch) { var n = { x: t.clientX, y: t.clientY }; this.lastTouches.push(n); var i = this.lastTouches; setTimeout((function () { var e = i.indexOf(n); e > -1 && i.splice(e, 1) }), we) } } function ke(e) { for (var t = e.srcEvent.clientX, n = e.srcEvent.clientY, i = 0; i < this.lastTouches.length; i++) { var r = this.lastTouches[i], o = Math.abs(t - r.x), a = Math.abs(n - r.y); if (o <= 25 && a <= 25) return !0 } return !1 } g(Ee, Q, { handler: function (e, t, n) { var i = n.pointerType == j, r = n.pointerType == L; if (!(r && n.sourceCapabilities && n.sourceCapabilities.firesTouchEvents)) { if (i) Se.call(this, t, n); else if (r && ke.call(this, n)) return; this.callback(e, t, n) } }, destroy: function () { this.touch.destroy(), this.mouse.destroy() } }); var Re = A(s.style, "touchAction"), Pe = Re !== r, Te = "compute", Ae = "auto", Me = "manipulation", De = "none", Be = "pan-x", Ne = "pan-y", Oe = function () { if (!Pe) return !1; var e = {}, n = t.CSS && t.CSS.supports; return ["auto", "manipulation", "pan-y", "pan-x", "pan-x pan-y", "none"].forEach((function (i) { e[i] = !n || t.CSS.supports("touch-action", i) })), e }(); function je(e, t) { this.manager = e, this.set(t) } je.prototype = { set: function (e) { e == Te && (e = this.compute()), Pe && this.manager.element.style && Oe[e] && (this.manager.element.style[Re] = e), this.actions = e.toLowerCase().trim() }, update: function () { this.set(this.manager.options.touchAction) }, compute: function () { var e = []; return f(this.manager.recognizers, (function (t) { b(t.options.enable, [t]) && (e = e.concat(t.getTouchAction())) })), function (e) { if (C(e, De)) return De; var t = C(e, Be), n = C(e, Ne); if (t && n) return De; if (t || n) return t ? Be : Ne; if (C(e, Me)) return Me; return Ae }(e.join(" ")) }, preventDefaults: function (e) { var t = e.srcEvent, n = e.offsetDirection; if (this.manager.session.prevented) t.preventDefault(); else { var i = this.actions, r = C(i, De) && !Oe[De], o = C(i, Ne) && !Oe[Ne], a = C(i, Be) && !Oe[Be]; if (r) { var s = 1 === e.pointers.length, c = e.distance < 2, p = e.deltaTime < 250; if (s && c && p) return } if (!a || !o) return r || o && n & q || a && n & K ? this.preventSrc(t) : void 0 } }, preventSrc: function (e) { this.manager.session.prevented = !0, e.preventDefault() } }; var Le = 1, Ie = 32; function $e(e) { this.options = o({}, this.defaults, e || {}), this.id = M++, this.manager = null, this.options.enable = x(this.options.enable, !0), this.state = Le, this.simultaneous = {}, this.requireFail = [] } function Fe(e) { return 16 & e ? "cancel" : 8 & e ? "end" : 4 & e ? "move" : 2 & e ? "start" : "" } function ze(e) { return e == U ? "down" : e == G ? "up" : e == V ? "left" : e == W ? "right" : "" } function He(e, t) { var n = t.manager; return n ? n.get(e) : e } function Ve() { $e.apply(this, arguments) } function We() { Ve.apply(this, arguments), this.pX = null, this.pY = null } function Ge() { Ve.apply(this, arguments) } function Ue() { $e.apply(this, arguments), this._timer = null, this._input = null } function qe() { Ve.apply(this, arguments) } function Ke() { Ve.apply(this, arguments) } function Ye() { $e.apply(this, arguments), this.pTime = !1, this.pCenter = !1, this._timer = null, this._input = null, this.count = 0 } function Xe(e, t) { return (t = t || {}).recognizers = x(t.recognizers, Xe.defaults.preset), new Ze(e, t) } $e.prototype = { defaults: {}, set: function (e) { return o(this.options, e), this.manager && this.manager.touchAction.update(), this }, recognizeWith: function (e) { if (d(e, "recognizeWith", this)) return this; var t = this.simultaneous; return t[(e = He(e, this)).id] || (t[e.id] = e, e.recognizeWith(this)), this }, dropRecognizeWith: function (e) { return d(e, "dropRecognizeWith", this) || (e = He(e, this), delete this.simultaneous[e.id]), this }, requireFailure: function (e) { if (d(e, "requireFailure", this)) return this; var t = this.requireFail; return -1 === R(t, e = He(e, this)) && (t.push(e), e.requireFailure(this)), this }, dropRequireFailure: function (e) { if (d(e, "dropRequireFailure", this)) return this; e = He(e, this); var t = R(this.requireFail, e); return t > -1 && this.requireFail.splice(t, 1), this }, hasRequireFailures: function () { return this.requireFail.length > 0 }, canRecognizeWith: function (e) { return !!this.simultaneous[e.id] }, emit: function (e) { var t = this, n = this.state; function i(n) { t.manager.emit(n, e) } n < 8 && i(t.options.event + Fe(n)), i(t.options.event), e.additionalEvent && i(e.additionalEvent), n >= 8 && i(t.options.event + Fe(n)) }, tryEmit: function (e) { if (this.canEmit()) return this.emit(e); this.state = Ie }, canEmit: function () { for (var e = 0; e < this.requireFail.length;) { if (!(this.requireFail[e].state & (Ie | Le))) return !1; e++ } return !0 }, recognize: function (e) { var t = o({}, e); if (!b(this.options.enable, [this, t])) return this.reset(), void (this.state = Ie); 56 & this.state && (this.state = Le), this.state = this.process(t), 30 & this.state && this.tryEmit(t) }, process: function (e) { }, getTouchAction: function () { }, reset: function () { } }, g(Ve, $e, { defaults: { pointers: 1 }, attrTest: function (e) { var t = this.options.pointers; return 0 === t || e.pointers.length === t }, process: function (e) { var t = this.state, n = e.eventType, i = 6 & t, r = this.attrTest(e); return i && (n & z || !r) ? 16 | t : i || r ? n & F ? 8 | t : 2 & t ? 4 | t : 2 : Ie } }), g(We, Ve, { defaults: { event: "pan", threshold: 10, pointers: 1, direction: Y }, getTouchAction: function () { var e = this.options.direction, t = []; return e & q && t.push(Ne), e & K && t.push(Be), t }, directionTest: function (e) { var t = this.options, n = !0, i = e.distance, r = e.direction, o = e.deltaX, a = e.deltaY; return r & t.direction || (t.direction & q ? (r = 0 === o ? H : o < 0 ? V : W, n = o != this.pX, i = Math.abs(e.deltaX)) : (r = 0 === a ? H : a < 0 ? G : U, n = a != this.pY, i = Math.abs(e.deltaY))), e.direction = r, n && i > t.threshold && r & t.direction }, attrTest: function (e) { return Ve.prototype.attrTest.call(this, e) && (2 & this.state || !(2 & this.state) && this.directionTest(e)) }, emit: function (e) { this.pX = e.deltaX, this.pY = e.deltaY; var t = ze(e.direction); t && (e.additionalEvent = this.options.event + t), this._super.emit.call(this, e) } }), g(Ge, Ve, { defaults: { event: "pinch", threshold: 0, pointers: 2 }, getTouchAction: function () { return [De] }, attrTest: function (e) { return this._super.attrTest.call(this, e) && (Math.abs(e.scale - 1) > this.options.threshold || 2 & this.state) }, emit: function (e) { if (1 !== e.scale) { var t = e.scale < 1 ? "in" : "out"; e.additionalEvent = this.options.event + t } this._super.emit.call(this, e) } }), g(Ue, $e, { defaults: { event: "press", pointers: 1, time: 251, threshold: 9 }, getTouchAction: function () { return [Ae] }, process: function (e) { var t = this.options, n = e.pointers.length === t.pointers, i = e.distance < t.threshold, r = e.deltaTime > t.time; if (this._input = e, !i || !n || e.eventType & (F | z) && !r) this.reset(); else if (e.eventType & $) this.reset(), this._timer = h((function () { this.state = 8, this.tryEmit() }), t.time, this); else if (e.eventType & F) return 8; return Ie }, reset: function () { clearTimeout(this._timer) }, emit: function (e) { 8 === this.state && (e && e.eventType & F ? this.manager.emit(this.options.event + "up", e) : (this._input.timeStamp = u(), this.manager.emit(this.options.event, this._input))) } }), g(qe, Ve, { defaults: { event: "rotate", threshold: 0, pointers: 2 }, getTouchAction: function () { return [De] }, attrTest: function (e) { return this._super.attrTest.call(this, e) && (Math.abs(e.rotation) > this.options.threshold || 2 & this.state) } }), g(Ke, Ve, { defaults: { event: "swipe", threshold: 10, velocity: .3, direction: q | K, pointers: 1 }, getTouchAction: function () { return We.prototype.getTouchAction.call(this) }, attrTest: function (e) { var t, n = this.options.direction; return n & (q | K) ? t = e.overallVelocity : n & q ? t = e.overallVelocityX : n & K && (t = e.overallVelocityY), this._super.attrTest.call(this, e) && n & e.offsetDirection && e.distance > this.options.threshold && e.maxPointers == this.options.pointers && l(t) > this.options.velocity && e.eventType & F }, emit: function (e) { var t = ze(e.offsetDirection); t && this.manager.emit(this.options.event + t, e), this.manager.emit(this.options.event, e) } }), g(Ye, $e, { defaults: { event: "tap", pointers: 1, taps: 1, interval: 300, time: 250, threshold: 9, posThreshold: 10 }, getTouchAction: function () { return [Me] }, process: function (e) { var t = this.options, n = e.pointers.length === t.pointers, i = e.distance < t.threshold, r = e.deltaTime < t.time; if (this.reset(), e.eventType & $ && 0 === this.count) return this.failTimeout(); if (i && r && n) { if (e.eventType != F) return this.failTimeout(); var o = !this.pTime || e.timeStamp - this.pTime < t.interval, a = !this.pCenter || re(this.pCenter, e.center) < t.posThreshold; if (this.pTime = e.timeStamp, this.pCenter = e.center, a && o ? this.count += 1 : this.count = 1, this._input = e, 0 === this.count % t.taps) return this.hasRequireFailures() ? (this._timer = h((function () { this.state = 8, this.tryEmit() }), t.interval, this), 2) : 8 } return Ie }, failTimeout: function () { return this._timer = h((function () { this.state = Ie }), this.options.interval, this), Ie }, reset: function () { clearTimeout(this._timer) }, emit: function () { 8 == this.state && (this._input.tapCount = this.count, this.manager.emit(this.options.event, this._input)) } }), Xe.VERSION = "2.0.7", Xe.defaults = { domEvents: !1, touchAction: Te, enable: !0, inputTarget: null, inputClass: null, preset: [[qe, { enable: !1 }], [Ge, { enable: !1 }, ["rotate"]], [Ke, { direction: q }], [We, { direction: q }, ["swipe"]], [Ye], [Ye, { event: "doubletap", taps: 2 }, ["tap"]], [Ue]], cssProps: { userSelect: "none", touchSelect: "none", touchCallout: "none", contentZooming: "none", userDrag: "none", tapHighlightColor: "rgba(0,0,0,0)" } }; function Ze(e, t) { var n; this.options = o({}, Xe.defaults, t || {}), this.options.inputTarget = this.options.inputTarget || e, this.handlers = {}, this.session = {}, this.recognizers = [], this.oldCssProps = {}, this.element = e, this.input = new ((n = this).options.inputClass || (N ? fe : O ? be : B ? Ee : pe))(n, J), this.touchAction = new je(this, this.options.touchAction), Qe(this, !0), f(this.options.recognizers, (function (e) { var t = this.add(new e[0](e[1])); e[2] && t.recognizeWith(e[2]), e[3] && t.requireFailure(e[3]) }), this) } function Qe(e, t) { var n, i = e.element; i.style && (f(e.options.cssProps, (function (r, o) { n = A(i.style, o), t ? (e.oldCssProps[n] = i.style[n], i.style[n] = r) : i.style[n] = e.oldCssProps[n] || "" })), t || (e.oldCssProps = {})) } Ze.prototype = { set: function (e) { return o(this.options, e), e.touchAction && this.touchAction.update(), e.inputTarget && (this.input.destroy(), this.input.target = e.inputTarget, this.input.init()), this }, stop: function (e) { this.session.stopped = e ? 2 : 1 }, recognize: function (e) { var t = this.session; if (!t.stopped) { var n; this.touchAction.preventDefaults(e); var i = this.recognizers, r = t.curRecognizer; (!r || r && 8 & r.state) && (r = t.curRecognizer = null); for (var o = 0; o < i.length;)n = i[o], 2 === t.stopped || r && n != r && !n.canRecognizeWith(r) ? n.reset() : n.recognize(e), !r && 14 & n.state && (r = t.curRecognizer = n), o++ } }, get: function (e) { if (e instanceof $e) return e; for (var t = this.recognizers, n = 0; n < t.length; n++)if (t[n].options.event == e) return t[n]; return null }, add: function (e) { if (d(e, "add", this)) return this; var t = this.get(e.options.event); return t && this.remove(t), this.recognizers.push(e), e.manager = this, this.touchAction.update(), e }, remove: function (e) { if (d(e, "remove", this)) return this; if (e = this.get(e)) { var t = this.recognizers, n = R(t, e); -1 !== n && (t.splice(n, 1), this.touchAction.update()) } return this }, on: function (e, t) { if (e !== r && t !== r) { var n = this.handlers; return f(k(e), (function (e) { n[e] = n[e] || [], n[e].push(t) })), this } }, off: function (e, t) { if (e !== r) { var n = this.handlers; return f(k(e), (function (e) { t ? n[e] && n[e].splice(R(n[e], t), 1) : delete n[e] })), this } }, emit: function (e, t) { this.options.domEvents && function (e, t) { var i = n.createEvent("Event"); i.initEvent(e, !0, !0), i.gesture = t, t.target.dispatchEvent(i) }(e, t); var i = this.handlers[e] && this.handlers[e].slice(); if (i && i.length) { t.type = e, t.preventDefault = function () { t.srcEvent.preventDefault() }; for (var r = 0; r < i.length;)i[r](t), r++ } }, destroy: function () { this.element && Qe(this, !1), this.handlers = {}, this.session = {}, this.input.destroy(), this.element = null } }, o(Xe, { INPUT_START: $, INPUT_MOVE: 2, INPUT_END: F, INPUT_CANCEL: z, STATE_POSSIBLE: Le, STATE_BEGAN: 2, STATE_CHANGED: 4, STATE_ENDED: 8, STATE_RECOGNIZED: 8, STATE_CANCELLED: 16, STATE_FAILED: Ie, DIRECTION_NONE: H, DIRECTION_LEFT: V, DIRECTION_RIGHT: W, DIRECTION_UP: G, DIRECTION_DOWN: U, DIRECTION_HORIZONTAL: q, DIRECTION_VERTICAL: K, DIRECTION_ALL: Y, Manager: Ze, Input: Q, TouchAction: je, TouchInput: be, MouseInput: pe, PointerEventInput: fe, TouchMouseInput: Ee, SingleTouchInput: ve, Recognizer: $e, AttrRecognizer: Ve, Tap: Ye, Pan: We, Swipe: Ke, Pinch: Ge, Rotate: qe, Press: Ue, on: w, off: E, each: f, merge: y, extend: v, assign: o, inherit: g, bindFn: _, prefixed: A }), (void 0 !== t ? t : "undefined" != typeof self ? self : {}).Hammer = Xe, "function" == typeof r && r.amd ? r((function () { return Xe })) : e.exports ? e.exports = Xe : t.Hammer = Xe }(window, document) }(ds); var fs = hs(ds.exports), ms = ["mousedown", "mouseup", "mouseover", "mouseout", "click", "dblclick"]; function vs(e, t) { return t.get(e, !1) } function ys(e) { e.preventDefault(), "function" == typeof e.stopPropagation ? e.stopPropagation() : e.srcEvent && "function" == typeof e.srcEvent.stopPropagation && e.srcEvent.stopPropagation(), "function" == typeof e.stopImmediatePropagation && e.stopImmediatePropagation() } function gs(e) { function t(t) { setTimeout((function () { g(ms, (function (t) { ae.unbind(e, t, ys, !0) })) }), 500) } ae.bind(e, "touchstart", (function (t) { g(ms, (function (t) { ae.bind(e, t, ys, !0) })) }), !0), ae.bind(e, "touchend", t, !0), ae.bind(e, "touchcancel", t, !0); var n = new fs.Manager(e, { inputClass: fs.TouchInput, recognizers: [], domEvents: !0 }), i = new fs.Tap, r = new fs.Pan({ threshold: 10 }), o = new fs.Press, a = new fs.Pinch, s = new fs.Tap({ event: "doubletap", taps: 2 }); return a.requireFailure(r), a.requireFailure(o), n.add([r, o, a, s, i]), n.reset = function (e) { var t = this.recognizers, i = this.session; i.stopped || (n.stop(e), setTimeout((function () { var e, n; for (e = 0; n = t[e]; e++)n.reset(), n.state = 8; i.curRecognizer = null }), 0)) }, n.on("hammer.input", (function (e) { e.srcEvent.defaultPrevented && n.reset(!0) })), n } function _s(e, t, n, i, r) { var o, a = vs("dragging", e), s = vs("move", e), c = vs("contextPad", e), p = vs("palette", e); function l(e, t) { return function (n) { var o = u(n.target), a = o && i.get(o); return t && (n.srcEvent.button = t), r.fire(e, n, a) } } function u(e) { return ee(e, "svg, .djs-element", !0) } function h(e) { function n(e) { var n = u(e.target), r = n && i.get(n); if (s && t.getRootElement() !== r) return s.start(e, r, !0); !function (e) { var n = 0, i = 0; function r(e) { var r = e.deltaX - n, o = e.deltaY - i; t.scroll({ dx: r, dy: o }), n = e.deltaX, i = e.deltaY } function a(e) { o.off("panmove", r), o.off("panend", a), o.off("pancancel", a) } o.on("panmove", r), o.on("panend", a), o.on("pancancel", a) }() } (o = gs(e)).on("tap", l("element.click")), o.on("doubletap", l("element.dblclick", 1)), o.on("panstart", n), o.on("press", n), o.on("pinchstart", (function (e) { var n = t.zoom(), i = e.center; function r(e) { var r = 1 - (1 - e.scale) / 1.5, o = Math.max(.2, Math.min(4, r * n)); t.zoom(o, i), ys(e) } function a(e) { o.off("pinchmove", r), o.off("pinchend", a), o.off("pinchcancel", a), o.reset(!0) } o.on("pinchmove", r), o.on("pinchend", a), o.on("pinchcancel", a) })) } a && n.on("drag.move", (function (e) { var t = e.originalEvent; if (t && !(t instanceof MouseEvent)) { var n = jo(t), r = u(document.elementFromPoint(n.x, n.y)), o = r && i.get(r); o !== e.hover && (e.hover && a.out(e), o && (a.hover({ element: o, gfx: r }), e.hover = o, e.hoverGfx = r)) } })), c && n.on("contextPad.create", (function (e) { var t = gs(e.pad.html); t.on("panstart", (function (e) { c.trigger("dragstart", e, !0) })), t.on("press", (function (e) { c.trigger("dragstart", e, !0) })), t.on("tap", (function (e) { c.trigger("click", e) })) })), p && n.on("palette.create", (function (e) { var t = gs(e.container); t.on("panstart", (function (e) { p.trigger("dragstart", e, !0) })), t.on("press", (function (e) { p.trigger("dragstart", e, !0) })), t.on("tap", (function (e) { p.trigger("click", e) })) })), n.on("canvas.init", (function (e) { h(e.svg) })) } function bs(e) { var t = this; e.on("canvas.init", (function (e) { t.addBBoxMarker(e.svg) })) } _s.$inject = ["injector", "canvas", "eventBus", "elementRegistry", "interactionEvents", "touchFix"], bs.$inject = ["eventBus"], bs.prototype.addBBoxMarker = function (e) { var t = { fill: "none", class: "outer-bound-marker" }, n = De("rect"); we(n, { x: -1e4, y: 1e4, width: 10, height: 10 }), we(n, t), ge(e, n); var i = De("rect"); we(i, { x: 1e4, y: 1e4, width: 10, height: 10 }), we(i, t), ge(e, i) }; var xs = { __depends__: [{ __depends__: [Go], __init__: ["touchInteractionEvents"], touchInteractionEvents: ["type", _s], touchFix: ["type", bs] }] }; function ws(e) { return e && e[e.length - 1] } function Es(e) { return e.y } function Ss(e) { return e.x } var Cs = { left: Ss, center: Ss, right: function (e) { return e.x + e.width }, top: Es, middle: Es, bottom: function (e) { return e.y + e.height } }; function ks(e, t) { this._modeling = e, this._rules = t } ks.$inject = ["modeling", "rules"], ks.prototype._getOrientationDetails = function (e) { var t = "x", n = "width"; return -1 !== ["top", "bottom", "middle"].indexOf(e) && (t = "y", n = "height"), { axis: t, dimension: n } }, ks.prototype._isType = function (e, t) { return -1 !== t.indexOf(e) }, ks.prototype._alignmentPosition = function (e, t) { var n, i, r, o = this._getOrientationDetails(e), a = o.axis, s = o.dimension, c = {}, p = {}, l = !1; if (this._isType(e, ["left", "top"])) c[e] = t[0][a]; else if (this._isType(e, ["right", "bottom"])) r = ws(t), c[e] = r[a] + r[s]; else if (this._isType(e, ["center", "middle"])) { if (g(t, (function (e) { var t = e[a] + Math.round(e[s] / 2); p[t] ? p[t].elements.push(e) : p[t] = { elements: [e], center: t } })), n = T(p, (function (e) { return e.elements.length > 1 && (l = !0), e.elements.length })), l) return c[e] = ws(n).center, c; i = t[0], r = ws(t = T(t, (function (e) { return e[a] + e[s] }))), c[e] = function (e, t) { return Math.round((e[a] + t[a] + t[s]) / 2) }(i, r) } return c }, ks.prototype.trigger = function (e, t) { var n, i = this._modeling, r = y(e, (function (e) { return !(e.waypoints || e.host || e.labelTarget) })); if (p(n = this._rules.allowed("elements.align", { elements: r })) && (r = n), !(r.length < 2) && n) { var o = T(r, Cs[t]), a = this._alignmentPosition(t, o); i.alignElements(o, a) } }; var Rs = { __init__: ["alignElements"], alignElements: ["type", ks] }, Ps = ".entry"; function Ts(e, t, n, i) { this._canvas = e, this._eventBus = n, this._overlays = i; var r = s(t && t.scale) ? t.scale : { min: 1, max: 1.5 }; this._overlaysConfig = { scale: r }, this._current = null, this._init() } function As(e, t) { return -1 !== e.indexOf(t) } Ts.$inject = ["canvas", "config.contextPad", "eventBus", "overlays"], Ts.prototype._init = function () { var e = this; this._eventBus.on("selection.changed", (function (t) { var n = t.newSelection, i = n.length ? 1 === n.length ? n[0] : n : null; i ? e.open(i, !0) : e.close() })), this._eventBus.on("elements.changed", (function (t) { var n = t.elements, i = e._current; if (i) { var r = i.target; w(p(r) ? r : [r], (function (e) { return As(n, e) })) && e.open(r, !0) } })) }, Ts.prototype.registerProvider = function (e, t) { t || (t = e, e = 1e3), this._eventBus.on("contextPad.getProviders", e, (function (e) { e.providers.push(t) })) }, Ts.prototype.getEntries = function (e) { var t = this._getProviders(), n = p(e) ? "getMultiElementContextPadEntries" : "getContextPadEntries", i = {}; return g(t, (function (t) { if (h(t[n])) { var r = t[n](e); h(r) ? i = r(i) : g(r, (function (e, t) { i[t] = e })) } })), i }, Ts.prototype.trigger = function (e, t, n) { var i, r, o = t.delegateTarget || t.target; return o ? (i = K(o, "data-action"), r = t.originalEvent || t, "mouseover" === e ? this._timeout = setTimeout((() => { this._mouseout = this.triggerEntry(i, "hover", r, n) }), 300) : "mouseout" === e && (clearTimeout(this._timeout), this._mouseout && (this._mouseout(), this._mouseout = null)), this.triggerEntry(i, e, r, n)) : t.preventDefault() }, Ts.prototype.triggerEntry = function (e, t, n, i) { if (this.isShown()) { var r = this._current.target, o = this._current.entries[e]; if (o) { var a = o.action; if (!1 !== this._eventBus.fire("contextPad.trigger", { entry: o, event: n })) { if (h(a)) { if ("click" === t) return a(n, r, i) } else if (a[t]) return a[t](n, r, i); n.preventDefault() } } } }, Ts.prototype.open = function (e, t) { !t && this.isOpen(e) || (this.close(), this._updateAndOpen(e)) }, Ts.prototype._getProviders = function () { var e = this._eventBus.createEvent({ type: "contextPad.getProviders", providers: [] }); return this._eventBus.fire(e), e.providers }, Ts.prototype._updateAndOpen = function (e) { var t, n = this.getEntries(e), i = this.getPad(e), r = i.html; g(n, (function (e, n) { var i, o = e.group || "default", a = de(e.html || '<div class="entry" draggable="true"></div>'); K(a, "data-action", n), (i = fe("[data-group=" + fa(o) + "]", r)) || (K(i = de('<div class="group"></div>'), "data-group", o), r.appendChild(i)), i.appendChild(a), e.className && function (e, t) { var n = X(e); (t = p(t) ? t : t.split(/\s+/g)).forEach((function (e) { n.add(e) })) }(a, e.className), e.title && K(a, "title", e.title), e.imageUrl && (K(t = de("<img>"), "src", e.imageUrl), t.style.width = "100%", t.style.height = "100%", a.appendChild(t)) })), X(r).add("open"), this._current = { target: e, entries: n, pad: i }, this._eventBus.fire("contextPad.open", { current: this._current }) }, Ts.prototype.getPad = function (e) { if (this.isOpen()) return this._current.pad; var t = this, n = this._overlays, i = de('<div class="djs-context-pad"></div>'), r = this._getPosition(e), o = L({ html: i }, this._overlaysConfig, r); pe.bind(i, Ps, "click", (function (e) { t.trigger("click", e) })), pe.bind(i, Ps, "dragstart", (function (e) { t.trigger("dragstart", e) })), pe.bind(i, Ps, "mouseover", (function (e) { t.trigger("mouseover", e) })), pe.bind(i, Ps, "mouseout", (function (e) { t.trigger("mouseout", e) })), ae.bind(i, "mousedown", (function (e) { e.stopPropagation() })); var a = this._canvas.getRootElement(); this._overlayId = n.add(a, "context-pad", o); var s = n.get(this._overlayId); return this._eventBus.fire("contextPad.create", { target: e, pad: s }), s }, Ts.prototype.close = function () { this.isOpen() && (clearTimeout(this._timeout), this._overlays.remove(this._overlayId), this._overlayId = null, this._eventBus.fire("contextPad.close", { current: this._current }), this._current = null) }, Ts.prototype.isOpen = function (e) { var t = this._current; if (!t) return !1; if (!e) return !0; var n = t.target; return p(e) === p(n) && (p(e) ? e.length === n.length && x(e, (function (e) { return As(n, e) })) : n === e) }, Ts.prototype.isShown = function () { return this.isOpen() && this._overlays.isShown() }, Ts.prototype._getPosition = function (e) { var t, n = vt(p(e = un(e) ? (t = e).waypoints[t.waypoints.length - 1] : e) ? e : [e]); return { position: { left: n.x + n.width + 12, top: n.y - 6 } } }; var Ms, Ds, Bs, Ns, Os, js, Ls, Is = { __depends__: [Go, sa], contextPad: ["type", Ts] }, $s = {}, Fs = [], zs = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i, Hs = Array.isArray; function Vs(e, t) { for (var n in t) e[n] = t[n]; return e } function Ws(e) { var t = e.parentNode; t && t.removeChild(e) } function Gs(e, t, n) { var i, r, o, a = {}; for (o in t) "key" == o ? i = t[o] : "ref" == o ? r = t[o] : a[o] = t[o]; if (arguments.length > 2 && (a.children = arguments.length > 3 ? Ms.call(arguments, 2) : n), "function" == typeof e && null != e.defaultProps) for (o in e.defaultProps) void 0 === a[o] && (a[o] = e.defaultProps[o]); return Us(e, a, i, r, null) } function Us(e, t, n, i, r) { var o = { type: e, props: t, key: n, ref: i, __k: null, __: null, __b: 0, __e: null, __d: void 0, __c: null, __h: null, constructor: void 0, __v: null == r ? ++Bs : r }; return null == r && null != Ds.vnode && Ds.vnode(o), o } function qs(e) { return e.children } function Ks(e, t) { this.props = e, this.context = t } function Ys(e, t) { if (null == t) return e.__ ? Ys(e.__, e.__.__k.indexOf(e) + 1) : null; for (var n; t < e.__k.length; t++)if (null != (n = e.__k[t]) && null != n.__e) return n.__d || n.__e; return "function" == typeof e.type ? Ys(e) : null } function Xs(e) { var t, n; if (null != (e = e.__) && null != e.__c) { for (e.__e = e.__c.base = null, t = 0; t < e.__k.length; t++)if (null != (n = e.__k[t]) && null != n.__e) { e.__e = e.__c.base = n.__e; break } return Xs(e) } } function Zs(e) { (!e.__d && (e.__d = !0) && Ns.push(e) && !Qs.__r++ || Os !== Ds.debounceRendering) && ((Os = Ds.debounceRendering) || js)(Qs) } function Qs() { var e, t, n, i, r, o, a, s, c; for (Ns.sort(Ls); e = Ns.shift();)e.__d && (t = Ns.length, i = void 0, r = void 0, o = void 0, s = (a = (n = e).__v).__e, (c = n.__P) && (i = [], r = [], (o = Vs({}, a)).__v = a.__v + 1, sc(c, a, o, n.__n, void 0 !== c.ownerSVGElement, null != a.__h ? [s] : null, i, null == s ? Ys(a) : s, a.__h, r), cc(i, a, r), a.__e != s && Xs(a)), Ns.length > t && Ns.sort(Ls)); Qs.__r = 0 } function Js(e, t, n, i, r, o, a, s, c, p, l) { var u, h, d, f, m, v, y, g, _, b = 0, x = i && i.__k || Fs, w = x.length, E = w, S = t.length; for (n.__k = [], u = 0; u < S; u++)null != (f = n.__k[u] = null == (f = t[u]) || "boolean" == typeof f || "function" == typeof f ? null : "string" == typeof f || "number" == typeof f || "bigint" == typeof f ? Us(null, f, null, null, f) : Hs(f) ? Us(qs, { children: f }, null, null, null) : f.__b > 0 ? Us(f.type, f.props, f.key, f.ref ? f.ref : null, f.__v) : f) ? (f.__ = n, f.__b = n.__b + 1, -1 === (g = nc(f, x, y = u + b, E)) ? d = $s : (d = x[g] || $s, x[g] = void 0, E--), sc(e, f, d, r, o, a, s, c, p, l), m = f.__e, (h = f.ref) && d.ref != h && (d.ref && lc(d.ref, null, f), l.push(h, f.__c || m, f)), null != m && (null == v && (v = m), (_ = d === $s || null === d.__v) ? -1 == g && b-- : g !== y && (g === y + 1 ? b++ : g > y ? E > S - y ? b += g - y : b-- : b = g < y && g == y - 1 ? g - y : 0), y = u + b, "function" != typeof f.type || g === y && d.__k !== f.__k ? "function" == typeof f.type || g === y && !_ ? void 0 !== f.__d ? (c = f.__d, f.__d = void 0) : c = m.nextSibling : c = tc(e, m, c) : c = ec(f, c, e), "function" == typeof n.type && (n.__d = c))) : (d = x[u]) && null == d.key && d.__e && (d.__e == c && (d.__ = i, c = Ys(d)), uc(d, d, !1), x[u] = null); for (n.__e = v, u = w; u--;)null != x[u] && ("function" == typeof n.type && null != x[u].__e && x[u].__e == n.__d && (n.__d = x[u].__e.nextSibling), uc(x[u], x[u])) } function ec(e, t, n) { for (var i, r = e.__k, o = 0; r && o < r.length; o++)(i = r[o]) && (i.__ = e, t = "function" == typeof i.type ? ec(i, t, n) : tc(n, i.__e, t)); return t } function tc(e, t, n) { return null == n || n.parentNode !== e ? e.insertBefore(t, null) : t == n && null != t.parentNode || e.insertBefore(t, n), t.nextSibling } function nc(e, t, n, i) { var r = e.key, o = e.type, a = n - 1, s = n + 1, c = t[n]; if (null === c || c && r == c.key && o === c.type) return n; if (i > (null != c ? 1 : 0)) for (; a >= 0 || s < t.length;) { if (a >= 0) { if ((c = t[a]) && r == c.key && o === c.type) return a; a-- } if (s < t.length) { if ((c = t[s]) && r == c.key && o === c.type) return s; s++ } } return -1 } function ic(e, t, n) { "-" === t[0] ? e.setProperty(t, null == n ? "" : n) : e[t] = null == n ? "" : "number" != typeof n || zs.test(t) ? n : n + "px" } function rc(e, t, n, i, r) { var o; e: if ("style" === t) if ("string" == typeof n) e.style.cssText = n; else { if ("string" == typeof i && (e.style.cssText = i = ""), i) for (t in i) n && t in n || ic(e.style, t, ""); if (n) for (t in n) i && n[t] === i[t] || ic(e.style, t, n[t]) } else if ("o" === t[0] && "n" === t[1]) o = t !== (t = t.replace(/(PointerCapture)$|Capture$/, "$1")), t = t.toLowerCase() in e ? t.toLowerCase().slice(2) : t.slice(2), e.l || (e.l = {}), e.l[t + o] = n, n ? i ? n.u = i.u : (n.u = Date.now(), e.addEventListener(t, o ? ac : oc, o)) : e.removeEventListener(t, o ? ac : oc, o); else if ("dangerouslySetInnerHTML" !== t) { if (r) t = t.replace(/xlink(H|:h)/, "h").replace(/sName$/, "s"); else if ("width" !== t && "height" !== t && "href" !== t && "list" !== t && "form" !== t && "tabIndex" !== t && "download" !== t && "rowSpan" !== t && "colSpan" !== t && "role" !== t && t in e) try { e[t] = null == n ? "" : n; break e } catch (e) { } "function" == typeof n || (null == n || !1 === n && "-" !== t[4] ? e.removeAttribute(t) : e.setAttribute(t, n)) } } function oc(e) { var t = this.l[e.type + !1]; if (e.t) { if (e.t <= t.u) return } else e.t = Date.now(); return t(Ds.event ? Ds.event(e) : e) } function ac(e) { return this.l[e.type + !0](Ds.event ? Ds.event(e) : e) } function sc(e, t, n, i, r, o, a, s, c, p) { var l, u, h, d, f, m, v, y, g, _, b, x, w, E, S, C = t.type; if (void 0 !== t.constructor) return null; null != n.__h && (c = n.__h, s = t.__e = n.__e, t.__h = null, o = [s]), (l = Ds.__b) && l(t); e: if ("function" == typeof C) try { if (y = t.props, g = (l = C.contextType) && i[l.__c], _ = l ? g ? g.props.value : l.__ : i, n.__c ? v = (u = t.__c = n.__c).__ = u.__E : ("prototype" in C && C.prototype.render ? t.__c = u = new C(y, _) : (t.__c = u = new Ks(y, _), u.constructor = C, u.render = hc), g && g.sub(u), u.props = y, u.state || (u.state = {}), u.context = _, u.__n = i, h = u.__d = !0, u.__h = [], u._sb = []), null == u.__s && (u.__s = u.state), null != C.getDerivedStateFromProps && (u.__s == u.state && (u.__s = Vs({}, u.__s)), Vs(u.__s, C.getDerivedStateFromProps(y, u.__s))), d = u.props, f = u.state, u.__v = t, h) null == C.getDerivedStateFromProps && null != u.componentWillMount && u.componentWillMount(), null != u.componentDidMount && u.__h.push(u.componentDidMount); else { if (null == C.getDerivedStateFromProps && y !== d && null != u.componentWillReceiveProps && u.componentWillReceiveProps(y, _), !u.__e && (null != u.shouldComponentUpdate && !1 === u.shouldComponentUpdate(y, u.__s, _) || t.__v === n.__v)) { for (t.__v !== n.__v && (u.props = y, u.state = u.__s, u.__d = !1), t.__e = n.__e, t.__k = n.__k, t.__k.forEach((function (e) { e && (e.__ = t) })), b = 0; b < u._sb.length; b++)u.__h.push(u._sb[b]); u._sb = [], u.__h.length && a.push(u); break e } null != u.componentWillUpdate && u.componentWillUpdate(y, u.__s, _), null != u.componentDidUpdate && u.__h.push((function () { u.componentDidUpdate(d, f, m) })) } if (u.context = _, u.props = y, u.__P = e, u.__e = !1, x = Ds.__r, w = 0, "prototype" in C && C.prototype.render) { for (u.state = u.__s, u.__d = !1, x && x(t), l = u.render(u.props, u.state, u.context), E = 0; E < u._sb.length; E++)u.__h.push(u._sb[E]); u._sb = [] } else do { u.__d = !1, x && x(t), l = u.render(u.props, u.state, u.context), u.state = u.__s } while (u.__d && ++w < 25); u.state = u.__s, null != u.getChildContext && (i = Vs(Vs({}, i), u.getChildContext())), h || null == u.getSnapshotBeforeUpdate || (m = u.getSnapshotBeforeUpdate(d, f)), Js(e, Hs(S = null != l && l.type === qs && null == l.key ? l.props.children : l) ? S : [S], t, n, i, r, o, a, s, c, p), u.base = t.__e, t.__h = null, u.__h.length && a.push(u), v && (u.__E = u.__ = null) } catch (e) { t.__v = null, (c || null != o) && (t.__e = s, t.__h = !!c, o[o.indexOf(s)] = null), Ds.__e(e, t, n) } else null == o && t.__v === n.__v ? (t.__k = n.__k, t.__e = n.__e) : t.__e = pc(n.__e, t, n, i, r, o, a, c, p); (l = Ds.diffed) && l(t) } function cc(e, t, n) { for (var i = 0; i < n.length; i++)lc(n[i], n[++i], n[++i]); Ds.__c && Ds.__c(t, e), e.some((function (t) { try { e = t.__h, t.__h = [], e.some((function (e) { e.call(t) })) } catch (e) { Ds.__e(e, t.__v) } })) } function pc(e, t, n, i, r, o, a, s, c) { var p, l, u, h = n.props, d = t.props, f = t.type, m = 0; if ("svg" === f && (r = !0), null != o) for (; m < o.length; m++)if ((p = o[m]) && "setAttribute" in p == !!f && (f ? p.localName === f : 3 === p.nodeType)) { e = p, o[m] = null; break } if (null == e) { if (null === f) return document.createTextNode(d); e = r ? document.createElementNS("http://www.w3.org/2000/svg", f) : document.createElement(f, d.is && d), o = null, s = !1 } if (null === f) h === d || s && e.data === d || (e.data = d); else { if (o = o && Ms.call(e.childNodes), l = (h = n.props || $s).dangerouslySetInnerHTML, u = d.dangerouslySetInnerHTML, !s) { if (null != o) for (h = {}, m = 0; m < e.attributes.length; m++)h[e.attributes[m].name] = e.attributes[m].value; (u || l) && (u && (l && u.__html == l.__html || u.__html === e.innerHTML) || (e.innerHTML = u && u.__html || "")) } if (function (e, t, n, i, r) { var o; for (o in n) "children" === o || "key" === o || o in t || rc(e, o, null, n[o], i); for (o in t) r && "function" != typeof t[o] || "children" === o || "key" === o || "value" === o || "checked" === o || n[o] === t[o] || rc(e, o, t[o], n[o], i) }(e, d, h, r, s), u) t.__k = []; else if (Js(e, Hs(m = t.props.children) ? m : [m], t, n, i, r && "foreignObject" !== f, o, a, o ? o[0] : n.__k && Ys(n, 0), s, c), null != o) for (m = o.length; m--;)null != o[m] && Ws(o[m]); s || ("value" in d && void 0 !== (m = d.value) && (m !== e.value || "progress" === f && !m || "option" === f && m !== h.value) && rc(e, "value", m, h.value, !1), "checked" in d && void 0 !== (m = d.checked) && m !== e.checked && rc(e, "checked", m, h.checked, !1)) } return e } function lc(e, t, n) { try { "function" == typeof e ? e(t) : e.current = t } catch (e) { Ds.__e(e, n) } } function uc(e, t, n) { var i, r; if (Ds.unmount && Ds.unmount(e), (i = e.ref) && (i.current && i.current !== e.__e || lc(i, null, t)), null != (i = e.__c)) { if (i.componentWillUnmount) try { i.componentWillUnmount() } catch (e) { Ds.__e(e, t) } i.base = i.__P = null, e.__c = void 0 } if (i = e.__k) for (r = 0; r < i.length; r++)i[r] && uc(i[r], t, n || "function" != typeof e.type); n || null == e.__e || Ws(e.__e), e.__ = e.__e = e.__d = void 0 } function hc(e, t, n) { return this.constructor(e, n) } function dc(e, t, n) { var i, r, o, a; Ds.__ && Ds.__(e, t), r = (i = "function" == typeof n) ? null : n && n.__k || t.__k, o = [], a = [], sc(t, e = (!i && n || t).__k = Gs(qs, null, [e]), r || $s, $s, void 0 !== t.ownerSVGElement, !i && n ? [n] : r ? null : t.firstChild ? Ms.call(t.childNodes) : null, o, !i && n ? n : r ? r.__e : t.firstChild, i, a), cc(o, e, a) } Ms = Fs.slice, Ds = { __e: function (e, t, n, i) { for (var r, o, a; t = t.__;)if ((r = t.__c) && !r.__) try { if ((o = r.constructor) && null != o.getDerivedStateFromError && (r.setState(o.getDerivedStateFromError(e)), a = r.__d), null != r.componentDidCatch && (r.componentDidCatch(e, i || {}), a = r.__d), a) return r.__E = r } catch (t) { e = t } throw e } }, Bs = 0, Ks.prototype.setState = function (e, t) { var n; n = null != this.__s && this.__s !== this.state ? this.__s : this.__s = Vs({}, this.state), "function" == typeof e && (e = e(Vs({}, n), this.props)), e && Vs(n, e), null != e && this.__v && (t && this._sb.push(t), Zs(this)) }, Ks.prototype.forceUpdate = function (e) { this.__v && (this.__e = !0, e && this.__h.push(e), Zs(this)) }, Ks.prototype.render = qs, Ns = [], js = "function" == typeof Promise ? Promise.prototype.then.bind(Promise.resolve()) : setTimeout, Ls = function (e, t) { return e.__v.__b - t.__v.__b }, Qs.__r = 0; var fc = function (e, t, n, i) { var r; t[0] = 0; for (var o = 1; o < t.length; o++) { var a = t[o++], s = t[o] ? (t[0] |= a ? 1 : 2, n[t[o++]]) : t[++o]; 3 === a ? i[0] = s : 4 === a ? i[1] = Object.assign(i[1] || {}, s) : 5 === a ? (i[1] = i[1] || {})[t[++o]] = s : 6 === a ? i[1][t[++o]] += s + "" : a ? (r = e.apply(s, fc(e, s, n, ["", null])), i.push(r), s[0] ? t[0] |= 2 : (t[o - 2] = 0, t[o] = r)) : i.push(s) } return i }, mc = new Map; var vc, yc, gc, _c, bc = function (e) { var t = mc.get(this); return t || (t = new Map, mc.set(this, t)), (t = fc(this, t.get(e) || (t.set(e, t = function (e) { for (var t, n, i = 1, r = "", o = "", a = [0], s = function (e) { 1 === i && (e || (r = r.replace(/^\s*\n\s*|\s*\n\s*$/g, ""))) ? a.push(0, e, r) : 3 === i && (e || r) ? (a.push(3, e, r), i = 2) : 2 === i && "..." === r && e ? a.push(4, e, 0) : 2 === i && r && !e ? a.push(5, 0, !0, r) : i >= 5 && ((r || !e && 5 === i) && (a.push(i, 0, r, n), i = 6), e && (a.push(i, e, 0, n), i = 6)), r = "" }, c = 0; c < e.length; c++) { c && (1 === i && s(), s(c)); for (var p = 0; p < e[c].length; p++)t = e[c][p], 1 === i ? "<" === t ? (s(), a = [a], i = 3) : r += t : 4 === i ? "--" === r && ">" === t ? (i = 1, r = "") : r = t + r[0] : o ? t === o ? o = "" : r += t : '"' === t || "'" === t ? o = t : ">" === t ? (s(), i = 1) : i && ("=" === t ? (i = 5, n = r, r = "") : "/" === t && (i < 5 || ">" === e[c][p + 1]) ? (s(), 3 === i && (a = a[0]), i = a, (a = a[0]).push(2, 0, i), i = 0) : " " === t || "\t" === t || "\n" === t || "\r" === t ? (s(), i = 2) : r += t), 3 === i && "!--" === r && (i = 4, a = a[0]) } return s(), a }(e)), t), arguments, [])).length > 1 ? t : t[0] }.bind(Gs), xc = 0, wc = [], Ec = [], Sc = Ds.__b, Cc = Ds.__r, kc = Ds.diffed, Rc = Ds.__c, Pc = Ds.unmount; function Tc(e, t) { Ds.__h && Ds.__h(yc, e, xc || t), xc = 0; var n = yc.__H || (yc.__H = { __: [], __h: [] }); return e >= n.__.length && n.__.push({ __V: Ec }), n.__[e] } function Ac(e) { return xc = 1, function (e, t, n) { var i = Tc(vc++, 2); if (i.t = e, !i.__c && (i.__ = [n ? n(t) : Hc(void 0, t), function (e) { var t = i.__N ? i.__N[0] : i.__[0], n = i.t(t, e); t !== n && (i.__N = [n, i.__[1]], i.__c.setState({})) }], i.__c = yc, !yc.u)) { var r = function (e, t, n) { if (!i.__c.__H) return !0; var r = i.__c.__H.__.filter((function (e) { return e.__c })); if (r.every((function (e) { return !e.__N }))) return !o || o.call(this, e, t, n); var a = !1; return r.forEach((function (e) { if (e.__N) { var t = e.__[0]; e.__ = e.__N, e.__N = void 0, t !== e.__[0] && (a = !0) } })), !(!a && i.__c.props === e) && (!o || o.call(this, e, t, n)) }; yc.u = !0; var o = yc.shouldComponentUpdate, a = yc.componentWillUpdate; yc.componentWillUpdate = function (e, t, n) { if (this.__e) { var i = o; o = void 0, r(e, t, n), o = i } a && a.call(this, e, t, n) }, yc.shouldComponentUpdate = r } return i.__N || i.__ }(Hc, e) } function Mc(e, t) { var n = Tc(vc++, 3); !Ds.__s && zc(n.__H, t) && (n.__ = e, n.i = t, yc.__H.__h.push(n)) } function Dc(e, t) { var n = Tc(vc++, 4); !Ds.__s && zc(n.__H, t) && (n.__ = e, n.i = t, yc.__h.push(n)) } function Bc(e) { return xc = 5, Nc((function () { return { current: e } }), []) } function Nc(e, t) { var n = Tc(vc++, 7); return zc(n.__H, t) ? (n.__V = e(), n.i = t, n.__h = e, n.__V) : n.__ } function Oc(e, t) { return xc = 8, Nc((function () { return e }), t) } function jc() { for (var e; e = wc.shift();)if (e.__P && e.__H) try { e.__H.__h.forEach($c), e.__H.__h.forEach(Fc), e.__H.__h = [] } catch (t) { e.__H.__h = [], Ds.__e(t, e.__v) } } Ds.__b = function (e) { yc = null, Sc && Sc(e) }, Ds.__r = function (e) { Cc && Cc(e), vc = 0; var t = (yc = e.__c).__H; t && (gc === yc ? (t.__h = [], yc.__h = [], t.__.forEach((function (e) { e.__N && (e.__ = e.__N), e.__V = Ec, e.__N = e.i = void 0 }))) : (t.__h.forEach($c), t.__h.forEach(Fc), t.__h = [], vc = 0)), gc = yc }, Ds.diffed = function (e) { kc && kc(e); var t = e.__c; t && t.__H && (t.__H.__h.length && (1 !== wc.push(t) && _c === Ds.requestAnimationFrame || ((_c = Ds.requestAnimationFrame) || Ic)(jc)), t.__H.__.forEach((function (e) { e.i && (e.__H = e.i), e.__V !== Ec && (e.__ = e.__V), e.i = void 0, e.__V = Ec }))), gc = yc = null }, Ds.__c = function (e, t) { t.some((function (e) { try { e.__h.forEach($c), e.__h = e.__h.filter((function (e) { return !e.__ || Fc(e) })) } catch (n) { t.some((function (e) { e.__h && (e.__h = []) })), t = [], Ds.__e(n, e.__v) } })), Rc && Rc(e, t) }, Ds.unmount = function (e) { Pc && Pc(e); var t, n = e.__c; n && n.__H && (n.__H.__.forEach((function (e) { try { $c(e) } catch (e) { t = e } })), n.__H = void 0, t && Ds.__e(t, n.__v)) }; var Lc = "function" == typeof requestAnimationFrame; function Ic(e) { var t, n = function () { clearTimeout(i), Lc && cancelAnimationFrame(t), setTimeout(e) }, i = setTimeout(n, 100); Lc && (t = requestAnimationFrame(n)) } function $c(e) { var t = yc, n = e.__c; "function" == typeof n && (e.__c = void 0, n()), yc = t } function Fc(e) { var t = yc; e.__c = e.__(), yc = t } function zc(e, t) { return !e || e.length !== t.length || t.some((function (t, n) { return t !== e[n] })) } function Hc(e, t) { return "function" == typeof t ? t(e) : t } function Vc(e) { var t, n, i = ""; if ("string" == typeof e || "number" == typeof e) i += e; else if ("object" == typeof e) if (Array.isArray(e)) for (t = 0; t < e.length; t++)e[t] && (n = Vc(e[t])) && (i && (i += " "), i += n); else for (t in e) e[t] && (i && (i += " "), i += t); return i } function Wc() { for (var e, t, n = 0, i = ""; n < arguments.length;)(e = arguments[n++]) && (t = Vc(e)) && (i && (i += " "), i += t); return i } function Gc(e) {
        const { entry: t, selected: n, onMouseEnter: i, onMouseLeave: r, onAction: o } = e; return bc`
    <li
      class=${Wc("entry", { selected: n })}
      data-id=${t.id}
      title=${t.title || t.label}
      onClick=${o}
      onMouseEnter=${i}
      onMouseLeave=${r}
      onDragStart=${e => o(e, t, "dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${Wc("djs-popup-entry-name", t.className)}
        >
          ${t.imageUrl && bc`<img class="djs-popup-entry-icon" src=${t.imageUrl} alt="" />` || t.imageHtml && bc`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{ __html: t.imageHtml }} />`}

          ${t.label ? bc`
            <span class="djs-popup-label">
              ${t.label}
            </span>
          `: null}
        </span>
        ${t.description && bc`
          <span
            class="djs-popup-entry-description"
            title=${t.description}
          >
            ${t.description}
          </span>
        `}
      </div>
      ${t.documentationRef && bc`
        <div class="djs-popup-entry-docs">
          <a
            href="${t.documentationRef}"
            onClick=${e => e.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `} function Uc(e) {
        const { selectedEntry: t, setSelectedEntry: n, entries: i, ...r } = e, o = Bc(), a = Nc((() => function (e) { const t = [], n = e => t.find((t => e.id === t.id)), i = e => !!n(e), r = e => "string" == typeof e ? { id: e } : e; return e.forEach((e => { const o = e.group ? r(e.group) : { id: "default" }; i(o) ? n(o).entries.push(e) : t.push({ ...o, entries: [e] }) })), t }(i)), [i]); return Dc((() => { const e = o.current; if (!e) return; const t = e.querySelector(".selected"); var n; t && ("function" == typeof (n = t).scrollIntoViewIfNeeded ? n.scrollIntoViewIfNeeded() : n.scrollIntoView({ scrollMode: "if-needed", block: "nearest" })) }), [t]), bc`
    <div class="djs-popup-results" ref=${o}>
      ${a.map((e => bc`
        ${e.name && bc`
          <div key=${e.id} class="entry-header" title=${e.name}>
            ${e.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${e.id}>
          ${e.entries.map((e => bc`
            <${Gc}
              key=${e.id}
              entry=${e}
              selected=${e === t}
              onMouseEnter=${() => n(e)}
              onMouseLeave=${() => n(null)}
              ...${r}
            />
          `))}
        </ul>
      `))}
    </div>
  `} function qc(e) {
        const { onClose: t, onSelect: n, className: i, headerEntries: r, position: o, title: a, width: c, scale: p, search: l, entries: u, onOpened: h, onClosed: d } = e, f = Nc((() => !!s(l) && u.length > 5), [l, u]), m = Bc(), [v, y] = Ac(""), g = Oc(((e, t) => { if (!f) return e; return e.filter((e => { if (!t) return (e.rank || 0) >= 0; if (!1 === e.searchable) return !1; const n = [e.description || "", e.label || "", e.search || ""].join("---").toLowerCase(); return t.toLowerCase().split(/\s/g).every((e => n.includes(e))) })) }), [f]), [_, b] = Ac(g(u, v)), [x, w] = Ac(_[0]), E = Oc((e => { x && e.includes(x) || w(e[0]), b(e) }), [x, b, w]); Mc((() => { E(g(u, v)) }), [v, u]), Mc((() => { const e = e => { if ("Escape" === e.key) return e.preventDefault(), t() }; return document.documentElement.addEventListener("keydown", e), () => { document.documentElement.removeEventListener("keydown", e) } }), []), Dc((() => { m.current && m.current.focus() }), []); const S = Oc((e => { let t = _.indexOf(x) + e; t < 0 && (t = _.length - 1), t >= _.length && (t = 0), w(_[t]) }), [_, x, w]), C = Oc((e => "Enter" === e.key && x ? n(e, x) : "ArrowUp" === e.key || "Tab" === e.key && e.shiftKey ? (S(-1), e.preventDefault()) : "ArrowDown" === e.key || "Tab" === e.key ? (S(1), e.preventDefault()) : void 0), [n, t, x, S]), k = Oc((e => { J(e.target, "input") && y((() => e.target.value)) }), [y]); Mc((() => (h(), () => { d() })), []); const R = Nc((() => a || r.length > 0), [a, r]); return bc`
    <${Kc}
      onClose=${t}
      onKeyup=${k}
      onKeydown=${C}
      className=${i}
      position=${o}
      width=${c}
      scale=${p}
    >
      ${R && bc`
        <div class="djs-popup-header">
          <h3 class="djs-popup-title" title=${a}>${a}</h3>
          ${r.map((e => bc`
            <span
              class=${function (e, t) { return Wc("entry", e.className, e.active ? "active" : "", e.disabled ? "disabled" : "", t ? "selected" : "") }(e, e === x)}
              onClick=${t => n(t, e)}
              title=${e.title || e.label}
              data-id=${e.id}
              onMouseEnter=${() => w(e)}
              onMouseLeave=${() => w(null)}
            >
            ${e.imageUrl && bc`<img class="djs-popup-entry-icon" src=${e.imageUrl} alt="" />` || e.imageHtml && bc`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{ __html: e.imageHtml }} />`}

              ${e.label ? bc`
                <span class="djs-popup-label">${e.label}</span>
              `: null}
            </span>
          `))}
        </div>
      `}
      ${u.length > 0 && bc`
        <div class="djs-popup-body">

          ${f && bc`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input
                ref=${m}
                type="text"
              />
          </div>
          `}

          <${Uc}
            entries=${_}
            selectedEntry=${x}
            setSelectedEntry=${w}
            onAction=${n}
          />
        </div>
        ${0 === _.length && bc`
          <div class="djs-popup-no-results">No matching entries found.</div>
        `}
      `}
    </${Kc}>
  `} function Kc(e) {
        const { onClose: t, onKeydown: n, onKeyup: i, className: r, children: o, position: a } = e, s = Bc(), c = Oc((e => { ee(e.target, ".djs-popup", !0) || t() }), [t]); return Dc((() => { if ("function" != typeof a) return; const e = s.current, t = a(e); e.style.left = `${t.x}px`, e.style.top = `${t.y}px` }), [s.current, a]), Dc((() => { s.current && s.current.focus() }), []), bc`
    <div
      class="djs-popup-backdrop"
      onClick=${c}
    >
      <div
        class=${Wc("djs-popup", r)}
        style=${function (e) { return { transform: `scale(${e.scale})`, width: `${e.width}px` } }(e)}
        onKeydown=${n}
        onKeyup=${i}
        ref=${s}
        tabIndex="-1"
      >
        ${o}
      </div>
    </div>
  `} var Yc = ["contextPad.close", "canvas.viewbox.changing", "commandStack.changed"]; function Xc(e, t, n) { this._eventBus = t, this._canvas = n, this._current = null; var i = s(e && e.scale) ? e.scale : { min: 1, max: 1.5 }; this._config = { scale: i }, t.on("diagram.destroy", (() => { this.close() })), t.on("element.changed", (e => { const t = this.isOpen() && this._current.target; e.element === t && this._render() })) } Xc.$inject = ["config.popupMenu", "eventBus", "canvas"], Xc.prototype._render = function () {
        const { position: e, className: t, entries: n, headerEntries: i, options: r } = this._current, o = Object.entries(n).map((([e, t]) => ({ id: e, ...t }))), a = Object.entries(i).map((([e, t]) => ({ id: e, ...t }))), s = e && (t => this._ensureVisible(t, e)), c = this._updateScale(this._current.container); dc(bc`
      <${qc}
        onClose=${e => this.close(e)}
        onSelect=${(e, t, n) => this.trigger(e, t, n)}
        position=${s}
        className=${t}
        entries=${o}
        headerEntries=${a}
        scale=${c}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${{ ...r }}
      />
    `, this._current.container)
    }, Xc.prototype.open = function (e, t, n, i) { if (!e) throw new Error("target is missing"); if (!t) throw new Error("providers for <" + t + "> not found"); if (!n) throw new Error("position is missing"); this.isOpen() && this.close(); const { entries: r, headerEntries: o } = this._getContext(e, t); this._current = { position: n, className: t, target: e, entries: r, headerEntries: o, container: this._createContainer({ provider: t }), options: i }, this._emit("open"), this._bindAutoClose(), this._render() }, Xc.prototype._getContext = function (e, t) { const n = this._getProviders(t); if (!n || !n.length) throw new Error("provider for <" + t + "> not found"); const i = this._getEntries(e, n), r = this._getHeaderEntries(e, n); return { entries: i, headerEntries: r, empty: !(Object.keys(i).length || Object.keys(r).length) } }, Xc.prototype.close = function () { this.isOpen() && (this._emit("close"), this.reset(), this._current = null) }, Xc.prototype.reset = function () { const e = this._current.container; dc(null, e), ve(e) }, Xc.prototype._emit = function (e, t) { this._eventBus.fire(`popupMenu.${e}`, t) }, Xc.prototype._onOpened = function () { this._emit("opened") }, Xc.prototype._onClosed = function () { this._emit("closed") }, Xc.prototype._createContainer = function (e) { var t = this._canvas.getContainer(); const n = de(`<div class="djs-popup-parent djs-scrollable" data-popup=${e.provider}></div>`); return t.appendChild(n), n }, Xc.prototype._bindAutoClose = function () { this._eventBus.once(Yc, this.close, this) }, Xc.prototype._unbindAutoClose = function () { this._eventBus.off(Yc, this.close, this) }, Xc.prototype._updateScale = function () { var e, t, n = this._canvas.zoom(), i = this._config.scale, r = n; return !0 !== i && (!1 === i ? (e = 1, t = 1) : (e = i.min, t = i.max), s(e) && n < e && (r = e), s(t) && n > t && (r = t)), r }, Xc.prototype._ensureVisible = function (e, t) { var n = document.documentElement.getBoundingClientRect(), i = e.getBoundingClientRect(), r = {}, o = t.x, a = t.y; return t.x + i.width > n.width && (r.x = !0), t.y + i.height > n.height && (r.y = !0), r.x && r.y ? (o = t.x - i.width, a = t.y - i.height) : r.x ? (o = t.x - i.width, a = t.y) : r.y && t.y < i.height ? (o = t.x, a = 10) : r.y && (o = t.x, a = t.y - i.height), t.y < n.top && (a = t.y + i.height), { x: o, y: a } }, Xc.prototype.isEmpty = function (e, t) { if (!e) throw new Error("target is missing"); if (!t) throw new Error("provider ID is missing"); const n = this._getProviders(t); return !n || !n.length || this._getContext(e, t).empty }, Xc.prototype.registerProvider = function (e, t, n) { n || (n = t, t = 1e3), this._eventBus.on("popupMenu.getProviders." + e, t, (function (e) { e.providers.push(n) })) }, Xc.prototype._getProviders = function (e) { var t = this._eventBus.createEvent({ type: "popupMenu.getProviders." + e, providers: [] }); return this._eventBus.fire(t), t.providers }, Xc.prototype._getEntries = function (e, t) { var n = {}; return g(t, (function (t) { if (t.getPopupMenuEntries) { var i = t.getPopupMenuEntries(e); h(i) ? n = i(n) : g(i, (function (e, t) { n[t] = e })) } else g(t.getEntries(e), (function (e) { var t = e.id; if (!t) throw new Error("entry ID is missing"); n[t] = $(e, ["id"]) })) })), n }, Xc.prototype._getHeaderEntries = function (e, t) { var n = {}; return g(t, (function (t) { if (t.getPopupMenuHeaderEntries) { var i = t.getPopupMenuHeaderEntries(e); h(i) ? n = i(n) : g(i, (function (e, t) { n[t] = e })) } else { if (!t.getHeaderEntries) return; g(t.getHeaderEntries(e), (function (e) { var t = e.id; if (!t) throw new Error("entry ID is missing"); n[t] = $(e, ["id"]) })) } })), n }, Xc.prototype.isOpen = function () { return !!this._current }, Xc.prototype.trigger = function (e, t, n = "click") { if (e.preventDefault(), !t) { let n = K(ee(e.delegateTarget || e.target, ".entry", !0), "data-id"); t = { id: n, ...this._getEntry(n) } } const i = t.action; if (!1 !== this._emit("trigger", { entry: t, event: e })) if (h(i)) { if ("click" === n) return i(e, t) } else if (i[n]) return i[n](e, t) }, Xc.prototype._getEntry = function (e) { var t = this._current.entries[e] || this._current.headerEntries[e]; if (!t) throw new Error("entry not found"); return t }; var Zc = { __init__: ["popupMenu"], popupMenu: ["type", Xc] }, Qc = { align: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 2000">\n              <line x1="200" y1="150" x2="200" y2="1850" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n              <rect x="500" y="150" width="1300" height="700" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n              <rect x="500" y="1150" width="700" height="700" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>', bottom: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n            <line x1="150" y1="1650" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n            <rect x="150" y="350" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n            <rect x="1050" y="850" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>', center: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n            <line x1="900" y1="150" x2="900" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n            <rect x="250" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n            <rect x="500" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>', left: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n            <line x1="100" y1="150" x2="100" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n            <rect x="100" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n            <rect x="100" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>', right: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n            <line x1="1650" y1="150" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n            <rect x="350" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n            <rect x="850" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>', top: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n            <line x1="150" y1="150" x2="1650" y2="150" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n            <rect x="150" y="150" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n            <rect x="1050" y="150" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>', middle: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n            <line x1="150" y1="900" x2="1650" y2="900" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>\n            <rect x="150" y="250" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n            <rect x="1050" y="500" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n          </svg>' }; function Jc(e, t, n, i) { e.registerProvider(900, this), this._contextPad = e, this._popupMenu = t, this._translate = n, this._canvas = i } Jc.$inject = ["contextPad", "popupMenu", "translate", "canvas"], Jc.prototype.getMultiElementContextPadEntries = function (e) { var t = {}; return this._isAllowed(e) && L(t, this._getEntries(e)), t }, Jc.prototype._isAllowed = function (e) { return !this._popupMenu.isEmpty(e, "align-elements") }, Jc.prototype._getEntries = function () { var e = this; return { "align-elements": { group: "align-elements", title: e._translate("Align elements"), html: `<div class="entry">${Qc.align}</div>`, action: { click: function (t, n) { var i = e._getMenuPosition(n); L(i, { cursor: { x: t.x, y: t.y } }), e._popupMenu.open(n, "align-elements", i) } } } } }, Jc.prototype._getMenuPosition = function (e) { var t = this._contextPad.getPad(e).html.getBoundingClientRect(); return { x: t.left, y: t.bottom + 5 } }; var ep = ["left", "center", "right", "top", "middle", "bottom"]; function tp(e, t, n, i) { this._alignElements = t, this._translate = n, this._popupMenu = e, this._rules = i, e.registerProvider("align-elements", this) } function np(e) { la.call(this, e), this.init() } function ip(e) { np.call(this, e) } tp.$inject = ["popupMenu", "alignElements", "translate", "rules"], tp.prototype.getPopupMenuEntries = function (e) { var t = {}; return this._isAllowed(e) && L(t, this._getEntries(e)), t }, tp.prototype._isAllowed = function (e) { return this._rules.allowed("elements.align", { elements: e }) }, tp.prototype._getEntries = function (e) { var t = this._alignElements, n = this._translate, i = this._popupMenu, r = {}; return g(ep, (function (o) { r["align-elements-" + o] = { group: "align", title: n("Align elements " + o), className: "bjs-align-elements-menu-entry", imageHtml: Qc[o], action: function () { t.trigger(e, o), i.close() } } })), r }, np.$inject = ["eventBus"], e(np, la), np.prototype.addRule = function (e, t, n) { var i = this; "string" == typeof e && (e = [e]), e.forEach((function (e) { i.canExecute(e, t, (function (e, t, i) { return n(e) }), !0) })) }, np.prototype.init = function () { }, ip.$inject = ["eventBus"], e(ip, np), ip.prototype.init = function () { this.addRule("elements.align", (function (e) { var t = y(e.elements, (function (e) { return !(e.waypoints || e.host || e.labelTarget) })); return !((t = ut(t)).length < 2) && t })) }; var rp = { __depends__: [Rs, Is, Zc], __init__: ["alignElementsContextPadProvider", "alignElementsMenuProvider", "bpmnAlignElements"], alignElementsContextPadProvider: ["type", Jc], alignElementsMenuProvider: ["type", tp], bpmnAlignElements: ["type", ip] }, op = 10, ap = 50, sp = 250; function cp(e, t, n, i) { for (var r; r = lp(e, n, t);)n = i(t, n, r); return n } function pp(e) { return function (t, n, i) { var r = { x: n.x, y: n.y }; return ["x", "y"].forEach((function (o) { var a = e[o]; if (a) { var s = "x" === o ? "width" : "height", c = a.margin, p = a.minDistance; r[o] = c < 0 ? Math.min(i[o] + c - t[s] / 2, n[o] - p + c) : Math.max(i[o] + i[s] + c + t[s] / 2, n[o] + p + c) } })), r } } function lp(e, t, n) { var i = { x: t.x - n.width / 2, y: t.y - n.height / 2, width: n.width, height: n.height }, r = function (e) { var t = up(e); e.host && (t = t.concat(up(e.host))); e.attachers && (t = t.concat(e.attachers.reduce((function (e, t) { return e.concat(up(t)) }), []))); return t }(e); return m(r, (function (e) { return e !== n && "intersect" === _n(e, i, op) })) } function up(e) { return (t = e, t.outgoing.map((function (e) { return e.target }))).concat(function (e) { return e.incoming.map((function (e) { return e.source })) }(e)); var t } function hp() { return !0 } function dp(e, t, n) { e.on("autoPlace", 100, (function (e) { var t = e.shape; return function (e, t, n) { n || (n = {}); var i = n.defaultDistance || ap, r = gn(e), o = mn(e); return { x: o.right + i + t.width / 2, y: r.y } }(e.source, t) })), e.on("autoPlace.end", (function (e) { n.scrollToElement(e.shape) })), this.append = function (n, i, r) { e.fire("autoPlace.start", { source: n, shape: i }); var o = e.fire("autoPlace", { source: n, shape: i }), a = t.appendShape(n, i, o, n.parent, r); return e.fire("autoPlace.end", { source: n, shape: a }), a } } function fp(e, t) { e.on("autoPlace.end", 500, (function (e) { t.select(e.shape) })) } dp.$inject = ["eventBus", "modeling", "canvas"], fp.$inject = ["eventBus", "selection"]; var mp = { __init__: ["autoPlaceSelectionBehavior"], autoPlace: ["type", dp], autoPlaceSelectionBehavior: ["type", fp] }; function vp(e, t) { for (d(t) && (t = [t]); e = e.parent;)if (Sr(e, t)) return e; return null } function yp(e, t) { return Er(t, "bpmn:TextAnnotation") ? function (e, t) { var n = mn(e), i = { x: n.right + t.width / 2, y: n.top - 50 - t.height / 2 }; un(e) && ((i = gn(e)).x += 100, i.y -= 50); return cp(e, t, i, pp({ y: { margin: -30, minDistance: 20 } })) }(e, t) : Sr(t, ["bpmn:DataObjectReference", "bpmn:DataStoreReference"]) ? function (e, t) { var n = mn(e), i = { x: n.right - 10 + t.width / 2, y: n.bottom + 40 + t.width / 2 }; return cp(e, t, i, pp({ x: { margin: 30, minDistance: 30 } })) }(e, t) : Er(t, "bpmn:FlowNode") ? function (e, t) { var n = mn(e), i = gn(e), r = function (e, t) { t || (t = {}); var n = t.defaultDistance || ap, i = t.direction || "e", r = t.filter, o = t.getWeight || function (t) { return t.source === e ? 1 : -1 }, a = t.maxDistance || sp, s = t.reference || "start"; function c(e, t) { return "n" === i ? "start" === s ? mn(e).top - mn(t).bottom : "center" === s ? mn(e).top - gn(t).y : mn(e).top - mn(t).top : "w" === i ? "start" === s ? mn(e).left - mn(t).right : "center" === s ? mn(e).left - gn(t).x : mn(e).left - mn(t).left : "s" === i ? "start" === s ? mn(t).top - mn(e).bottom : "center" === s ? gn(t).y - mn(e).bottom : mn(t).bottom - mn(e).bottom : "start" === s ? mn(t).left - mn(e).right : "center" === s ? gn(t).x - mn(e).right : mn(t).right - mn(e).right } r || (r = hp); var p = e.incoming.filter(r).map((function (t) { var n = o(t), i = n < 0 ? c(t.source, e) : c(e, t.source); return { id: t.source.id, distance: i, weight: n } })), l = e.outgoing.filter(r).map((function (t) { var n = o(t), i = n > 0 ? c(e, t.target) : c(t.target, e); return { id: t.target.id, distance: i, weight: n } })), u = b(p.concat(l).reduce((function (e, t) { return e[t.id + "__weight_" + t.weight] = t, e }), {}), (function (e, t) { var n = t.distance, i = t.weight; return n < 0 || n > a || (e[String(n)] || (e[String(n)] = 0), e[String(n)] += 1 * i, (!e.distance || e[e.distance] < e[String(n)]) && (e.distance = n)), e }), {}); return u.distance || n }(e, { filter: function (e) { return Er(e, "bpmn:SequenceFlow") } }), o = 30, a = 80, s = "left"; Er(e, "bpmn:BoundaryEvent") && -1 !== (s = _n(e, e.host, -25)).indexOf("top") && (o *= -1); var c = { x: n.right + r + t.width / 2, y: i.y + gp(s, a) }; return cp(e, t, c, pp({ y: { margin: o, minDistance: a } })) }(e, t) : void 0 } function gp(e, t) { return e.includes("top") ? -1 * t : e.includes("bottom") ? t : 0 } function _p(e) { e.on("autoPlace", (function (e) { var t = e.shape; return yp(e.source, t) })) } _p.$inject = ["eventBus"]; var bp = { __depends__: [mp], __init__: ["bpmnAutoPlace"], bpmnAutoPlace: ["type", _p] }; function xp(e, t, n, r) { la.call(this, e), this._elementRegistry = t, this._modeling = n, this._rules = r; var o = this; this.postExecuted(["shape.create"], (function (e) { var t = e.context, n = t.hints || {}, i = t.shape, r = t.parent || t.newParent; !1 !== n.autoResize && o._expand([i], r) })), this.postExecuted(["elements.move"], (function (e) { var t = e.context, n = i(C(t.closure.topLevel)), r = t.hints, a = !r || r.autoResize; !1 !== a && g(k(n, (function (e) { return e.parent.id })), (function (e, t) { p(a) && (e = e.filter((function (e) { return m(a, A({ id: e.id })) }))), o._expand(e, t) })) })), this.postExecuted(["shape.toggleCollapse"], (function (e) { var t = e.context, n = t.hints, i = t.shape; n && !1 === n.autoResize || i.collapsed || o._expand(i.children || [], i) })), this.postExecuted(["shape.resize"], (function (e) { var t = e.context, n = t.hints, i = t.shape, r = i.parent; n && !1 === n.autoResize || r && o._expand([i], r) })) } function wp(e) { e.invoke(xp, this) } function Ep(e) { np.call(this, e); var t = this; this.addRule("element.autoResize", (function (e) { return t.canResize(e.elements, e.target) })) } function Sp(e, t) { Ep.call(this, e), this._modeling = t } xp.$inject = ["eventBus", "elementRegistry", "modeling", "rules"], e(xp, la), xp.prototype._getOptimalBounds = function (e, t) { var n = this.getOffset(t), i = this.getPadding(t), r = mn(vt(e)), o = mn(t), a = {}; return r.top - o.top < i.top && (a.top = r.top - n.top), r.left - o.left < i.left && (a.left = r.left - n.left), o.right - r.right < i.right && (a.right = r.right + n.right), o.bottom - r.bottom < i.bottom && (a.bottom = r.bottom + n.bottom), vn(L({}, o, a)) }, xp.prototype._expand = function (e, t) { if ("string" == typeof t && (t = this._elementRegistry.get(t)), this._rules.allowed("element.autoResize", { elements: e, target: t })) { var n = this._getOptimalBounds(e, t); if (function (e, t) { return e.x !== t.x || e.y !== t.y || e.width !== t.width || e.height !== t.height }(n, t)) { var i = function (e, t) { var n = ""; e = mn(e), t = mn(t), e.top > t.top && (n = n.concat("n")); e.right < t.right && (n = n.concat("w")); e.bottom < t.bottom && (n = n.concat("s")); e.left > t.left && (n = n.concat("e")); return n }(I(t, ["x", "y", "width", "height"]), n); this.resize(t, n, { autoResize: i }); var r = t.parent; r && this._expand([t], r) } } }, xp.prototype.getOffset = function (e) { return { top: 60, bottom: 60, left: 100, right: 100 } }, xp.prototype.getPadding = function (e) { return { top: 2, bottom: 2, left: 15, right: 15 } }, xp.prototype.resize = function (e, t, n) { this._modeling.resizeShape(e, t, null, n) }, wp.$inject = ["injector"], e(wp, xp), wp.prototype.resize = function (e, t, n) { Er(e, "bpmn:Participant") ? this._modeling.resizeLane(e, t, null, n) : this._modeling.resizeShape(e, t, null, n) }, Ep.$inject = ["eventBus"], e(Ep, np), Ep.prototype.canResize = function (e, t) { return !1 }, e(Sp, Ep), Sp.$inject = ["eventBus", "modeling"], Sp.prototype.canResize = function (e, t) { if (Er(t.di, "bpmndi:BPMNPlane")) return !1; if (!Er(t, "bpmn:Participant") && !Er(t, "bpmn:Lane") && !Er(t, "bpmn:SubProcess")) return !1; var n = !0; return g(e, (function (e) { (Er(e, "bpmn:Lane") || hn(e)) && (n = !1) })), n }; var Cp = { __init__: ["bpmnAutoResize", "bpmnAutoResizeProvider"], bpmnAutoResize: ["type", wp], bpmnAutoResizeProvider: ["type", Sp] }; function kp(e, t, n) { var i, r, o = this, a = n.get("dragging", !1); a && t.on("drag.start", (function (n) { t.once("drag.move", 1500, (function (t) { !function (t) { if (!t.hover) { var n = t.originalEvent, i = o._findTargetGfx(n), r = i && e.get(i); i && r && (t.stopPropagation(), a.hover({ element: r, gfx: i }), a.move(n)) } }(t) })) })), t.on("element.hover", (function (e) { i = e.gfx, r = e.element })), t.on("element.hover", 1500, (function (e) { r && t.fire("element.out", { element: r, gfx: i }) })), t.on("element.out", (function () { i = null, r = null })), this._findTargetGfx = function (e) { var t; if (e instanceof MouseEvent) return t = jo(e), function (e) { return ee(e, "svg, .djs-element", !0) }(document.elementFromPoint(t.x, t.y)) } } kp.$inject = ["elementRegistry", "eventBus", "injector"]; var Rp = { __init__: ["hoverFix"], hoverFix: ["type", kp] }, Pp = Math.round, Tp = "djs-drag-active"; function Ap(e) { e.preventDefault() } function Mp(e, t, n, i) { var r, o = { threshold: 5, trapClick: !0 }; function a(e) { var n = t.viewbox(), i = t._container.getBoundingClientRect(); return { x: n.x + (e.x - i.left) / n.scale, y: n.y + (e.y - i.top) / n.scale } } function s(t, n) { n = n || r; var i = e.createEvent(L({}, n.payload, n.data, { isTouch: n.isTouch })); return !1 !== e.fire("drag." + t, i) && e.fire(n.prefix + "." + t, i) } function c(e, i) { var o, c = r.payload, p = r.displacement, l = r.globalStart, u = jo(e), h = ns(u, l), d = r.localStart, f = a(u), v = ns(f, d); if (!r.active && (i || (o = h, Math.sqrt(Math.pow(o.x, 2) + Math.pow(o.y, 2)) > r.threshold))) { if (L(c, { x: Pp(d.x + p.x), y: Pp(d.y + p.y), dx: 0, dy: 0 }, { originalEvent: e }), !1 === s("start")) return m(); r.active = !0, r.keepSelection || (c.previousSelection = n.get(), n.select(null)), r.cursor && Za(r.cursor), t.addMarker(t.getRootElement(), Tp) } Oo(e), r.active && (L(c, { x: Pp(f.x + p.x), y: Pp(f.y + p.y), dx: Pp(v.x), dy: Pp(v.y) }, { originalEvent: e }), s("move")) } function p(e) { var t = !0; r.active && (e && (r.payload.originalEvent = e, Oo(e)), t = s("end")), !1 === t && s("rejected"), s("ended", v(!0 !== t)) } function l(e) { $a("Escape", e) && (Ap(e), m()) } function u(t) { var n; r.active && (n = es(e), setTimeout(n, 400), Ap(t)), p(t) } function h(e) { c(e) } function d(e) { var t = r.payload; t.hoverGfx = e.gfx, t.hover = e.element, s("hover") } function f(e) { s("out"); var t = r.payload; t.hoverGfx = null, t.hover = null } function m(e) { var t; if (r) { var n = r.active; n && s("cancel"), t = v(e), n && s("canceled", t) } } function v(o) { var a, v; s("cleanup"), Qa(), v = r.trapClick ? u : p, ae.unbind(document, "mousemove", c), ae.unbind(document, "dragstart", Ap), ae.unbind(document, "selectstart", Ap), ae.unbind(document, "mousedown", v, !0), ae.unbind(document, "mouseup", v, !0), ae.unbind(document, "keyup", l), ae.unbind(document, "touchstart", h, !0), ae.unbind(document, "touchcancel", m, !0), ae.unbind(document, "touchmove", c, !0), ae.unbind(document, "touchend", p, !0), e.off("element.hover", d), e.off("element.out", f), t.removeMarker(t.getRootElement(), Tp); var y = r.payload.previousSelection; return !1 !== o && y && !n.get().length && function (e) { var t = e.filter((function (e) { return i.get(e.id) })); t.length && n.select(t) }(y), a = r, r = null, a } e.on("diagram.destroy", m), this.init = function (t, n, i, v) { r && m(!1), "string" == typeof n && (v = i, i = n, n = null); var y, g, _, b, x, w = (v = L({}, o, v || {})).data || {}; b = v.trapClick ? u : p, t ? (y = No(t) || t, g = jo(t), Oo(t), "dragstart" === y.type && Ap(y)) : (y = null, g = { x: 0, y: 0 }), _ = a(g), n || (n = _), x = function (e) { return "undefined" != typeof TouchEvent && e instanceof TouchEvent }(y), r = L({ prefix: i, data: w, payload: {}, globalStart: g, displacement: ns(n, _), localStart: _, isTouch: x }, v), v.manual || (x ? (ae.bind(document, "touchstart", h, !0), ae.bind(document, "touchcancel", m, !0), ae.bind(document, "touchmove", c, !0), ae.bind(document, "touchend", p, !0)) : (ae.bind(document, "mousemove", c), ae.bind(document, "dragstart", Ap), ae.bind(document, "selectstart", Ap), ae.bind(document, "mousedown", b, !0), ae.bind(document, "mouseup", b, !0)), ae.bind(document, "keyup", l), e.on("element.hover", d), e.on("element.out", f)), s("init"), v.autoActivate && c(t, !0) }, this.move = c, this.hover = d, this.out = f, this.end = p, this.cancel = m, this.context = function () { return r }, this.setOptions = function (e) { L(o, e) } } Mp.$inject = ["eventBus", "canvas", "selection", "elementRegistry"]; var Dp = { __depends__: [Rp, ea], dragging: ["type", Mp] }; function Bp(e, t, n) { this._canvas = n, this._opts = L({ scrollThresholdIn: [20, 20, 20, 20], scrollThresholdOut: [0, 0, 0, 0], scrollRepeatTimeout: 15, scrollStep: 10 }, e); var i = this; t.on("drag.move", (function (e) { var t = i._toBorderPoint(e); i.startScroll(t) })), t.on(["drag.cleanup"], (function () { i.stopScroll() })) } function Np(e, t, n) { return t < e && e < n } Bp.$inject = ["config.autoScroll", "eventBus", "canvas"], Bp.prototype.startScroll = function (e) { var t = this._canvas, n = this._opts, i = this, r = t.getContainer().getBoundingClientRect(), o = [e.x, e.y, r.width - e.x, r.height - e.y]; this.stopScroll(); for (var a = 0, s = 0, c = 0; c < 4; c++)Np(o[c], n.scrollThresholdOut[c], n.scrollThresholdIn[c]) && (0 === c ? a = n.scrollStep : 1 == c ? s = n.scrollStep : 2 == c ? a = -n.scrollStep : 3 == c && (s = -n.scrollStep)); 0 === a && 0 === s || (t.scroll({ dx: a, dy: s }), this._scrolling = setTimeout((function () { i.startScroll(e) }), n.scrollRepeatTimeout)) }, Bp.prototype.stopScroll = function () { clearTimeout(this._scrolling) }, Bp.prototype.setOptions = function (e) { this._opts = L({}, this._opts, e) }, Bp.prototype._toBorderPoint = function (e) { var t = this._canvas._container.getBoundingClientRect(), n = jo(e.originalEvent); return { x: n.x - t.left, y: n.y - t.top } }; var Op = { __depends__: [Dp], __init__: ["autoScroll"], autoScroll: ["type", Bp] }; function jp(e) { this._commandStack = e.get("commandStack", !1) } jp.$inject = ["injector"], jp.prototype.allowed = function (e, t) { var n = !0, i = this._commandStack; return i && (n = i.canExecute(e, t)), void 0 === n || n }; var Lp = { __init__: ["rules"], rules: ["type", jp] }, Ip = Math.round, $p = Math.max; var Fp = 10; function zp(e, t) { return function (e, t) { var n, i; for (n = 0; i = e[n]; n++)if (Ct(i, t) <= Fp) return { point: e[n], bendpoint: !0, index: n }; return null }(e, t) || function (e, t) { var n, i, r = rn(function (e, t) { return [["M", e.x, e.y], ["m", 0, -t], ["a", t, t, 0, 1, 1, 0, 2 * t], ["a", t, t, 0, 1, 1, 0, -2 * t], ["z"]] }(t, Fp), (n = [], e.forEach((function (e, t) { n.push([0 === t ? "M" : "L", e.x, e.y]) })), n)), o = r[0], a = r[r.length - 1]; return o ? o !== a ? o.segment2 !== a.segment2 ? { point: e[i = $p(o.segment2, a.segment2) - 1], bendpoint: !0, index: i } : { point: { x: Ip(o.x + a.x) / 2, y: Ip(o.y + a.y) / 2 }, index: o.segment2 } : { point: { x: Ip(o.x), y: Ip(o.y) }, index: o.segment2 } : null }(e, t) } function Hp(e) { return Math.sqrt(Math.pow(e.x, 2) + Math.pow(e.y, 2)) } function Vp(e) { return Math.atan((e[1].y - e[0].y) / (e[1].x - e[0].x)) } function Wp(e, t) { var n = t[0], i = t[1], r = { x: i.x - n.x, y: i.y - n.y }, o = function (e, t, n) { var i = [{ n: e[0] - n[0], lambda: t[0] }, { n: e[1] - n[1], lambda: t[1] }]; return -(i[0].n * t[0] + i[1].n * t[1]) / (i[0].lambda * t[0] + i[1].lambda * t[1]) }([n.x, n.y], [r.x, r.y], [e.x, e.y]); return { x: n.x + o * r.x, y: n.y + o * r.y } } function Gp(e, t) { var n = Wp(e, t); return Hp({ x: n.x - e.x, y: n.y - e.y }) } function Up(e, t) { return Hp({ x: e.x - t.x, y: e.y - t.y }) } var qp = "djs-bendpoint", Kp = "djs-segment-dragger"; function Yp(e, t, n) { var i = function (e, t) { var n, i = jo(t), r = e._container.getBoundingClientRect(); n = { x: r.left, y: r.top }; var o = e.viewbox(); return { x: o.x + (i.x - n.x) / o.scale, y: o.y + (i.y - n.y) / o.scale } }(e, n); return zp(t, i) } function Xp(e, t) { var n = De("g"); Se(n).add(qp), ge(e, n); var i = De("circle"); we(i, { cx: 0, cy: 0, r: 4 }), Se(i).add("djs-visual"), ge(n, i); var r = De("circle"); return we(r, { cx: 0, cy: 0, r: 10 }), Se(r).add("djs-hit"), ge(n, r), t && Se(n).add(t), n } function Zp(e, t, n, i) { var r = De("g"); ge(e, r); var o = function (e, t, n) { var i = t.x - e.x, r = t.y - e.y; return Jp("h" === n ? i : r) }(t, n, i), a = De("rect"); we(a, { x: -9, y: -3, width: 18, height: 6 }), Se(a).add("djs-visual"), ge(r, a); var s = De("rect"); return we(s, { x: -o / 2, y: -8.5, width: o, height: 17 }), Se(s).add("djs-hit"), ge(r, s), Xn(r, "v" === i ? 90 : 0), r } function Qp(e, t, n) { var i = De("g"), r = Mt(t, n), o = Pt(t, n); return ge(e, i), Zp(i, t, n, o), Se(i).add(Kp), Se(i).add("h" === o ? "horizontal" : "vertical"), Yn(i, r.x, r.y), i } function Jp(e) { return Math.abs(Math.round(2 * e / 3)) } function el(e, t) { var n = function (e, t) { for (var n, i = t.waypoints, r = 1 / 0, o = 0; o < i.length - 1; o++) { var a = Gp(e, [i[o], i[o + 1]]); a < r && (r = a, n = o) } return [i[n], i[n + 1]] }(e, t); return Wp(e, n) } function tl(e, t, n, i, r) { function o(e, n) { var o, a = n.waypoints, s = Yp(t, a, e); if (s) return o = function (e, t) { var n, i, r = e.waypoints; return t.index <= 0 || t.bendpoint ? null : (i = Pt((n = { start: r[t.index - 1], end: r[t.index] }).start, n.end)) ? Jp("h" === i ? n.end.x - n.start.x : n.end.y - n.start.y) / 2 : null }(n, s), !function (e, t, n) { var i, r, o, a, s, c, p = e.index, l = e.point; return !(p <= 0 || e.bendpoint) && (o = Mt(i = t[p - 1], r = t[p]), a = Pt(i, r), s = Math.abs(l.x - o.x), c = Math.abs(l.y - o.y), a && s <= n && c <= n) }(s, a, o) ? i.start(e, n, s.index, !s.bendpoint) : r.start(e, n, s.index), !0 } function a(e, t, i) { ae.bind(e, t, (function (e) { n.triggerMouseEvent(t, e, i), e.stopPropagation() })) } function s(e, n) { var i = t.getLayer("overlays"), r = fe('.djs-bendpoints[data-element-id="' + fa(e.id) + '"]', i); return !r && n && (we(r = De("g"), { "data-element-id": e.id }), Se(r).add("djs-bendpoints"), ge(i, r), a(r, "mousedown", e), a(r, "click", e), a(r, "dblclick", e)), r } function c(e, t) { return fe('.djs-segment-dragger[data-segment-idx="' + e + '"]', t) } function p(e, t) { t.waypoints.forEach((function (t, n) { var i = Xp(e); ge(e, i), Yn(i, t.x, t.y) })), Xp(e, "floating") } function l(e, t) { for (var n, i, r, o = t.waypoints, s = 1; s < o.length; s++)Pt(n = o[s - 1], i = o[s]) && (we(r = Qp(e, n, i), { "data-segment-idx": s }), a(r, "mousemove", t)) } function u(e) { var t = s(e); return t || (p(t = s(e, !0), e), l(t, e)), t } function h(e) { var t = s(e); t && (!function (e) { g(me("." + Kp, e), (function (e) { ke(e) })) }(t), function (e) { g(me("." + qp, e), (function (e) { ke(e) })) }(t), l(t, e), p(t, e)) } function d(e, t, n) { var i, r, o = c(t.index, e), a = n[t.index - 1], s = n[t.index], p = t.point, l = Mt(a, s), u = Pt(a, s); o && (i = function (e) { return fe(".djs-visual", e) }(o), r = { x: p.x - l.x, y: p.y - l.y }, "v" === u && (r = { x: r.y, y: r.x }), Yn(i, r.x, r.y)) } e.on("connection.changed", (function (e) { h(e.element) })), e.on("connection.remove", (function (e) { var t = s(e.element); t && ke(t) })), e.on("element.marker.update", (function (e) { var t, n = e.element; n.waypoints && (t = u(n), e.add ? Se(t).add(e.marker) : Se(t).remove(e.marker)) })), e.on("element.mousemove", (function (e) { var n, i, r = e.element, o = r.waypoints; if (o) { if (n = s(r, !0), !(i = Yp(t, o, e.originalEvent))) return; !function (e, t) { var n = fe(".floating", e), i = t.point; n && Yn(n, i.x, i.y) }(n, i), i.bendpoint || d(n, i, o) } })), e.on("element.mousedown", (function (e) { if ($o(e)) { var t = e.originalEvent, n = e.element; if (n.waypoints) return o(t, n) } })), e.on("selection.changed", (function (e) { var t = e.newSelection[0]; t && t.waypoints && u(t) })), e.on("element.hover", (function (e) { var t = e.element; t.waypoints && (u(t), n.registerEvent(e.gfx, "mousemove", "element.mousemove")) })), e.on("element.out", (function (e) { n.unregisterEvent(e.gfx, "mousemove", "element.mousemove") })), e.on("element.updateId", (function (e) { var t = e.element, n = e.newId; if (t.waypoints) { var i = s(t); i && we(i, { "data-element-id": n }) } })), this.addHandles = u, this.updateHandles = h, this.getBendpointsContainer = s, this.getSegmentDragger = c } tl.$inject = ["eventBus", "canvas", "interactionEvents", "bendpointMove", "connectionSegmentMove"]; var nl = Math.round, il = "reconnectStart", rl = "reconnectEnd", ol = "updateWaypoints"; function al(e, t, n, i, r, o) { this._injector = e, this.start = function (e, t, o, a) { var s, c = n.getGraphics(t), p = t.source, l = t.target, u = t.waypoints, h = (s = a || 0 !== o ? a || o !== u.length - 1 ? ol : rl : il) === ol ? "connection.updateWaypoints" : "connection.reconnect", d = r.allowed(h, { connection: t, source: p, target: l }); !1 === d && (d = r.allowed(h, { connection: t, source: l, target: p })), !1 !== d && i.init(e, "bendpoint.move", { data: { connection: t, connectionGfx: c, context: { allowed: d, bendpointIndex: o, connection: t, source: p, target: l, insert: a, type: s } } }) }, t.on("bendpoint.move.hover", (function (e) { var t, n = e.context, i = n.connection, o = i.source, a = i.target, s = e.hover, c = n.type; if (n.hover = s, s) { var p = c === ol ? "connection.updateWaypoints" : "connection.reconnect"; if (t = n.allowed = r.allowed(p, { connection: i, source: c === il ? s : o, target: c === rl ? s : a })) return n.source = c === il ? s : o, void (n.target = c === rl ? s : a); !1 === t && (t = n.allowed = r.allowed(p, { connection: i, source: c === rl ? s : a, target: c === il ? s : o })), t && (n.source = c === rl ? s : a, n.target = c === il ? s : o) } })), t.on(["bendpoint.move.out", "bendpoint.move.cleanup"], (function (e) { var t = e.context, n = t.type; t.hover = null, t.source = null, t.target = null, n !== ol && (t.allowed = !1) })), t.on("bendpoint.move.end", (function (e) { var t = e.context, n = t.allowed, i = t.bendpointIndex, r = t.connection, a = t.insert, s = r.waypoints.slice(), c = t.source, p = t.target, l = t.type, u = t.hints || {}, h = { x: nl(e.x), y: nl(e.y) }; if (!n) return !1; l === ol ? (a ? s.splice(i, 0, h) : s[i] = h, u.bendpointMove = { insert: a, bendpointIndex: i }, s = this.cropWaypoints(r, s), o.updateWaypoints(r, function (e) { e = e.slice(); for (var t, n, i, r = 0; e[r];)t = e[r], n = e[r - 1], 0 === Ct(t, i = e[r + 1]) || kt(n, i, t) ? e.splice(r, 1) : r++; return e }(s), u)) : (l === il ? (u.docking = "source", sl(t) && (u.docking = "target", u.newWaypoints = s.reverse())) : l === rl && (u.docking = "target", sl(t) && (u.docking = "source", u.newWaypoints = s.reverse())), o.reconnect(r, c, p, h, u)) }), this) } function sl(e) { var t = e.hover, n = e.source, i = e.target, r = e.type; return r === il ? t && i && t === i && n !== i : r === rl ? t && n && t === n && n !== i : void 0 } al.$inject = ["injector", "eventBus", "canvas", "dragging", "rules", "modeling"], al.prototype.cropWaypoints = function (e, t) { var n = this._injector.get("connectionDocking", !1); if (!n) return t; var i = e.waypoints; return e.waypoints = t, e.waypoints = n.getCroppedWaypoints(e), t = e.waypoints, e.waypoints = i, t }; var cl = "updateWaypoints", pl = "connect-ok", ll = "connect-not-ok", ul = "connect-hover", hl = "djs-updating", dl = "djs-dragging"; function fl(e, t, n, i) { this._injector = t; var r = t.get("connectionPreview", !1); n.on("bendpoint.move.start", (function (e) { var t = e.context, n = t.bendpointIndex, r = t.connection, o = t.insert, a = r.waypoints, s = a.slice(); t.waypoints = a, o && s.splice(n, 0, { x: e.x, y: e.y }), r.waypoints = s, Se(t.draggerGfx = Xp(i.getLayer("overlays"))).add("djs-dragging"), i.addMarker(r, dl), i.addMarker(r, hl) })), n.on("bendpoint.move.hover", (function (e) { var t = e.context, n = t.allowed, r = t.hover, o = t.type; if (r) { if (i.addMarker(r, ul), o === cl) return; n ? (i.removeMarker(r, ll), i.addMarker(r, pl)) : !1 === n && (i.removeMarker(r, pl), i.addMarker(r, ll)) } })), n.on(["bendpoint.move.out", "bendpoint.move.cleanup"], 1100, (function (e) { var t = e.context, n = t.hover, r = t.target; n && (i.removeMarker(n, ul), i.removeMarker(n, r ? pl : ll)) })), n.on("bendpoint.move.move", (function (t) { var n = t.context, i = n.allowed, o = n.bendpointIndex, a = n.draggerGfx, s = n.hover, c = n.type, p = n.connection, l = p.source, u = p.target, h = p.waypoints.slice(), d = { x: t.x, y: t.y }, f = n.hints || {}, m = {}; r && (f.connectionStart && (m.connectionStart = f.connectionStart), f.connectionEnd && (m.connectionEnd = f.connectionEnd), "reconnectStart" === c ? sl(n) ? (m.connectionEnd = m.connectionEnd || d, m.source = u, m.target = s || l, h = h.reverse()) : (m.connectionStart = m.connectionStart || d, m.source = s || l, m.target = u) : "reconnectEnd" === c ? sl(n) ? (m.connectionStart = m.connectionStart || d, m.source = s || u, m.target = l, h = h.reverse()) : (m.connectionEnd = m.connectionEnd || d, m.source = l, m.target = s || u) : (m.noCropping = !0, m.noLayout = !0, h[o] = d), c === cl && (h = e.cropWaypoints(p, h)), m.waypoints = h, r.drawPreview(n, i, m)), Yn(a, t.x, t.y) }), this), n.on(["bendpoint.move.end", "bendpoint.move.cancel"], 1100, (function (e) { var t = e.context, n = t.connection, o = t.draggerGfx, a = t.hover, s = t.target, c = t.waypoints; n.waypoints = c, ke(o), i.removeMarker(n, hl), i.removeMarker(n, dl), a && (i.removeMarker(a, pl), i.removeMarker(a, s ? pl : ll)), r && r.cleanUp(t) })) } fl.$inject = ["bendpointMove", "injector", "eventBus", "canvas"]; var ml = "connect-hover", vl = "djs-updating"; function yl(e, t, n) { return gl(e, t, e[t] + n) } function gl(e, t, n) { return { x: "x" === t ? n : e.x, y: "y" === t ? n : e.y } } function _l(e) { return "x" === e ? "y" : "x" } function bl(e, t, n) { var i, r; return e.original ? e.original : (i = gn(t), gl(e, r = _l(n), i[r])) } function xl(e, t, n, i, r, o) { var a = e.get("connectionDocking", !1); function s(e, t) { if (!a) return t; var n, i = e.waypoints; return e.waypoints = t, n = a.getCroppedWaypoints(e), e.waypoints = i, n } function c(e) { r.update("connection", e.connection, e.connectionGfx) } function p(e, t, n) { var i = e.newWaypoints, r = function (e, t, n, i) { var r = Math.max(t[i], n[i]), o = Math.min(t[i], n[i]); return gl(t, i, Math.min(Math.max(o + 20, e[i]), r - 20)) }(n, i[e.segmentStartIndex + t], i[e.segmentEndIndex + t], _l(e.axis)); Yn(e.draggerGfx, r.x, r.y) } this.start = function (e, t, r) { var o, a, s, c, p = n.getGraphics(t), l = r - 1, u = r, h = t.waypoints, d = h[l], f = h[u], m = Yp(n, h, e); (a = Pt(d, f)) && (s = "v" === a ? "x" : "y", 0 === l && (d = bl(d, t.source, s)), u === h.length - 1 && (f = bl(f, t.target, s)), o = { connection: t, segmentStartIndex: l, segmentEndIndex: u, segmentStart: d, segmentEnd: f, axis: s, dragPosition: c = m ? m.point : { x: (d.x + f.x) / 2, y: (d.y + f.y) / 2 } }, i.init(e, c, "connectionSegment.move", { cursor: "x" === s ? "resize-ew" : "resize-ns", data: { connection: t, connectionGfx: p, context: o } })) }, t.on("connectionSegment.move.start", (function (e) { var t = e.context, i = e.connection, r = n.getLayer("overlays"); t.originalWaypoints = i.waypoints.slice(), t.draggerGfx = Qp(r, t.segmentStart, t.segmentEnd), Se(t.draggerGfx).add("djs-dragging"), n.addMarker(i, vl) })), t.on("connectionSegment.move.move", (function (e) { var t, n, i = e.context, r = i.connection, o = i.segmentStartIndex, a = i.segmentEndIndex, l = i.segmentStart, u = i.segmentEnd, h = i.axis, d = i.originalWaypoints.slice(), f = yl(l, h, e["d" + h]), m = yl(u, h, e["d" + h]), v = d.length, y = 0; d[o] = f, d[a] = m, o < 2 && (t = _n(r.source, f), 1 === o ? "intersect" === t && (d.shift(), d[0] = f, y--) : "intersect" !== t && (d.unshift(l), y++)), a > v - 3 && (n = _n(r.target, m), a === v - 2 ? "intersect" === n && (d.pop(), d[d.length - 1] = m) : "intersect" !== n && d.push(u)), i.newWaypoints = r.waypoints = s(r, d), p(i, y, e), i.newSegmentStartIndex = o + y, c(e) })), t.on("connectionSegment.move.hover", (function (e) { e.context.hover = e.hover, n.addMarker(e.hover, ml) })), t.on(["connectionSegment.move.out", "connectionSegment.move.cleanup"], (function (e) { var t = e.context.hover; t && n.removeMarker(t, ml) })), t.on("connectionSegment.move.cleanup", (function (e) { var t = e.context, i = t.connection; t.draggerGfx && ke(t.draggerGfx), n.removeMarker(i, vl) })), t.on(["connectionSegment.move.cancel", "connectionSegment.move.end"], (function (e) { var t = e.context; t.connection.waypoints = t.originalWaypoints, c(e) })), t.on("connectionSegment.move.end", (function (e) { var t = e.context, n = t.connection, i = t.newWaypoints, r = t.newSegmentStartIndex; i = i.map((function (e) { return { original: e.original, x: Math.round(e.x), y: Math.round(e.y) } })); var a = function (e, t) { var n = 0, i = e.filter((function (i, r) { return !kt(e[r - 1], e[r + 1], i) || (n = r <= t ? n - 1 : n, !1) })); return { waypoints: i, segmentOffset: n } }(i, r), c = s(n, a.waypoints), p = a.segmentOffset, l = { segmentMove: { segmentStartIndex: t.segmentStartIndex, newSegmentStartIndex: r + p } }; o.updateWaypoints(n, c, l) })) } xl.$inject = ["injector", "eventBus", "canvas", "dragging", "graphicsFactory", "modeling"]; var wl = Math.abs, El = Math.round; function Sl(e) { return { x: e.x, y: e.y } } function Cl(e) { return { x: e.x + e.width, y: e.y + e.height } } function kl(e, t) { return !e || isNaN(e.x) || isNaN(e.y) ? t : { x: El(e.x + e.width / 2), y: El(e.y + e.height / 2) } } function Rl(e, t) { var n = e.snapped; return !!n && ("string" == typeof t ? n[t] : n.x && n.y) } function Pl(e, t, n) { if ("string" != typeof t) throw new Error("axis must be in [x, y]"); if ("number" != typeof n && !1 !== n) throw new Error("value must be Number or false"); var i, r = e[t], o = e.snapped = e.snapped || {}; return !1 === n ? o[t] = !1 : (o[t] = !0, i = n - r, e[t] += i, e["d" + t] += i), r } function Tl(e) { return e.children || [] } var Al = Math.abs, Ml = Math.round; function Dl(e) { function t(e, t) { if (p(e)) { for (var n = e.length; n--;)if (Al(e[n] - t) <= 10) return e[n] } else { var i = t % (e = +e); if (i < 10) return t - i; if (i > e - 10) return t - i + e } return t } function n(e, t) { return e.waypoints ? el(t, e) : e.width ? { x: Ml(e.width / 2 + e.x), y: Ml(e.height / 2 + e.y) } : void 0 } e.on("connectionSegment.move.move", 1500, (function (e) { var i, r, o = function (e) { var t = e.context, i = t.snapPoints, r = t.connection, o = r.waypoints, a = t.segmentStart, s = t.segmentStartIndex, c = t.segmentEnd, p = t.segmentEndIndex, l = t.axis; if (i) return i; var u = [o[s - 1], a, c, o[p + 1]]; return s < 2 && u.unshift(n(r.source, e)), p > o.length - 3 && u.unshift(n(r.target, e)), t.snapPoints = i = { horizontal: [], vertical: [] }, g(u, (function (e) { e && (e = e.original || e, "y" === l && i.horizontal.push(e.y), "x" === l && i.vertical.push(e.x)) })), i }(e), a = e.x, s = e.y; if (o) { var c = a - (i = t(o.vertical, a)), p = s - (r = t(o.horizontal, s)); L(e, { dx: e.dx - c, dy: e.dy - p, x: i, y: r }), (c || -1 !== o.vertical.indexOf(a)) && Pl(e, "x", i), (p || -1 !== o.horizontal.indexOf(s)) && Pl(e, "y", r) } })), e.on(["connect.hover", "connect.move", "connect.end"], 1500, (function (e) { var t = e.context.hover, i = t && n(t, e); un(t) && i && i.x && i.y && (Pl(e, "x", i.x), Pl(e, "y", i.y)) })), e.on(["bendpoint.move.move", "bendpoint.move.end"], 1500, (function (e) { var i, r, o = e.context, a = function (e) { var t = e.snapPoints, n = e.connection.waypoints, i = e.bendpointIndex; if (t) return t; var r = [n[i - 1], n[i + 1]]; return e.snapPoints = t = { horizontal: [], vertical: [] }, g(r, (function (e) { e && (e = e.original || e, t.horizontal.push(e.y), t.vertical.push(e.x)) })), t }(o), s = o.hover, c = s && n(s, e), p = e.x, l = e.y; if (a) { var u = p - (i = t(c ? a.vertical.concat([c.x]) : a.vertical, p)), h = l - (r = t(c ? a.horizontal.concat([c.y]) : a.horizontal, l)); L(e, { dx: e.dx - u, dy: e.dy - h, x: e.x - u, y: e.y - h }), (u || -1 !== a.vertical.indexOf(p)) && Pl(e, "x", i), (h || -1 !== a.horizontal.indexOf(l)) && Pl(e, "y", r) } })) } Dl.$inject = ["eventBus"]; var Bl = { __depends__: [Dp, Lp], __init__: ["bendpoints", "bendpointSnapping", "bendpointMovePreview"], bendpoints: ["type", tl], bendpointMove: ["type", al], bendpointMovePreview: ["type", fl], connectionSegmentMove: ["type", xl], bendpointSnapping: ["type", Dl] }; function Nl(e, t, n, i) { function r(e, t) { return i.allowed("connection.create", { source: e, target: t }) } e.on("connect.hover", (function (e) { var t, n = e.context, i = n.start, o = e.hover; if (n.hover = o, !c(t = n.canExecute = r(i, o))) { if (!1 !== t) return n.source = i, void (n.target = o); c(t = n.canExecute = r(o, i)) || !1 !== t && (n.source = o, n.target = i) } })), e.on(["connect.out", "connect.cleanup"], (function (e) { var t = e.context; t.hover = null, t.source = null, t.target = null, t.canExecute = !1 })), e.on("connect.end", (function (e) { var t = e.context, i = t.canExecute, r = t.connectionStart, o = { x: e.x, y: e.y }, a = t.source, s = t.target; if (!i) return !1; var c = null, p = { connectionStart: Ol(t) ? o : r, connectionEnd: Ol(t) ? r : o }; l(i) && (c = i), t.connection = n.connect(a, s, c, p) })), this.start = function (e, n, i, r) { l(i) || (r = i, i = gn(n)), t.init(e, "connect", { autoActivate: r, data: { shape: n, context: { start: n, connectionStart: i } } }) } } function Ol(e) { var t = e.hover, n = e.source, i = e.target; return t && n && t === n && n !== i } Nl.$inject = ["eventBus", "dragging", "modeling", "rules"]; var jl = "connect-ok", Ll = "connect-not-ok"; function Il(e, t, n) { var i = e.get("connectionPreview", !1); i && t.on("connect.move", (function (e) { var t = e.context, n = t.canExecute, r = t.hover, o = t.source, a = t.start, s = t.startPosition, c = t.target, p = t.connectionStart || s, l = t.connectionEnd || { x: e.x, y: e.y }, u = p, h = l; Ol(t) && (u = l, h = p), i.drawPreview(t, n, { source: o || a, target: c || r, connectionStart: u, connectionEnd: h }) })), t.on("connect.hover", 900, (function (e) { var t = e.context, i = e.hover, r = t.canExecute; null !== r && n.addMarker(i, r ? jl : Ll) })), t.on(["connect.out", "connect.cleanup"], 1100, (function (e) { var t = e.hover; t && (n.removeMarker(t, jl), n.removeMarker(t, Ll)) })), i && t.on("connect.cleanup", (function (e) { i.cleanUp(e.context) })) } Il.$inject = ["injector", "eventBus", "canvas"]; var $l = { __depends__: [ea, Lp, Dp], __init__: ["connectPreview"], connect: ["type", Nl], connectPreview: ["type", Il] }; function Fl(e, t, n, i) { this._canvas = t, this._graphicsFactory = n, this._elementFactory = i, this._connectionDocking = e.get("connectionDocking", !1), this._layouter = e.get("layouter", !1) } Fl.$inject = ["injector", "canvas", "graphicsFactory", "elementFactory"], Fl.prototype.drawPreview = function (e, t, n) { n = n || {}; var i, r, o, a = e.connectionPreviewGfx, s = e.getConnection, c = n.source, p = n.target, l = n.waypoints, u = n.connectionStart, h = n.connectionEnd, d = n.noLayout, f = n.noCropping, m = n.noNoop, v = this; a || (a = e.connectionPreviewGfx = this.createConnectionPreviewGfx()), Re(a), s || (s = e.getConnection = (r = function (e, t, n) { return v.getConnection(e, t, n) }, o = {}, function (e) { var t = JSON.stringify(e), n = o[t]; return n || (n = o[t] = r.apply(null, arguments)), n })), t && (i = s(t, c, p)), i ? (i.waypoints = l || [], this._layouter && !d && (i.waypoints = this._layouter.layoutConnection(i, { source: c, target: p, connectionStart: u, connectionEnd: h, waypoints: n.waypoints || i.waypoints })), i.waypoints && i.waypoints.length || (i.waypoints = [c ? gn(c) : u, p ? gn(p) : h]), this._connectionDocking && (c || p) && !f && (i.waypoints = this._connectionDocking.getCroppedWaypoints(i, c, p)), this._graphicsFactory.drawConnection(a, i, { stroke: "var(--element-dragger-color)" })) : !m && this.drawNoopPreview(a, n) }, Fl.prototype.drawNoopPreview = function (e, t) { var n = t.source, i = t.target, r = t.connectionStart || gn(n), o = t.connectionEnd || gn(i), a = this.cropWaypoints(r, o, n, i); ge(e, this.createNoopConnection(a[0], a[1])) }, Fl.prototype.cropWaypoints = function (e, t, n, i) { var r = this._graphicsFactory, o = n && r.getShapePath(n), a = i && r.getShapePath(i), s = r.getConnectionPath({ waypoints: [e, t] }); return [e = n && bn(o, s, !0) || e, t = i && bn(a, s, !1) || t] }, Fl.prototype.cleanUp = function (e) { e && e.connectionPreviewGfx && ke(e.connectionPreviewGfx) }, Fl.prototype.getConnection = function (e) { var t = function (e) { return l(e) ? e : {} }(e); return this._elementFactory.createConnection(t) }, Fl.prototype.createConnectionPreviewGfx = function () { var e = De("g"); return we(e, { pointerEvents: "none" }), Se(e).add("djs-dragger"), ge(this._canvas.getActiveLayer(), e), e }, Fl.prototype.createNoopConnection = function (e, t) { return pt([e, t], { stroke: "#333", strokeDasharray: [1], strokeWidth: 2, "pointer-events": "none" }) }; var zl = { __init__: ["connectionPreview"], connectionPreview: ["type", Fl] }, Hl = ["marker-start", "marker-mid", "marker-end"], Vl = ["circle", "ellipse", "line", "path", "polygon", "polyline", "path", "rect"]; function Wl(e, t, n, i) { this._elementRegistry = e, this._canvas = n, this._styles = i, this._clonedMarkers = {}; var r = this; t.on("drag.cleanup", (function () { r.cleanUp() })) } Wl.$inject = ["elementRegistry", "eventBus", "canvas", "styles"], Wl.prototype.cleanUp = function () { g(this._clonedMarkers, (function (e) { ke(e) })), this._clonedMarkers = {} }, Wl.prototype.getGfx = function (e) { return this._elementRegistry.getGraphics(e) }, Wl.prototype.addDragger = function (e, t, n, i = "djs-dragger") { var r = Pe(n = n || this.getGfx(e)), o = n.getBoundingClientRect(); return this._cloneMarkers(qn(r), i), we(r, this._styles.cls(i, [], { x: o.top, y: o.left })), ge(t, r), we(r, "data-preview-support-element-id", e.id), r }, Wl.prototype.addFrame = function (e, t) { var n = De("rect", { class: "djs-resize-overlay", width: e.width, height: e.height, x: e.x, y: e.y }); return ge(t, n), we(n, "data-preview-support-element-id", e.id), n }, Wl.prototype._cloneMarkers = function (e, t = "djs-dragger") { var n = this; if (e.childNodes) for (var i = 0; i < e.childNodes.length; i++)n._cloneMarkers(e.childNodes[i], t); (function (e) { return -1 !== Vl.indexOf(e.nodeName) })(e) && Hl.forEach((function (i) { if (we(e, i)) { var r = function (e, t, n) { var i = (r = we(e, t), r.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]); var r; return fe("marker#" + i, n || document) }(e, i, n._canvas.getContainer()); n._cloneMarker(e, r, i, t) } })) }, Wl.prototype._cloneMarker = function (e, t, n, i = "djs-dragger") { var r = t.id + "-" + i, o = this._clonedMarkers[r]; if (!o) { var a = r + "-clone"; (o = Pe(t)).id = a, Se(o).add(i), this._clonedMarkers[r] = o; var s = fe("defs", this._canvas._svg); s || (s = De("defs"), ge(this._canvas._svg, s)), ge(s, o) } we(e, n, "url(#" + this._clonedMarkers[r].id + ")") }; var Gl = { __init__: ["previewSupport"], previewSupport: ["type", Wl] }; const Ul = "complex-preview"; class ql { constructor(e, t, n) { this._canvas = e, this._graphicsFactory = t, this._previewSupport = n, this._markers = [] } create(e) { this.cleanUp(); const { created: t = [], moved: n = [], removed: i = [], resized: r = [] } = e, o = this._canvas.getLayer(Ul); t.filter((e => !function (e) { return e.hidden }(e))).forEach((e => { let t; un(e) ? (t = this._graphicsFactory._createContainer("connection", De("g")), this._graphicsFactory.drawConnection(qn(t), e)) : (t = this._graphicsFactory._createContainer("shape", De("g")), this._graphicsFactory.drawShape(qn(t), e), Yn(t, e.x, e.y)), this._previewSupport.addDragger(e, o, t) })), n.forEach((({ element: e, delta: t }) => { this._previewSupport.addDragger(e, o, void 0, "djs-dragging"), this._canvas.addMarker(e, "djs-element-hidden"), this._markers.push([e, "djs-element-hidden"]); const n = this._previewSupport.addDragger(e, o); un(e) ? Yn(n, t.x, t.y) : Yn(n, e.x + t.x, e.y + t.y) })), i.forEach((e => { this._previewSupport.addDragger(e, o, void 0, "djs-dragging"), this._canvas.addMarker(e, "djs-element-hidden"), this._markers.push([e, "djs-element-hidden"]) })), r.forEach((({ shape: e, bounds: t }) => { this._canvas.addMarker(e, "djs-hidden"), this._markers.push([e, "djs-hidden"]), this._previewSupport.addDragger(e, o, void 0, "djs-dragging"); const n = this._graphicsFactory._createContainer("shape", De("g")); this._graphicsFactory.drawShape(qn(n), e, { width: t.width, height: t.height }), Yn(n, t.x, t.y), this._previewSupport.addDragger(e, o, n) })) } cleanUp() { Re(this._canvas.getLayer(Ul)), this._markers.forEach((([e, t]) => this._canvas.removeMarker(e, t))), this._markers = [], this._previewSupport.cleanUp() } show() { this._canvas.showLayer(Ul) } hide() { this._canvas.hideLayer(Ul) } } ql.$inject = ["canvas", "graphicsFactory", "previewSupport"]; var Kl = { __depends__: [Gl], __init__: ["complexPreview"], complexPreview: ["type", ql] }, Yl = ["top", "bottom", "left", "right"], Xl = 10; function Zl(e, t) { function n(e) { if (Xr(e)) { var n = function (e) { var t = gn(e.label), n = gn(e), i = Ql(n, t); if (r = i, -1 === Yl.indexOf(r)) return; var r; var o = function (e) { var t = gn(e), n = [].concat(e.incoming.map((function (e) { return e.waypoints[e.waypoints.length - 2] })), e.outgoing.map((function (e) { return e.waypoints[1] }))).map((function (e) { return Ql(t, e) })); return n }(e); if (e.host) { var a = function (e) { var t, n = e.host, i = gn(e), r = _n(i, n); t = r.indexOf("-") >= 0 ? r.split("-") : [r]; var o = Yl.filter((function (e) { return -1 === t.indexOf(e) })); return o }(e); o = o.concat(a) } var s = Yl.filter((function (e) { return -1 === o.indexOf(e) })); if (-1 !== s.indexOf(i)) return; return s[0] }(e); n && function (e, n) { var i = gn(e), r = e.label, o = gn(r); if (!r.parent) return; var a, s = mn(e); switch (n) { case "top": a = { x: i.x, y: s.top - Xl - r.height / 2 }; break; case "left": a = { x: s.left - Xl - r.width / 2, y: i.y }; break; case "bottom": a = { x: i.x, y: s.bottom + Xl + r.height / 2 }; break; case "right": a = { x: s.right + Xl + r.width / 2, y: i.y } }var c = ns(a, o); t.moveShape(r, c) }(e, n) } } la.call(this, e), this.postExecuted(["connection.create", "connection.layout", "connection.updateWaypoints"], (function (e) { var t = e.context, i = t.connection, r = i.source, o = i.target; !1 !== (t.hints || {}).createElementsBehavior && (n(r), n(o)) })), this.postExecuted(["label.create"], (function (e) { var t = e.context, i = t.shape; !1 !== (t.hints || {}).createElementsBehavior && n(i.labelTarget) })), this.postExecuted(["elements.create"], (function (e) { var t = e.context, i = t.elements; !1 !== (t.hints || {}).createElementsBehavior && i.forEach((function (e) { n(e) })) })) } function Ql(e, t) { return _n(t, e, 5) } function Jl(e) { la.call(this, e), this.preExecute("shape.append", (function (e) { var t = e.source, n = e.shape; e.position || (Er(n, "bpmn:TextAnnotation") ? e.position = { x: t.x + t.width / 2 + 75, y: t.y - 50 - n.height / 2 } : e.position = { x: t.x + t.width + 80 + n.width / 2, y: t.y + t.height / 2 }) }), !0) } function eu(e, t) { e.invoke(la, this), this.postExecute("shape.move", (function (e) { var n = e.newParent, i = e.shape; g(y(i.incoming.concat(i.outgoing), (function (e) { return Er(e, "bpmn:Association") })), (function (e) { t.moveConnection(e, { x: 0, y: 0 }, n) })) }), !0) } e(Zl, la), Zl.$inject = ["eventBus", "modeling"], e(Jl, la), Jl.$inject = ["eventBus"], e(eu, la), eu.$inject = ["injector", "modeling"]; function tu(e, t) { t.invoke(la, this), this._bpmnReplace = e; var n = this; this.postExecuted("elements.create", 500, (function (e) { var t = e.elements; 1 === (t = t.filter((function (e) { return nu(e, e.host) }))).length && t.map((function (e) { return t.indexOf(e) })).forEach((function (i) { var r = t[i]; e.elements[i] = n._replaceShape(t[i], r) })) }), !0), this.preExecute("elements.move", 500, (function (e) { var t = e.shapes, i = e.newHost; if (1 === t.length) { var r = t[0]; nu(r, i) && (e.shapes = [n._replaceShape(r, i)]) } }), !0) } function nu(e, t) { return !hn(e) && Sr(e, ["bpmn:IntermediateThrowEvent", "bpmn:IntermediateCatchEvent"]) && !!t } function iu(e, t) { function n(e) { return y(e.attachers, (function (e) { return Er(e, "bpmn:BoundaryEvent") })) } la.call(this, e), this.postExecute("connection.create", (function (e) { var i = e.context.source, r = e.context.target, o = n(r); Er(i, "bpmn:EventBasedGateway") && Er(r, "bpmn:ReceiveTask") && o.length > 0 && t.removeElements(o) })), this.postExecute("connection.reconnect", (function (e) { var i = e.context.oldSource, r = e.context.newSource; Er(i, "bpmn:Gateway") && Er(r, "bpmn:EventBasedGateway") && g(r.outgoing, (function (e) { var i = e.target, r = n(i); Er(i, "bpmn:ReceiveTask") && r.length > 0 && t.removeElements(r) })) })) } function ru(e, t, n) { function i(e) { t.updateProperties(e, { isForCompensation: !0 }) } function r(e) { t.updateProperties(e, { isForCompensation: void 0 }) } la.call(this, e), this.preExecute("shape.replace", (function (e) { const { newData: n, oldShape: i } = e; if (au(e.oldShape) && "bpmn:CompensateEventDefinition" !== n.eventDefinitionType || "bpmn:BoundaryEvent" !== n.type) { const t = i.outgoing.find((({ target: e }) => ou(e))); t && t.target && (e._connectionTarget = t.target) } else if (!au(e.oldShape) && "bpmn:CompensateEventDefinition" === n.eventDefinitionType && "bpmn:BoundaryEvent" === n.type) { const n = i.outgoing.find((({ target: e }) => su(e))); n && n.target && (e._connectionTarget = n.target), function (e) { const n = e.outgoing.filter((e => Er(e, "bpmn:SequenceFlow"))); t.removeElements(n) }(i) } }), !0), this.postExecuted("shape.replace", (function (e) { const { _connectionTarget: n, newShape: i } = e; n && t.connect(i, n) }), !0), this.preExecute("connection.create", (function (e) { const n = e.connection, r = e.source, o = e.target; au(r) && su(o) && (i(o), function (e, n) { const i = e.outgoing.filter((e => Er(e, "bpmn:Association"))), r = i.filter((e => ou(e.target) && !n.includes(e))); r.forEach((e => t.removeConnection(e))) }(r, [n])) }), !0), this.postExecuted("connection.delete", (function (e) { const t = e.source, n = e.target; au(t) && ou(n) && r(n) }), !0), this.postExecuted("connection.reconnect", (function (e) { const t = e.newTarget, n = e.oldSource, o = e.oldTarget; if (o !== t) { const e = n; ou(o) && r(o), au(e) && su(t) && i(t) } }), !0), this.postExecuted("element.updateProperties", (function (e) { const { element: i } = e; ou(i) ? (function (e) { for (const i of e.incoming) n.canConnect(i.source, e) || t.removeConnection(i); for (const i of e.outgoing) n.canConnect(e, i.target) || t.removeConnection(i) }(i), function (e) { const n = e.attachers.slice(); if (!n.length) return; t.removeElements(n) }(i)) : su(i) && function (e) { const n = e.incoming.filter((e => au(e.source))); t.removeElements(n) }(i) }), !0) } function ou(e) { const t = Cr(e); return t && t.get("isForCompensation") } function au(e) { return e && Er(e, "bpmn:BoundaryEvent") && Ur(e, "bpmn:CompensateEventDefinition") } function su(e) { return e && Er(e, "bpmn:Activity") && !Gr(e) } function cu(e) { e.invoke(la, this), this.preExecute("shape.create", 1500, (function (e) { var t = e.context, n = t.parent, i = t.shape; Er(n, "bpmn:Lane") && !Er(i, "bpmn:Lane") && (t.parent = vp(n, "bpmn:Participant")) })) } function pu(e, t) { la.call(this, e), this.preExecute("shape.create", (function (e) { var n = e.context.shape; if (Er(n, "bpmn:DataObjectReference") && "label" !== n.type) { var i = t.create("bpmn:DataObject"); n.businessObject.dataObjectRef = i } })) } tu.$inject = ["bpmnReplace", "injector"], e(tu, la), tu.prototype._replaceShape = function (e, t) { var n, i = (n = Cr(e).eventDefinitions) && n[0], r = { type: "bpmn:BoundaryEvent", host: t }; return i && (r.eventDefinitionType = i.$type), this._bpmnReplace.replaceElement(e, r, { layoutConnection: !1 }) }, iu.$inject = ["eventBus", "modeling"], e(iu, la), e(ru, la), ru.$inject = ["eventBus", "modeling", "bpmnRules"], cu.$inject = ["injector"], e(cu, la), pu.$inject = ["eventBus", "bpmnFactory"], e(pu, la); var lu = 20, uu = 20, hu = 30, du = 2e3; function fu(e, t, n) { function i() { var t = e.getRootElement(); return Er(t, "bpmn:Collaboration") ? t : n.makeCollaboration() } la.call(this, t), t.on(["create.start", "shape.move.start"], du, (function (t) { var n = t.context, i = n.shape, r = e.getRootElement(); if (Er(i, "bpmn:Participant") && Er(r, "bpmn:Process") && r.children.length) { var o = r.children.filter((function (e) { return !Er(e, "bpmn:Group") && !hn(e) && !un(e) })); if (o.length) { var a = vt(o), s = function (e, t) { t = { width: t.width + 2 * lu + hu, height: t.height + 2 * uu }; var n = Math.max(e.width, t.width), i = Math.max(e.height, t.height); return { x: -n / 2, y: -i / 2, width: n, height: i } }(i, a); L(i, s), n.createConstraints = function (e, t) { return t = mn(t), { bottom: t.top + e.height / 2 - uu, left: t.right - e.width / 2 + lu, top: t.bottom - e.height / 2 + uu, right: t.left + e.width / 2 - lu - hu } }(i, a) } } })), t.on("create.start", du, (function (n) { var i = n.context.shape, r = e.getRootElement(), o = e.getGraphics(r); function a(e) { e.element = r, e.gfx = o } Er(i, "bpmn:Participant") && Er(r, "bpmn:Process") && (t.on("element.hover", du, a), t.once("create.cleanup", (function () { t.off("element.hover", a) }))) })), this.preExecute("elements.create", du, (function (e) { var t, n = e.elements, r = e.parent, o = function (e) { return m(e, (function (e) { return Er(e, "bpmn:Participant") })) }(n); o && Er(r, "bpmn:Process") && (e.parent = i(), (t = e.hints = e.hints || {}).participant = o, t.process = r, t.processRef = Cr(o).get("processRef")) }), !0), this.preExecute("shape.create", (function (e) { var t = e.parent, n = e.shape; Er(n, "bpmn:Participant") && Er(t, "bpmn:Process") && (e.parent = i(), e.process = t, e.processRef = Cr(n).get("processRef")) }), !0), this.execute("shape.create", (function (e) { var t = e.hints || {}, n = e.process || t.process, i = e.shape, r = t.participant; !n || r && i !== r || Cr(i).set("processRef", Cr(n)) }), !0), this.revert("shape.create", (function (e) { var t = e.hints || {}, n = e.process || t.process, i = e.processRef || t.processRef, r = e.shape, o = t.participant; !n || o && r !== o || Cr(r).set("processRef", i) }), !0), this.postExecute("shape.create", (function (e) { var t = e.hints || {}, i = e.process || e.hints.process, r = e.shape, o = t.participant; if (i) { var a = i.children.slice(); o ? r === o && n.moveElements(a, { x: 0, y: 0 }, o) : n.moveElements(a, { x: 0, y: 0 }, r) } }), !0) } fu.$inject = ["canvas", "eventBus", "modeling"], e(fu, la); var mu = "__targetRef_placeholder"; function vu(e, t) { function n(e, n) { var i = e.get("properties"), r = m(i, (function (e) { return e.name === mu })); return !r && n && Et(i, r = t.create("bpmn:Property", { name: mu })), r } function i(e, t) { var i = n(e); i && (function (e, t, n) { return m(e.get("dataInputAssociations"), (function (e) { return e !== n && e.targetRef === t })) }(e, i, t) || wt(e.get("properties"), i)) } function r(e) { var t, r = e.context, o = r.connection, a = o.businessObject, s = o.target, c = s && s.businessObject, p = r.newTarget, l = p && p.businessObject, u = r.oldTarget || r.target, h = u && u.businessObject, d = o.businessObject; h && h !== c && i(h, a), l && l !== c && i(l, a), c ? (t = n(c, !0), d.targetRef = t) : d.targetRef = null } la.call(this, e), this.executed(["connection.create", "connection.delete", "connection.move", "connection.reconnect"], yu(r)), this.reverted(["connection.create", "connection.delete", "connection.move", "connection.reconnect"], yu(r)) } function yu(e) { return function (t) { if (Er(t.context.connection, "bpmn:DataInputAssociation")) return e(t) } } function gu(e) { this._bpmnUpdater = e } function _u(e, t, n, i) { function r(e) { return e.children.filter((function (e) { return Er(e, "bpmn:DataStoreReference") && !e.labelTarget })) } function o(e, i) { var r = e.businessObject || e; if (i = i || n.filter((function (e) { return Er(e, "bpmn:Participant") && Cr(e).processRef }))[0]) { var o = i.businessObject || i; t.execute("dataStore.updateContainment", { dataStoreBo: r, dataStoreDi: kr(e), newSemanticParent: o.processRef || o, newDiParent: kr(i) }) } } la.call(this, i), t.registerHandler("dataStore.updateContainment", gu), this.preExecute("shape.create", (function (e) { var t = e.context, n = t.shape; Er(n, "bpmn:DataStoreReference") && "label" !== n.type && (t.hints || (t.hints = {}), t.hints.autoResize = !1) })), this.preExecute("elements.move", (function (e) { var t = e.context, n = t.shapes; n.filter((function (e) { return Er(e, "bpmn:DataStoreReference") })).length && (t.hints || (t.hints = {}), t.hints.autoResize = n.filter((function (e) { return !Er(e, "bpmn:DataStoreReference") }))) })), this.postExecute("shape.create", (function (e) { var t = e.context.shape, n = t.parent; Er(t, "bpmn:DataStoreReference") && "label" !== t.type && Er(n, "bpmn:Collaboration") && o(t) })), this.postExecute("shape.move", (function (e) { var t = e.context, n = t.shape, i = t.oldParent, r = n.parent; Er(i, "bpmn:Collaboration") || Er(n, "bpmn:DataStoreReference") && "label" !== n.type && Er(r, "bpmn:Collaboration") && o(n, Er(i, "bpmn:Participant") ? i : function (e, t) { for (; e.parent;) { if (Er(e.parent, t)) return e.parent; e = e.parent } }(i, "bpmn:Participant")) })), this.postExecute("shape.delete", (function (t) { var n = t.context.shape, i = e.getRootElement(); Sr(n, ["bpmn:Participant", "bpmn:SubProcess"]) && Er(i, "bpmn:Collaboration") && r(i).filter((function (e) { return function (e, t) { var n = e.businessObject || e, i = t.businessObject || t; for (; n.$parent;) { if (n.$parent === i.processRef || i) return !0; n = n.$parent } return !1 }(e, n) })).forEach((function (e) { o(e) })) })), this.postExecute("canvas.updateRoot", (function (e) { var t = e.context, n = t.oldRoot, i = t.newRoot; r(n).forEach((function (e) { Er(i, "bpmn:Process") && o(e, i) })) })) } vu.$inject = ["eventBus", "bpmnFactory"], e(vu, la), gu.$inject = ["bpmnUpdater"], gu.prototype.execute = function (e) { var t = e.dataStoreBo, n = e.dataStoreDi, i = e.newSemanticParent, r = e.newDiParent; return e.oldSemanticParent = t.$parent, e.oldDiParent = n.$parent, this._bpmnUpdater.updateSemanticParent(t, i), this._bpmnUpdater.updateDiParent(n, r), [] }, gu.prototype.revert = function (e) { var t = e.dataStoreBo, n = e.dataStoreDi, i = e.oldSemanticParent, r = e.oldDiParent; return this._bpmnUpdater.updateSemanticParent(t, i), this._bpmnUpdater.updateDiParent(n, r), [] }, _u.$inject = ["canvas", "commandStack", "elementRegistry", "eventBus"], e(_u, la); var bu = Math.max, xu = Math.min, wu = 20; function Eu(e, t) { return { top: e.top - t.top, right: e.right - t.right, bottom: e.bottom - t.bottom, left: e.left - t.left } } function Su(e, t, n) { var i = t[e], r = n.min && n.min[e], o = n.max && n.max[e]; return u(r) && (i = (/top|left/.test(e) ? xu : bu)(i, r)), u(o) && (i = (/top|left/.test(e) ? bu : xu)(i, o)), i } function Cu(e, t) { return void 0 !== e ? e : wu } function ku(e) { return !e.waypoints && "label" !== e.type } function Ru(e, t) { var n; if ((n = void 0 === e.length ? y(e.children, ku) : e).length) return function (e, t) { var n, i, r, o; return "object" == typeof t ? (n = Cu(t.left), i = Cu(t.right), r = Cu(t.top), o = Cu(t.bottom)) : n = i = r = o = Cu(t), { x: e.x - n, y: e.y - r, width: e.width + n + i, height: e.height + r + o } }(vt(n), t) } var Pu = Math.abs; var Tu = ["bpmn:Participant", "bpmn:Process", "bpmn:SubProcess"], Au = 30; function Mu(e, t) { return t = t || [], e.children.filter((function (e) { Er(e, "bpmn:Lane") && (Mu(e, t), t.push(e)) })), t } function Du(e) { return e.children.filter((function (e) { return Er(e, "bpmn:Lane") })) } function Bu(e) { return vp(e, Tu) || e } function Nu(e, t) { var n = Bu(e), i = Mu(n, Er(n, "bpmn:Process") ? [] : [n]), r = mn(e), o = mn(t), a = function (e, t) { return Eu(mn(t), mn(e)) }(e, t), s = []; return i.forEach((function (t) { if (t !== e) { var n, i, c = 0, p = a.right, l = 0, u = a.left, h = mn(t); a.top && (Pu(h.bottom - r.top) < 10 && (l = o.top - h.bottom), Pu(h.top - r.top) < 5 && (c = o.top - h.top)), a.bottom && (Pu(h.top - r.bottom) < 10 && (c = o.bottom - h.top), Pu(h.bottom - r.bottom) < 5 && (l = o.bottom - h.bottom)), (c || p || l || u) && s.push({ shape: t, newBounds: (n = t, i = { top: c, right: p, bottom: l, left: u }, { x: n.x + (i.left || 0), y: n.y + (i.top || 0), width: n.width - (i.left || 0) + (i.right || 0), height: n.height - (i.top || 0) + (i.bottom || 0) }) }) } })), s } function Ou(e, t) { la.call(this, e), this.postExecuted("shape.delete", 500, (function (e) { var n = e.context, i = n.hints, r = n.shape, o = n.oldParent; Er(r, "bpmn:Lane") && (i && i.nested || function (e, n) { var i, r, o, a = Du(n), s = [], c = []; ft(a, (function (t) { return t.y > e.y ? c.push(t) : s.push(t), t.children })), a.length && (i = c.length && s.length ? e.height / 2 : e.height, s.length && (r = t.calculateAdjustments(s, "y", i, e.y - 10), t.makeSpace(r.movingShapes, r.resizingShapes, { x: 0, y: i }, "s")), c.length && (o = t.calculateAdjustments(c, "y", -i, e.y + e.height + 10), t.makeSpace(o.movingShapes, o.resizingShapes, { x: 0, y: -i }, "n"))) }(r, o)) })) } Ou.$inject = ["eventBus", "spaceTool"], e(Ou, la); function ju(e, t) { t.invoke(la, this), this._bpmnReplace = e; var n = this; this.postExecuted("elements.create", 500, (function (e) { var t = e.elements; t.filter((function (e) { return Lu(e, e.host) })).map((function (e) { return t.indexOf(e) })).forEach((function (i) { e.elements[i] = n._replaceShape(t[i]) })) }), !0), this.preExecute("elements.move", 500, (function (e) { var t = e.shapes, i = e.newHost; t.forEach((function (e, r) { var o, a = e.host; Lu(e, (o = a, -1 !== t.indexOf(o) ? a : i)) && (t[r] = n._replaceShape(e)) })) }), !0) } function Lu(e, t) { return !hn(e) && Er(e, "bpmn:BoundaryEvent") && !t } function Iu(e, t, n) { function i(e, i, r) { var o, a, s, c, p, l, h, d, f = i.waypoints, m = e.outgoing.slice(), v = e.incoming.slice(), g = zp(f, d = u(r.width) ? gn(r) : r); if (g) { if (o = f.slice(0, g.index), a = f.slice(g.index + (g.bendpoint ? 1 : 0)), !o.length || !a.length) return; s = g.bendpoint ? f[g.index] : d, 1 !== o.length && $u(e, o[o.length - 1]) || o.push(Fu(s)), 1 !== a.length && $u(e, a[0]) || a.unshift(Fu(s)) } c = i.source, p = i.target, t.canConnect(c, e, i) && (n.reconnectEnd(i, e, o || d), l = i), t.canConnect(e, p, i) && (l ? h = n.connect(e, p, { type: i.type, waypoints: a }) : (n.reconnectStart(i, e, a || d), h = i)); var _ = [].concat(l && y(v, (function (e) { return e.source === l.source })) || [], h && y(m, (function (e) { return e.target === h.target })) || []); _.length && n.removeElements(_) } la.call(this, e), this.preExecute("elements.move", (function (e) { var n = e.newParent, i = e.shapes, r = e.delta, o = i[0]; if (o && n) { n && n.waypoints && (e.newParent = n = n.parent); var a = gn(o), s = { x: a.x + r.x, y: a.y + r.y }, c = m(n.children, (function (e) { return t.canInsert(i, e) && zp(e.waypoints, s) })); c && (e.targetFlow = c, e.position = s) } }), !0), this.postExecuted("elements.move", (function (e) { var t = e.shapes, n = e.targetFlow, r = e.position; n && i(t[0], n, r) }), !0), this.preExecute("shape.create", (function (e) { var n = e.parent, i = e.shape; t.canInsert(i, n) && (e.targetFlow = n, e.parent = n.parent) }), !0), this.postExecuted("shape.create", (function (e) { var t = e.shape, n = e.targetFlow, r = e.position; n && i(t, n, r) }), !0) } function $u(e, t) { var n = t.x, i = t.y; return n >= e.x && n <= e.x + e.width && i >= e.y && i <= e.y + e.height } function Fu(e) { return L({}, e) } function zu(e, t) { la.call(this, e), this.preExecuted("connection.create", (function (e) { var n = e.context, i = n.connection, r = n.source, o = n.target, a = n.hints; if ((!a || !1 !== a.createElementsBehavior) && Hu(i)) { (Er(r, "bpmn:EventBasedGateway") ? o.incoming.filter((e => e !== i && Hu(e))) : o.incoming.filter((e => e !== i && Hu(e) && Er(e.source, "bpmn:EventBasedGateway")))).forEach((function (e) { t.removeConnection(e) })) } })), this.preExecuted("shape.replace", (function (e) { var n = e.context.newShape; Er(n, "bpmn:EventBasedGateway") && n.outgoing.filter(Hu).reduce((function (e, t) { return e.includes(t.target) ? e : e.concat(t.target) }), []).forEach((function (e) { e.incoming.filter(Hu).forEach((function (i) { const r = e.incoming.filter(Hu).filter((function (e) { return e.source === n })); (i.source !== n || r.length > 1) && t.removeConnection(i) })) })) })) } function Hu(e) { return Er(e, "bpmn:SequenceFlow") } ju.$inject = ["bpmnReplace", "injector"], e(ju, la), ju.prototype._replaceShape = function (e) { var t, n, i = (n = Cr(e).eventDefinitions) && n[0]; return t = i ? { type: "bpmn:IntermediateCatchEvent", eventDefinitionType: i.$type } : { type: "bpmn:IntermediateThrowEvent" }, this._bpmnReplace.replaceElement(e, t, { layoutConnection: !1 }) }, e(Iu, la), Iu.$inject = ["eventBus", "bpmnRules", "modeling"], zu.$inject = ["eventBus", "modeling"], e(zu, la); var Vu = 1500; function Wu(e, t, n) { t.on(["create.hover", "create.move", "create.out", "create.end", "shape.move.hover", "shape.move.move", "shape.move.out", "shape.move.end"], Vu, (function (t) { var i = t.context.shape || t.shape, r = t.hover; Er(r, "bpmn:Lane") && !Sr(i, ["bpmn:Lane", "bpmn:Participant"]) && (t.hover = Bu(r), t.hoverGfx = e.getGraphics(t.hover)); var o = n.getRootElement(); r !== o && (i.labelTarget || Er(i, "bpmn:Group")) && (t.hover = o, t.hoverGfx = e.getGraphics(t.hover)) })), t.on(["connect.hover", "connect.out", "connect.end", "connect.cleanup", "global-connect.hover", "global-connect.out", "global-connect.end", "global-connect.cleanup"], Vu, (function (t) { var n = t.hover; Er(n, "bpmn:Lane") && (t.hover = Bu(n) || n, t.hoverGfx = e.getGraphics(t.hover)) })), t.on(["bendpoint.move.hover"], Vu, (function (t) { var n = t.context, i = t.hover, r = n.type; Er(i, "bpmn:Lane") && /reconnect/.test(r) && (t.hover = Bu(i) || i, t.hoverGfx = e.getGraphics(t.hover)) })), t.on(["connect.start"], Vu, (function (e) { var t = e.context, n = t.start; Er(n, "bpmn:Lane") && (t.start = Bu(n) || n) })), t.on("shape.move.start", 2e3, (function (e) { var t = e.shape; Er(t, "bpmn:Lane") && (e.shape = Bu(t) || t) })), t.on("spaceTool.move", 2e3, (function (e) { var t = e.hover; t && Er(t, "bpmn:Lane") && (e.hover = Bu(t)) })) } Wu.$inject = ["elementRegistry", "eventBus", "canvas"]; function Gu(e, t, n, i, r, o) { function a(e, t, i) { var r = n.filter((function (e) { return Er(e, "bpmn:Group") })).filter((function (e) { return e.businessObject !== i })); t && !function (e, t) { return e.some((function (e) { var n = Cr(e); return (n.categoryValueRef && n.categoryValueRef.$parent) === t })) }(r, t) && function (e) { var t = e.$parent; t && (wt(t.get("rootElements"), e), e.$parent = null) }(t), e && !function (e, t) { return e.some((function (e) { return Cr(e).categoryValueRef === t })) }(r, e) && function (e) { var t = e.$parent; t && (wt(t.get("categoryValue"), e), e.$parent = null) }(e) } function s(e, n) { return function (e, t, n) { return Et(t.get("categoryValue"), e), e.$parent = t, Et(n.get("rootElements"), t), t.$parent = n, e }(e, n, t.getDefinitions()) } function c(n, i) { var r = Cr(n), o = r.categoryValueRef; o || (o = r.categoryValueRef = i.categoryValue = i.categoryValue || function (e) { return e.create("bpmn:CategoryValue") }(e)); var a = o.$parent; a || (a = o.$parent = i.category = i.category || function (e) { return e.create("bpmn:Category") }(e)), s(o, a, t.getDefinitions()) } function p(e, t) { var n = t.category, i = t.categoryValue, r = Cr(e); i ? (r.categoryValueRef = null, a(i, n, r)) : a(null, r.categoryValueRef.$parent, r) } function l(t, n) { var i = e.create(t.$type); return o.copyElement(t, i, null, n) } r.invoke(la, this), this.execute("label.create", (function (e) { var t = e.context, n = t.labelTarget; Er(n, "bpmn:Group") && c(n, t) })), this.revert("label.create", (function (e) { var t = e.context, n = t.labelTarget; Er(n, "bpmn:Group") && p(n, t) })), this.execute("shape.delete", (function (e) { var t = e.context, n = t.shape, i = Cr(n); if (Er(n, "bpmn:Group") && !n.labelTarget) { var r = t.categoryValue = i.categoryValueRef; r && (a(r, t.category = r.$parent, i), i.categoryValueRef = null) } })), this.reverted("shape.delete", (function (e) { var t = e.context, n = t.shape; if (Er(n, "bpmn:Group") && !n.labelTarget) { var i = t.category, r = t.categoryValue, o = Cr(n); r && (o.categoryValueRef = r, s(r, i)) } })), this.execute("shape.create", (function (e) { var t = e.context, n = t.shape; Er(n, "bpmn:Group") && !n.labelTarget && Cr(n).categoryValueRef && c(n, t) })), this.reverted("shape.create", (function (e) { var t = e.context, n = t.shape; Er(n, "bpmn:Group") && !n.labelTarget && Cr(n).categoryValueRef && p(n, t) })), i.on("copyPaste.copyElement", 770, (function (e) { var t = e.descriptor, n = e.element; if (Er(n, "bpmn:Group") && !n.labelTarget) { var i = Cr(n); if (i.categoryValueRef) { var r = i.categoryValueRef; t.categoryValue = l(r, !0), r.$parent && (t.category = l(r.$parent, !0)) } } })), i.on("copyPaste.pasteElement", 770, (function (e) { var t = e.descriptor, n = t.businessObject, i = t.categoryValue, r = t.category; i && (i = n.categoryValueRef = l(i)), r && (i.$parent = l(r)), delete t.category, delete t.categoryValue })) } function Uu(e, t, n, i) { var r, o, a, s; return 0 == (r = (i.y - n.y) * (t.x - e.x) - (i.x - n.x) * (t.y - e.y)) ? null : (o = e.y - n.y, a = e.x - n.x, s = ((i.x - n.x) * o - (i.y - n.y) * a) / r, { x: Math.round(e.x + s * (t.x - e.x)), y: Math.round(e.y + s * (t.y - e.y)) }) } function qu(e) { function t(e, t, n) { var i, r = { x: n.x, y: n.y - 50 }, o = { x: n.x - 50, y: n.y }, a = Uu(e, t, n, r), s = Uu(e, t, n, o); i = a && s ? Ku(a, n) > Ku(s, n) ? s : a : a || s, e.original = i } e.on("bpmnElement.added", (function (e) { var n, i, r = e.element; r.waypoints && (t((i = (n = r).waypoints)[0], i[1], gn(n.source)), t(i[i.length - 1], i[i.length - 2], gn(n.target))) })) } function Ku(e, t) { return Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2)) } function Yu(e) { la.call(this, e); var t = ["bpmn:Participant", "bpmn:Lane"]; this.executed(["shape.move", "shape.create", "shape.resize"], (function (e) { var n = e.context.shape, i = Cr(n), r = kr(n); if (Sr(i, t)) { var o = r.get("isHorizontal"); void 0 === o && (o = !0), r.set("isHorizontal", o) } })) } Gu.$inject = ["bpmnFactory", "bpmnjs", "elementRegistry", "eventBus", "injector", "moddleCopy"], e(Gu, la), qu.$inject = ["eventBus"], Yu.$inject = ["eventBus"], e(Yu, la); var Xu = Math.sqrt, Zu = Math.min, Qu = Math.max, Ju = Math.abs; function eh(e) { return Math.pow(e, 2) } function th(e, t) { return Xu(eh(e.x - t.x) + eh(e.y - t.y)) } function nh(e, t, n, i) { var r = t.x - e.x, o = t.y - e.y, a = n.x - e.x, s = n.y - e.y, c = r * r + o * o, p = (r * a + o * s) / c, l = p * p - (a * a + s * s - i * i) / c; if (l < 0 && l > -1e-6 && (l = 0), l < 0) return []; var u = Xu(l), h = -p + u, d = -p - u, f = { x: e.x - r * h, y: e.y - o * h }; return 0 === l ? [f] : [f, { x: e.x - r * d, y: e.y - o * d }].filter((function (n) { return function (e, t, n) { return ih(e.x, t.x, n.x) && ih(e.y, t.y, n.y) }(n, e, t) })) } function ih(e, t, n) { return e >= Zu(t, n) - rh && e <= Qu(t, n) + rh } var rh = .1; function oh(e, t) { return Ju(e.x - t.x) <= rh && Ju(e.y - t.y) <= rh } function ah(e, t, n, i) { var r = 0, o = 0, a = { point: e, delta: { x: 0, y: 0 } }, s = function (e, t) { var n, i, r, o, a, s, c, p, l, u, h, d, f = 0; for (f = 0; f < t.length - 1; f++) { if (oh(n = t[f], i = t[f + 1]) ? s = [n] : (r = th(e, n), o = th(e, i), s = nh(n, i, e, Zu(r, o))), s.length < 1) throw new Error("expected between [1, 2] circle -> line intersections"); 1 === s.length && (c = { type: "bendpoint", position: s[0], segmentIndex: f, bendpointIndex: oh(n, s[0]) ? f : f + 1 }), 2 === s.length && (h = s[0], d = s[1], c = { type: "segment", position: a = { x: (h.x + d.x) / 2, y: (h.y + d.y) / 2 }, segmentIndex: f, relativeLocation: th(n, a) / th(n, i) }), p = th(c.position, e), (!u || l > p) && (u = c, l = p) } return u }(e, n), c = s.segmentIndex, p = function (e, t, n, i) { var r = n.segmentIndex, o = t.length - e.length; if (i.segmentMove) { var a = i.segmentMove.segmentStartIndex, s = i.segmentMove.newSegmentStartIndex; return r === a ? s : r >= s ? r + o < s ? s : r + o : r } if (i.bendpointMove) { var c, p = i.bendpointMove.insert, l = i.bendpointMove.bendpointIndex; return 0 === o ? r : (r >= l && (c = p ? r + 1 : r - 1), r < l && (c = r, p && "bendpoint" !== n.type && l - 1 === r && sh(t, l) < n.relativeLocation && c++), c) } return 0 === o ? r : i.connectionStart && 0 === r ? 0 : i.connectionEnd && r === e.length - 2 ? t.length - 2 : Math.floor((t.length - 2) / 2) }(n, t, s, i); if (p < 0 || p > t.length - 2 || null === p) return a; var l, u, h = ch(n, c), d = ch(t, p), f = s.position, m = function (e, t) { var n = Up(e[0], e[1]), i = Up(e[0], t); return 0 === n ? 0 : i / n }(h, f), v = (l = d, u = Vp(h), Vp(l) - u); if ("bendpoint" === s.type) { var y = t.length - n.length, g = s.bendpointIndex, _ = n[g]; if (-1 !== t.indexOf(_)) return a; if (0 === y) { var b = t[g]; return { delta: { x: r = b.x - s.position.x, y: o = b.y - s.position.y }, point: { x: e.x + r, y: e.y + o } } } y < 0 && 0 !== g && g < n.length - 1 && (m = sh(n, g)) } var x, w, E = { x: (d[1].x - d[0].x) * m + d[0].x, y: (d[1].y - d[0].y) * m + d[0].y }, S = (x = { x: e.x - f.x, y: e.y - f.y }, (w = v) ? { x: Math.cos(w) * x.x - Math.sin(w) * x.y, y: Math.sin(w) * x.x + Math.cos(w) * x.y } : x); return r = E.x + S.x - e.x, o = E.y + S.y - e.y, { point: fn(E), delta: fn({ x: r, y: o }) } } function sh(e, t) { var n = Up(e[t - 1], e[t]); return n / (n + Up(e[t], e[t + 1])) } function ch(e, t) { return [e[t], e[t + 1]] } function ph(e, t, n) { var i = ts(t), r = ts(n), o = ns(e, i), a = o.x * (n.width / t.width), s = o.y * (n.height / t.height); return fn({ x: r.x + a, y: r.y + s }) } function lh(e, t, n) { var i = ts(e), r = ts(t), o = ts(n), a = ns(e, i), s = ns(i, r), c = function (e, t, n) { var i = mn(t), r = mn(n); if (function (e, t) { return function (e, t) { return e.right !== t.right && e.left !== t.left }(e, t) || function (e, t) { return e.top !== t.top && e.bottom !== t.bottom }(e, t) }(i, r)) return null; var o, a, s, c = _n(t, e); if ("top" === c) o = { x: 0, y: r.bottom - i.bottom }; else if ("bottom" === c) o = { x: 0, y: r.top - i.top }; else if ("right" === c) o = { x: r.left - i.left, y: 0 }; else { if ("left" !== c) return null; o = { x: r.right - i.right, y: 0 } } if (a = { x: e.x + o.x, y: e.y + o.y }, s = _n(n, a), s !== c) return null; return o }(i, t, n); if (c) return c; var p = s.x * (n.width / t.width), l = s.y * (n.height / t.height), u = o.x + p, h = o.y + l; return fn({ x: u + a.x - e.x, y: h + a.y - e.y }) } var uh = "name", hh = "text"; function dh(e, t, n, i) { function r(e) { var n = e.context, r = n.element, o = n.properties; if (uh in o && t.updateLabel(r, o[uh]), hh in o && Er(r, "bpmn:TextAnnotation")) { var a = i.getTextAnnotationBounds({ x: r.x, y: r.y, width: r.width, height: r.height }, o[hh] || ""); t.updateLabel(r, o.text, a) } } function o(e) { var t = e.context, n = t.connection, i = n.label, r = L({}, t.hints), o = t.newWaypoints || n.waypoints, a = t.oldWaypoints; return void 0 === r.startChanged && (r.startChanged = !!r.connectionStart), void 0 === r.endChanged && (r.endChanged = !!r.connectionEnd), function (e, t, n, i) { return ah(gn(e), t, n, i).delta }(i, o, a, r) } la.call(this, e), this.postExecute("element.updateProperties", r), this.postExecute("element.updateModdleProperties", (e => { Cr(e.context.element) === e.context.moddleElement && r(e) })), this.postExecute(["shape.create", "connection.create"], (function (e) { var n = e.context; if (!1 !== (n.hints || {}).createElementsBehavior) { var i = n.shape || n.connection; !hn(i) && Yr(i) && eo(i) && t.updateLabel(i, eo(i)) } })), this.postExecute("shape.delete", (function (e) { var n = e.context, i = n.labelTarget, r = n.hints || {}; i && !1 !== r.unsetLabel && t.updateLabel(i, null, null, { removeShape: !1 }) })), this.postExecute(["connection.layout", "connection.updateWaypoints"], (function (e) { var n = e.context; if (!1 !== (n.hints || {}).labelBehavior) { var i, r = n.connection.label; r && r.parent && (i = o(e), t.moveShape(r, i)) } })), this.postExecute(["shape.replace"], (function (e) { var t = e.context, n = t.newShape, i = t.oldShape, r = Cr(n); r && Yr(r) && i.label && n.label && (n.label.x = i.label.x, n.label.y = i.label.y) })), this.postExecute("shape.resize", (function (e) { var n, i = e.context, r = i.shape, o = i.newBounds, a = i.oldBounds; if (Xr(r)) { var s = r.label, c = function (e, t) { if (!t.length) return; var n = function (e, t) { var n = t.map((function (t) { return { line: t, distance: Gp(e, t) } })); return T(n, "distance")[0].line }(e, t); return Wp(e, n) }(gn(s), [[{ x: (n = a).x, y: n.y }, { x: n.x + (n.width || 0), y: n.y }], [{ x: n.x + (n.width || 0), y: n.y }, { x: n.x + (n.width || 0), y: n.y + (n.height || 0) }], [{ x: n.x, y: n.y + (n.height || 0) }, { x: n.x + (n.width || 0), y: n.y + (n.height || 0) }], [{ x: n.x, y: n.y }, { x: n.x, y: n.y + (n.height || 0) }]]), p = fh(c, a, o); t.moveShape(s, p) } })) } function fh(e, t, n) { return fn(ns(ph(e, t, n), e)) } function mh(e, t) { function n(e, t) { var n = e.context, i = n.connection, r = L({}, n.hints), o = n.newWaypoints || i.waypoints, a = n.oldWaypoints; return void 0 === r.startChanged && (r.startChanged = !!r.connectionStart), void 0 === r.endChanged && (r.endChanged = !!r.connectionEnd), function (e, t, n, i) { return ah(e, t, n, i).point }(t, o, a, r) } la.call(this, e), this.postExecute(["connection.layout", "connection.updateWaypoints"], (function (e) { var i = e.context.connection, r = i.outgoing; i.incoming.forEach((function (i) { var r = i.waypoints[i.waypoints.length - 1], o = n(e, r), a = [].concat(i.waypoints.slice(0, -1), [o]); t.updateWaypoints(i, a) })), r.forEach((function (i) { var r = i.waypoints[0], o = n(e, r), a = [].concat([o], i.waypoints.slice(1)); t.updateWaypoints(i, a) })) })), this.postExecute(["connection.move"], (function (e) { var n = e.context, i = n.connection, r = i.outgoing, o = i.incoming, a = n.delta; o.forEach((function (e) { var n = e.waypoints[e.waypoints.length - 1], i = { x: n.x + a.x, y: n.y + a.y }, r = [].concat(e.waypoints.slice(0, -1), [i]); t.updateWaypoints(e, r) })), r.forEach((function (e) { var n = e.waypoints[0], i = { x: n.x + a.x, y: n.y + a.y }, r = [].concat([i], e.waypoints.slice(1)); t.updateWaypoints(e, r) })) })) } function vh(e, t, n) { var i = xh(e), r = wh(i, t), o = i[0]; return r.length ? r[r.length - 1] : ph(o.original || o, n, t) } function yh(e, t, n) { var i = xh(e), r = wh(i, t), o = i[i.length - 1]; return r.length ? r[0] : ph(o.original || o, n, t) } function gh(e, t, n) { var i = xh(e), r = bh(t, n), o = i[0]; return ph(o.original || o, r, t) } function _h(e, t, n) { var i = xh(e), r = bh(t, n), o = i[i.length - 1]; return ph(o.original || o, r, t) } function bh(e, t) { return { x: e.x - t.x, y: e.y - t.y, width: e.width, height: e.height } } function xh(e) { var t = e.waypoints; if (!t.length) throw new Error("connection#" + e.id + ": no waypoints"); return t } function wh(e, t) { return y(E(e, Eh), (function (e) { return function (e, t) { return "intersect" === _n(t, e, 1) }(e, t) })) } function Eh(e) { return e.original || e } function Sh(e, t) { la.call(this, e), this.postExecute("shape.replace", (function (e) { var n = e.oldShape, i = e.newShape; if (function (e, t) { return Er(e, "bpmn:Participant") && Vr(e) && Er(t, "bpmn:Participant") && !Vr(t) }(n, i)) { var r, o, a, s, c = (o = mt([r = n], !1), a = [], s = [], o.forEach((function (e) { e !== r && (e.incoming.forEach((function (e) { Er(e, "bpmn:MessageFlow") && a.push(e) })), e.outgoing.forEach((function (e) { Er(e, "bpmn:MessageFlow") && s.push(e) }))) }), []), { incoming: a, outgoing: s }); c.incoming.forEach((function (e) { var r = yh(e, i, n); t.reconnectEnd(e, i, r) })), c.outgoing.forEach((function (e) { var r = vh(e, i, n); t.reconnectStart(e, i, r) })) } }), !0) } e(dh, la), dh.$inject = ["eventBus", "modeling", "bpmnFactory", "textRenderer"], e(mh, la), mh.$inject = ["eventBus", "modeling"], Sh.$inject = ["eventBus", "modeling"], e(Sh, la); const Ch = ["bpmn:MessageEventDefinition", "bpmn:TimerEventDefinition", "bpmn:EscalationEventDefinition", "bpmn:ConditionalEventDefinition", "bpmn:SignalEventDefinition"]; function kh(e) { const t = Cr(e); if (!(Er(t, "bpmn:BoundaryEvent") || Er(t, "bpmn:StartEvent") && Gr(t.$parent))) return !1; const n = t.get("eventDefinitions"); return !(!n || !n.length) && Ch.some((e => Er(n[0], e))) } function Rh(e) { return Er(e, "bpmn:BoundaryEvent") ? "cancelActivity" : "isInterrupting" } function Ph(e, t) { e.invoke(la, this), this.postExecuted("shape.replace", (function (e) { const n = e.context.oldShape, i = e.context.newShape, r = e.context.hints; if (!kh(i)) return; const o = Rh(i); if (r.targetElement && void 0 !== r.targetElement[o]) return; const a = Cr(n).get(o); a !== Cr(i).get(o) && t.updateProperties(i, { [o]: a }) })) } function Th(e, t) { la.call(this, e), this.preExecute("shape.resize", (function (e) { var n = e.shape, i = kr(n), r = i && i.get("label"); r && r.get("bounds") && t.updateModdleProperties(n, r, { bounds: void 0 }) }), !0) } function Ah(e, t, n) { la.call(this, e), this.preExecute("shape.delete", (function (e) { var i = e.context.shape; if (1 === i.incoming.length && 1 === i.outgoing.length) { var r = i.incoming[0], o = i.outgoing[0]; if (Er(r, "bpmn:SequenceFlow") && Er(o, "bpmn:SequenceFlow") && t.canConnect(r.source, o.target, r)) { var a = function (e, t) { var n = Uu(Mh(e[e.length - 2]), Mh(e[e.length - 1]), Mh(t[1]), Mh(t[0])); return n ? [].concat(e.slice(0, e.length - 1), [n], t.slice(1)) : [Mh(e[0]), Mh(t[t.length - 1])] }(r.waypoints, o.waypoints); n.reconnectEnd(r, o.target, a) } } })) } function Mh(e) { return e.original || e } function Dh(e, t) { la.call(this, e), this.preExecute("shape.delete", (function (e) { var t = e.shape, n = t.parent; Er(t, "bpmn:Participant") && (e.collaborationRoot = n) }), !0), this.postExecute("shape.delete", (function (e) { var n = e.collaborationRoot; n && !n.businessObject.participants.length && t.makeProcess() }), !0) } function Bh(e, t, n, i) { la.call(this, e); var r = i.get("dragging", !1); function o(e) { var i, r, o = e.source, a = e.target; e.parent && (Er(e, "bpmn:SequenceFlow") && (n.canConnectSequenceFlow(o, a) || (r = !0), n.canConnectMessageFlow(o, a) && (i = "bpmn:MessageFlow")), Er(e, "bpmn:MessageFlow") && (n.canConnectMessageFlow(o, a) || (r = !0), n.canConnectSequenceFlow(o, a) && (i = "bpmn:SequenceFlow")), r && t.removeConnection(e), i && t.connect(o, a, { type: i, waypoints: e.waypoints.slice() })) } this.postExecuted("elements.move", (function (e) { g(e.closure.allConnections, o) }), !0), this.preExecute("connection.reconnect", (function (e) { var i, o, a = e.context, s = a.connection, c = a.newSource || s.source, p = a.newTarget || s.target; (i = n.canConnect(c, p)) && i.type !== s.type && (o = t.connect(c, p, { type: i.type, associationDirection: i.associationDirection, waypoints: s.waypoints.slice() }), s.parent && t.removeConnection(s), a.connection = o, r && function (e, t) { var n, i = r.context(), o = i && i.payload.previousSelection; if (!o || !o.length) return; if (-1 === (n = o.indexOf(e))) return; o.splice(n, 1, t) }(s, o)) })), this.postExecuted("element.updateProperties", (function (e) { var n, i = e.context, r = i.properties, o = i.element, a = o.businessObject; r.default && (n = m(o.outgoing, A({ id: o.businessObject.default.id }))) && t.updateProperties(n, { conditionExpression: void 0 }), r.conditionExpression && a.sourceRef.default === a && t.updateProperties(o.source, { default: void 0 }) })) } function Nh(e, t, n, i, r, o) { i.invoke(la, this), this._bpmnReplace = e, this._elementRegistry = n, this._selection = o, this.postExecuted(["elements.create"], 500, (function (e) { var n = e.context, i = n.parent, r = n.elements, o = b(r, (function (e, n) { var r = t.canReplace([n], n.host || n.parent || i); return r ? e.concat(r.replacements) : e }), []); o.length && this._replaceElements(r, o) }), this), this.postExecuted(["elements.move"], 500, (function (e) { var n = e.context, i = n.newParent, r = n.newHost, o = []; g(n.closure.topLevel, (function (e) { o = Gr(e) ? o.concat(e.children) : o.concat(e) })), 1 === o.length && r && (i = r); var a = t.canReplace(o, i); a && this._replaceElements(o, a.replacements, r) }), this), this.postExecute(["shape.replace"], 1500, (function (e) { var n, i = e.context, r = i.oldShape, o = i.newShape, a = r.attachers; a && a.length && (n = t.canReplace(a, o), this._replaceElements(a, n.replacements)) }), this), this.postExecuted(["shape.replace"], 1500, (function (e) { var t = e.context, n = t.oldShape, i = t.newShape; r.unclaimId(n.businessObject.id, n.businessObject), r.updateProperties(i, { id: n.id }) })) } Ph.$inject = ["injector", "modeling"], e(Ph, la), e(Th, la), Th.$inject = ["eventBus", "modeling"], e(Ah, la), Ah.$inject = ["eventBus", "bpmnRules", "modeling"], Dh.$inject = ["eventBus", "modeling"], e(Dh, la), e(Bh, la), Bh.$inject = ["eventBus", "modeling", "bpmnRules", "injector"], e(Nh, la), Nh.prototype._replaceElements = function (e, t) { var n = this._elementRegistry, i = this._bpmnReplace, r = this._selection; g(t, (function (t) { var r = { type: t.newElementType }, o = n.get(t.oldElementId), a = e.indexOf(o); e[a] = i.replaceElement(o, r, { select: !1 }) })), t && r.select(e) }, Nh.$inject = ["bpmnReplace", "bpmnRules", "elementRegistry", "injector", "modeling", "selection"]; var Oh = { width: 140, height: 120 }, jh = { width: 300, height: 60 }, Lh = { width: 300, height: 150 }, Ih = { width: 140, height: 120 }, $h = { width: 50, height: 30 }; function Fh(e) { e.on("resize.start", 1500, (function (e) { var t = e.context, n = t.shape, i = t.direction, r = t.balanced; (Er(n, "bpmn:Lane") || Er(n, "bpmn:Participant")) && (t.resizeConstraints = function (e, t, n) { var i = Bu(e), r = !0, o = !0, a = Mu(i, [i]), s = mn(e), c = {}, p = {}; /e/.test(t) ? p.right = s.left + jh.width : /w/.test(t) && (p.left = s.right - jh.width); a.forEach((function (e) { var i = mn(e); /n/.test(t) && (i.top < s.top - 10 && (r = !1), n && zh(s.top - i.bottom) < 10 && Uh(c, "top", i.top + jh.height), zh(s.top - i.top) < 5 && Gh(p, "top", i.bottom - jh.height)), /s/.test(t) && (i.bottom > s.bottom + 10 && (o = !1), n && zh(s.bottom - i.top) < 10 && Gh(c, "bottom", i.bottom - jh.height), zh(s.bottom - i.bottom) < 5 && Uh(p, "bottom", i.top + jh.height)) })); var l = i.children.filter((function (e) { return !e.hidden && !e.waypoints && (Er(e, "bpmn:FlowElement") || Er(e, "bpmn:Artifact")) })); return l.forEach((function (e) { var n = mn(e); r && /n/.test(t) && Gh(p, "top", n.top - Yh), /e/.test(t) && Uh(p, "right", n.right + qh), o && /s/.test(t) && Uh(p, "bottom", n.bottom + Xh), /w/.test(t) && Gh(p, "left", n.left - Kh) })), { min: p, max: c } }(n, i, r)), Er(n, "bpmn:Participant") && (t.minDimensions = Lh), Er(n, "bpmn:SubProcess") && Vr(n) && (t.minDimensions = Ih), Er(n, "bpmn:TextAnnotation") && (t.minDimensions = $h) })) } Fh.$inject = ["eventBus"]; var zh = Math.abs, Hh = Math.min, Vh = Math.max; function Wh(e, t, n, i) { var r = e[t]; e[t] = void 0 === r ? n : i(n, r) } function Gh(e, t, n) { return Wh(e, t, n, Hh) } function Uh(e, t, n) { return Wh(e, t, n, Vh) } var qh = 20, Kh = 50, Yh = 20, Xh = 20; function Zh(e, t) { e.on("resize.start", 1501, (function (e) { var t = e.context, n = t.shape; (Er(n, "bpmn:Lane") || Er(n, "bpmn:Participant")) && (t.balanced = !Fo(e)) })), e.on("resize.end", 1001, (function (e) { var n = e.context, i = n.shape, r = n.canExecute, o = n.newBounds; if (Er(i, "bpmn:Lane") || Er(i, "bpmn:Participant")) return r && (o = dn(o), t.resizeLane(i, o, n.balanced)), !1 })) } Zh.$inject = ["eventBus", "modeling"]; function Qh(e, t, n, i, r) { function o(e) { return Sr(e, ["bpmn:ReceiveTask", "bpmn:SendTask"]) || function (e, t) { p(t) || (t = [t]); return w(t, (function (t) { return Ur(e, t) })) }(e, ["bpmn:ErrorEventDefinition", "bpmn:EscalationEventDefinition", "bpmn:MessageEventDefinition", "bpmn:SignalEventDefinition"]) } function a(t) { return !!m(e.getDefinitions().get("rootElements"), A({ id: t.id })) } function s(e) { return Er(e, "bpmn:ErrorEventDefinition") ? "errorRef" : Er(e, "bpmn:EscalationEventDefinition") ? "escalationRef" : Er(e, "bpmn:MessageEventDefinition") ? "messageRef" : Er(e, "bpmn:SignalEventDefinition") ? "signalRef" : void 0 } function c(e) { if (Sr(e, ["bpmn:ReceiveTask", "bpmn:SendTask"])) return e.get("messageRef"); var t = e.get("eventDefinitions")[0]; return t.get(s(t)) } n.invoke(la, this), this.executed(["shape.create", "element.updateProperties", "element.updateModdleProperties"], (function (t) { var n = t.shape || t.element; if (o(n)) { var i = c(Cr(n)); i && !a(i) && (Et(e.getDefinitions().get("rootElements"), i), t.addedRootElement = i) } }), !0), this.reverted(["shape.create", "element.updateProperties", "element.updateModdleProperties"], (function (t) { var n = t.addedRootElement; n && wt(e.getDefinitions().get("rootElements"), n) }), !0), t.on("copyPaste.copyElement", (function (e) { var t = e.descriptor, n = e.element; if (!n.labelTarget && o(n)) { var i = c(Cr(n)); i && (t.referencedRootElement = i) } })), t.on("copyPaste.pasteElement", 500, (function (e) { var t = e.descriptor, n = t.businessObject, o = t.referencedRootElement; o && (a(o) || (o = i.copyElement(o, r.create(o.$type))), function (e, t) { if (Sr(e, ["bpmn:ReceiveTask", "bpmn:SendTask"])) return e.set("messageRef", t); var n = e.get("eventDefinitions")[0]; n.set(s(n), t) }(n, o), delete t.referencedRootElement) })) } Qh.$inject = ["bpmnjs", "eventBus", "injector", "moddleCopy", "bpmnFactory"], e(Qh, la); var Jh = Math.max; function ed(e) { e.on("spaceTool.getMinDimensions", (function (e) { var t = e.shapes, n = e.axis, i = e.start, r = {}; return g(t, (function (e) { var t = e.id; Er(e, "bpmn:Participant") && (!function (e) { return "x" === e }(n) ? r[t] = { width: Lh.width, height: td(e, i) } : r[t] = Lh), Er(e, "bpmn:SubProcess") && Vr(e) && (r[t] = Ih), Er(e, "bpmn:TextAnnotation") && (r[t] = $h), Er(e, "bpmn:Group") && (r[t] = Oh) })), r })) } function td(e, t) { var n; return Du(e).length ? (n = function (e, t) { var n, i = Du(e); return n = nd(i, t), e.height - n.height + jh.height }(e, t), Jh(Lh.height, n)) : Lh.height } function nd(e, t) { var n, i, r; for (n = 0; n < e.length; n++)if (t >= (i = e[n]).y && t <= i.y + i.height) return (r = Du(i)).length ? nd(r, t) : i } ed.$inject = ["eventBus"]; var id = 180, rd = 160; function od(e, t, n, i, r, o, a) { la.call(this, t), this._canvas = e, this._eventBus = t, this._modeling = n, this._elementFactory = i, this._bpmnFactory = r, this._bpmnjs = o, this._elementRegistry = a; var s = this; function c(e) { return Er(e, "bpmn:SubProcess") && !Vr(e) } function p(t) { var n = t.shape, i = t.newRootElement, r = Cr(n); i = s._addDiagram(i || r), t.newRootElement = e.addRootElement(i) } function l(t) { var n = Cr(t.shape); s._removeDiagram(n); var i = t.newRootElement = a.get(_a(n)); e.removeRootElement(i) } this.executed("shape.create", (function (e) { c(e.shape) && p(e) }), !0), this.postExecuted("shape.create", (function (e) { var t = e.shape, n = e.newRootElement; n && t.children && (s._showRecursively(t.children), s._moveChildrenToShape(t, n)) }), !0), this.reverted("shape.create", (function (e) { c(e.shape) && l(e) }), !0), this.preExecuted("shape.delete", (function (e) { var t = e.shape; if (c(t)) { var i = a.get(_a(t)); i && n.removeElements(i.children.slice()) } }), !0), this.executed("shape.delete", (function (e) { c(e.shape) && l(e) }), !0), this.reverted("shape.delete", (function (e) { c(e.shape) && p(e) }), !0), this.preExecuted("shape.replace", (function (t) { var n = t.oldShape, i = t.newShape; c(n) && c(i) && (t.oldRoot = e.removeRootElement(_a(n))) }), !0), this.postExecuted("shape.replace", (function (t) { var i = t.newShape, r = t.oldRoot, o = e.findRoot(_a(i)); if (r && o) { var a = r.children; n.moveElements(a, { x: 0, y: 0 }, o) } }), !0), this.executed("element.updateProperties", (function (e) { var t = e.element; if (Er(t, "bpmn:SubProcess")) { var n = e.properties, i = e.oldProperties.id, r = n.id; if (i !== r) { if (xa(t)) return a.updateId(t, ba(r)), void a.updateId(i, r); a.get(ba(i)) && a.updateId(ba(i), ba(r)) } } }), !0), this.reverted("element.updateProperties", (function (e) { var t = e.element; if (Er(t, "bpmn:SubProcess")) { var n = e.properties, i = e.oldProperties.id, r = n.id; if (i !== r) { if (xa(t)) return a.updateId(t, ba(i)), void a.updateId(r, i); var o = a.get(ba(r)); o && a.updateId(o, ba(i)) } } }), !0), t.on("element.changed", (function (e) { var n = e.element; if (xa(n)) { var i = n, r = a.get(ga(i)); r && r !== i && t.fire("element.changed", { element: r }) } })), this.executed("shape.toggleCollapse", 400, (function (e) { var t = e.shape; Er(t, "bpmn:SubProcess") && (Vr(t) ? l(e) : (p(e), s._showRecursively(t.children))) }), !0), this.reverted("shape.toggleCollapse", 400, (function (e) { var t = e.shape; Er(t, "bpmn:SubProcess") && (Vr(t) ? l(e) : (p(e), s._showRecursively(t.children))) }), !0), this.postExecuted("shape.toggleCollapse", 600, (function (e) { var t = e.shape; if (Er(t, "bpmn:SubProcess")) { var n = e.newRootElement; n && (Vr(t) ? s._moveChildrenToShape(n, t) : s._moveChildrenToShape(t, n)) } }), !0), t.on("copyPaste.createTree", (function (e) { var t = e.element, n = e.children; if (c(t)) { var i = _a(t), r = a.get(i); r && n.push.apply(n, r.children) } })), t.on("copyPaste.copyElement", (function (e) { var t = e.descriptor, n = e.element, i = e.elements, r = n.parent; if (Er(kr(r), "bpmndi:BPMNPlane")) { var o = ga(r), a = m(i, (function (e) { return e.id === o })); a && (t.parent = a.id) } })), t.on("copyPaste.pasteElement", (function (e) { var t = e.descriptor; t.parent && (c(t.parent) || t.parent.hidden) && (t.hidden = !0) })) } function ad(e, t) { e.invoke(la, this), this.postExecuted("shape.replace", (function (e) { var n = e.context.oldShape, i = e.context.newShape; if (Er(i, "bpmn:SubProcess") && (Er(n, "bpmn:Task") || Er(n, "bpmn:CallActivity")) && Vr(i)) { var r, o = { x: (r = i).x + r.width / 6, y: r.y + r.height / 2 }; t.createShape({ type: "bpmn:StartEvent" }, o, i) } })) } function sd(e, t) { la.call(this, e), this.postExecuted("shape.toggleCollapse", 1500, (function (e) { var n = e.shape; if (!Vr(n)) { var i = mt(n); i.forEach((function (e) { var t = e.incoming.slice(), n = e.outgoing.slice(); g(t, (function (e) { r(e, !0) })), g(n, (function (e) { r(e, !1) })) })) } function r(e, r) { -1 !== i.indexOf(e.source) && -1 !== i.indexOf(e.target) || (r ? t.reconnectEnd(e, n, gn(n)) : t.reconnectStart(e, n, gn(n))) } }), !0) } e(od, la), od.prototype._moveChildrenToShape = function (e, t) { var n, i = this._modeling, r = e.children; if (r) { var o = (r = r.concat(r.reduce((function (t, n) { return n.label && n.label.parent !== e ? t.concat(n.label) : t }), []))).filter((function (e) { return !e.hidden })); if (o.length) { var a = vt(o); if (t.x) { var s = gn(t), c = gn(a); n = { x: s.x - c.x, y: s.y - c.y } } else n = { x: id - a.x, y: rd - a.y }; i.moveElements(r, n, t, { autoResize: !1 }) } else i.moveElements(r, { x: 0, y: 0 }, t, { autoResize: !1 }) } }, od.prototype._showRecursively = function (e, t) { var n = this, i = []; return e.forEach((function (e) { e.hidden = !!t, i = i.concat(e), e.children && (i = i.concat(n._showRecursively(e.children, e.collapsed || t))) })), i }, od.prototype._addDiagram = function (e) { var t = this._bpmnjs.getDefinitions().diagrams; return e.businessObject || (e = this._createNewDiagram(e)), t.push(e.di.$parent), e }, od.prototype._createNewDiagram = function (e) { var t = this._bpmnFactory, n = this._elementFactory, i = t.create("bpmndi:BPMNPlane", { bpmnElement: e }), r = t.create("bpmndi:BPMNDiagram", { plane: i }); return i.$parent = r, n.createRoot({ id: _a(e), type: e.$type, di: i, businessObject: e, collapsed: !0 }) }, od.prototype._removeDiagram = function (e) { var t = this._bpmnjs.getDefinitions().diagrams, n = m(t, (function (t) { return t.plane.bpmnElement.id === e.id })); return t.splice(t.indexOf(n), 1), n }, od.$inject = ["canvas", "eventBus", "modeling", "elementFactory", "bpmnFactory", "bpmnjs", "elementRegistry"], ad.$inject = ["injector", "modeling"], e(ad, la), e(sd, la), sd.$inject = ["eventBus", "modeling"]; function cd(e, t, n) { la.call(this, e), this.executed(["shape.toggleCollapse"], 500, (function (e) { var t, n = e.context.shape; Er(n, "bpmn:SubProcess") && (n.collapsed ? kr(n).isExpanded = !1 : ((t = n.children).length && t.forEach((function (e) { "label" !== e.type || e.businessObject.name || (e.hidden = !0) })), kr(n).isExpanded = !0)) })), this.reverted(["shape.toggleCollapse"], 500, (function (e) { var t = e.context.shape; t.collapsed ? kr(t).isExpanded = !1 : kr(t).isExpanded = !0 })), this.postExecuted(["shape.toggleCollapse"], 500, (function (e) { var i, r = e.context.shape, o = t.getDefaultSize(r); i = r.collapsed ? function (e, t) { return { x: e.x + (e.width - t.width) / 2, y: e.y + (e.height - t.height) / 2, width: t.width, height: t.height } }(r, o) : function (e, t) { var n, i, r, o = e.children, a = t; return n = (r = o, r.filter((function (e) { return !e.hidden }))).concat([e]), (i = Ru(n)) ? (a.width = Math.max(i.width, a.width), a.height = Math.max(i.height, a.height), a.x = i.x + (i.width - a.width) / 2, a.y = i.y + (i.height - a.height) / 2) : (a.x = e.x + (e.width - a.width) / 2, a.y = e.y + (e.height - a.height) / 2), a }(r, o), n.resizeShape(r, i, null, { autoResize: !r.collapsed && "nwse" }) })) } function pd(e, t, n, i) { t.invoke(la, this), this.preExecute("shape.delete", (function (e) { var t = e.context.shape, r = t.businessObject; hn(t) || (Er(t, "bpmn:Participant") && Vr(t) && n.ids.unclaim(r.processRef.id), i.unclaimId(r.id, r)) })), this.preExecute("connection.delete", (function (e) { var t = e.context.connection.businessObject; i.unclaimId(t.id, t) })), this.preExecute("canvas.updateRoot", (function () { var t = e.getRootElement(), i = t.businessObject; Er(t, "bpmn:Collaboration") && n.ids.unclaim(i.id) })) } function ld(e, t) { la.call(this, e), this.preExecute("connection.delete", (function (e) { var n = e.context.connection, i = n.source; (function (e, t) { if (!Er(e, "bpmn:SequenceFlow")) return !1; var n = Cr(t), i = Cr(e); return n.get("default") === i })(n, i) && t.updateProperties(i, { default: null }) })) } e(cd, la), cd.$inject = ["eventBus", "elementFactory", "modeling"], e(pd, la), pd.$inject = ["canvas", "injector", "moddle", "modeling"], e(ld, la), ld.$inject = ["eventBus", "modeling"]; function ud(e, t, n) { var i; function r() { if (!i) throw new Error(n("out of bounds release")); return i } la.call(this, e); var o = ["spaceTool", "lane.add", "lane.resize", "lane.split", "elements.create", "elements.delete", "elements.move", "shape.create", "shape.delete", "shape.move", "shape.resize"]; this.preExecute(o, 5e3, (function (e) { (i = i || new hd).enter() })), this.postExecuted(o, 500, (function (e) { !function () { if (!i) throw new Error(n("out of bounds release")); var e = i.leave(); e && (t.updateLaneRefs(i.flowNodes, i.lanes), i = null) }() })), this.preExecute(["shape.create", "shape.move", "shape.delete", "shape.resize"], (function (e) { var t = e.context.shape, n = r(); t.labelTarget || (Er(t, "bpmn:Lane") && n.addLane(t), Er(t, "bpmn:FlowNode") && n.addFlowNode(t)) })) } function hd() { this.flowNodes = [], this.lanes = [], this.counter = 0, this.addLane = function (e) { this.lanes.push(e) }, this.addFlowNode = function (e) { this.flowNodes.push(e) }, this.enter = function () { this.counter++ }, this.leave = function () { return this.counter--, !this.counter } } ud.$inject = ["eventBus", "modeling", "translate"], e(ud, la); var dd = { __init__: ["adaptiveLabelPositioningBehavior", "appendBehavior", "associationBehavior", "attachEventBehavior", "boundaryEventBehavior", "compensateBoundaryEventBehaviour", "createBehavior", "createDataObjectBehavior", "createParticipantBehavior", "dataInputAssociationBehavior", "dataStoreBehavior", "deleteLaneBehavior", "detachEventBehavior", "dropOnFlowBehavior", "eventBasedGatewayBehavior", "fixHoverBehavior", "groupBehavior", "importDockingFix", "isHorizontalFix", "labelBehavior", "layoutConnectionBehavior", "messageFlowBehavior", "nonInterruptingBehavior", "removeElementBehavior", "removeEmbeddedLabelBoundsBehavior", "removeParticipantBehavior", "replaceConnectionBehavior", "replaceElementBehaviour", "resizeBehavior", "resizeLaneBehavior", "rootElementReferenceBehavior", "spaceToolBehavior", "subProcessPlaneBehavior", "subProcessStartEventBehavior", "toggleCollapseConnectionBehaviour", "toggleElementCollapseBehaviour", "unclaimIdBehavior", "updateFlowNodeRefsBehavior", "unsetDefaultFlowBehavior"], adaptiveLabelPositioningBehavior: ["type", Zl], appendBehavior: ["type", Jl], associationBehavior: ["type", eu], attachEventBehavior: ["type", tu], boundaryEventBehavior: ["type", iu], compensateBoundaryEventBehaviour: ["type", ru], createBehavior: ["type", cu], createDataObjectBehavior: ["type", pu], createParticipantBehavior: ["type", fu], dataInputAssociationBehavior: ["type", vu], dataStoreBehavior: ["type", _u], deleteLaneBehavior: ["type", Ou], detachEventBehavior: ["type", ju], dropOnFlowBehavior: ["type", Iu], eventBasedGatewayBehavior: ["type", zu], fixHoverBehavior: ["type", Wu], groupBehavior: ["type", Gu], importDockingFix: ["type", qu], isHorizontalFix: ["type", Yu], labelBehavior: ["type", dh], layoutConnectionBehavior: ["type", mh], messageFlowBehavior: ["type", Sh], nonInterruptingBehavior: ["type", Ph], removeElementBehavior: ["type", Ah], removeEmbeddedLabelBoundsBehavior: ["type", Th], removeParticipantBehavior: ["type", Dh], replaceConnectionBehavior: ["type", Bh], replaceElementBehaviour: ["type", Nh], resizeBehavior: ["type", Fh], resizeLaneBehavior: ["type", Zh], rootElementReferenceBehavior: ["type", Qh], spaceToolBehavior: ["type", ed], subProcessPlaneBehavior: ["type", od], subProcessStartEventBehavior: ["type", ad], toggleCollapseConnectionBehaviour: ["type", sd], toggleElementCollapseBehaviour: ["type", cd], unclaimIdBehavior: ["type", pd], unsetDefaultFlowBehavior: ["type", ld], updateFlowNodeRefsBehavior: ["type", ud] }; function fd(e, t) { var n = _n(e, t, -15); return "intersect" !== n ? n : null } function md(e) { np.call(this, e) } function vd(e) { return !e || hn(e) } function yd(e) { do { if (Er(e, "bpmn:Process")) return Cr(e); if (Er(e, "bpmn:Participant")) return Cr(e).processRef || Cr(e) } while (e = e.parent) } function gd(e) { return Er(e, "bpmn:TextAnnotation") } function _d(e) { return Er(e, "bpmn:Group") && !e.labelTarget } function bd(e) { return Er(e, "bpmn:BoundaryEvent") && Sd(e, "bpmn:CompensateEventDefinition") } function xd(e) { return Cr(e).isForCompensation } function wd(e) { for (var t = e; t = t.parent;) { if (Er(t, "bpmn:FlowElementsContainer")) return Cr(t); if (Er(t, "bpmn:Participant")) return Cr(t).processRef } return null } function Ed(e, t) { return wd(e) === wd(t) } function Sd(e, t) { return !!m(Cr(e).eventDefinitions || [], (function (e) { return Er(e, t) })) } function Cd(e, t) { return (Cr(e).eventDefinitions || []).every((function (e) { return Er(e, t) })) } function kd(e, t) { var n = function (e) { for (var t = []; e;)(e = e.parent) && t.push(e); return t }(t); return -1 !== n.indexOf(e) } function Rd(e, t, n) { if (vd(e) || vd(t)) return null; if (!Er(n, "bpmn:DataAssociation")) { if (zd(e, t)) return { type: "bpmn:MessageFlow" }; if (Hd(e, t)) return { type: "bpmn:SequenceFlow" } } var i = Vd(e, t); return i || (Fd(e, t) ? { type: "bpmn:Association", associationDirection: "One" } : !!$d(e, t) && { type: "bpmn:Association", associationDirection: "None" }) } function Pd(e, t) { return !(!hn(e) && !_d(e)) || !(Er(t, "bpmn:Participant") && !Vr(t)) && (Er(e, "bpmn:Participant") ? Er(t, "bpmn:Process") || Er(t, "bpmn:Collaboration") : Sr(e, ["bpmn:DataInput", "bpmn:DataOutput"]) && e.parent ? t === e.parent : Er(e, "bpmn:Lane") ? Er(t, "bpmn:Participant") || Er(t, "bpmn:Lane") : !(Er(e, "bpmn:BoundaryEvent") && !function (e) { return Cr(e).cancelActivity && (Md(e) || Dd(e)) }(e)) && (Er(e, "bpmn:FlowElement") && !Er(e, "bpmn:DataStoreReference") ? Er(t, "bpmn:FlowElementsContainer") ? Vr(t) : Sr(t, ["bpmn:Participant", "bpmn:Lane"]) : Er(e, "bpmn:DataStoreReference") && Er(t, "bpmn:Collaboration") ? w(Cr(t).get("participants"), (function (e) { return !!e.get("processRef") })) : Sr(e, ["bpmn:Artifact", "bpmn:DataAssociation", "bpmn:DataStoreReference"]) ? Sr(t, ["bpmn:Collaboration", "bpmn:Lane", "bpmn:Participant", "bpmn:Process", "bpmn:SubProcess"]) : !!Er(e, "bpmn:MessageFlow") && (Er(t, "bpmn:Collaboration") || e.source.parent == t || e.target.parent == t))) } function Td(e) { return Er(e, "bpmn:Lane") } function Ad(e) { return !!function (e) { return !hn(e) && Er(e, "bpmn:BoundaryEvent") }(e) || (!(!Er(e, "bpmn:IntermediateThrowEvent") || !Md(e)) || Er(e, "bpmn:IntermediateCatchEvent") && Dd(e)) } function Md(e) { var t = Cr(e); return t && !(t.eventDefinitions && t.eventDefinitions.length) } function Dd(e) { return Bd(e, ["bpmn:MessageEventDefinition", "bpmn:TimerEventDefinition", "bpmn:SignalEventDefinition", "bpmn:ConditionalEventDefinition"]) } function Bd(e, t) { return t.some((function (t) { return Sd(e, t) })) } function Nd(e, t, n, i) { if (Array.isArray(e) || (e = [e]), 1 !== e.length) return !1; var r = e[0]; return !hn(r) && (!!Ad(r) && (!Gr(t) && (!(!Er(t, "bpmn:Activity") || xd(t)) && (!(i && !fd(i, t)) && (!function (e) { return Er(e, "bpmn:ReceiveTask") && m(e.incoming, (function (e) { return Er(e.source, "bpmn:EventBasedGateway") })) }(t) && "attach"))))) } function Od(e, t, n) { if (!t) return !1; var i = { replacements: [] }; return g(e, (function (e) { Gr(t) || Er(e, "bpmn:StartEvent") && "label" !== e.type && Pd(e, t) && (function (e) { return e && !1 !== Cr(e).isInterrupting }(e) || i.replacements.push({ oldElementId: e.id, newElementType: "bpmn:StartEvent" }), (function (e) { return Ur(e, "bpmn:ErrorEventDefinition") }(e) || function (e) { return Ur(e, "bpmn:EscalationEventDefinition") }(e) || function (e) { return Ur(e, "bpmn:CompensateEventDefinition") }(e)) && i.replacements.push({ oldElementId: e.id, newElementType: "bpmn:StartEvent" }), Bd(e, ["bpmn:MessageEventDefinition", "bpmn:TimerEventDefinition", "bpmn:SignalEventDefinition", "bpmn:ConditionalEventDefinition"]) && Er(t, "bpmn:SubProcess") && i.replacements.push({ oldElementId: e.id, newElementType: "bpmn:StartEvent" })), Er(t, "bpmn:Transaction") || Sd(e, "bpmn:CancelEventDefinition") && "label" !== e.type && (Er(e, "bpmn:EndEvent") && Pd(e, t) && i.replacements.push({ oldElementId: e.id, newElementType: "bpmn:EndEvent" }), Er(e, "bpmn:BoundaryEvent") && Nd(e, t, 0, n) && i.replacements.push({ oldElementId: e.id, newElementType: "bpmn:BoundaryEvent" })) })), !!i.replacements.length && i } function jd(e, t) { return !w(e, Td) && (!t || e.every((function (e) { return Pd(e, t) }))) } function Ld(e, t, n, i) { return !!t && (!(!hn(e) && !_d(e)) || !function (e, t) { return e === t }(n, t) && ((!n || !kd(n, t)) && (Pd(e, t) || Wd(e, t)))) } function Id(e, t) { return Er(e, "bpmn:SubProcess") ? Vr(e) && (!t || t.width >= 100 && t.height >= 80) : Er(e, "bpmn:Lane") ? !t || t.width >= 130 && t.height >= 60 : Er(e, "bpmn:Participant") ? !t || t.width >= 250 && t.height >= 50 : !!gd(e) || !!_d(e) } function $d(e, t) { return !kd(t, e) && !kd(e, t) && (!!function (e, t) { var n = gd(e), i = gd(t); return (n || i) && n !== i }(e, t) || !!Vd(e, t)) } function Fd(e, t) { return Ed(e, t) && bd(e) && Er(t, "bpmn:Activity") && (n = e, !t.attachers.includes(n)) && !Gr(t); var n } function zd(e, t) { return !(Ud(e) && !Ud(t)) && (Er(n = e, "bpmn:InteractionNode") && !Er(n, "bpmn:BoundaryEvent") && (!Er(n, "bpmn:Event") || Er(n, "bpmn:ThrowEvent") && Cd(n, "bpmn:MessageEventDefinition")) && function (e) { return Er(e, "bpmn:InteractionNode") && !xd(e) && (!Er(e, "bpmn:Event") || Er(e, "bpmn:CatchEvent") && Cd(e, "bpmn:MessageEventDefinition")) && !(Er(e, "bpmn:BoundaryEvent") && !Sd(e, "bpmn:MessageEventDefinition")) }(t) && !function (e, t) { return yd(e) === yd(t) }(e, t)); var n } function Hd(e, t) { return Er(n = e, "bpmn:FlowNode") && !Er(n, "bpmn:EndEvent") && !Gr(n) && !(Er(n, "bpmn:IntermediateThrowEvent") && Sd(n, "bpmn:LinkEventDefinition")) && !bd(n) && !xd(n) && function (e) { return Er(e, "bpmn:FlowNode") && !Er(e, "bpmn:StartEvent") && !Er(e, "bpmn:BoundaryEvent") && !Gr(e) && !(Er(e, "bpmn:IntermediateCatchEvent") && Sd(e, "bpmn:LinkEventDefinition")) && !xd(e) }(t) && Ed(e, t) && !(Er(e, "bpmn:EventBasedGateway") && !function (e) { return Er(e, "bpmn:ReceiveTask") || Er(e, "bpmn:IntermediateCatchEvent") && (Sd(e, "bpmn:MessageEventDefinition") || Sd(e, "bpmn:TimerEventDefinition") || Sd(e, "bpmn:ConditionalEventDefinition") || Sd(e, "bpmn:SignalEventDefinition")) }(t)); var n } function Vd(e, t) { return Sr(e, ["bpmn:DataObjectReference", "bpmn:DataStoreReference"]) && Sr(t, ["bpmn:Activity", "bpmn:ThrowEvent"]) ? { type: "bpmn:DataInputAssociation" } : !(!Sr(t, ["bpmn:DataObjectReference", "bpmn:DataStoreReference"]) || !Sr(e, ["bpmn:Activity", "bpmn:CatchEvent"])) && { type: "bpmn:DataOutputAssociation" } } function Wd(e, t, n) { if (!t) return !1; if (Array.isArray(e)) { if (1 !== e.length) return !1; e = e[0] } return t.source !== e && t.target !== e && (Sr(t, ["bpmn:SequenceFlow", "bpmn:MessageFlow"]) && !hn(t) && Er(e, "bpmn:FlowNode") && !Er(e, "bpmn:BoundaryEvent") && Pd(e, t.parent)) } function Gd(e, t) { return !!hn(t) || !(Er(t, "bpmn:Lane") && !function (e, t) { return e && t && -1 !== e.indexOf(t) }(e, t.parent)) } function Ud(e) { return vp(e, "bpmn:Process") || vp(e, "bpmn:Collaboration") } e(md, np), md.$inject = ["eventBus"], md.prototype.init = function () { this.addRule("connection.start", (function (e) { return function (e) { if (vd(e)) return null; return Sr(e, ["bpmn:FlowNode", "bpmn:InteractionNode", "bpmn:DataObjectReference", "bpmn:DataStoreReference", "bpmn:Group", "bpmn:TextAnnotation"]) }(e.source) })), this.addRule("connection.create", (function (e) { var t = e.source, n = e.target, i = e.hints || {}, r = i.targetParent; if (i.targetAttach) return !1; r && (n.parent = r); try { return Rd(t, n) } finally { r && (n.parent = null) } })), this.addRule("connection.reconnect", (function (e) { var t = e.connection; return Rd(e.source, e.target, t) })), this.addRule("connection.updateWaypoints", (function (e) { return { type: e.connection.type } })), this.addRule("shape.resize", (function (e) { return Id(e.shape, e.newBounds) })), this.addRule("elements.create", (function (e) { var t = e.elements, n = e.position, i = e.target; return !(un(i) && !Wd(t, i)) && x(t, (function (e) { return un(e) ? Rd(e.source, e.target, e) : e.host ? Nd(e, e.host, null, n) : Ld(e, i, null) })) })), this.addRule("elements.move", (function (e) { var t = e.target, n = e.shapes, i = e.position; return Nd(n, t, null, i) || Od(n, t, i) || jd(n, t) || Wd(n, t) })), this.addRule("shape.create", (function (e) { return Ld(e.shape, e.target, e.source, e.position) })), this.addRule("shape.attach", (function (e) { return Nd(e.shape, e.target, null, e.position) })), this.addRule("element.copy", (function (e) { var t = e.element; return Gd(e.elements, t) })) }, md.prototype.canConnectMessageFlow = zd, md.prototype.canConnectSequenceFlow = Hd, md.prototype.canConnectDataAssociation = Vd, md.prototype.canConnectAssociation = $d, md.prototype.canConnectCompensationAssociation = Fd, md.prototype.canMove = jd, md.prototype.canAttach = Nd, md.prototype.canReplace = Od, md.prototype.canDrop = Pd, md.prototype.canInsert = Wd, md.prototype.canCreate = Ld, md.prototype.canConnect = Rd, md.prototype.canResize = Id, md.prototype.canCopy = Gd; var qd = { __depends__: [Lp], __init__: ["bpmnRules"], bpmnRules: ["type", md] }; function Kd(e, t) { e.on("saveXML.start", 2e3, (function () { g(t.getRootElements(), (function (e) { var t, n = kr(e); t = E(y(mt([e], !1), (function (t) { return t !== e && !t.labelTarget })), kr), n.set("planeElement", t) })) })) } Kd.$inject = ["eventBus", "canvas"]; var Yd = { __init__: ["bpmnDiOrdering"], bpmnDiOrdering: ["type", Kd] }; function Xd(e) { la.call(this, e); var t = this; this.preExecute(["shape.create", "connection.create"], (function (e) { var n = e.context, i = n.shape || n.connection, r = n.parent, o = t.getOrdering(i, r); o && (void 0 !== o.parent && (n.parent = o.parent), n.parentIndex = o.index) })), this.preExecute(["shape.move", "connection.move"], (function (e) { var n = e.context, i = n.shape || n.connection, r = n.newParent || i.parent, o = t.getOrdering(i, r); o && (void 0 !== o.parent && (n.newParent = o.parent), n.newParentIndex = o.index) })) } function Zd(e, t, n) { Xd.call(this, e); var i = [{ type: "bpmn:SubProcess", order: { level: 6 } }, { type: "bpmn:SequenceFlow", order: { level: 9, containers: ["bpmn:Participant", "bpmn:FlowElementsContainer"] } }, { type: "bpmn:DataAssociation", order: { level: 9, containers: ["bpmn:Collaboration", "bpmn:FlowElementsContainer"] } }, { type: "bpmn:MessageFlow", order: { level: 9, containers: ["bpmn:Collaboration"] } }, { type: "bpmn:Association", order: { level: 6, containers: ["bpmn:Participant", "bpmn:FlowElementsContainer", "bpmn:Collaboration"] } }, { type: "bpmn:BoundaryEvent", order: { level: 8 } }, { type: "bpmn:Group", order: { level: 10, containers: ["bpmn:Collaboration", "bpmn:FlowElementsContainer"] } }, { type: "bpmn:FlowElement", order: { level: 5 } }, { type: "bpmn:Participant", order: { level: -2 } }, { type: "bpmn:Lane", order: { level: -1 } }]; function r(e) { var t = e.order; if (t || (e.order = t = function (e) { if (e.labelTarget) return { level: 10 }; var t = m(i, (function (t) { return Sr(e, [t.type]) })); return t && t.order || { level: 1 } }(e)), !t) throw new Error("no order for <" + e.id + ">"); return t } this.getOrdering = function (e, n) { if (e.labelTarget) return { parent: t.findRoot(n) || t.getRootElement(), index: -1 }; var i = r(e); i.containers && (n = function (e, t, n) { for (var i = t; i && !Sr(i, n);)i = i.parent; if (!i) throw new Error("no parent for <" + e.id + "> in <" + (t && t.id) + ">"); return i }(e, n, i.containers)); var o = n.children.indexOf(e), a = v(n.children, (function (t) { return !(!e.labelTarget && t.labelTarget) && i.level < r(t).level })); return -1 !== a && -1 !== o && o < a && (a -= 1), { index: a, parent: n } } } Xd.prototype.getOrdering = function (e, t) { return null }, e(Xd, la), Zd.$inject = ["eventBus", "canvas", "translate"], e(Zd, Xd); var Qd = { __depends__: [Ro], __init__: ["bpmnOrderingProvider"], bpmnOrderingProvider: ["type", Zd] }; function Jd() { } Jd.prototype.get = function () { return this._data }, Jd.prototype.set = function (e) { this._data = e }, Jd.prototype.clear = function () { var e = this._data; return delete this._data, e }, Jd.prototype.isEmpty = function () { return !this._data }; var ef = { clipboard: ["type", Jd] }, tf = "drop-ok", nf = "drop-not-ok", rf = "attach-ok", of = "new-parent", af = "create"; function sf(e, t, n, i, r) { function o(t, n) { [rf, tf, nf, of].forEach((function (i) { i === n ? e.addMarker(t, i) : e.removeMarker(t, i) })) } function a() { var e = t.context(); e && e.prefix === af && t.cancel() } n.on(["create.move", "create.hover"], (function (e) { var t = e.context, n = t.elements, i = e.hover, a = t.source, s = t.hints || {}; if (!i) return t.canExecute = !1, void (t.target = null); cf(e); var c = { x: e.x, y: e.y }, p = t.canExecute = i && function (e, t, n, i, o) { if (!t) return !1; var a = m(e = y(e, (function (t) { var n = t.labelTarget; return !(t.parent || hn(t) && -1 !== e.indexOf(n)) })), (function (e) { return !un(e) })), s = !1, c = !1, p = !1; pf(e) && (s = r.allowed("shape.attach", { position: n, shape: a, target: t })), s || (p = pf(e) ? r.allowed("shape.create", { position: n, shape: a, source: i, target: t }) : r.allowed("elements.create", { elements: e, position: n, target: t })); var l = o.connectionTarget; return p || s ? (a && i && (c = r.allowed("connection.create", { source: l === i ? a : i, target: l === i ? i : a, hints: { targetParent: t, targetAttach: s } })), { attach: s, connect: c }) : (null === p || null === s) && null }(n, i, c, a, s); i && null !== p && (t.target = i, p && p.attach ? o(i, rf) : o(i, p ? of : nf)) })), n.on(["create.end", "create.out", "create.cleanup"], (function (e) { var t = e.hover; t && o(t, null) })), n.on("create.end", (function (e) { var t = e.context, n = t.source, r = t.shape, o = t.elements, a = t.target, s = t.canExecute, c = s && s.attach, p = s && s.connect, l = t.hints || {}; if (!1 === s || !a) return !1; cf(e); var u = { x: e.x, y: e.y }; r = p ? i.appendShape(n, r, u, a, { attach: c, connection: !0 === p ? {} : p, connectionTarget: l.connectionTarget }) : m(o = i.createElements(o, u, a, L({}, l, { attach: c })), (function (e) { return !un(e) })), L(t, { elements: o, shape: r }), L(e, { elements: o, shape: r }) })), n.on("create.init", (function () { n.on("elements.changed", a), n.once(["create.cancel", "create.end"], 2e3, (function () { n.off("elements.changed", a) })) })), this.start = function (e, n, i) { p(n) || (n = [n]); var r = m(n, (function (e) { return !un(e) })); if (r) { i = L({ elements: n, hints: {}, shape: r }, i || {}), g(n, (function (e) { u(e.x) || (e.x = 0), u(e.y) || (e.y = 0) })); var o = vt(y(n, (function (e) { return !e.hidden }))); g(n, (function (e) { un(e) && (e.waypoints = E(e.waypoints, (function (e) { return { x: e.x - o.x - o.width / 2, y: e.y - o.y - o.height / 2 } }))), L(e, { x: e.x - o.x - o.width / 2, y: e.y - o.y - o.height / 2 }) })), t.init(e, af, { cursor: "grabbing", autoActivate: !0, data: { shape: r, elements: n, context: i } }) } } } function cf(e) { var t = e.context.createConstraints; t && (t.left && (e.x = Math.max(e.x, t.left)), t.right && (e.x = Math.min(e.x, t.right)), t.top && (e.y = Math.max(e.y, t.top)), t.bottom && (e.y = Math.min(e.y, t.bottom))) } function pf(e) { return e && 1 === e.length && !un(e[0]) } sf.$inject = ["canvas", "dragging", "eventBus", "modeling", "rules"]; function lf(e, t, n, i, r) { t.on("create.move", 750, (function (t) { var o = t.hover, a = t.context, s = a.elements, c = a.dragGroup; c || (c = a.dragGroup = function (e) { var t = De("g"); we(t, r.cls("djs-drag-group", ["no-events"])); var o = De("g"); return e.forEach((function (e) { var r; e.hidden || (e.waypoints ? (r = n._createContainer("connection", o), n.drawConnection(qn(r), e)) : (r = n._createContainer("shape", o), n.drawShape(qn(r), e), Yn(r, e.x, e.y)), i.addDragger(e, t, r)) })), t }(s)), o ? (c.parentNode || ge(e.getActiveLayer(), c), Yn(c, t.x, t.y)) : ke(c) })), t.on("create.cleanup", (function (e) { var t = e.context.dragGroup; t && ke(t) })) } lf.$inject = ["canvas", "eventBus", "graphicsFactory", "previewSupport", "styles"]; var uf = { __depends__: [Dp, Gl, Lp, ea], __init__: ["create", "createPreview"], create: ["type", sf], createPreview: ["type", lf] }; function hf(e) { var t = this; function n(e) { t._lastMoveEvent = e } this._lastMoveEvent = null, e.on("canvas.init", (function (e) { (t._svg = e.svg).addEventListener("mousemove", n) })), e.on("canvas.destroy", (function () { t._lastMouseEvent = null, t._svg.removeEventListener("mousemove", n) })) } hf.$inject = ["eventBus"], hf.prototype.getLastMoveEvent = function () { return this._lastMoveEvent || function (e, t) { var n = document.createEvent("MouseEvent"), i = e, r = t, o = e, a = t; n.initMouseEvent && n.initMouseEvent("mousemove", !0, !0, window, 0, i, r, o, a, !1, !1, !1, !1, 0, null); return n }(0, 0) }; var df = { __init__: ["mouse"], mouse: ["type", hf] }; function ff(e, t, n, i, r, o, a, s) { this._canvas = e, this._create = t, this._clipboard = n, this._elementFactory = i, this._eventBus = r, this._modeling = o, this._mouse = a, this._rules = s, r.on("copyPaste.copyElement", (function (e) { var t = e.descriptor, n = e.element, i = e.elements; t.priority = 1, t.id = n.id; var r = m(i, (function (e) { return e === n.parent })); r && (t.parent = n.parent.id), function (e) { return !!e.host }(n) && (t.priority = 2, t.host = n.host.id), un(n) && (t.priority = 3, t.source = n.source.id, t.target = n.target.id, t.waypoints = function (e) { return E(e.waypoints, (function (e) { return (e = mf(e)).original && (e.original = mf(e.original)), e })) }(n)), hn(n) && (t.priority = 4, t.labelTarget = n.labelTarget.id), g(["x", "y", "width", "height"], (function (e) { u(n[e]) && (t[e] = n[e]) })), t.hidden = n.hidden, t.collapsed = n.collapsed })), r.on("copyPaste.pasteElements", (function (e) { L(e.hints, { createElementsBehavior: !1 }) })) } function mf(e) { return L({}, e) } function vf(e, t) { var n = t.indexOf(e); return -1 === n ? t : t.splice(n, 1) } ff.$inject = ["canvas", "create", "clipboard", "elementFactory", "eventBus", "modeling", "mouse", "rules"], ff.prototype.copy = function (e) { var t, n; return p(e) || (e = e ? [e] : []), n = !1 === (t = this._eventBus.fire("copyPaste.canCopyElements", { elements: e })) ? {} : this.createTree(p(t) ? t : e), this._clipboard.set(n), this._eventBus.fire("copyPaste.elementsCopied", { elements: e, tree: n }), n }, ff.prototype.paste = function (e) { var t = this._clipboard.get(); if (!this._clipboard.isEmpty()) { var n = e && e.hints || {}; this._eventBus.fire("copyPaste.pasteElements", { hints: n }); var i = this._createElements(t); if (e && e.element && e.point) return this._paste(i, e.element, e.point, n); this._create.start(this._mouse.getLastMoveEvent(), i, { hints: n || {} }) } }, ff.prototype._paste = function (e, t, n, i) { g(e, (function (e) { u(e.x) || (e.x = 0), u(e.y) || (e.y = 0) })); var r = vt(e); return g(e, (function (e) { un(e) && (e.waypoints = E(e.waypoints, (function (e) { return { x: e.x - r.x - r.width / 2, y: e.y - r.y - r.height / 2 } }))), L(e, { x: e.x - r.x - r.width / 2, y: e.y - r.y - r.height / 2 }) })), this._modeling.createElements(e, n, t, L({}, i)) }, ff.prototype._createElements = function (e) { var t = this, n = this._eventBus, i = {}, r = []; return g(e, (function (e, o) { g(e = T(e, "priority"), (function (e) { var o, a = L({}, $(e, ["priority"])); return i[e.parent] ? a.parent = i[e.parent] : delete a.parent, n.fire("copyPaste.pasteElement", { cache: i, descriptor: a }), un(a) ? (a.source = i[e.source], a.target = i[e.target], o = i[e.id] = t.createConnection(a), void r.push(o)) : hn(a) ? (a.labelTarget = i[a.labelTarget], o = i[e.id] = t.createLabel(a), void r.push(o)) : (a.host && (a.host = i[a.host]), o = i[e.id] = t.createShape(a), void r.push(o)) })) })), r }, ff.prototype.createConnection = function (e) { return this._elementFactory.createConnection($(e, ["id"])) }, ff.prototype.createLabel = function (e) { return this._elementFactory.createLabel($(e, ["id"])) }, ff.prototype.createShape = function (e) { return this._elementFactory.createShape($(e, ["id"])) }, ff.prototype.hasRelations = function (e, t) { var n, i; return !(un(e) && (n = m(t, A({ id: e.source.id })), i = m(t, A({ id: e.target.id })), !n || !i)) && !(hn(e) && !m(t, A({ id: e.labelTarget.id }))) }, ff.prototype.createTree = function (e) { var t = this._rules, n = this, i = {}, r = []; function o(e, t) { var n = m(r, (function (t) { return e === t.element })); n ? n.depth < t && (r = function (e, t) { var n = t.indexOf(e); -1 !== n && t.splice(n, 1); return t }(n, r), r.push({ element: n.element, depth: t })) : r.push({ element: e, depth: t }) } return ft(ut(e), (function (e, t, i) { if (!hn(e)) { g(e.labels, (function (e) { o(e, i) })), g([e.attachers, e.incoming, e.outgoing], (function (e) { e && e.length && g(e, (function (e) { g(e.labels, (function (e) { o(e, i) })), o(e, i) })) })), o(e, i); var r = []; return e.children && (r = e.children.slice()), n._eventBus.fire("copyPaste.createTree", { element: e, children: r }), r } })), e = E(r, (function (e) { return e.element })), r = E(r, (function (t) { return t.descriptor = {}, n._eventBus.fire("copyPaste.copyElement", { descriptor: t.descriptor, element: t.element, elements: e }), t })), r = T(r, (function (e) { return e.descriptor.priority })), e = E(r, (function (e) { return e.element })), g(r, (function (r) { var o = r.depth; n.hasRelations(r.element, e) ? !function (e, n) { return t.allowed("element.copy", { element: e, elements: n }) }(r.element, e) ? vf(r.element, e) : (i[o] || (i[o] = []), i[o].push(r.descriptor)) : vf(r.element, e) })), i }; var yf = { __depends__: [ef, uf, df, Lp], __init__: ["copyPaste"], copyPaste: ["type", ff] }; function gf(e, t, n) { p(n) || (n = [n]), g(n, (function (n) { a(e[n]) || (t[n] = e[n]) })) } function _f(e, t, n) { function i(t, i) { var r = e.create(t.$type); return n.copyElement(t, r, null, i) } t.on("copyPaste.copyElement", 750, (function (e) { var t = e.descriptor, n = e.element, r = Cr(n); if (hn(n)) return t; var o = t.businessObject = i(r, !0), a = t.di = i(kr(n), !0); a.bpmnElement = o, gf(o, t, "name"), gf(a, t, "isExpanded"), r.default && (t.default = r.default.id) })); var r = "-bpmn-js-refs"; t.on("copyPaste.pasteElement", (function (e) { var t = e.cache, n = e.descriptor, r = n.businessObject, o = n.di; if (hn(n)) return n.businessObject = Cr(t[n.labelTarget]), void (n.di = kr(t[n.labelTarget])); r = n.businessObject = i(r), (o = n.di = i(o)).bpmnElement = r, gf(n, r, ["isExpanded", "name"]), n.type = r.$type })), t.on("copyPaste.copyElement", 750, (function (e) { var t = e.descriptor, n = e.element; if (Er(n, "bpmn:Participant")) { var r = Cr(n); r.processRef && (t.processRef = i(r.processRef, !0)) } })), t.on("copyPaste.pasteElement", (function (e) { var t = e.descriptor, n = t.processRef; n && (t.processRef = i(n)) })), t.on("copyPaste.pasteElement", 750, (function (e) { var t = e.cache; !function (e, t) { e[r] = t }(t, function (e, t, n) { var i = Cr(e); return e.default && (n[e.default] = { element: i, property: "default" }), e.host && (Cr(e).attachedToRef = Cr(t[e.host])), $(n, b(n, (function (t, n, r) { var o = n.element, a = n.property; return r === e.id && (o.set(a, i), t.push(e.id)), t }), [])) }(e.descriptor, t, function (e) { return e[r] = e[r] || {} }(t))) })) } _f.$inject = ["bpmnFactory", "eventBus", "moddleCopy"]; var bf = ["artifacts", "dataInputAssociations", "dataOutputAssociations", "default", "flowElements", "lanes", "incoming", "outgoing", "categoryValue"]; function xf(e, t, n) { this._bpmnFactory = t, this._eventBus = e, this._moddle = n, e.on("moddleCopy.canCopyProperties", (function (e) { var t = e.propertyNames; if (t && t.length) return T(t, (function (e) { return "extensionElements" === e })) })), e.on("moddleCopy.canCopyProperty", (function (e) { var t = e.parent, n = l(t) && t.$descriptor, i = e.propertyName; return (!i || -1 === bf.indexOf(i)) && (!(i && n && !m(n.properties, A({ name: i }))) && void 0) })), e.on("moddleCopy.canSetCopiedProperty", (function (e) { var t, n, i = e.property; if (n = "bpmn:ExtensionElements", (t = i) && h(t.$instanceOf) && t.$instanceOf(n) && (!i.values || !i.values.length)) return !1 })) } function wf(e, t) { return b(e.properties, (function (e, n) { return t && n.default ? e : e.concat(n.name) }), []) } xf.$inject = ["eventBus", "bpmnFactory", "moddle"], xf.prototype.copyElement = function (e, t, n, i = !1) { var r = this; n && !p(n) && (n = [n]), n = n || wf(e.$descriptor); var o = this._eventBus.fire("moddleCopy.canCopyProperties", { propertyNames: n, sourceElement: e, targetElement: t, clone: i }); return !1 === o || (p(o) && (n = o), g(n, (function (n) { var o; f(e, n) && (o = e.get(n)); var a = r.copyProperty(o, t, n, i); s(a) && (!1 !== r._eventBus.fire("moddleCopy.canSetCopiedProperty", { parent: t, property: a, propertyName: n }) && t.set(n, a)) }))), t }, xf.prototype.copyProperty = function (e, t, n, i = !1) { var r = this, o = this._eventBus.fire("moddleCopy.canCopyProperty", { parent: t, property: e, propertyName: n, clone: i }); if (!1 !== o) { if (o) return l(o) && o.$type && !o.$parent && (o.$parent = t), o; var a = this._moddle.getPropertyDescriptor(t, n); if (!a.isReference) { if (a.isId) return e && this._copyId(e, t, i); if (p(e)) return b(e, (function (e, a) { return (o = r.copyProperty(a, t, n, i)) ? e.concat(o) : e }), []); if (l(e) && e.$type) { if (this._moddle.getElementDescriptor(e).isGeneric) return; return (o = r._bpmnFactory.create(e.$type)).$parent = t, o = r.copyElement(e, o, null, i) } return e } } }, xf.prototype._copyId = function (e, t, n = !1) { return n ? e : this._moddle.ids.assigned(e) ? void 0 : (this._moddle.ids.claim(e, t), e) }; var Ef = { __depends__: [yf], __init__: ["bpmnCopyPaste", "moddleCopy"], bpmnCopyPaste: ["type", _f], moddleCopy: ["type", xf] }, Sf = Math.round; function Cf(e, t) { this._modeling = e, this._eventBus = t } function kf(e, t) { t.on("replace.end", 500, (function (t) { const { newElement: n, hints: i = {} } = t; !1 !== i.select && e.select(n) })) } Cf.$inject = ["modeling", "eventBus"], Cf.prototype.replaceElement = function (e, t, n) { if (e.waypoints) return null; var i = this._modeling, r = this._eventBus; r.fire("replace.start", { element: e, attrs: t, hints: n }); var o = t.width || e.width, a = t.height || e.height, s = t.x || e.x, c = t.y || e.y, p = Sf(s + o / 2), l = Sf(c + a / 2), u = i.replaceShape(e, L({}, t, { x: p, y: l, width: o, height: a }), n); return r.fire("replace.end", { element: e, newElement: u, hints: n }), u }, kf.$inject = ["selection", "eventBus"]; var Rf = { __init__: ["replace", "replaceSelectionBehavior"], replaceSelectionBehavior: ["type", kf], replace: ["type", Cf] }; var Pf = ["cancelActivity", "instantiate", "eventGatewayType", "triggeredByEvent", "isInterrupting"]; function Tf(e, t, n, i, r, o) { this.replaceElement = function (s, c, l) { l = l || {}; var u = c.type, h = s.businessObject; if (Af(h) && "bpmn:SubProcess" === u && function (e, t) { var n = e && f(e, "collapsed") ? e.collapsed : !Vr(e); return n !== (t && (f(t, "collapsed") || f(t, "isExpanded")) ? f(t, "collapsed") ? t.collapsed : !t.isExpanded : n) }(s, c)) return i.toggleCollapse(s), s; var d = e.create(u), m = { type: u, businessObject: d, di: {} }; !function (e, t, n) { p(n) || (n = [n]), g(n, (function (n) { a(e[n]) || (t[n] = e[n]) })) }(s.di, m.di, ["fill", "stroke", "background-color", "border-color", "color"]); var v = function (e, t) { return e.filter((function (e) { return t.includes(e) })) }(wf(h.$descriptor), wf(d.$descriptor, !0)); L(d, I(c, Pf)); var _ = y(v, (function (e) { return "eventDefinitions" === e ? Mf(s, c.eventDefinitionType) : "loopCharacteristics" === e ? !Gr(d) : !f(d, e) && (("processRef" !== e || !1 !== c.isExpanded) && ("triggeredByEvent" !== e && ("isForCompensation" !== e || !Gr(d)))) })); if (d = n.copyElement(h, d, _), c.eventDefinitionType && (Mf(d, c.eventDefinitionType) || (m.eventDefinitionType = c.eventDefinitionType, m.eventDefinitionAttrs = c.eventDefinitionAttrs)), Er(h, "bpmn:Activity")) { if (Af(h)) m.isExpanded = Vr(s); else if (c && f(c, "isExpanded")) { m.isExpanded = c.isExpanded; var b = t.getDefaultSize(d, { isExpanded: m.isExpanded }); m.width = b.width, m.height = b.height, m.x = s.x - (m.width - s.width) / 2, m.y = s.y - (m.height - s.height) / 2 } Vr(s) && !Er(h, "bpmn:Task") && m.isExpanded && (m.width = s.width, m.height = s.height) } return Af(h) && !Af(d) && (l.moveChildren = !1), Er(h, "bpmn:Participant") && (!0 === c.isExpanded ? d.processRef = e.create("bpmn:Process") : l.moveChildren = !1, m.width = s.width, m.height = t.getDefaultSize(m).height), o.allowed("shape.resize", { shape: d }) || (m.height = t.getDefaultSize(m).height, m.width = t.getDefaultSize(m).width), d.name = h.name, Sr(h, ["bpmn:ExclusiveGateway", "bpmn:InclusiveGateway", "bpmn:Activity"]) && Sr(d, ["bpmn:ExclusiveGateway", "bpmn:InclusiveGateway", "bpmn:Activity"]) && (d.default = h.default), c.host && !Er(h, "bpmn:BoundaryEvent") && Er(d, "bpmn:BoundaryEvent") && (m.host = c.host), "bpmn:DataStoreReference" !== m.type && "bpmn:DataObjectReference" !== m.type || (m.x = s.x + (s.width - m.width) / 2), r.replaceElement(s, m, { ...l, targetElement: c }) } } function Af(e) { return Er(e, "bpmn:SubProcess") } function Mf(e, t) { var n = Cr(e); return t && n.get("eventDefinitions").some((function (e) { return Er(e, t) })) } Tf.$inject = ["bpmnFactory", "elementFactory", "moddleCopy", "modeling", "replace", "rules"]; var Df = { __depends__: [Ef, Rf, ea], bpmnReplace: ["type", Tf] }; function Bf(e, t) { this._eventBus = e, this._dragging = t, this._tools = [], this._active = null } Bf.$inject = ["eventBus", "dragging"], Bf.prototype.registerTool = function (e, t) { var n = this._tools; if (!t) throw new Error('A tool has to be registered with it\'s "events"'); n.push(e), this.bindEvents(e, t) }, Bf.prototype.isActive = function (e) { return e && this._active === e }, Bf.prototype.length = function (e) { return this._tools.length }, Bf.prototype.setActive = function (e) { var t = this._eventBus; this._active !== e && (this._active = e, t.fire("tool-manager.update", { tool: e })) }, Bf.prototype.bindEvents = function (e, t) { var n = this._eventBus, i = this._dragging, r = []; n.on(t.tool + ".init", (function (t) { if (!t.context.reactivate && this.isActive(e)) return this.setActive(null), void i.cancel(); this.setActive(e) }), this), g(t, (function (e) { r.push(e + ".ended"), r.push(e + ".canceled") })), n.on(r, 250, (function (e) { this._active && (function (e) { var t = e.originalEvent && e.originalEvent.target; return t && ee(t, '.group[data-group="tools"]') }(e) || this.setActive(null)) }), this) }; var Nf = { __depends__: [Dp], __init__: ["toolManager"], toolManager: ["type", Bf] }; function Of(e, t) { return -1 !== e.indexOf(t) } var jf = Math.abs, Lf = Math.round, If = { x: "width", y: "height" }, $f = "crosshair", Ff = { n: "top", w: "left", s: "bottom", e: "right" }, zf = 1500, Hf = { n: "s", w: "e", s: "n", e: "w" }, Vf = 20; function Wf(e, t, n, i, r, o, a) { this._canvas = e, this._dragging = t, this._eventBus = n, this._modeling = i, this._rules = r, this._toolManager = o, this._mouse = a; var s = this; o.registerTool("space", { tool: "spaceTool.selection", dragging: "spaceTool" }), n.on("spaceTool.selection.end", (function (e) { n.once("spaceTool.selection.ended", (function () { s.activateMakeSpace(e.originalEvent) })) })), n.on("spaceTool.move", zf, (function (e) { var t = e.context, n = t.initialized; n || (n = t.initialized = s.init(e, t)), n && Uf(e) })), n.on("spaceTool.end", (function (e) { var t = e.context, i = t.axis, r = t.direction, o = t.movingShapes, a = t.resizingShapes, c = t.start; if (t.initialized) { Uf(e); var p = { x: 0, y: 0 }; p[i] = Lf(e["d" + i]), s.makeSpace(o, a, p, r, c), n.once("spaceTool.ended", (function (e) { s.activateSelection(e.originalEvent, !0, !0) })) } })) } function Gf(e) { return { top: e.top - Vf, right: e.right + Vf, bottom: e.bottom + Vf, left: e.left - Vf } } function Uf(e) { var t, n, i = e.context.spaceToolConstraints; i && (u(i.left) && (t = Math.max(e.x, i.left), e.dx = e.dx + t - e.x, e.x = t), u(i.right) && (t = Math.min(e.x, i.right), e.dx = e.dx + t - e.x, e.x = t), u(i.top) && (n = Math.max(e.y, i.top), e.dy = e.dy + n - e.y, e.y = n), u(i.bottom) && (n = Math.min(e.y, i.bottom), e.dy = e.dy + n - e.y, e.y = n)) } function qf(e, t) { return -1 !== e.indexOf(t) } Wf.$inject = ["canvas", "dragging", "eventBus", "modeling", "rules", "toolManager", "mouse"], Wf.prototype.activateSelection = function (e, t, n) { this._dragging.init(e, "spaceTool.selection", { autoActivate: t, cursor: $f, data: { context: { reactivate: n } }, trapClick: !1 }) }, Wf.prototype.activateMakeSpace = function (e) { this._dragging.init(e, "spaceTool", { autoActivate: !0, cursor: $f, data: { context: {} } }) }, Wf.prototype.makeSpace = function (e, t, n, i, r) { return this._modeling.createSpace(e, t, n, i, r) }, Wf.prototype.init = function (e, t) { var n = jf(e.dx) > jf(e.dy) ? "x" : "y", i = e["d" + n], r = e[n] - i; if (jf(i) < 5) return !1; i < 0 && (i *= -1), Fo(e) && (i *= -1); var o = function (e, t) { if ("x" === e) { if (t > 0) return "e"; if (t < 0) return "w" } if ("y" === e) { if (t > 0) return "s"; if (t < 0) return "n" } return null }(n, i), a = this._canvas.getRootElement(); !zo(e) && e.hover && (a = e.hover); var s = [...mt(a, !0), ...a.attachers || []], c = this.calculateAdjustments(s, n, i, r), p = function (e, t, n, i, r) { var o = e.movingShapes, a = e.resizingShapes; if (!a.length) return; var s, c, p = {}; return g(a, (function (e) { var l, h, d, f, m, v, g = e.attachers, _ = e.children, b = mn(e), x = y(_, (function (e) { return !(un(e) || hn(e) || qf(o, e) || qf(a, e)) })), w = y(_, (function (e) { return !un(e) && !hn(e) && qf(o, e) })), E = [], S = []; x.length && (h = Gf(mn(vt(x))), l = i - b[Ff[n]] + h[Ff[n]], "n" === n ? p.bottom = c = u(c) ? Math.min(c, l) : l : "w" === n ? p.right = c = u(c) ? Math.min(c, l) : l : "s" === n ? p.top = s = u(s) ? Math.max(s, l) : l : "e" === n && (p.left = s = u(s) ? Math.max(s, l) : l)), w.length && (d = Gf(mn(vt(w))), l = i - d[Ff[Hf[n]]] + b[Ff[Hf[n]]], "n" === n ? p.bottom = c = u(c) ? Math.min(c, l) : l : "w" === n ? p.right = c = u(c) ? Math.min(c, l) : l : "s" === n ? p.top = s = u(s) ? Math.max(s, l) : l : "e" === n && (p.left = s = u(s) ? Math.max(s, l) : l)), g && g.length && (g.forEach((function (e) { qf(o, e) ? E.push(e) : S.push(e) })), E.length && (f = mn(vt(E.map(gn))), m = b[Ff[Hf[n]]] - (f[Ff[Hf[n]]] - i)), S.length && (v = mn(vt(S.map(gn)))[Ff[n]] - (b[Ff[n]] - i)), "n" === n ? (l = Math.min(m || 1 / 0, v || 1 / 0), p.bottom = c = u(c) ? Math.min(c, l) : l) : "w" === n ? (l = Math.min(m || 1 / 0, v || 1 / 0), p.right = c = u(c) ? Math.min(c, l) : l) : "s" === n ? (l = Math.max(m || -1 / 0, v || -1 / 0), p.top = s = u(s) ? Math.max(s, l) : l) : "e" === n && (l = Math.max(m || -1 / 0, v || -1 / 0), p.left = s = u(s) ? Math.max(s, l) : l)); var C = r && r[e.id]; C && ("n" === n ? (l = i + e[If[t]] - C[If[t]], p.bottom = c = u(c) ? Math.min(c, l) : l) : "w" === n ? (l = i + e[If[t]] - C[If[t]], p.right = c = u(c) ? Math.min(c, l) : l) : "s" === n ? (l = i - e[If[t]] + C[If[t]], p.top = s = u(s) ? Math.max(s, l) : l) : "e" === n && (l = i - e[If[t]] + C[If[t]], p.left = s = u(s) ? Math.max(s, l) : l)) })), p }(c, n, o, r, this._eventBus.fire("spaceTool.getMinDimensions", { axis: n, direction: o, shapes: c.resizingShapes, start: r })); return L(t, c, { axis: n, direction: o, spaceToolConstraints: p, start: r }), Za("resize-" + ("x" === n ? "ew" : "ns")), !0 }, Wf.prototype.calculateAdjustments = function (e, t, n, i) { var r = this._rules, o = [], a = [], s = [], c = []; function p(e) { o.includes(e) || o.push(e); var t = e.label; t && !o.includes(t) && o.push(t) } g(e, (function (e) { if (e.parent && !hn(e)) if (un(e)) c.push(e); else { var o = e[t], l = o + e[If[t]]; if (function (e) { return !!e.host }(e) && (n > 0 && gn(e)[t] > i || n < 0 && gn(e)[t] < i)) s.push(e); else { var u; if (!(n > 0 && o > i || n < 0 && l < i)) return o < i && l > i && r.allowed("shape.resize", { shape: e }) ? (u = e, void (a.includes(u) || a.push(u))) : void 0; p(e) } } })), g(o, (function (e) { var t = e.attachers; t && g(t, (function (e) { p(e) })) })); var l = o.concat(a); return g(s, (function (e) { var t = e.host; qf(l, t) && p(e) })), l = o.concat(a), g(c, (function (e) { var t = e.source, n = e.target, i = e.label; qf(l, t) && qf(l, n) && i && p(i) })), { movingShapes: o, resizingShapes: a } }, Wf.prototype.toggle = function () { if (this.isActive()) return this._dragging.cancel(); var e = this._mouse.getLastMoveEvent(); this.activateSelection(e, !!e) }, Wf.prototype.isActive = function () { var e = this._dragging.context(); return !!e && /^spaceTool/.test(e.prefix) }; var Kf = "djs-dragging", Yf = "djs-resizing", Xf = Math.max; function Zf(e, t, n, i, r) { function o(e, t) { g(e, (function (e) { r.addDragger(e, t), n.addMarker(e, Kf) })) } e.on("spaceTool.selection.start", (function (e) { var t = n.getLayer("space"), r = e.context, o = "M 0,-10000 L 0,10000", a = "M -10000,0 L 10000,0", s = De("g"); we(s, i.cls("djs-crosshair-group", ["no-events"])), ge(t, s); var c = De("path"); we(c, "d", o), Se(c).add("djs-crosshair"), ge(s, c); var p = De("path"); we(p, "d", a), Se(p).add("djs-crosshair"), ge(s, p), r.crosshairGroup = s })), e.on("spaceTool.selection.move", (function (e) { Yn(e.context.crosshairGroup, e.x, e.y) })), e.on("spaceTool.selection.cleanup", (function (e) { var t = e.context.crosshairGroup; t && ke(t) })), e.on("spaceTool.move", 250, (function (e) { var a = e.context, s = a.line, c = a.axis, p = a.movingShapes, l = a.resizingShapes; if (a.initialized) { if (!a.dragGroup) { var u = n.getLayer("space"); we(s = De("path"), "d", "M0,0 L0,0"), Se(s).add("djs-crosshair"), ge(u, s), a.line = s; var h = De("g"); we(h, i.cls("djs-drag-group", ["no-events"])), ge(n.getActiveLayer(), h), o(p, h), o(a.movingConnections = t.filter((function (e) { var t = !1; g(p, (function (n) { g(n.outgoing, (function (n) { e === n && (t = !0) })) })); var n = !1; g(p, (function (t) { g(t.incoming, (function (t) { e === t && (n = !0) })) })); var i = !1; g(l, (function (t) { g(t.outgoing, (function (t) { e === t && (i = !0) })) })); var r = !1; return g(l, (function (t) { g(t.incoming, (function (t) { e === t && (r = !0) })) })), un(e) && (t || i) && (n || r) })), h), a.dragGroup = h } if (!a.frameGroup) { var d = De("g"); we(d, i.cls("djs-frame-group", ["no-events"])), ge(n.getActiveLayer(), d); var f = []; g(l, (function (e) { var t = r.addFrame(e, d), i = t.getBBox(); f.push({ element: t, initialBounds: i }), n.addMarker(e, Yf) })), a.frameGroup = d, a.frames = f } we(s, { d: { x: "M" + e.x + ", -10000 L" + e.x + ", 10000", y: "M -10000, " + e.y + " L 10000, " + e.y }[c] }); var m = { x: e.dx, y: e.dy }; m[{ x: "y", y: "x" }[a.axis]] = 0, Yn(a.dragGroup, m.x, m.y), g(a.frames, (function (e) { var t, n, i = e.element, r = e.initialBounds; "e" === a.direction ? we(i, { width: Xf(r.width + m.x, 5) }) : we(i, { width: t = Xf(r.width - m.x, 5), x: r.x + r.width - t }), "s" === a.direction ? we(i, { height: Xf(r.height + m.y, 5) }) : we(i, { height: n = Xf(r.height - m.y, 5), y: r.y + r.height - n }) })) } })), e.on("spaceTool.cleanup", (function (e) { var t = e.context, i = t.movingShapes, r = t.movingConnections, o = t.resizingShapes, a = t.line, s = t.dragGroup, c = t.frameGroup; g(i, (function (e) { n.removeMarker(e, Kf) })), g(r, (function (e) { n.removeMarker(e, Kf) })), s && (ke(a), ke(s)), g(o, (function (e) { n.removeMarker(e, Yf) })), c && ke(c) })) } Zf.$inject = ["eventBus", "elementRegistry", "canvas", "styles", "previewSupport"]; var Qf = { __init__: ["spaceToolPreview"], __depends__: [Dp, Lp, Nf, Gl, df], spaceTool: ["type", Wf], spaceToolPreview: ["type", Zf] }; function Jf(e) { e.invoke(Wf, this) } Jf.$inject = ["injector"], e(Jf, Wf), Jf.prototype.calculateAdjustments = function (e, t, n, i) { var r = Wf.prototype.calculateAdjustments.call(this, e, t, n, i); return r.resizingShapes = r.resizingShapes.filter((function (e) { return !Er(e, "bpmn:TextAnnotation") && ("y" !== t || !function (e) { return Er(e, "bpmn:Participant") && !Cr(e).processRef }(e)) })), r }; var em = { __depends__: [Qf], spaceTool: ["type", Jf] }; function tm(e, t) { this._handlerMap = {}, this._stack = [], this._stackIdx = -1, this._currentExecution = { actions: [], dirty: [], trigger: null }, this._injector = t, this._eventBus = e, this._uid = 1, e.on(["diagram.destroy", "diagram.clear"], (function () { this.clear(!1) }), this) } tm.$inject = ["eventBus", "injector"], tm.prototype.execute = function (e, t) { if (!e) throw new Error("command required"); this._currentExecution.trigger = "execute"; const n = { command: e, context: t }; this._pushAction(n), this._internalExecute(n), this._popAction() }, tm.prototype.canExecute = function (e, t) { const n = { command: e, context: t }, i = this._getHandler(e); let r = this._fire(e, "canExecute", n); if (void 0 === r) { if (!i) return !1; i.canExecute && (r = i.canExecute(t)) } return r }, tm.prototype.clear = function (e) { this._stack.length = 0, this._stackIdx = -1, !1 !== e && this._fire("changed", { trigger: "clear" }) }, tm.prototype.undo = function () { let e, t = this._getUndoAction(); if (t) { for (this._currentExecution.trigger = "undo", this._pushAction(t); t && (this._internalUndo(t), e = this._getUndoAction(), e && e.id === t.id);)t = e; this._popAction() } }, tm.prototype.redo = function () { let e, t = this._getRedoAction(); if (t) { for (this._currentExecution.trigger = "redo", this._pushAction(t); t && (this._internalExecute(t, !0), e = this._getRedoAction(), e && e.id === t.id);)t = e; this._popAction() } }, tm.prototype.register = function (e, t) { this._setHandler(e, t) }, tm.prototype.registerHandler = function (e, t) { if (!e || !t) throw new Error("command and handlerCls must be defined"); const n = this._injector.instantiate(t); this.register(e, n) }, tm.prototype.canUndo = function () { return !!this._getUndoAction() }, tm.prototype.canRedo = function () { return !!this._getRedoAction() }, tm.prototype._getRedoAction = function () { return this._stack[this._stackIdx + 1] }, tm.prototype._getUndoAction = function () { return this._stack[this._stackIdx] }, tm.prototype._internalUndo = function (e) { const t = e.command, n = e.context, i = this._getHandler(t); this._atomicDo((() => { this._fire(t, "revert", e), i.revert && this._markDirty(i.revert(n)), this._revertedAction(e), this._fire(t, "reverted", e) })) }, tm.prototype._fire = function (e, t, n) { arguments.length < 3 && (n = t, t = null); const i = t ? [e + "." + t, t] : [e]; let r; n = this._eventBus.createEvent(n); for (const e of i) if (r = this._eventBus.fire("commandStack." + e, n), n.cancelBubble) break; return r }, tm.prototype._createId = function () { return this._uid++ }, tm.prototype._atomicDo = function (e) { const t = this._currentExecution; t.atomic = !0; try { e() } finally { t.atomic = !1 } }, tm.prototype._internalExecute = function (e, t) { const n = e.command, i = e.context, r = this._getHandler(n); if (!r) throw new Error("no command handler registered for <" + n + ">"); this._pushAction(e), t || (this._fire(n, "preExecute", e), r.preExecute && r.preExecute(i), this._fire(n, "preExecuted", e)), this._atomicDo((() => { this._fire(n, "execute", e), r.execute && this._markDirty(r.execute(i)), this._executedAction(e, t), this._fire(n, "executed", e) })), t || (this._fire(n, "postExecute", e), r.postExecute && r.postExecute(i), this._fire(n, "postExecuted", e)), this._popAction() }, tm.prototype._pushAction = function (e) { const t = this._currentExecution, n = t.actions, i = n[0]; if (t.atomic) throw new Error("illegal invocation in <execute> or <revert> phase (action: " + e.command + ")"); e.id || (e.id = i && i.id || this._createId()), n.push(e) }, tm.prototype._popAction = function () { const e = this._currentExecution, t = e.trigger, n = e.actions, i = e.dirty; n.pop(), n.length || (this._eventBus.fire("elements.changed", { elements: R("id", i.reverse()) }), i.length = 0, this._fire("changed", { trigger: t }), e.trigger = null) }, tm.prototype._markDirty = function (e) { const t = this._currentExecution; e && (e = p(e) ? e : [e], t.dirty = t.dirty.concat(e)) }, tm.prototype._executedAction = function (e, t) { const n = ++this._stackIdx; t || this._stack.splice(n, this._stack.length, e) }, tm.prototype._revertedAction = function (e) { this._stackIdx-- }, tm.prototype._getHandler = function (e) { return this._handlerMap[e] }, tm.prototype._setHandler = function (e, t) { if (!e || !t) throw new Error("command and handler required"); if (this._handlerMap[e]) throw new Error("overriding handler for command <" + e + ">"); this._handlerMap[e] = t }; var nm = { commandStack: ["type", tm] }; function im(e, t) { if ("function" != typeof t) throw new Error("removeFn iterator must be a function"); if (e) { for (var n; n = e[0];)t(n); return e } } function rm(e, t, n) { la.call(this, t); var i = e.get("movePreview", !1); t.on("shape.move.start", 1400, (function (e) { var t = e.context, n = t.shapes, i = t.validatedShapes; t.shapes = om(n), t.validatedShapes = om(i) })), i && t.on("shape.move.start", 250, (function (e) { var t = e.context, n = t.shapes, r = []; g(n, (function (e) { g(e.labels, (function (n) { n.hidden || -1 !== t.shapes.indexOf(n) || r.push(n), e.labelTarget && r.push(e) })) })), g(r, (function (e) { i.makeDraggable(t, e, !0) })) })), this.preExecuted("elements.move", 1400, (function (e) { var t = e.context.closure, n = t.enclosedElements, i = []; g(n, (function (e) { g(e.labels, (function (e) { n[e.id] || i.push(e) })) })), t.addAll(i) })), this.preExecute(["connection.delete", "shape.delete"], (function (e) { var t = e.context; im((t.connection || t.shape).labels, (function (e) { n.removeShape(e, { nested: !0 }) })) })), this.execute("shape.delete", (function (e) { var t = e.context, n = t.shape, i = n.labelTarget; i && (t.labelTargetIndex = St(i.labels, n), t.labelTarget = i, n.labelTarget = null) })), this.revert("shape.delete", (function (e) { var t = e.context, n = t.shape, i = t.labelTarget, r = t.labelTargetIndex; i && (Et(i.labels, n, r), n.labelTarget = i) })) } function om(e) { return y(e, (function (t) { return -1 === e.indexOf(t.labelTarget) })) } e(rm, la), rm.$inject = ["injector", "eventBus", "modeling"]; var am = { __init__: ["labelSupport"], labelSupport: ["type", rm] }, sm = "attach-ok"; function cm(e, t, n, i, r) { la.call(this, t); var o = e.get("movePreview", !1); t.on("shape.move.start", 1401, (function (e) { var t, n, i = e.context, r = i.shapes, o = i.validatedShapes; i.shapes = (n = pm(t = r), P("id", t, n)), i.validatedShapes = function (e) { var t = k(e, "id"); return y(e, (function (e) { for (; e;) { if (e.host && t[e.host.id]) return !1; e = e.parent } return !0 })) }(o) })), o && t.on("shape.move.start", 251, (function (e) { var t = e.context; g(pm(t.shapes), (function (e) { o.makeDraggable(t, e, !0), g(e.labels, (function (e) { o.makeDraggable(t, e, !0) })) })) })), o && t.on("shape.move.start", (function (e) { var i = e.context.shapes; if (1 === i.length) { var r = i[0].host; r && (n.addMarker(r, sm), t.once(["shape.move.out", "shape.move.cleanup"], (function () { n.removeMarker(r, sm) }))) } })), this.preExecuted("elements.move", 1401, (function (e) { var t = e.context, n = t.closure; g(pm(t.shapes), (function (e) { n.add(e, n.topLevel[e.host.id]) })) })), this.postExecuted("elements.move", (function (e) { var t = e.context, n = t.shapes, i = t.newHost; i && 1 !== n.length || g(i ? n : y(n, (function (e) { var t, i = e.host; return function (e) { return !!e.host }(e) && (t = i, !(-1 !== n.indexOf(t))) })), (function (e) { r.updateAttachment(e, i) })) })), this.postExecuted("elements.move", (function (e) { g(e.context.shapes, (function (e) { g(e.attachers, (function (e) { g(e.outgoing.slice(), (function (e) { i.allowed("connection.reconnect", { connection: e, source: e.source, target: e.target }) || r.removeConnection(e) })), g(e.incoming.slice(), (function (e) { i.allowed("connection.reconnect", { connection: e, source: e.source, target: e.target }) || r.removeConnection(e) })) })) })) })), this.postExecute("shape.create", (function (e) { var t = e.context, n = t.shape, i = t.host; i && r.updateAttachment(n, i) })), this.postExecute("shape.replace", (function (e) { var t = e.context, n = t.oldShape, o = t.newShape; im(n.attachers, (function (e) { "attach" === i.allowed("elements.move", { target: o, shapes: [e] }) ? r.updateAttachment(e, o) : r.removeShape(e) })), o.attachers.length && g(o.attachers, (function (e) { var t = lh(e, n, o); r.moveShape(e, t, e.parent) })) })), this.postExecute("shape.resize", (function (e) { var t = e.context, n = t.shape, i = t.oldBounds, o = t.newBounds, a = n.attachers; !1 !== (t.hints || {}).attachSupport && g(a, (function (e) { var t = lh(e, i, o); r.moveShape(e, t, e.parent), g(e.labels, (function (e) { r.moveShape(e, t, e.parent) })) })) })), this.preExecute("shape.delete", (function (e) { var t = e.context.shape; im(t.attachers, (function (e) { r.removeShape(e) })), t.host && r.updateAttachment(t, null) })) } function pm(e) { return i(E(e, (function (e) { return e.attachers || [] }))) } e(cm, la), cm.$inject = ["injector", "eventBus", "canvas", "rules", "modeling"]; var lm = { __depends__: [Lp], __init__: ["attachSupport"], attachSupport: ["type", cm] }; function um(e) { this._model = e } function hm(e, t, n, i) { la.call(this, e), this._bpmnFactory = t, this._translate = i; var r = this; function o(e) { g(e.context.oldRoot.children, (function (e) { Er(e, "bpmn:BaseElement") && r.updateParent(e) })) } function a(e) { var t = e.context.shape; Er(t, "bpmn:BaseElement") && r.updateBounds(t) } function s(e) { r.updateConnection(e.context) } function c(e) { r.updateConnectionWaypoints(e.context.connection) } function p(e) { r.updateAttachment(e.context) } function l(e) { const { element: n } = e.context, i = eo(n), r = kr(n), o = r && r.get("label"); Yr(n) || (i && !o ? r.set("label", t.create("bpmndi:BPMNLabel")) : !i && o && r.set("label", void 0)) } this.executed(["connection.layout", "connection.create"], (function (e) { var t, i = e.context, r = i.hints || {}; i.cropped || !1 === r.createElementsBehavior || ((t = i.connection).waypoints = n.getCroppedWaypoints(t), i.cropped = !0) })), this.reverted(["connection.layout"], (function (e) { delete e.context.cropped })), this.executed(["shape.move", "shape.create", "shape.delete", "connection.create", "connection.move", "connection.delete"], dm((function (e) { var t = e.context; r.updateParent(t.shape || t.connection, t.oldParent) }))), this.reverted(["shape.move", "shape.create", "shape.delete", "connection.create", "connection.move", "connection.delete"], dm((function (e) { var t = e.context, n = t.shape || t.connection, i = t.parent || t.newParent; r.updateParent(n, i) }))), this.executed(["canvas.updateRoot"], o), this.reverted(["canvas.updateRoot"], o), this.executed(["shape.move", "shape.create", "shape.resize"], dm((function (e) { "label" !== e.context.shape.type && a(e) }))), this.reverted(["shape.move", "shape.create", "shape.resize"], dm((function (e) { "label" !== e.context.shape.type && a(e) }))), e.on("shape.changed", (function (e) { "label" === e.element.type && a({ context: { shape: e.element } }) })), this.executed(["connection.create", "connection.move", "connection.delete", "connection.reconnect"], dm(s)), this.reverted(["connection.create", "connection.move", "connection.delete", "connection.reconnect"], dm(s)), this.executed(["connection.layout", "connection.move", "connection.updateWaypoints"], dm(c)), this.reverted(["connection.layout", "connection.move", "connection.updateWaypoints"], dm(c)), this.executed("connection.reconnect", dm((function (e) { var t = e.context, n = t.connection, i = t.oldSource, r = t.newSource, o = Cr(n), a = Cr(i), s = Cr(r); o.conditionExpression && !Sr(s, ["bpmn:Activity", "bpmn:ExclusiveGateway", "bpmn:InclusiveGateway"]) && (t.oldConditionExpression = o.conditionExpression, delete o.conditionExpression), i !== r && a.default === o && (t.oldDefault = a.default, delete a.default) }))), this.reverted("connection.reconnect", dm((function (e) { var t = e.context, n = t.connection, i = t.oldSource, r = t.newSource, o = Cr(n), a = Cr(i), s = Cr(r); t.oldConditionExpression && (o.conditionExpression = t.oldConditionExpression), t.oldDefault && (a.default = t.oldDefault, delete s.default) }))), this.executed(["element.updateAttachment"], dm(p)), this.reverted(["element.updateAttachment"], dm(p)), this.executed("element.updateLabel", dm(l)), this.reverted("element.updateLabel", dm(l)) } function dm(e) { return function (t) { var n = t.context; Er(n.shape || n.connection || n.element, "bpmn:BaseElement") && e(t) } } function fm(e, t, n) { Hn.call(this), this._bpmnFactory = e, this._moddle = t, this._translate = n } function mm(e, t, n) { return void 0 === t[n] ? t : (e[n] = t[n], $(t, [n])) } function vm(e, t) { this._modeling = e, this._canvas = t } function ym(e) { this._modeling = e } function gm(e, t) { this._canvas = e, this._layouter = t } um.$inject = ["moddle"], um.prototype._needsId = function (e) { return Sr(e, ["bpmn:RootElement", "bpmn:FlowElement", "bpmn:MessageFlow", "bpmn:DataAssociation", "bpmn:Artifact", "bpmn:Participant", "bpmn:Lane", "bpmn:LaneSet", "bpmn:Process", "bpmn:Collaboration", "bpmndi:BPMNShape", "bpmndi:BPMNEdge", "bpmndi:BPMNDiagram", "bpmndi:BPMNPlane", "bpmn:Property", "bpmn:CategoryValue"]) }, um.prototype._ensureId = function (e) { var t; e.id ? this._model.ids.claim(e.id, e) : (t = Er(e, "bpmn:Activity") ? "Activity" : Er(e, "bpmn:Event") ? "Event" : Er(e, "bpmn:Gateway") ? "Gateway" : Sr(e, ["bpmn:SequenceFlow", "bpmn:MessageFlow"]) ? "Flow" : (e.$type || "").replace(/^[^:]*:/g, ""), t += "_", !e.id && this._needsId(e) && (e.id = this._model.ids.nextPrefixed(t, e))) }, um.prototype.create = function (e, t) { var n = this._model.create(e, t || {}); return this._ensureId(n), n }, um.prototype.createDiLabel = function () { return this.create("bpmndi:BPMNLabel", { bounds: this.createDiBounds() }) }, um.prototype.createDiShape = function (e, t) { return this.create("bpmndi:BPMNShape", L({ bpmnElement: e, bounds: this.createDiBounds() }, t)) }, um.prototype.createDiBounds = function (e) { return this.create("dc:Bounds", e) }, um.prototype.createDiWaypoints = function (e) { var t = this; return E(e, (function (e) { return t.createDiWaypoint(e) })) }, um.prototype.createDiWaypoint = function (e) { return this.create("dc:Point", I(e, ["x", "y"])) }, um.prototype.createDiEdge = function (e, t) { return this.create("bpmndi:BPMNEdge", L({ bpmnElement: e, waypoint: this.createDiWaypoints([]) }, t)) }, um.prototype.createDiPlane = function (e, t) { return this.create("bpmndi:BPMNPlane", L({ bpmnElement: e }, t)) }, e(hm, la), hm.$inject = ["eventBus", "bpmnFactory", "connectionDocking", "translate"], hm.prototype.updateAttachment = function (e) { var t = e.shape, n = t.businessObject, i = t.host; n.attachedToRef = i && i.businessObject }, hm.prototype.updateParent = function (e, t) { if (!(hn(e) || Er(e, "bpmn:DataStoreReference") && e.parent && Er(e.parent, "bpmn:Collaboration"))) { var n = e.parent, i = e.businessObject, r = kr(e), o = n && n.businessObject, a = kr(n); Er(e, "bpmn:FlowNode") && this.updateFlowNodeRefs(i, o, t && t.businessObject), Er(e, "bpmn:DataOutputAssociation") && (o = e.source ? e.source.businessObject : null), Er(e, "bpmn:DataInputAssociation") && (o = e.target ? e.target.businessObject : null), this.updateSemanticParent(i, o), Er(e, "bpmn:DataObjectReference") && i.dataObjectRef && this.updateSemanticParent(i.dataObjectRef, o), this.updateDiParent(r, a) } }, hm.prototype.updateBounds = function (e) { var t = kr(e), n = function (e) { if (!Er(e, "bpmn:Activity")) return; var t = kr(e); if (!t) return; var n = t.get("label"); if (!n) return; return n.get("bounds") }(e); if (n) { var i = ns(n, t.get("bounds")); L(n, { x: e.x + i.x, y: e.y + i.y }) } var r = hn(e) ? this._getLabel(t) : t, o = r.bounds; o || (o = this._bpmnFactory.createDiBounds(), r.set("bounds", o)), L(o, { x: e.x, y: e.y, width: e.width, height: e.height }) }, hm.prototype.updateFlowNodeRefs = function (e, t, n) { n !== t && (Er(n, "bpmn:Lane") && wt(n.get("flowNodeRef"), e), Er(t, "bpmn:Lane") && Et(t.get("flowNodeRef"), e)) }, hm.prototype.updateDiConnection = function (e, t, n) { var i = kr(e), r = kr(t), o = kr(n); i.sourceElement && i.sourceElement.bpmnElement !== Cr(t) && (i.sourceElement = t && r), i.targetElement && i.targetElement.bpmnElement !== Cr(n) && (i.targetElement = n && o) }, hm.prototype.updateDiParent = function (e, t) { if (t && !Er(t, "bpmndi:BPMNPlane") && (t = t.$parent), e.$parent !== t) { var n = (t || e.$parent).get("planeElement"); t ? (n.push(e), e.$parent = t) : (wt(n, e), e.$parent = null) } }, hm.prototype.getLaneSet = function (e) { var t, n; return Er(e, "bpmn:Lane") ? ((t = e.childLaneSet) || (t = this._bpmnFactory.create("bpmn:LaneSet"), e.childLaneSet = t, t.$parent = e), t) : (Er(e, "bpmn:Participant") && (e = e.processRef), (t = (n = e.get("laneSets"))[0]) || ((t = this._bpmnFactory.create("bpmn:LaneSet")).$parent = e, n.push(t)), t) }, hm.prototype.updateSemanticParent = function (e, t, n) { var i, r = this._translate; if (e.$parent !== t && (!Er(e, "bpmn:DataInput") && !Er(e, "bpmn:DataOutput") || (Er(t, "bpmn:Participant") && "processRef" in t && (t = t.processRef), !("ioSpecification" in t) || t.ioSpecification !== e.$parent))) { if (Er(e, "bpmn:Lane")) t && (t = this.getLaneSet(t)), i = "lanes"; else if (Er(e, "bpmn:FlowElement")) { if (t) if (Er(t, "bpmn:Participant")) t = t.processRef; else if (Er(t, "bpmn:Lane")) do { t = t.$parent.$parent } while (Er(t, "bpmn:Lane")); i = "flowElements" } else if (Er(e, "bpmn:Artifact")) { for (; t && !Er(t, "bpmn:Process") && !Er(t, "bpmn:SubProcess") && !Er(t, "bpmn:Collaboration");) { if (Er(t, "bpmn:Participant")) { t = t.processRef; break } t = t.$parent } i = "artifacts" } else if (Er(e, "bpmn:MessageFlow")) i = "messageFlows"; else if (Er(e, "bpmn:Participant")) { i = "participants"; var o, a = e.processRef; a && (o = function (e) { for (; e && !Er(e, "bpmn:Definitions");)e = e.$parent; return e }(e.$parent || t), e.$parent && (wt(o.get("rootElements"), a), a.$parent = null), t && (Et(o.get("rootElements"), a), a.$parent = o)) } else Er(e, "bpmn:DataOutputAssociation") ? i = "dataOutputAssociations" : Er(e, "bpmn:DataInputAssociation") && (i = "dataInputAssociations"); if (!i) throw new Error(r("no parent for {element} in {parent}", { element: e.id, parent: t.id })); var s; if (e.$parent && wt(s = e.$parent.get(i), e), t ? ((s = t.get(i)).push(e), e.$parent = t) : e.$parent = null, n) { var c = n.get(i); wt(s, e), t && (c || (c = [], t.set(i, c)), c.push(e)) } } }, hm.prototype.updateConnectionWaypoints = function (e) { kr(e).set("waypoint", this._bpmnFactory.createDiWaypoints(e.waypoints)) }, hm.prototype.updateConnection = function (e) { var t, n = e.connection, i = Cr(n), r = n.source, o = Cr(r), a = n.target, s = Cr(n.target); if (Er(i, "bpmn:DataAssociation")) Er(i, "bpmn:DataInputAssociation") ? (i.get("sourceRef")[0] = o, t = e.parent || e.newParent || s, this.updateSemanticParent(i, s, t)) : Er(i, "bpmn:DataOutputAssociation") && (t = e.parent || e.newParent || o, this.updateSemanticParent(i, o, t), i.targetRef = s); else { var c = Er(i, "bpmn:SequenceFlow"); i.sourceRef !== o && (c && (wt(i.sourceRef && i.sourceRef.get("outgoing"), i), o && o.get("outgoing") && o.get("outgoing").push(i)), i.sourceRef = o), i.targetRef !== s && (c && (wt(i.targetRef && i.targetRef.get("incoming"), i), s && s.get("incoming") && s.get("incoming").push(i)), i.targetRef = s) } this.updateConnectionWaypoints(n), this.updateDiConnection(n, r, a) }, hm.prototype._getLabel = function (e) { return e.label || (e.label = this._bpmnFactory.createDiLabel()), e.label }, e(fm, Hn), fm.$inject = ["bpmnFactory", "moddle", "translate"], fm.prototype._baseCreate = Hn.prototype.create, fm.prototype.create = function (e, t) { if ("label" === e) { var n = t.di || this._bpmnFactory.createDiLabel(); return this._baseCreate(e, L({ type: "label", di: n }, qr, t)) } return this.createElement(e, t) }, fm.prototype.createElement = function (e, t) { var n, i, r, o = this._translate, a = (t = L({}, t || {})).businessObject, c = t.di; if (!a) { if (!t.type) throw new Error(o("no shape type specified")); br(a = this._bpmnFactory.create(t.type)) } if (!Sr(c, ["bpmndi:BPMNShape", "bpmndi:BPMNEdge", "bpmndi:BPMNDiagram", "bpmndi:BPMNPlane"])) { var p = L({}, c || {}, { id: a.id + "_di" }); c = "root" === e ? this._bpmnFactory.createDiPlane(a, p) : "connection" === e ? this._bpmnFactory.createDiEdge(a, p) : this._bpmnFactory.createDiShape(a, p) } return Er(a, "bpmn:Group") && (t = L({ isFrame: !0 }, t)), t = function (e, t, n) { return g(n, (function (n) { t = mm(e, t, n) })), t }(a, t, ["processRef", "isInterrupting", "associationDirection", "isForCompensation"]), t.isExpanded && (t = mm(c, t, "isExpanded")), Er(a, "bpmn:SubProcess") && (t.collapsed = !Vr(a, c)), Er(a, "bpmn:ExclusiveGateway") && (c.isMarkerVisible = !0), s(t.triggeredByEvent) && (a.triggeredByEvent = t.triggeredByEvent, delete t.triggeredByEvent), s(t.cancelActivity) && (a.cancelActivity = t.cancelActivity, delete t.cancelActivity), t.eventDefinitionType && (i = a.get("eventDefinitions") || [], r = this._bpmnFactory.create(t.eventDefinitionType, t.eventDefinitionAttrs), "bpmn:ConditionalEventDefinition" === t.eventDefinitionType && (r.condition = this._bpmnFactory.create("bpmn:FormalExpression")), i.push(r), r.$parent = a, a.eventDefinitions = i, delete t.eventDefinitionType), n = this.getDefaultSize(a, c), t = L({ id: a.id }, n, t, { businessObject: a, di: c }), this._baseCreate(e, t) }, fm.prototype.getDefaultSize = function (e, t) { var n = Cr(e); return t = t || kr(e), Er(n, "bpmn:SubProcess") ? Vr(n, t) ? { width: 350, height: 200 } : { width: 100, height: 80 } : Er(n, "bpmn:Task") ? { width: 100, height: 80 } : Er(n, "bpmn:Gateway") ? { width: 50, height: 50 } : Er(n, "bpmn:Event") ? { width: 36, height: 36 } : Er(n, "bpmn:Participant") ? Vr(n, t) ? { width: 600, height: 250 } : { width: 400, height: 60 } : Er(n, "bpmn:Lane") ? { width: 400, height: 100 } : Er(n, "bpmn:DataObjectReference") ? { width: 36, height: 50 } : Er(n, "bpmn:DataStoreReference") ? { width: 50, height: 50 } : Er(n, "bpmn:TextAnnotation") ? { width: 100, height: 30 } : Er(n, "bpmn:Group") ? { width: 300, height: 300 } : { width: 100, height: 80 } }, fm.prototype.createParticipantShape = function (e) { return l(e) || (e = { isExpanded: e }), !1 !== (e = L({ type: "bpmn:Participant" }, e || {})).isExpanded && (e.processRef = this._bpmnFactory.create("bpmn:Process")), this.createShape(e) }, vm.$inject = ["modeling", "canvas"], vm.prototype.preExecute = function (e) { var t = this._modeling, n = e.elements, i = e.alignment; g(n, (function (e) { var n = { x: 0, y: 0 }; s(i.left) ? n.x = i.left - e.x : s(i.right) ? n.x = i.right - e.width - e.x : s(i.center) ? n.x = i.center - Math.round(e.width / 2) - e.x : s(i.top) ? n.y = i.top - e.y : s(i.bottom) ? n.y = i.bottom - e.height - e.y : s(i.middle) && (n.y = i.middle - Math.round(e.height / 2) - e.y), t.moveElements([e], n, e.parent) })) }, vm.prototype.postExecute = function (e) { }, ym.$inject = ["modeling"], ym.prototype.preExecute = function (e) { var t = e.source; if (!t) throw new Error("source required"); var n = e.target || t.parent, i = e.shape, r = e.hints || {}; i = e.shape = this._modeling.createShape(i, e.position, n, { attach: r.attach }), e.shape = i }, ym.prototype.postExecute = function (e) { var t, n, i = e.hints || {}; t = e.source, n = e.shape, w(t.outgoing, (function (e) { return e.target === n })) || (i.connectionTarget === e.source ? this._modeling.connect(e.shape, e.source, e.connection) : this._modeling.connect(e.source, e.shape, e.connection)) }, gm.$inject = ["canvas", "layouter"], gm.prototype.execute = function (e) { var t = e.connection, n = e.source, i = e.target, r = e.parent, o = e.parentIndex, a = e.hints; if (!n || !i) throw new Error("source and target required"); if (!r) throw new Error("parent required"); return t.source = n, t.target = i, t.waypoints || (t.waypoints = this._layouter.layoutConnection(t, a)), this._canvas.addConnection(t, r, o), t }, gm.prototype.revert = function (e) { var t = e.connection; return this._canvas.removeConnection(t), t.source = null, t.target = null, t }; var _m = Math.round; function bm(e) { this._modeling = e } bm.$inject = ["modeling"], bm.prototype.preExecute = function (e) { var t = e.elements, n = e.parent, i = e.parentIndex, r = e.position, o = e.hints, a = this._modeling; g(t, (function (e) { u(e.x) || (e.x = 0), u(e.y) || (e.y = 0) })); var s = vt(y(t, (function (e) { return !e.hidden }))); g(t, (function (e) { un(e) && (e.waypoints = E(e.waypoints, (function (e) { return { x: _m(e.x - s.x - s.width / 2 + r.x), y: _m(e.y - s.y - s.height / 2 + r.y) } }))), L(e, { x: _m(e.x - s.x - s.width / 2 + r.x), y: _m(e.y - s.y - s.height / 2 + r.y) }) })); var c = ut(t), p = {}; g(t, (function (e) { if (un(e)) p[e.id] = u(i) ? a.createConnection(p[e.source.id], p[e.target.id], i, e, e.parent || n, o) : a.createConnection(p[e.source.id], p[e.target.id], e, e.parent || n, o); else { var t = L({}, o); -1 === c.indexOf(e) && (t.autoResize = !1), hn(e) && (t = $(t, ["attach"])), p[e.id] = u(i) ? a.createShape(e, I(e, ["x", "y", "width", "height"]), e.parent || n, i, t) : a.createShape(e, I(e, ["x", "y", "width", "height"]), e.parent || n, t) } })), e.elements = C(p) }; var xm = Math.round; function wm(e) { this._canvas = e } function Em(e) { wm.call(this, e) } wm.$inject = ["canvas"], wm.prototype.execute = function (e) { var t = e.shape, n = e.position, i = e.parent, r = e.parentIndex; if (!i) throw new Error("parent required"); if (!n) throw new Error("position required"); return void 0 !== n.width ? L(t, n) : L(t, { x: n.x - xm(t.width / 2), y: n.y - xm(t.height / 2) }), this._canvas.addShape(t, i, r), t }, wm.prototype.revert = function (e) { var t = e.shape; return this._canvas.removeShape(t), t }, e(Em, wm), Em.$inject = ["canvas"]; var Sm = wm.prototype.execute; Em.prototype.execute = function (e) { var t = e.shape; return function (e) { ["width", "height"].forEach((function (t) { void 0 === e[t] && (e[t] = 0) })) }(t), t.labelTarget = e.labelTarget, Sm.call(this, e) }; var Cm = wm.prototype.revert; function km(e, t) { this._canvas = e, this._modeling = t } function Rm(e, t) { this._modeling = e, this._elementRegistry = t } function Pm(e, t) { this._canvas = e, this._modeling = t } function Tm(e) { this._modeling = e } Em.prototype.revert = function (e) { return e.shape.labelTarget = null, Cm.call(this, e) }, km.$inject = ["canvas", "modeling"], km.prototype.preExecute = function (e) { var t = this._modeling, n = e.connection; im(n.incoming, (function (e) { t.removeConnection(e, { nested: !0 }) })), im(n.outgoing, (function (e) { t.removeConnection(e, { nested: !0 }) })) }, km.prototype.execute = function (e) { var t = e.connection, n = t.parent; return e.parent = n, e.parentIndex = St(n.children, t), e.source = t.source, e.target = t.target, this._canvas.removeConnection(t), t.source = null, t.target = null, t }, km.prototype.revert = function (e) { var t = e.connection, n = e.parent, i = e.parentIndex; return t.source = e.source, t.target = e.target, Et(n.children, t, i), this._canvas.addConnection(t, n), t }, Rm.$inject = ["modeling", "elementRegistry"], Rm.prototype.postExecute = function (e) { var t = this._modeling, n = this._elementRegistry; g(e.elements, (function (e) { n.get(e.id) && (e.waypoints ? t.removeConnection(e) : t.removeShape(e)) })) }, Pm.$inject = ["canvas", "modeling"], Pm.prototype.preExecute = function (e) { var t = this._modeling, n = e.shape; im(n.incoming, (function (e) { t.removeConnection(e, { nested: !0 }) })), im(n.outgoing, (function (e) { t.removeConnection(e, { nested: !0 }) })), im(n.children, (function (e) { un(e) ? t.removeConnection(e, { nested: !0 }) : t.removeShape(e, { nested: !0 }) })) }, Pm.prototype.execute = function (e) { var t = this._canvas, n = e.shape, i = n.parent; return e.oldParent = i, e.oldParentIndex = St(i.children, n), t.removeShape(n), n }, Pm.prototype.revert = function (e) { var t = this._canvas, n = e.shape, i = e.oldParent, r = e.oldParentIndex; return Et(i.children, n, r), t.addShape(n, i), n }, Tm.$inject = ["modeling"]; var Am = { x: "y", y: "x" }; function Mm(e, t) { this._layouter = e, this._canvas = t } function Dm() { } function Bm() { this.allShapes = {}, this.allConnections = {}, this.enclosedElements = {}, this.enclosedConnections = {}, this.topLevel = {} } function Nm(e) { this._modeling = e } function Om(e) { this._helper = new Nm(e) } function jm(e) { this._modeling = e, this._helper = new Nm(e) } function Lm(e) { this._modeling = e } function Im(e) { return e.original || e } function $m(e, t) { this._modeling = e, this._rules = t } function Fm(e) { this._modeling = e } function zm(e) { this._modeling = e } function Hm(e) { return L({}, e) } function Vm(e) { switch (e) { case "n": case "s": return "y"; case "w": case "e": return "x" } } function Wm(e, t, n) { var i = Vm(n); return /e|s/.test(n) ? e[i] > t : /n|w/.test(n) ? e[i] < t : void 0 } function Gm(e, t) { return -1 !== e.indexOf(t) } function Um(e) { this._modeling = e } function qm(e) { var t = {}; return g(e, (function (e) { t[e.id] = e.hidden, e.children && (t = L({}, t, qm(e.children))) })), t } function Km(e, t) { var n = []; return g(e, (function (e) { e.hidden = t, n = n.concat(e), e.children && (n = n.concat(Km(e.children, e.collapsed || t))) })), n } function Ym(e, t) { var n = []; return g(e, (function (e) { e.hidden = t[e.id], n = n.concat(e), e.children && (n = n.concat(Ym(e.children, t))) })), n } function Xm(e) { this._modeling = e } function Zm(e, t) { return wt(e && e.attachers, t) } function Qm(e, t, n) { if (e) { var i = e.attachers; i || (e.attachers = i = []), Et(i, t, n) } } function Jm() { } function ev(e, t, n) { this._eventBus = e, this._elementFactory = t, this._commandStack = n; var i = this; e.on("diagram.init", (function () { i.registerHandlers(n) })) } function tv(e) { this._elementRegistry = e } function nv(e, t) { g(t, (function (t, n) { e.set(n, t) })) } Tm.prototype.preExecute = function (e) { var t = this._modeling, n = e.groups, i = e.axis, r = e.dimension; function o(e, t) { e.range.min = Math.min(t[i], e.range.min), e.range.max = Math.max(t[i] + t[r], e.range.max) } function a(e) { return e[i] + e[r] / 2 } function s(e) { return e.length - 1 } function c(e) { return e.max - e.min } var p, l, u = n[0], h = s(n), d = n[h], f = 0; g(n, (function (e, p) { var l, u, d; e.elements.length < 2 ? p && p !== n.length - 1 && (o(e, e.elements[0]), f += c(e.range)) : (u = (l = T(e.elements, i))[0], p === h && (u = l[s(l)]), d = a(u), e.range = null, g(l, (function (n) { !function (e, n) { var r = { y: 0 }; r[i] = e - a(n), r[i] && (r[Am[i]] = 0, t.moveElements([n], r, n.parent)) }(d, n), null !== e.range ? o(e, n) : e.range = { min: n[i], max: n[i] + n[r] } })), p && p !== n.length - 1 && (f += c(e.range))) })), l = Math.abs(d.range.min - u.range.max), (p = Math.round((l - f) / (n.length - 1))) < n.length - 1 || g(n, (function (e, o) { var a, s = {}; e !== u && e !== d && (a = n[o - 1], e.range.max = 0, g(e.elements, (function (n, o) { s[Am[i]] = 0, s[i] = a.range.max - n[i] + p, e.range.min !== n[i] && (s[i] += n[i] - e.range.min), s[i] && t.moveElements([n], s, n.parent), e.range.max = Math.max(n[i] + n[r], o ? e.range.max : 0) }))) })) }, Tm.prototype.postExecute = function (e) { }, Mm.$inject = ["layouter", "canvas"], Mm.prototype.execute = function (e) { var t = e.connection; return L(e, { oldWaypoints: t.waypoints }), t.waypoints = this._layouter.layoutConnection(t, e.hints), t }, Mm.prototype.revert = function (e) { var t = e.connection; return t.waypoints = e.oldWaypoints, t }, Dm.prototype.execute = function (e) { var t = e.connection, n = e.delta, i = e.newParent || t.parent, r = e.newParentIndex, o = t.parent; return e.oldParent = o, e.oldParentIndex = wt(o.children, t), Et(i.children, t, r), t.parent = i, g(t.waypoints, (function (e) { e.x += n.x, e.y += n.y, e.original && (e.original.x += n.x, e.original.y += n.y) })), t }, Dm.prototype.revert = function (e) { var t = e.connection, n = t.parent, i = e.oldParent, r = e.oldParentIndex, o = e.delta; return wt(n.children, t), Et(i.children, t, r), t.parent = i, g(t.waypoints, (function (e) { e.x -= o.x, e.y -= o.y, e.original && (e.original.x -= o.x, e.original.y -= o.y) })), t }, Bm.prototype.add = function (e, t) { return this.addAll([e], t) }, Bm.prototype.addAll = function (e, t) { var n = function (e, t, n) { a(t) && (t = !0), l(t) && (n = t, t = !0); var i = _t((n = n || {}).allShapes), r = _t(n.allConnections), o = _t(n.enclosedElements), s = _t(n.enclosedConnections), c = _t(n.topLevel, t && k(e, (function (e) { return e.id }))); function p(e) { c[e.source.id] && c[e.target.id] && (c[e.id] = [e]), i[e.source.id] && i[e.target.id] && (s[e.id] = o[e.id] = e), r[e.id] = e } return ft(e, (function (e) { if (o[e.id] = e, !e.waypoints) return i[e.id] = e, g(e.incoming, p), g(e.outgoing, p), e.children; s[e.id] = r[e.id] = e })), { allShapes: i, allConnections: r, topLevel: c, enclosedConnections: s, enclosedElements: o } }(e, !!t, this); return L(this, n), this }, Nm.prototype.moveRecursive = function (e, t, n) { return e ? this.moveClosure(this.getClosure(e), t, n) : [] }, Nm.prototype.moveClosure = function (e, t, n, i, r) { var o = this._modeling, a = e.allShapes, s = e.allConnections, c = e.enclosedConnections, p = e.topLevel, l = !1; r && r.parent === n && (l = !0), g(a, (function (e) { o.moveShape(e, t, p[e.id] && !l && n, { recurse: !1, layout: !1 }) })), g(s, (function (e) { var i = !!a[e.source.id], r = !!a[e.target.id]; c[e.id] && i && r ? o.moveConnection(e, t, p[e.id] && !l && n) : o.layoutConnection(e, { connectionStart: i && gh(e, e.source, t), connectionEnd: r && _h(e, e.target, t) }) })) }, Nm.prototype.getClosure = function (e) { return (new Bm).addAll(e, !0) }, Om.$inject = ["modeling"], Om.prototype.preExecute = function (e) { e.closure = this._helper.getClosure(e.shapes) }, Om.prototype.postExecute = function (e) { var t, n = e.hints; n && n.primaryShape && (t = n.primaryShape, n.oldParent = t.parent), this._helper.moveClosure(e.closure, e.delta, e.newParent, e.newHost, t) }, jm.$inject = ["modeling"], jm.prototype.execute = function (e) { var t = e.shape, n = e.delta, i = e.newParent || t.parent, r = e.newParentIndex, o = t.parent; return e.oldBounds = I(t, ["x", "y", "width", "height"]), e.oldParent = o, e.oldParentIndex = wt(o.children, t), Et(i.children, t, r), L(t, { parent: i, x: t.x + n.x, y: t.y + n.y }), t }, jm.prototype.postExecute = function (e) { var t = e.shape, n = e.delta, i = e.hints, r = this._modeling; !1 !== i.layout && (g(t.incoming, (function (e) { r.layoutConnection(e, { connectionEnd: _h(e, t, n) }) })), g(t.outgoing, (function (e) { r.layoutConnection(e, { connectionStart: gh(e, t, n) }) }))), !1 !== i.recurse && this.moveChildren(e) }, jm.prototype.revert = function (e) { var t = e.shape, n = e.oldParent, i = e.oldParentIndex, r = e.delta; return Et(n.children, t, i), L(t, { parent: n, x: t.x - r.x, y: t.y - r.y }), t }, jm.prototype.moveChildren = function (e) { var t = e.delta, n = e.shape; this._helper.moveRecursive(n.children, t, null) }, jm.prototype.getNewParent = function (e) { return e.newParent || e.shape.parent }, Lm.$inject = ["modeling"], Lm.prototype.execute = function (e) { var t = e.newSource, n = e.newTarget, i = e.connection, r = e.dockingOrPoints; if (!t && !n) throw new Error("newSource or newTarget required"); return p(r) && (e.oldWaypoints = i.waypoints, i.waypoints = r), t && (e.oldSource = i.source, i.source = t), n && (e.oldTarget = i.target, i.target = n), i }, Lm.prototype.postExecute = function (e) { var t = e.connection, n = e.newSource, i = e.newTarget, r = e.dockingOrPoints, o = e.hints || {}, a = {}; o.connectionStart && (a.connectionStart = o.connectionStart), o.connectionEnd && (a.connectionEnd = o.connectionEnd), !1 !== o.layoutConnection && (!n || i && "source" !== o.docking || (a.connectionStart = a.connectionStart || Im(p(r) ? r[0] : r)), !i || n && "target" !== o.docking || (a.connectionEnd = a.connectionEnd || Im(p(r) ? r[r.length - 1] : r)), o.newWaypoints && (a.waypoints = o.newWaypoints), this._modeling.layoutConnection(t, a)) }, Lm.prototype.revert = function (e) { var t = e.oldSource, n = e.oldTarget, i = e.oldWaypoints, r = e.connection; return t && (r.source = t), n && (r.target = n), i && (r.waypoints = i), r }, $m.$inject = ["modeling", "rules"], $m.prototype.preExecute = function (e) { var t, n = this, i = this._modeling, r = this._rules, o = e.oldShape, a = e.newData, s = e.hints || {}; function c(e, t, n) { return r.allowed("connection.reconnect", { connection: n, source: e, target: t }) } var p, l = { x: a.x, y: a.y }, u = { x: o.x, y: o.y, width: o.width, height: o.height }; t = e.newShape = e.newShape || n.createShape(a, l, o.parent, s), o.host && i.updateAttachment(t, o.host), !1 !== s.moveChildren && (p = o.children.slice(), i.moveElements(p, { x: 0, y: 0 }, t, s)); var h = o.incoming.slice(), d = o.outgoing.slice(); g(h, (function (e) { c(e.source, t, e) && n.reconnectEnd(e, t, yh(e, t, u), s) })), g(d, (function (e) { var i = e.target; c(t, i, e) && n.reconnectStart(e, t, vh(e, t, u), s) })) }, $m.prototype.postExecute = function (e) { var t = e.oldShape; this._modeling.removeShape(t) }, $m.prototype.execute = function (e) { }, $m.prototype.revert = function (e) { }, $m.prototype.createShape = function (e, t, n, i) { return this._modeling.createShape(e, t, n, i) }, $m.prototype.reconnectStart = function (e, t, n, i) { this._modeling.reconnectStart(e, t, n, i) }, $m.prototype.reconnectEnd = function (e, t, n, i) { this._modeling.reconnectEnd(e, t, n, i) }, Fm.$inject = ["modeling"], Fm.prototype.execute = function (e) { var t = e.shape, n = e.newBounds, i = e.minBounds; if (void 0 === n.x || void 0 === n.y || void 0 === n.width || void 0 === n.height) throw new Error("newBounds must have {x, y, width, height} properties"); if (i && (n.width < i.width || n.height < i.height)) throw new Error("width and height cannot be less than minimum height and width"); if (!i && n.width < 10 || n.height < 10) throw new Error("width and height cannot be less than 10px"); return e.oldBounds = { width: t.width, height: t.height, x: t.x, y: t.y }, L(t, { width: n.width, height: n.height, x: n.x, y: n.y }), t }, Fm.prototype.postExecute = function (e) { var t = this._modeling, n = e.shape, i = e.oldBounds; !1 !== (e.hints || {}).layout && (g(n.incoming, (function (e) { t.layoutConnection(e, { connectionEnd: yh(e, n, i) }) })), g(n.outgoing, (function (e) { t.layoutConnection(e, { connectionStart: vh(e, n, i) }) }))) }, Fm.prototype.revert = function (e) { var t = e.shape, n = e.oldBounds; return L(t, { width: n.width, height: n.height, x: n.x, y: n.y }), t }, zm.$inject = ["modeling"], zm.prototype.preExecute = function (e) { var t = e.delta, n = e.direction, i = e.movingShapes, r = e.resizingShapes, o = e.start, a = {}; this.moveShapes(i, t), g(r, (function (e) { a[e.id] = function (e) { return { x: e.x, y: e.y, height: e.height, width: e.width } }(e) })), this.resizeShapes(r, t, n), this.updateConnectionWaypoints(function (e, t) { var n = []; return g(e.concat(t), (function (i) { var r = i.incoming, o = i.outgoing; g(r.concat(o), (function (i) { var r = i.source, o = i.target; (Of(e, r) || Of(e, o) || Of(t, r) || Of(t, o)) && (Of(n, i) || n.push(i)) })) })), n }(i, r), t, n, o, i, r, a) }, zm.prototype.execute = function () { }, zm.prototype.revert = function () { }, zm.prototype.moveShapes = function (e, t) { var n = this; g(e, (function (e) { n._modeling.moveShape(e, t, null, { autoResize: !1, layout: !1, recurse: !1 }) })) }, zm.prototype.resizeShapes = function (e, t, n) { var i = this; g(e, (function (e) { var r = function (e, t, n) { var i = e.x, r = e.y, o = e.width, a = e.height, s = n.x, c = n.y; switch (t) { case "n": return { x: i, y: r + c, width: o, height: a - c }; case "s": return { x: i, y: r, width: o, height: a + c }; case "w": return { x: i + s, y: r, width: o - s, height: a }; case "e": return { x: i, y: r, width: o + s, height: a }; default: throw new Error("unknown direction: " + t) } }(e, n, t); i._modeling.resizeShape(e, r, null, { attachSupport: !1, autoResize: !1, layout: !1 }) })) }, zm.prototype.updateConnectionWaypoints = function (e, t, n, i, r, o, a) { var s = this, c = r.concat(o); g(e, (function (e) { var p = e.source, l = e.target, u = function (e) { return E(e.waypoints, (function (e) { return (e = Hm(e)).original && (e.original = Hm(e.original)), e })) }(e), h = Vm(n), d = {}; Gm(c, p) && Gm(c, l) ? (u = E(u, (function (e) { return Wm(e, i, n) && (e[h] = e[h] + t[h]), e.original && Wm(e.original, i, n) && (e.original[h] = e.original[h] + t[h]), e })), s._modeling.updateWaypoints(e, u, { labelBehavior: !1 })) : (Gm(c, p) || Gm(c, l)) && (Gm(r, p) ? d.connectionStart = gh(e, p, t) : Gm(r, l) ? d.connectionEnd = _h(e, l, t) : Gm(o, p) ? d.connectionStart = vh(e, p, a[p.id]) : Gm(o, l) && (d.connectionEnd = yh(e, l, a[l.id])), s._modeling.layoutConnection(e, d)) })) }, Um.$inject = ["modeling"], Um.prototype.execute = function (e) { var t = e.shape, n = t.children; e.oldChildrenVisibility = qm(n), t.collapsed = !t.collapsed; var i = Km(n, t.collapsed); return [t].concat(i) }, Um.prototype.revert = function (e) { var t = e.shape, n = e.oldChildrenVisibility, i = Ym(t.children, n); return t.collapsed = !t.collapsed, [t].concat(i) }, Xm.$inject = ["modeling"], Xm.prototype.execute = function (e) { var t = e.shape, n = e.newHost, i = t.host; return e.oldHost = i, e.attacherIdx = Zm(i, t), Qm(n, t), t.host = n, t }, Xm.prototype.revert = function (e) { var t = e.shape, n = e.newHost, i = e.oldHost, r = e.attacherIdx; return t.host = i, Zm(n, t), Qm(i, t, r), t }, Jm.prototype.execute = function (e) { var t = e.connection, n = e.newWaypoints; return e.oldWaypoints = t.waypoints, t.waypoints = n, t }, Jm.prototype.revert = function (e) { var t = e.connection, n = e.oldWaypoints; return t.waypoints = n, t }, ev.$inject = ["eventBus", "elementFactory", "commandStack"], ev.prototype.getHandlers = function () { return { "shape.append": ym, "shape.create": wm, "shape.delete": Pm, "shape.move": jm, "shape.resize": Fm, "shape.replace": $m, "shape.toggleCollapse": Um, spaceTool: zm, "label.create": Em, "connection.create": gm, "connection.delete": km, "connection.move": Dm, "connection.layout": Mm, "connection.updateWaypoints": Jm, "connection.reconnect": Lm, "elements.create": bm, "elements.move": Om, "elements.delete": Rm, "elements.distribute": Tm, "elements.align": vm, "element.updateAttachment": Xm } }, ev.prototype.registerHandlers = function (e) { g(this.getHandlers(), (function (t, n) { e.registerHandler(n, t) })) }, ev.prototype.moveShape = function (e, t, n, i, r) { "object" == typeof i && (r = i, i = null); var o = { shape: e, delta: t, newParent: n, newParentIndex: i, hints: r || {} }; this._commandStack.execute("shape.move", o) }, ev.prototype.updateAttachment = function (e, t) { var n = { shape: e, newHost: t }; this._commandStack.execute("element.updateAttachment", n) }, ev.prototype.moveElements = function (e, t, n, i) { var r, o = (i = i || {}).attach, a = n; !0 === o ? (r = n, a = n.parent) : !1 === o && (r = null); var s = { shapes: e, delta: t, newParent: a, newHost: r, hints: i }; this._commandStack.execute("elements.move", s) }, ev.prototype.moveConnection = function (e, t, n, i, r) { "object" == typeof i && (r = i, i = void 0); var o = { connection: e, delta: t, newParent: n, newParentIndex: i, hints: r || {} }; this._commandStack.execute("connection.move", o) }, ev.prototype.layoutConnection = function (e, t) { var n = { connection: e, hints: t || {} }; this._commandStack.execute("connection.layout", n) }, ev.prototype.createConnection = function (e, t, n, i, r, o) { "object" == typeof n && (o = r, r = i, i = n, n = void 0); var a = { source: e, target: t, parent: r, parentIndex: n, connection: i = this._create("connection", i), hints: o }; return this._commandStack.execute("connection.create", a), a.connection }, ev.prototype.createShape = function (e, t, n, i, r) { "number" != typeof i && (r = i, i = void 0); var o, a, s = (r = r || {}).attach; e = this._create("shape", e), s ? (o = n.parent, a = n) : o = n; var c = { position: t, shape: e, parent: o, parentIndex: i, host: a, hints: r }; return this._commandStack.execute("shape.create", c), c.shape }, ev.prototype.createElements = function (e, t, n, i, r) { p(e) || (e = [e]), "number" != typeof i && (r = i, i = void 0); var o = { position: t, elements: e, parent: n, parentIndex: i, hints: r = r || {} }; return this._commandStack.execute("elements.create", o), o.elements }, ev.prototype.createLabel = function (e, t, n, i) { n = this._create("label", n); var r = { labelTarget: e, position: t, parent: i || e.parent, shape: n }; return this._commandStack.execute("label.create", r), r.shape }, ev.prototype.appendShape = function (e, t, n, i, r) { r = r || {}; var o = { source: e, position: n, target: i, shape: t = this._create("shape", t), connection: r.connection, connectionParent: r.connectionParent, hints: r }; return this._commandStack.execute("shape.append", o), o.shape }, ev.prototype.removeElements = function (e) { var t = { elements: e }; this._commandStack.execute("elements.delete", t) }, ev.prototype.distributeElements = function (e, t, n) { var i = { groups: e, axis: t, dimension: n }; this._commandStack.execute("elements.distribute", i) }, ev.prototype.removeShape = function (e, t) { var n = { shape: e, hints: t || {} }; this._commandStack.execute("shape.delete", n) }, ev.prototype.removeConnection = function (e, t) { var n = { connection: e, hints: t || {} }; this._commandStack.execute("connection.delete", n) }, ev.prototype.replaceShape = function (e, t, n) { var i = { oldShape: e, newData: t, hints: n || {} }; return this._commandStack.execute("shape.replace", i), i.newShape }, ev.prototype.alignElements = function (e, t) { var n = { elements: e, alignment: t }; this._commandStack.execute("elements.align", n) }, ev.prototype.resizeShape = function (e, t, n, i) { var r = { shape: e, newBounds: t, minBounds: n, hints: i }; this._commandStack.execute("shape.resize", r) }, ev.prototype.createSpace = function (e, t, n, i, r) { var o = { delta: n, direction: i, movingShapes: e, resizingShapes: t, start: r }; this._commandStack.execute("spaceTool", o) }, ev.prototype.updateWaypoints = function (e, t, n) { var i = { connection: e, newWaypoints: t, hints: n || {} }; this._commandStack.execute("connection.updateWaypoints", i) }, ev.prototype.reconnect = function (e, t, n, i, r) { var o = { connection: e, newSource: t, newTarget: n, dockingOrPoints: i, hints: r || {} }; this._commandStack.execute("connection.reconnect", o) }, ev.prototype.reconnectStart = function (e, t, n, i) { i || (i = {}), this.reconnect(e, t, e.target, n, L(i, { docking: "source" })) }, ev.prototype.reconnectEnd = function (e, t, n, i) { i || (i = {}), this.reconnect(e, e.source, t, n, L(i, { docking: "target" })) }, ev.prototype.connect = function (e, t, n, i) { return this.createConnection(e, t, n || {}, e.parent, i) }, ev.prototype._create = function (e, t) { return t instanceof jn ? t : this._elementFactory.create(e, t) }, ev.prototype.toggleCollapse = function (e, t) { var n = { shape: e, hints: t || {} }; this._commandStack.execute("shape.toggleCollapse", n) }, tv.$inject = ["elementRegistry"], tv.prototype.execute = function (e) { var t = e.element, n = e.moddleElement, i = e.properties; if (!n) throw new Error("<moddleElement> required"); var r = e.changed || this._getVisualReferences(n).concat(t), o = e.oldProperties || function (e, t) { return b(t, (function (t, n) { return t[n] = e.get(n), t }), {}) }(n, S(i)); return nv(n, i), e.oldProperties = o, e.changed = r, r }, tv.prototype.revert = function (e) { var t = e.oldProperties, n = e.moddleElement, i = e.changed; return nv(n, t), i }, tv.prototype._getVisualReferences = function (e) { var t = this._elementRegistry; return Er(e, "bpmn:DataObject") ? function (e, t) { return t.filter((function (t) { return Er(t, "bpmn:DataObjectReference") && Cr(t).dataObjectRef === e })) }(e, t) : [] }; var iv = "default", rv = "id", ov = "di", av = { width: 0, height: 0 }; function sv(e, t, n, i, r) { this._elementRegistry = e, this._moddle = t, this._translate = n, this._modeling = i, this._textRenderer = r } function cv(e, t) { return rv in e && e[rv] !== t[rv] } function pv(e, t) { var n = e.businessObject, i = kr(e); g(t, (function (e, t) { t !== ov ? n.set(t, e) : i && function (e, t) { g(t, (function (t, n) { e.set(n, t) })) }(i, e) })) } sv.$inject = ["elementRegistry", "moddle", "translate", "modeling", "textRenderer"], sv.prototype.execute = function (e) { var t = e.element, n = [t], i = this._translate; if (!t) throw new Error(i("element required")); var r = this._elementRegistry, o = this._moddle.ids, a = t.businessObject, s = function (e) { var t = L({}, e); return lv.forEach((function (n) { n in e && (t[n] = Cr(t[n])) })), t }(e.properties), c = e.oldProperties || function (e, t) { var n = S(t), i = e.businessObject, r = kr(e); return b(n, (function (e, n) { return e[n] = n !== ov ? i.get(n) : function (e, t) { return b(t, (function (t, n) { return t[n] = e && e.get(n), t }), {}) }(r, S(t.di)), e }), {}) }(t, s); return cv(s, a) && (o.unclaim(a[rv]), r.updateId(t, s[rv]), o.claim(s[rv], a)), iv in s && (s[iv] && n.push(r.get(s[iv].id)), a[iv] && n.push(r.get(a[iv].id))), pv(t, s), e.oldProperties = c, e.changed = n, n }, sv.prototype.postExecute = function (e) { var t = e.element.label, n = t && Cr(t).name; if (n) { var i = this._textRenderer.getExternalLabelBounds(t, n); this._modeling.resizeShape(t, i, av) } }, sv.prototype.revert = function (e) { var t = e.element, n = e.properties, i = e.oldProperties, r = t.businessObject, o = this._elementRegistry, a = this._moddle.ids; return pv(t, i), cv(n, r) && (a.unclaim(n[rv]), o.updateId(t, i[rv]), a.claim(i[rv], r)), e.changed }; var lv = ["default"]; function uv(e, t) { this._canvas = e, this._modeling = t } function hv(e, t) { this._modeling = e, this._spaceTool = t } function dv(e, t) { this._modeling = e, this._translate = t } function fv(e, t) { this._modeling = e, this._spaceTool = t } uv.$inject = ["canvas", "modeling"], uv.prototype.execute = function (e) { var t = this._canvas, n = e.newRoot, i = n.businessObject, r = t.getRootElement(), o = r.businessObject, a = o.$parent, s = kr(r); return t.setRootElement(n), t.removeRootElement(r), Et(a.rootElements, i), i.$parent = a, wt(a.rootElements, o), o.$parent = null, r.di = null, s.bpmnElement = i, n.di = s, e.oldRoot = r, [] }, uv.prototype.revert = function (e) { var t = this._canvas, n = e.newRoot, i = n.businessObject, r = e.oldRoot, o = r.businessObject, a = i.$parent, s = kr(n); return t.setRootElement(r), t.removeRootElement(n), wt(a.rootElements, i), i.$parent = null, Et(a.rootElements, o), o.$parent = a, n.di = null, s.bpmnElement = o, r.di = s, [] }, hv.$inject = ["modeling", "spaceTool"], hv.prototype.preExecute = function (e) { var t = this._spaceTool, n = this._modeling, i = e.shape, r = e.location, o = Bu(i), a = o === i, s = a ? i : i.parent; Du(s).length || n.createShape({ type: "bpmn:Lane" }, { x: i.x + Au, y: i.y, width: i.width - Au, height: i.height }, s); var c = []; ft(o, (function (e) { return c.push(e), e.label && c.push(e.label), e === i ? [] : y(e.children, (function (e) { return e !== i })) })); var p = "top" === r ? -120 : 120, l = "top" === r ? i.y : i.y + i.height, u = l + ("top" === r ? 10 : -10), h = "top" === r ? "n" : "s", d = t.calculateAdjustments(c, "y", p, u); t.makeSpace(d.movingShapes, d.resizingShapes, { x: 0, y: p }, h, u), e.newLane = n.createShape({ type: "bpmn:Lane" }, { x: i.x + (a ? Au : 0), y: l - ("top" === r ? 120 : 0), width: i.width - (a ? Au : 0), height: 120 }, s) }, dv.$inject = ["modeling", "translate"], dv.prototype.preExecute = function (e) { var t = this._modeling, n = this._translate, i = e.shape, r = e.count, o = Du(i), a = o.length; if (a > r) throw new Error(n("more than {count} child lanes", { count: r })); var s, c, p, l, u, h = Math.round(i.height / r); for (u = 0; u < r; u++)s = i.y + u * h, c = u === r - 1 ? i.height - h * u : h, p = { x: i.x + Au, y: s, width: i.width - Au, height: c }, u < a ? t.resizeShape(o[u], p) : (l = { type: "bpmn:Lane" }, t.createShape(l, p, i)) }, fv.$inject = ["modeling", "spaceTool"], fv.prototype.preExecute = function (e) { var t = e.shape, n = e.newBounds; !1 !== e.balanced ? this.resizeBalanced(t, n) : this.resizeSpace(t, n) }, fv.prototype.resizeBalanced = function (e, t) { var n = this._modeling, i = Nu(e, t); n.resizeShape(e, t), i.forEach((function (e) { n.resizeShape(e.shape, e.newBounds) })) }, fv.prototype.resizeSpace = function (e, t) { var n, i, r, o, a, s = this._spaceTool, c = mn(e), p = Eu(mn(t), c), l = Bu(e), u = [], h = []; ft(l, (function (e) { return u.push(e), (Er(e, "bpmn:Lane") || Er(e, "bpmn:Participant")) && h.push(e), e.children })), (p.bottom || p.top) && (n = p.bottom || p.top, i = e.y + (p.bottom ? e.height : 0) + (p.bottom ? -10 : 10), r = p.bottom ? "s" : "n", o = p.top > 0 || p.bottom < 0 ? -n : n, a = s.calculateAdjustments(u, "y", o, i), s.makeSpace(a.movingShapes, a.resizingShapes, { x: 0, y: n }, r)), (p.left || p.right) && (n = p.right || p.left, i = e.x + (p.right ? e.width : 0) + (p.right ? -10 : 100), r = p.right ? "e" : "w", o = p.left > 0 || p.right < 0 ? -n : n, a = s.calculateAdjustments(h, "x", o, i), s.makeSpace(a.movingShapes, a.resizingShapes, { x: n, y: 0 }, r)) }; var mv = "flowNodeRef", vv = "lanes"; function yv(e) { this._elementRegistry = e } function gv(e) { this._moddle = e } yv.$inject = ["elementRegistry"], yv.prototype._computeUpdates = function (e, t) { var n = [], i = [], r = {}, o = []; function a(e) { -1 === n.indexOf(e) && (o.push(e), n.push(e)) } function s(e) { if (!e.parent) return []; var t = function (e) { var t = Bu(e); return r[t.id] || (r[t.id] = Mu(t)), r[t.id] }(e); return t.filter((function (t) { return n = e, i = mn(t), r = n.x + n.width / 2, o = n.y + n.height / 2, r > i.left && r < i.right && o > i.top && o < i.bottom; var n, i, r, o })).map((function (e) { return e.businessObject })) } return t.forEach((function (e) { var t = Bu(e); if (t && -1 === n.indexOf(t)) { var i = t.children.filter((function (e) { return Er(e, "bpmn:FlowNode") })); i.forEach(a), n.push(t) } })), e.forEach(a), o.forEach((function (e) { var t = e.businessObject, n = t.get(vv).slice(), r = s(e); i.push({ flowNode: t, remove: n, add: r }) })), t.forEach((function (e) { var t = e.businessObject; e.parent || t.get(mv).forEach((function (e) { i.push({ flowNode: e, remove: [t], add: [] }) })) })), i }, yv.prototype.execute = function (e) { var t = e.updates; return t || (t = e.updates = this._computeUpdates(e.flowNodeShapes, e.laneShapes)), t.forEach((function (e) { var t = e.flowNode, n = t.get(vv); e.remove.forEach((function (e) { wt(n, e), wt(e.get(mv), t) })), e.add.forEach((function (e) { Et(n, e), Et(e.get(mv), t) })) })), [] }, yv.prototype.revert = function (e) { return e.updates.forEach((function (e) { var t = e.flowNode, n = t.get(vv); e.add.forEach((function (e) { wt(n, e), wt(e.get(mv), t) })), e.remove.forEach((function (e) { Et(n, e), Et(e.get(mv), t) })) })), [] }, gv.$inject = ["moddle"], gv.prototype.execute = function (e) { var t = this._moddle.ids, n = e.id, i = e.element; return e.claiming ? t.claim(n, i) : t.unclaim(n), [] }, gv.prototype.revert = function (e) { var t = this._moddle.ids, n = e.id, i = e.element; return e.claiming ? t.unclaim(n) : t.claim(n, i), [] }; var _v = { fill: void 0, stroke: void 0 }; function bv(e) { this._commandStack = e, this._normalizeColor = function (e) { if (e) { if (d(e)) { var t = function (e) { var t = document.createElement("canvas").getContext("2d"); return t.fillStyle = "transparent", t.fillStyle = e, /^#[0-9a-fA-F]{6}$/.test(t.fillStyle) ? t.fillStyle : null }(e); if (t) return t } throw new Error("invalid color value: " + e) } } } bv.$inject = ["commandStack"], bv.prototype.postExecute = function (e) { var t = e.elements, n = e.colors || _v, i = this, r = {}; "fill" in n && L(r, { "background-color": this._normalizeColor(n.fill) }), "stroke" in n && L(r, { "border-color": this._normalizeColor(n.stroke) }), g(t, (function (e) { var t = un(e) ? I(r, ["border-color"]) : r, n = kr(e); if (function (e) { "border-color" in e && (e.stroke = e["border-color"]); "background-color" in e && (e.fill = e["background-color"]) }(t), hn(e)) i._commandStack.execute("element.updateModdleProperties", { element: e, moddleElement: n.label, properties: { color: r["border-color"] } }); else { if (!Sr(n, ["bpmndi:BPMNEdge", "bpmndi:BPMNShape"])) return; i._commandStack.execute("element.updateProperties", { element: e, properties: { di: t } }) } })) }; var xv = { width: 0, height: 0 }; function wv(e, t, n) { function i(e, t) { var n = e.label || e, i = e.labelTarget || e; return function (e, t) { var n = e.businessObject, i = Jr(n); i && ("categoryValueRef" === i ? n.categoryValueRef.value = t : n[i] = t) }(n, t), [n, i] } this.preExecute = function (t) { var n = t.element, i = n.businessObject, r = t.newLabel; if (!hn(n) && Yr(n) && !Xr(n) && !Ev(r)) { var o = Qr(n); o = { x: o.x, y: o.y + 7 }, e.createLabel(n, o, { id: i.id + "_label", businessObject: i, di: n.di }) } }, this.execute = function (e) { return e.oldLabel = eo(e.element), i(e.element, e.newLabel) }, this.revert = function (e) { return i(e.element, e.oldLabel) }, this.postExecute = function (n) { var i = n.element, r = i.label || i, o = n.newLabel, a = n.newBounds, s = n.hints || {}; if (hn(r) || Er(r, "bpmn:TextAnnotation")) if (hn(r) && Ev(o)) !1 !== s.removeShape && e.removeShape(r, { unsetLabel: !1 }); else { var c = eo(i); void 0 === a && (a = t.getExternalLabelBounds(r, c)), a && e.resizeShape(r, a, xv) } } } function Ev(e) { return !e || !e.trim() } function Sv(e, t, n, i) { ev.call(this, e, t, n), this._bpmnRules = i } function Cv() { } wv.$inject = ["modeling", "textRenderer", "bpmnFactory"], e(Sv, ev), Sv.$inject = ["eventBus", "elementFactory", "commandStack", "bpmnRules"], Sv.prototype.getHandlers = function () { var e = ev.prototype.getHandlers.call(this); return e["element.updateModdleProperties"] = tv, e["element.updateProperties"] = sv, e["canvas.updateRoot"] = uv, e["lane.add"] = hv, e["lane.resize"] = fv, e["lane.split"] = dv, e["lane.updateRefs"] = yv, e["id.updateClaim"] = gv, e["element.setColor"] = bv, e["element.updateLabel"] = wv, e }, Sv.prototype.updateLabel = function (e, t, n, i) { this._commandStack.execute("element.updateLabel", { element: e, newLabel: t, newBounds: n, hints: i || {} }) }, Sv.prototype.connect = function (e, t, n, i) { var r = this._bpmnRules; if (n || (n = r.canConnect(e, t)), n) return this.createConnection(e, t, n, e.parent, i) }, Sv.prototype.updateModdleProperties = function (e, t, n) { this._commandStack.execute("element.updateModdleProperties", { element: e, moddleElement: t, properties: n }) }, Sv.prototype.updateProperties = function (e, t) { this._commandStack.execute("element.updateProperties", { element: e, properties: t }) }, Sv.prototype.resizeLane = function (e, t, n) { this._commandStack.execute("lane.resize", { shape: e, newBounds: t, balanced: n }) }, Sv.prototype.addLane = function (e, t) { var n = { shape: e, location: t }; return this._commandStack.execute("lane.add", n), n.newLane }, Sv.prototype.splitLane = function (e, t) { this._commandStack.execute("lane.split", { shape: e, count: t }) }, Sv.prototype.makeCollaboration = function () { var e = this._create("root", { type: "bpmn:Collaboration" }), t = { newRoot: e }; return this._commandStack.execute("canvas.updateRoot", t), e }, Sv.prototype.makeProcess = function () { var e = { newRoot: this._create("root", { type: "bpmn:Process" }) }; this._commandStack.execute("canvas.updateRoot", e) }, Sv.prototype.updateLaneRefs = function (e, t) { this._commandStack.execute("lane.updateRefs", { flowNodeShapes: e, laneShapes: t }) }, Sv.prototype.claimId = function (e, t) { this._commandStack.execute("id.updateClaim", { id: e, element: t, claiming: !0 }) }, Sv.prototype.unclaimId = function (e, t) { this._commandStack.execute("id.updateClaim", { id: e, element: t }) }, Sv.prototype.setColor = function (e, t) { e.length || (e = [e]), this._commandStack.execute("element.setColor", { elements: e, colors: t }) }, Cv.prototype.layoutConnection = function (e, t) { return [(t = t || {}).connectionStart || gn(t.source || e.source), t.connectionEnd || gn(t.target || e.target)] }; var kv = 20, Rv = 5, Pv = Math.round, Tv = 20, Av = { "h:h": 20, "v:v": 20, "h:v": -10, "v:h": -10 }; function Mv(e, t, n) { var i, r, o, a = _n(t, e, Rv), s = n.split(":")[0], c = Pv((t.x - e.x) / 2 + e.x), p = Pv((t.y - e.y) / 2 + e.y), l = (o = a, { t: /top/, r: /right/, b: /bottom/, l: /left/, h: /left|right/, v: /top|bottom/ }[s].test(o)), u = /h|r|l/.test(s), h = !1, d = !1; return l ? (i = u ? { x: c, y: e.y } : { x: e.x, y: p }, r = u ? "h:h" : "v:v") : (h = function (e, t) { return !{ t: /top/, r: /right/, b: /bottom/, l: /left/, h: /./, v: /./ }[t].test(e) }(a, s), r = u ? "h:v" : "v:h", h ? u ? (d = p === e.y, i = { x: e.x + kv * (/l/.test(s) ? -1 : 1), y: d ? p + kv : p }) : i = { x: (d = c === e.x) ? c + kv : c, y: e.y + kv * (/t/.test(s) ? -1 : 1) } : i = { x: c, y: p }), { waypoints: Bv(e, i, r).concat(i), directions: r, turnNextDirections: d } } function Dv(e) { return e.split(":").reverse().join(":") } function Bv(e, t, n) { if (!function (e) { return e && /^h|v|t|r|b|l:h|v|t|r|b|l$/.test(e) }(n = n || "h:h")) throw new Error("unknown directions: <" + n + ">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }"); if (Iv(n)) { var i = function (e, t, n) { return Mv(e, t, n) }(e, t, n), r = function (e, t, n) { var i = Mv(t, e, Dv(n)); return { waypoints: i.waypoints.slice().reverse(), directions: Dv(i.directions), turnNextDirections: i.turnNextDirections } }(e, t, n), o = function (e, t) { var n = e.directions.split(":")[1], i = t.directions.split(":")[0]; e.turnNextDirections && (n = "h" == n ? "v" : "h"), t.turnNextDirections && (i = "h" == i ? "v" : "h"); var r = n + ":" + i; return { waypoints: Bv(e.waypoints[e.waypoints.length - 1], t.waypoints[0], r), directions: r } }(i, r); return [].concat(i.waypoints, o.waypoints, r.waypoints) } return function (e, t, n) { var i = Pv((t.x - e.x) / 2 + e.x), r = Pv((t.y - e.y) / 2 + e.y); if ("h:v" === n) return [{ x: t.x, y: e.y }]; if ("v:h" === n) return [{ x: e.x, y: t.y }]; if ("h:h" === n) return [{ x: i, y: e.y }, { x: i, y: t.y }]; if ("v:v" === n) return [{ x: e.x, y: r }, { x: t.x, y: r }]; throw new Error("invalid directions: can only handle varians of [hv]:[hv]") }(e, t, n) } function Nv(e, t, n, i, r) { var o = _(r && r.preferredLayouts || [], "straight")[0] || "h:h", a = _n(e, t, Av[o] || 0), s = function (e, t) { if (Iv(t)) return t; switch (e) { case "intersect": return "t:t"; case "top": case "bottom": return "v:v"; case "left": case "right": return "h:h"; default: return t } }(a, o); n = n || gn(e), i = i || gn(t); var c = s.split(":"), p = $v(n, e, c[0], function (e) { return { top: "bottom", bottom: "top", left: "right", right: "left", "top-left": "bottom-right", "bottom-right": "top-left", "top-right": "bottom-left", "bottom-left": "top-right" }[e] }(a)); return function (e, t, n) { var i = Bv(e, t, n); return i.unshift(e), i.push(t), Fv(i) }(p, $v(i, t, c[1], a), s) } function Ov(e, t, n, i, r, o) { var a; return p(n) && (r = n, o = i, n = gn(e), i = gn(t)), r = r || [], a = -1 !== (o = L({ preferredLayouts: [] }, o)).preferredLayouts.indexOf("straight") && function (e, t, n, i, r) { var o, a, s = {}; if (a = _n(e, t), !/^(top|bottom|left|right)$/.test(a)) return null; /top|bottom/.test(a) && (o = "x"); /left|right/.test(a) && (o = "y"); return "target" === r.preserveDocking ? jv(o, i, e) ? (s[o] = i[o], [{ x: void 0 !== s.x ? s.x : n.x, y: void 0 !== s.y ? s.y : n.y, original: { x: void 0 !== s.x ? s.x : n.x, y: void 0 !== s.y ? s.y : n.y } }, { x: i.x, y: i.y }]) : null : jv(o, n, t) ? (s[o] = n[o], [{ x: n.x, y: n.y }, { x: void 0 !== s.x ? s.x : i.x, y: void 0 !== s.y ? s.y : i.y, original: { x: void 0 !== s.x ? s.x : i.x, y: void 0 !== s.y ? s.y : i.y } }]) : null }(e, t, n, i, o), a || (a = o.connectionEnd && function (e, t, n, i) { var r = i.slice().reverse(); return r = Lv(e, t, n, r), r ? r.reverse() : null }(t, e, i, r), a || ((a = o.connectionStart && Lv(e, t, n, r)) || (!o.connectionStart && !o.connectionEnd && r && r.length ? r : Nv(e, t, n, i, o)))) } function jv(e, t, n) { return function (e, t, n) { return e >= t && e <= n }(t[e], n[e], n[e] + n[{ x: "width", y: "height" }[e]]) } function Lv(e, t, n, i) { if (function (e) { return e.length < 3 || !(e.length > 4) && !!m(e, (function (t, n) { var i = e[n - 1]; return i && Ct(t, i) < 3 })) }(i)) return null; var r, o = i[0], a = i.slice(); return a[0] = n, a[1] = function (e, t, n) { switch (Pt(t, e)) { case "v": return { x: n.x, y: e.y }; case "h": return { x: e.x, y: n.y } }return { x: e.x, y: e.y } }(a[1], o, n), r = function (e, t, n) { var i; for (i = e.length - 2; 0 !== i; i--)if (At(e[i], t, Tv) || At(e[i], n, Tv)) return e.slice(i); return e }(a, e, t), r !== a && (a = Lv(e, t, n, r)), a && Pt(a) ? null : a } function Iv(e) { return e && /t|r|b|l/.test(e) } function $v(e, t, n, i) { if ("h" === n && (n = /left/.test(i) ? "l" : "r"), "v" === n && (n = /top/.test(i) ? "t" : "b"), "t" === n) return { original: e, x: e.x, y: t.y }; if ("r" === n) return { original: e, x: t.x + t.width, y: e.y }; if ("b" === n) return { original: e, x: e.x, y: t.y + t.height }; if ("l" === n) return { original: e, x: t.x, y: e.y }; throw new Error("unexpected dockingDirection: <" + n + ">") } function Fv(e) { return e.reduce((function (t, n, i) { return kt(t[t.length - 1], e[i + 1], n, 0) || t.push(n), t }), []) } var zv = -10, Hv = 40, Vv = { top: "bottom", "top-right": "bottom-left", "top-left": "bottom-right", right: "left", bottom: "top", "bottom-right": "top-left", "bottom-left": "top-right", left: "right" }, Wv = { top: "t", right: "r", bottom: "b", left: "l" }; function Gv() { } function Uv(e, t) { return Er(t, "bpmn:Participant") ? "source" : Er(e, "bpmn:Participant") ? "target" : Xv(t) ? "source" : Xv(e) || Er(t, "bpmn:Event") ? "target" : Er(e, "bpmn:Event") ? "source" : null } function qv(e) { return Xv(e) ? "target" : "source" } function Kv(e, t) { return e ? e.original || e : gn(t) } function Yv(e, t) { return Er(t, "bpmn:Activity") && Er(e, "bpmn:BoundaryEvent") && t.businessObject.isForCompensation } function Xv(e) { return Er(e, "bpmn:SubProcess") && Vr(e) } function Zv(e, t) { return e === t } function Qv(e) { var t = /right|left/.exec(e); return t && t[0] } function Jv(e) { var t = /top|bottom/.exec(e); return t && t[0] } function ey(e) { return "right" === e || "left" === e } function ty(e, t) { var n = t.waypoints, i = n && n.length && _n(n[0], e); return "top" === i ? ["t:r"] : "right" === i ? ["r:b"] : "left" === i ? ["l:t"] : ["b:l"] } function ny(e, t, n) { var i, r, o, a, s = gn(e), c = gn(t), p = (a = (o = e).host, _n(gn(o), a, zv)), l = Zv(e.host, t), u = -1 !== ["top", "right", "bottom", "left"].indexOf(p), h = _n(c, s, { x: e.width / 2 + t.width / 2, y: e.height / 2 + t.height / 2 }); return l ? function (e, t, n, i, r) { var o, a = t ? e : Jv(e), s = Wv[a]; o = t ? ey(e) ? iy("y", n, i, r) ? "h" : "b" : iy("x", n, i, r) ? "v" : "l" : "v"; return [s + ":" + o] }(p, u, e, t, n) : (i = function (e, t, n) { if (n) return Wv[e]; if (Zv(Jv(e), Jv(t)) || function (e, t) { return Vv[e] === t }(Qv(e), Qv(t))) return Wv[Jv(e)]; return Wv[Qv(e)] }(p, h, u), r = function (e, t, n) { if (n) return ey(e) ? function (e, t) { var n = Qv(e), i = Vv[n]; return -1 !== t.indexOf(i) }(e, t) || Zv(e, t) ? "h" : "v" : function (e, t) { var n = Jv(e), i = Vv[n]; return -1 !== t.indexOf(i) }(e, t) || Zv(e, t) ? "v" : "h"; return ey(t) || Zv(Jv(e), Jv(t)) && Qv(t) ? "h" : "v" }(p, h, u), [i + ":" + r]) } function iy(e, t, n, i) { var r = Hv; return !(ry(e, i, n, r) || ry(e, i, { x: n.x + n.width, y: n.y + n.height }, r) || ry(e, i, gn(t), r)) } function ry(e, t, n, i) { return Math.abs(t[e] - n[e]) < i } function oy(e) { return L({ original: e.point.original || e.point }, e.actual) } function ay(e, t) { this._elementRegistry = e, this._graphicsFactory = t } e(Gv, Cv), Gv.prototype.layoutConnection = function (e, t) { t || (t = {}); var n, i, r = t.source || e.source, o = t.target || e.target, a = t.waypoints || e.waypoints, s = t.connectionStart, c = t.connectionEnd; return s || (s = Kv(a && a[0], r)), c || (c = Kv(a && a[a.length - 1], o)), (Er(e, "bpmn:Association") || Er(e, "bpmn:DataAssociation")) && a && !Yv(r, o) ? [].concat([s], a.slice(1, -1), [c]) : (Er(e, "bpmn:MessageFlow") ? n = function (e, t) { return { preferredLayouts: ["straight", "v:v"], preserveDocking: Uv(e, t) } }(r, o) : (Er(e, "bpmn:SequenceFlow") || Yv(r, o)) && (n = r === o ? { preferredLayouts: ty(r, e) } : Er(r, "bpmn:BoundaryEvent") ? { preferredLayouts: ny(r, o, c) } : Xv(r) || Xv(o) ? function (e) { return { preferredLayouts: ["straight", "h:h"], preserveDocking: qv(e) } }(r) : Er(r, "bpmn:Gateway") ? { preferredLayouts: ["v:h"] } : Er(o, "bpmn:Gateway") ? { preferredLayouts: ["h:v"] } : { preferredLayouts: ["h:h"] }), n && (i = Fv(Ov(r, o, s, c, a, n = L(n, t)))), i || [s, c]) }, ay.$inject = ["elementRegistry", "graphicsFactory"], ay.prototype.getCroppedWaypoints = function (e, t, n) { t = t || e.source, n = n || e.target; var i = this.getDockingPoint(e, t, !0), r = this.getDockingPoint(e, n), o = e.waypoints.slice(i.idx + 1, r.idx); return o.unshift(oy(i)), o.push(oy(r)), o }, ay.prototype.getDockingPoint = function (e, t, n) { var i, r, o = e.waypoints; return { point: r = o[i = n ? 0 : o.length - 1], actual: this._getIntersection(t, e, n) || r, idx: i } }, ay.prototype._getIntersection = function (e, t, n) { return bn(this._getShapePath(e), this._getConnectionPath(t), n) }, ay.prototype._getConnectionPath = function (e) { return this._graphicsFactory.getConnectionPath(e) }, ay.prototype._getShapePath = function (e) { return this._graphicsFactory.getShapePath(e) }, ay.prototype._getGfx = function (e) { return this._elementRegistry.getGraphics(e) }; var sy = { __init__: ["modeling", "bpmnUpdater"], __depends__: [dd, qd, Yd, Qd, Df, nm, am, lm, ea, pa, em], bpmnFactory: ["type", um], bpmnUpdater: ["type", hm], elementFactory: ["type", fm], modeling: ["type", Sv], layouter: ["type", Gv], connectionDocking: ["type", ay] }; const cy = Math.round; function py(e, t, n, i, r, o) { this._complexPreview = e, this._connectionDocking = t, this._elementFactory = n, this._eventBus = i, this._layouter = r, this._rules = o } py.prototype.create = function (e, t, n) { const i = this._complexPreview, r = this._connectionDocking, o = this._elementFactory, a = this._eventBus, s = this._layouter, p = this._rules, l = o.createShape(L({ type: t }, n)), u = a.fire("autoPlace", { source: e, shape: l }); if (!u) return; L(l, { x: u.x - cy(l.width / 2), y: u.y - cy(l.height / 2) }); const h = p.allowed("connection.create", { source: e, target: l, hints: { targetParent: e.parent } }); let d = null; h && (d = o.createConnection(h), d.waypoints = s.layoutConnection(d, { source: e, target: l }), d.waypoints = r.getCroppedWaypoints(d, e, l)), i.create({ created: [l, d].filter((e => !c(e))) }) }, py.prototype.cleanUp = function () { this._complexPreview.cleanUp() }, py.$inject = ["complexPreview", "connectionDocking", "elementFactory", "eventBus", "layouter", "rules"]; var ly = { __depends__: [bp, Kl, sy], __init__: ["appendPreview"], appendPreview: ["type", py] }, uy = Math.min, hy = Math.max; function dy(e) { e.preventDefault() } function fy(e) { e.stopPropagation() } function my(e) { this.container = e.container, this.parent = de('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'), this.content = fe("[contenteditable]", this.parent), this.keyHandler = e.keyHandler || function () { }, this.resizeHandler = e.resizeHandler || function () { }, this.autoResize = j(this.autoResize, this), this.handlePaste = j(this.handlePaste, this) } function vy(e, t) { this._eventBus = e, this._providers = [], this._textbox = new my({ container: t.getContainer(), keyHandler: j(this._handleKey, this), resizeHandler: j(this._handleResize, this) }) } my.prototype.create = function (e, t, n, i) { var r = this.parent, o = this.content, a = this.container; i = this.options = i || {}; var s = I(t = this.style = t || {}, ["width", "height", "maxWidth", "maxHeight", "minWidth", "minHeight", "left", "top", "backgroundColor", "position", "overflow", "border", "wordWrap", "textAlign", "outline", "transform"]); L(r.style, { width: e.width + "px", height: e.height + "px", maxWidth: e.maxWidth + "px", maxHeight: e.maxHeight + "px", minWidth: e.minWidth + "px", minHeight: e.minHeight + "px", left: e.x + "px", top: e.y + "px", backgroundColor: "#ffffff", position: "absolute", overflow: "visible", border: "1px solid #ccc", boxSizing: "border-box", wordWrap: "normal", textAlign: "center", outline: "none" }, s); var c = I(t, ["fontFamily", "fontSize", "fontWeight", "lineHeight", "padding", "paddingTop", "paddingRight", "paddingBottom", "paddingLeft"]); return L(o.style, { boxSizing: "border-box", width: "100%", outline: "none", wordWrap: "break-word" }, c), i.centerVertically && L(o.style, { position: "absolute", top: "50%", transform: "translate(0, -50%)" }, c), o.innerText = n, ae.bind(o, "keydown", this.keyHandler), ae.bind(o, "mousedown", fy), ae.bind(o, "paste", this.handlePaste), i.autoResize && ae.bind(o, "input", this.autoResize), i.resizable && this.resizable(t), a.appendChild(r), this.setSelection(o.lastChild, o.lastChild && o.lastChild.length), r }, my.prototype.handlePaste = function (e) { var t, n = this.options, i = this.style; if (e.preventDefault(), t = e.clipboardData ? e.clipboardData.getData("text/plain") : window.clipboardData.getData("Text"), this.insertText(t), n.autoResize) { var r = this.autoResize(i); r && this.resizeHandler(r) } }, my.prototype.insertText = function (e) { e = e.replace(/\r\n|\r|\n/g, "\n"), document.execCommand("insertText", !1, e) || this._insertTextIE(e) }, my.prototype._insertTextIE = function (e) { var t, n, i, r = this.getSelection(), o = r.startContainer, a = r.endContainer, s = r.startOffset, c = r.endOffset, p = r.commonAncestorContainer, l = (t = p.childNodes, [].slice.call(t)); if (function (e) { return e.nodeType === Node.TEXT_NODE }(p)) { var u = o.textContent; o.textContent = u.substring(0, s) + e + u.substring(c), n = o, i = s + e.length } else if (o === this.content && a === this.content) { var h = document.createTextNode(e); this.content.insertBefore(h, l[s]), n = h, i = h.textContent.length } else { var d = l.indexOf(o), f = l.indexOf(a); l.forEach((function (t, n) { n === d ? t.textContent = o.textContent.substring(0, s) + e + a.textContent.substring(c) : n > d && n <= f && ve(t) })), n = o, i = s + e.length } n && void 0 !== i && setTimeout((function () { self.setSelection(n, i) })) }, my.prototype.autoResize = function () { var e = this.parent, t = this.content, n = parseInt(this.style.fontSize) || 12; if (t.scrollHeight > e.offsetHeight || t.scrollHeight < e.offsetHeight - n) { var i = e.getBoundingClientRect(), r = t.scrollHeight; e.style.height = r + "px", this.resizeHandler({ width: i.width, height: i.height, dx: 0, dy: r - i.height }) } }, my.prototype.resizable = function () { var e = this, t = this.parent, n = this.resizeHandle, i = parseInt(this.style.minWidth) || 0, r = parseInt(this.style.minHeight) || 0, o = parseInt(this.style.maxWidth) || 1 / 0, a = parseInt(this.style.maxHeight) || 1 / 0; if (!n) { var s, c, p, l; n = this.resizeHandle = de('<div class="djs-direct-editing-resize-handle"></div>'); var u = function (n) { dy(n), fy(n); var u = uy(hy(p + n.clientX - s, i), o), h = uy(hy(l + n.clientY - c, r), a); t.style.width = u + "px", t.style.height = h + "px", e.resizeHandler({ width: p, height: l, dx: n.clientX - s, dy: n.clientY - c }) }, h = function (e) { dy(e), fy(e), ae.unbind(document, "mousemove", u, !1), ae.unbind(document, "mouseup", h, !1) }; ae.bind(n, "mousedown", (function (e) { dy(e), fy(e), s = e.clientX, c = e.clientY; var n = t.getBoundingClientRect(); p = n.width, l = n.height, ae.bind(document, "mousemove", u), ae.bind(document, "mouseup", h) })) } L(n.style, { position: "absolute", bottom: "0px", right: "0px", cursor: "nwse-resize", width: "0", height: "0", borderTop: (parseInt(this.style.fontSize) / 4 || 3) + "px solid transparent", borderRight: (parseInt(this.style.fontSize) / 4 || 3) + "px solid #ccc", borderBottom: (parseInt(this.style.fontSize) / 4 || 3) + "px solid #ccc", borderLeft: (parseInt(this.style.fontSize) / 4 || 3) + "px solid transparent" }), t.appendChild(n) }, my.prototype.destroy = function () { var e = this.parent, t = this.content, n = this.resizeHandle; t.innerText = "", e.removeAttribute("style"), t.removeAttribute("style"), ae.unbind(t, "keydown", this.keyHandler), ae.unbind(t, "mousedown", fy), ae.unbind(t, "input", this.autoResize), ae.unbind(t, "paste", this.handlePaste), n && (n.removeAttribute("style"), ve(n)), ve(e) }, my.prototype.getValue = function () { return this.content.innerText.trim() }, my.prototype.getSelection = function () { return window.getSelection().getRangeAt(0) }, my.prototype.setSelection = function (e, t) { var n = document.createRange(); null === e ? n.selectNodeContents(this.content) : (n.setStart(e, t), n.setEnd(e, t)); var i = window.getSelection(); i.removeAllRanges(), i.addRange(n) }, vy.$inject = ["eventBus", "canvas"], vy.prototype.registerProvider = function (e) { this._providers.push(e) }, vy.prototype.isActive = function (e) { return !(!this._active || e && this._active.element !== e) }, vy.prototype.cancel = function () { this._active && (this._fire("cancel"), this.close()) }, vy.prototype._fire = function (e, t) { this._eventBus.fire("directEditing." + e, t || { active: this._active }) }, vy.prototype.close = function () { this._textbox.destroy(), this._fire("deactivate"), this._active = null, this.resizable = void 0 }, vy.prototype.complete = function () { var e = this._active; if (e) { var t, n = e.context.bounds, i = this.$textbox.getBoundingClientRect(), r = this.getValue(); r === e.context.text && i.height === n.height && i.width === n.width || (t = this._textbox.container.getBoundingClientRect(), e.provider.update(e.element, r, e.context.text, { x: i.left - t.left, y: i.top - t.top, width: i.width, height: i.height })), this._fire("complete"), this.close() } }, vy.prototype.getValue = function () { return this._textbox.getValue() }, vy.prototype._handleKey = function (e) { e.stopPropagation(); var t = e.keyCode || e.charCode; return 27 === t ? (e.preventDefault(), this.cancel()) : 13 !== t || e.shiftKey ? void 0 : (e.preventDefault(), this.complete()) }, vy.prototype._handleResize = function (e) { this._fire("resize", e) }, vy.prototype.activate = function (e) { var t; this.isActive() && this.cancel(); var n = m(this._providers, (function (n) { return (t = n.activate(e)) ? n : null })); return t && (this.$textbox = this._textbox.create(t.bounds, t.style, t.text, t.options), this._active = { element: e, context: t, provider: n }, t.options && t.options.resizable && (this.resizable = !0), this._fire("activate")), !!t }; var yy = { __depends__: [Go], __init__: ["directEditing"], directEditing: ["type", vy] }; function gy(e) { return function (t) { var n = t.target, i = Cr(e), r = i.eventDefinitions && i.eventDefinitions[0], o = i.$type === n.type, a = (r && r.$type) === n.eventDefinitionType, s = !!n.triggeredByEvent == !!i.triggeredByEvent, c = void 0 === n.isExpanded || n.isExpanded === Vr(e); return !(o && a && s && c) } } var _y = [{ label: "Start event", actionName: "replace-with-none-start", className: "bpmn-icon-start-event-none", target: { type: "bpmn:StartEvent" } }, { label: "Intermediate throw event", actionName: "replace-with-none-intermediate-throwing", className: "bpmn-icon-intermediate-event-none", target: { type: "bpmn:IntermediateThrowEvent" } }, { label: "End event", actionName: "replace-with-none-end", className: "bpmn-icon-end-event-none", target: { type: "bpmn:EndEvent" } }, { label: "Message start event", actionName: "replace-with-message-start", className: "bpmn-icon-start-event-message", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:MessageEventDefinition" } }, { label: "Timer start event", actionName: "replace-with-timer-start", className: "bpmn-icon-start-event-timer", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:TimerEventDefinition" } }, { label: "Conditional start event", actionName: "replace-with-conditional-start", className: "bpmn-icon-start-event-condition", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:ConditionalEventDefinition" } }, { label: "Signal start event", actionName: "replace-with-signal-start", className: "bpmn-icon-start-event-signal", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:SignalEventDefinition" } }], by = [{ label: "Start event", actionName: "replace-with-none-start", className: "bpmn-icon-start-event-none", target: { type: "bpmn:StartEvent" } }, { label: "Intermediate throw event", actionName: "replace-with-none-intermediate-throwing", className: "bpmn-icon-intermediate-event-none", target: { type: "bpmn:IntermediateThrowEvent" } }, { label: "End event", actionName: "replace-with-none-end", className: "bpmn-icon-end-event-none", target: { type: "bpmn:EndEvent" } }], xy = [{ label: "Start event", actionName: "replace-with-none-start", className: "bpmn-icon-start-event-none", target: { type: "bpmn:StartEvent" } }, { label: "Intermediate throw event", actionName: "replace-with-none-intermediate-throw", className: "bpmn-icon-intermediate-event-none", target: { type: "bpmn:IntermediateThrowEvent" } }, { label: "End event", actionName: "replace-with-none-end", className: "bpmn-icon-end-event-none", target: { type: "bpmn:EndEvent" } }, { label: "Message intermediate catch event", actionName: "replace-with-message-intermediate-catch", className: "bpmn-icon-intermediate-event-catch-message", target: { type: "bpmn:IntermediateCatchEvent", eventDefinitionType: "bpmn:MessageEventDefinition" } }, { label: "Message intermediate throw event", actionName: "replace-with-message-intermediate-throw", className: "bpmn-icon-intermediate-event-throw-message", target: { type: "bpmn:IntermediateThrowEvent", eventDefinitionType: "bpmn:MessageEventDefinition" } }, { label: "Timer intermediate catch event", actionName: "replace-with-timer-intermediate-catch", className: "bpmn-icon-intermediate-event-catch-timer", target: { type: "bpmn:IntermediateCatchEvent", eventDefinitionType: "bpmn:TimerEventDefinition" } }, { label: "Escalation intermediate throw event", actionName: "replace-with-escalation-intermediate-throw", className: "bpmn-icon-intermediate-event-throw-escalation", target: { type: "bpmn:IntermediateThrowEvent", eventDefinitionType: "bpmn:EscalationEventDefinition" } }, { label: "Conditional intermediate catch event", actionName: "replace-with-conditional-intermediate-catch", className: "bpmn-icon-intermediate-event-catch-condition", target: { type: "bpmn:IntermediateCatchEvent", eventDefinitionType: "bpmn:ConditionalEventDefinition" } }, { label: "Link intermediate catch event", actionName: "replace-with-link-intermediate-catch", className: "bpmn-icon-intermediate-event-catch-link", target: { type: "bpmn:IntermediateCatchEvent", eventDefinitionType: "bpmn:LinkEventDefinition", eventDefinitionAttrs: { name: "" } } }, { label: "Link intermediate throw event", actionName: "replace-with-link-intermediate-throw", className: "bpmn-icon-intermediate-event-throw-link", target: { type: "bpmn:IntermediateThrowEvent", eventDefinitionType: "bpmn:LinkEventDefinition", eventDefinitionAttrs: { name: "" } } }, { label: "Compensation intermediate throw event", actionName: "replace-with-compensation-intermediate-throw", className: "bpmn-icon-intermediate-event-throw-compensation", target: { type: "bpmn:IntermediateThrowEvent", eventDefinitionType: "bpmn:CompensateEventDefinition" } }, { label: "Signal intermediate catch event", actionName: "replace-with-signal-intermediate-catch", className: "bpmn-icon-intermediate-event-catch-signal", target: { type: "bpmn:IntermediateCatchEvent", eventDefinitionType: "bpmn:SignalEventDefinition" } }, { label: "Signal intermediate throw event", actionName: "replace-with-signal-intermediate-throw", className: "bpmn-icon-intermediate-event-throw-signal", target: { type: "bpmn:IntermediateThrowEvent", eventDefinitionType: "bpmn:SignalEventDefinition" } }], wy = [{ label: "Start event", actionName: "replace-with-none-start", className: "bpmn-icon-start-event-none", target: { type: "bpmn:StartEvent" } }, { label: "Intermediate throw event", actionName: "replace-with-none-intermediate-throw", className: "bpmn-icon-intermediate-event-none", target: { type: "bpmn:IntermediateThrowEvent" } }, { label: "End event", actionName: "replace-with-none-end", className: "bpmn-icon-end-event-none", target: { type: "bpmn:EndEvent" } }, { label: "Message end event", actionName: "replace-with-message-end", className: "bpmn-icon-end-event-message", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:MessageEventDefinition" } }, { label: "Escalation end event", actionName: "replace-with-escalation-end", className: "bpmn-icon-end-event-escalation", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:EscalationEventDefinition" } }, { label: "Error end event", actionName: "replace-with-error-end", className: "bpmn-icon-end-event-error", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:ErrorEventDefinition" } }, { label: "Cancel end event", actionName: "replace-with-cancel-end", className: "bpmn-icon-end-event-cancel", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:CancelEventDefinition" } }, { label: "Compensation end event", actionName: "replace-with-compensation-end", className: "bpmn-icon-end-event-compensation", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:CompensateEventDefinition" } }, { label: "Signal end event", actionName: "replace-with-signal-end", className: "bpmn-icon-end-event-signal", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:SignalEventDefinition" } }, { label: "Terminate end event", actionName: "replace-with-terminate-end", className: "bpmn-icon-end-event-terminate", target: { type: "bpmn:EndEvent", eventDefinitionType: "bpmn:TerminateEventDefinition" } }], Ey = [{ label: "Exclusive gateway", actionName: "replace-with-exclusive-gateway", className: "bpmn-icon-gateway-xor", target: { type: "bpmn:ExclusiveGateway" } }, { label: "Parallel gateway", actionName: "replace-with-parallel-gateway", className: "bpmn-icon-gateway-parallel", target: { type: "bpmn:ParallelGateway" } }, { label: "Inclusive gateway", actionName: "replace-with-inclusive-gateway", className: "bpmn-icon-gateway-or", target: { type: "bpmn:InclusiveGateway" } }, { label: "Complex gateway", actionName: "replace-with-complex-gateway", className: "bpmn-icon-gateway-complex", target: { type: "bpmn:ComplexGateway" } }, { label: "Event-based gateway", actionName: "replace-with-event-based-gateway", className: "bpmn-icon-gateway-eventbased", target: { type: "bpmn:EventBasedGateway", instantiate: !1, eventGatewayType: "Exclusive" } }], Sy = [{ label: "Transaction", actionName: "replace-with-transaction", className: "bpmn-icon-transaction", target: { type: "bpmn:Transaction", isExpanded: !0 } }, { label: "Event sub-process", actionName: "replace-with-event-subprocess", className: "bpmn-icon-event-subprocess-expanded", target: { type: "bpmn:SubProcess", triggeredByEvent: !0, isExpanded: !0 } }, { label: "Sub-process (collapsed)", actionName: "replace-with-collapsed-subprocess", className: "bpmn-icon-subprocess-collapsed", target: { type: "bpmn:SubProcess", isExpanded: !1 } }], Cy = [{ label: "Transaction", actionName: "replace-with-transaction", className: "bpmn-icon-transaction", target: { type: "bpmn:Transaction", isExpanded: !0 } }, { label: "Sub-process", actionName: "replace-with-subprocess", className: "bpmn-icon-subprocess-expanded", target: { type: "bpmn:SubProcess", isExpanded: !0 } }, { label: "Event sub-process", actionName: "replace-with-event-subprocess", className: "bpmn-icon-event-subprocess-expanded", target: { type: "bpmn:SubProcess", triggeredByEvent: !0, isExpanded: !0 } }], ky = Cy, Ry = [{ label: "Task", actionName: "replace-with-task", className: "bpmn-icon-task", target: { type: "bpmn:Task" } }, { label: "User task", actionName: "replace-with-user-task", className: "bpmn-icon-user", target: { type: "bpmn:UserTask" } }, { label: "Service task", actionName: "replace-with-service-task", className: "bpmn-icon-service", target: { type: "bpmn:ServiceTask" } }, { label: "Send task", actionName: "replace-with-send-task", className: "bpmn-icon-send", target: { type: "bpmn:SendTask" } }, { label: "Receive task", actionName: "replace-with-receive-task", className: "bpmn-icon-receive", target: { type: "bpmn:ReceiveTask" } }, { label: "Manual task", actionName: "replace-with-manual-task", className: "bpmn-icon-manual", target: { type: "bpmn:ManualTask" } }, { label: "Business rule task", actionName: "replace-with-rule-task", className: "bpmn-icon-business-rule", target: { type: "bpmn:BusinessRuleTask" } }, { label: "Script task", actionName: "replace-with-script-task", className: "bpmn-icon-script", target: { type: "bpmn:ScriptTask" } }, { label: "Call activity", actionName: "replace-with-call-activity", className: "bpmn-icon-call-activity", target: { type: "bpmn:CallActivity" } }, { label: "Sub-process (collapsed)", actionName: "replace-with-collapsed-subprocess", className: "bpmn-icon-subprocess-collapsed", target: { type: "bpmn:SubProcess", isExpanded: !1 } }, { label: "Sub-process (expanded)", actionName: "replace-with-expanded-subprocess", className: "bpmn-icon-subprocess-expanded", target: { type: "bpmn:SubProcess", isExpanded: !0 } }], Py = [{ label: "Data store reference", actionName: "replace-with-data-store-reference", className: "bpmn-icon-data-store", target: { type: "bpmn:DataStoreReference" } }], Ty = [{ label: "Data object reference", actionName: "replace-with-data-object-reference", className: "bpmn-icon-data-object", target: { type: "bpmn:DataObjectReference" } }], Ay = [{ label: "Message boundary event", actionName: "replace-with-message-boundary", className: "bpmn-icon-intermediate-event-catch-message", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:MessageEventDefinition", cancelActivity: !0 } }, { label: "Timer boundary event", actionName: "replace-with-timer-boundary", className: "bpmn-icon-intermediate-event-catch-timer", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:TimerEventDefinition", cancelActivity: !0 } }, { label: "Escalation boundary event", actionName: "replace-with-escalation-boundary", className: "bpmn-icon-intermediate-event-catch-escalation", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:EscalationEventDefinition", cancelActivity: !0 } }, { label: "Conditional boundary event", actionName: "replace-with-conditional-boundary", className: "bpmn-icon-intermediate-event-catch-condition", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:ConditionalEventDefinition", cancelActivity: !0 } }, { label: "Error boundary event", actionName: "replace-with-error-boundary", className: "bpmn-icon-intermediate-event-catch-error", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:ErrorEventDefinition", cancelActivity: !0 } }, { label: "Cancel boundary event", actionName: "replace-with-cancel-boundary", className: "bpmn-icon-intermediate-event-catch-cancel", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:CancelEventDefinition", cancelActivity: !0 } }, { label: "Signal boundary event", actionName: "replace-with-signal-boundary", className: "bpmn-icon-intermediate-event-catch-signal", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:SignalEventDefinition", cancelActivity: !0 } }, { label: "Compensation boundary event", actionName: "replace-with-compensation-boundary", className: "bpmn-icon-intermediate-event-catch-compensation", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:CompensateEventDefinition", cancelActivity: !0 } }, { label: "Message boundary event (non-interrupting)", actionName: "replace-with-non-interrupting-message-boundary", className: "bpmn-icon-intermediate-event-catch-non-interrupting-message", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:MessageEventDefinition", cancelActivity: !1 } }, { label: "Timer boundary event (non-interrupting)", actionName: "replace-with-non-interrupting-timer-boundary", className: "bpmn-icon-intermediate-event-catch-non-interrupting-timer", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:TimerEventDefinition", cancelActivity: !1 } }, { label: "Escalation boundary event (non-interrupting)", actionName: "replace-with-non-interrupting-escalation-boundary", className: "bpmn-icon-intermediate-event-catch-non-interrupting-escalation", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:EscalationEventDefinition", cancelActivity: !1 } }, { label: "Conditional boundary event (non-interrupting)", actionName: "replace-with-non-interrupting-conditional-boundary", className: "bpmn-icon-intermediate-event-catch-non-interrupting-condition", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:ConditionalEventDefinition", cancelActivity: !1 } }, { label: "Signal boundary event (non-interrupting)", actionName: "replace-with-non-interrupting-signal-boundary", className: "bpmn-icon-intermediate-event-catch-non-interrupting-signal", target: { type: "bpmn:BoundaryEvent", eventDefinitionType: "bpmn:SignalEventDefinition", cancelActivity: !1 } }], My = [{ label: "Message start event", actionName: "replace-with-message-start", className: "bpmn-icon-start-event-message", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:MessageEventDefinition", isInterrupting: !0 } }, { label: "Timer start event", actionName: "replace-with-timer-start", className: "bpmn-icon-start-event-timer", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:TimerEventDefinition", isInterrupting: !0 } }, { label: "Conditional start event", actionName: "replace-with-conditional-start", className: "bpmn-icon-start-event-condition", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:ConditionalEventDefinition", isInterrupting: !0 } }, { label: "Signal start event", actionName: "replace-with-signal-start", className: "bpmn-icon-start-event-signal", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:SignalEventDefinition", isInterrupting: !0 } }, { label: "Error start event", actionName: "replace-with-error-start", className: "bpmn-icon-start-event-error", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:ErrorEventDefinition", isInterrupting: !0 } }, { label: "Escalation start event", actionName: "replace-with-escalation-start", className: "bpmn-icon-start-event-escalation", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:EscalationEventDefinition", isInterrupting: !0 } }, { label: "Compensation start event", actionName: "replace-with-compensation-start", className: "bpmn-icon-start-event-compensation", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:CompensateEventDefinition", isInterrupting: !0 } }, { label: "Message start event (non-interrupting)", actionName: "replace-with-non-interrupting-message-start", className: "bpmn-icon-start-event-non-interrupting-message", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:MessageEventDefinition", isInterrupting: !1 } }, { label: "Timer start event (non-interrupting)", actionName: "replace-with-non-interrupting-timer-start", className: "bpmn-icon-start-event-non-interrupting-timer", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:TimerEventDefinition", isInterrupting: !1 } }, { label: "Conditional start event (non-interrupting)", actionName: "replace-with-non-interrupting-conditional-start", className: "bpmn-icon-start-event-non-interrupting-condition", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:ConditionalEventDefinition", isInterrupting: !1 } }, { label: "Signal start event (non-interrupting)", actionName: "replace-with-non-interrupting-signal-start", className: "bpmn-icon-start-event-non-interrupting-signal", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:SignalEventDefinition", isInterrupting: !1 } }, { label: "Escalation start event (non-interrupting)", actionName: "replace-with-non-interrupting-escalation-start", className: "bpmn-icon-start-event-non-interrupting-escalation", target: { type: "bpmn:StartEvent", eventDefinitionType: "bpmn:EscalationEventDefinition", isInterrupting: !1 } }], Dy = [{ label: "Sequence flow", actionName: "replace-with-sequence-flow", className: "bpmn-icon-connection" }, { label: "Default flow", actionName: "replace-with-default-flow", className: "bpmn-icon-default-flow" }, { label: "Conditional flow", actionName: "replace-with-conditional-flow", className: "bpmn-icon-conditional-flow" }], By = [{ label: "Expanded pool/participant", actionName: "replace-with-expanded-pool", className: "bpmn-icon-participant", target: { type: "bpmn:Participant", isExpanded: !0 } }, { label: function (e) { var t = "Empty pool/participant"; return e.children && e.children.length && (t += " (removes content)"), t }, actionName: "replace-with-collapsed-pool", className: "bpmn-icon-lane", target: { type: "bpmn:Participant", isExpanded: !1 } }], Ny = { "start-event-non-interrupting": '\n  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(0 995.64)">\n      <path d="m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z" fill="none" stroke="currentColor" stroke-dasharray="418.310422, 361.2328165" stroke-linecap="round" stroke-width="100"/>\n    </g>\n  </svg>', "intermediate-event-non-interrupting": '\n  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">\n     <g transform="translate(0 995.64)" fill="none" stroke="currentColor" stroke-linecap="round">\n        <circle cx="1024" cy="28.357" r="875" stroke-dasharray="418.310422, 361.2328165" stroke-width="100"/>\n        <circle cx="1024" cy="28.357" r="685" stroke-dasharray="348.31044857,261.23283643" stroke-dashoffset="500" stroke-width="100"/>\n     </g>\n  </svg>' }; function Oy(e, t, n, i, r, o, a, s) { this._bpmnFactory = e, this._popupMenu = t, this._modeling = n, this._moddle = i, this._bpmnReplace = r, this._rules = o, this._translate = a, this._moddleCopy = s, this._register() } Oy.$inject = ["bpmnFactory", "popupMenu", "modeling", "moddle", "bpmnReplace", "rules", "translate", "moddleCopy"], Oy.prototype._register = function () { this._popupMenu.registerProvider("bpmn-replace", this) }, Oy.prototype.getPopupMenuEntries = function (e) { var t = e.businessObject, n = this._rules, i = []; if (p(e) || !n.allowed("shape.replace", { element: e })) return {}; var r = gy(e); return Er(t, "bpmn:DataObjectReference") ? this._createEntries(e, Py) : Er(t, "bpmn:DataStoreReference") && !Er(e.parent, "bpmn:Collaboration") ? this._createEntries(e, Ty) : Er(t, "bpmn:StartEvent") && !Er(t.$parent, "bpmn:SubProcess") ? (i = y(_y, r), this._createEntries(e, i)) : Er(t, "bpmn:Participant") ? (i = y(By, (function (t) { return Vr(e) !== t.target.isExpanded })), this._createEntries(e, i)) : Er(t, "bpmn:StartEvent") && Gr(t.$parent) ? (i = y(My, (function (e) { var n = !1 !== e.target.isInterrupting, i = t.isInterrupting === n; return r(e) || !r(e) && !i })), this._createEntries(e, i)) : Er(t, "bpmn:StartEvent") && !Gr(t.$parent) && Er(t.$parent, "bpmn:SubProcess") ? (i = y(by, r), this._createEntries(e, i)) : Er(t, "bpmn:EndEvent") ? (i = y(wy, (function (e) { return !("bpmn:CancelEventDefinition" == e.target.eventDefinitionType && !Er(t.$parent, "bpmn:Transaction")) && r(e) })), this._createEntries(e, i)) : Er(t, "bpmn:BoundaryEvent") ? (i = y(Ay, (function (e) { var n = e.target; if ("bpmn:CancelEventDefinition" == n.eventDefinitionType && !Er(t.attachedToRef, "bpmn:Transaction")) return !1; var i = !1 !== n.cancelActivity, o = t.cancelActivity == i; return r(e) || !r(e) && !o })), this._createEntries(e, i)) : Er(t, "bpmn:IntermediateCatchEvent") || Er(t, "bpmn:IntermediateThrowEvent") ? (i = y(xy, r), this._createEntries(e, i)) : Er(t, "bpmn:Gateway") ? (i = y(Ey, r), this._createEntries(e, i)) : Er(t, "bpmn:Transaction") ? (i = y(Cy, r), this._createEntries(e, i)) : Gr(t) && Vr(e) ? (i = y(ky, r), this._createEntries(e, i)) : Er(t, "bpmn:SubProcess") && Vr(e) ? (i = y(Sy, r), this._createEntries(e, i)) : Er(t, "bpmn:AdHocSubProcess") && !Vr(e) ? (i = y(Ry, (function (e) { var t = e.target, n = "bpmn:SubProcess" === t.type, i = !0 === t.isExpanded; return gy(t) && (!n || i) })), this._createEntries(e, i)) : Er(t, "bpmn:SequenceFlow") ? this._createSequenceFlowEntries(e, Dy) : Er(t, "bpmn:FlowNode") ? (i = y(Ry, r), Er(t, "bpmn:SubProcess") && !Vr(e) && (i = y(i, (function (e) { return "Sub-process (collapsed)" !== e.label }))), this._createEntries(e, i)) : {} }, Oy.prototype.getPopupMenuHeaderEntries = function (e) { var t = {}; return Er(e, "bpmn:Activity") && !Gr(e) && (t = { ...t, ...this._getLoopCharacteristicsHeaderEntries(e) }), Er(e, "bpmn:DataObjectReference") && (t = { ...t, ...this._getCollectionHeaderEntries(e) }), Er(e, "bpmn:Participant") && (t = { ...t, ...this._getParticipantMultiplicityHeaderEntries(e) }), !Er(e, "bpmn:SubProcess") || Er(e, "bpmn:Transaction") || Gr(e) || (t = { ...t, ...this._getAdHocHeaderEntries(e) }), kh(e) && (t = { ...t, ...this._getNonInterruptingHeaderEntries(e) }), t }, Oy.prototype._createEntries = function (e, t) { var n = {}, i = this; return g(t, (function (t) { n[t.actionName] = i._createEntry(t, e) })), n }, Oy.prototype._createSequenceFlowEntries = function (e, t) { var n = Cr(e), i = {}, r = this._modeling, o = this._moddle, a = this; return g(t, (function (t) { switch (t.actionName) { case "replace-with-default-flow": n.sourceRef.default !== n && (Er(n.sourceRef, "bpmn:ExclusiveGateway") || Er(n.sourceRef, "bpmn:InclusiveGateway") || Er(n.sourceRef, "bpmn:ComplexGateway") || Er(n.sourceRef, "bpmn:Activity")) && (i = { ...i, [t.actionName]: a._createEntry(t, e, (function () { r.updateProperties(e.source, { default: n }) })) }); break; case "replace-with-conditional-flow": !n.conditionExpression && Er(n.sourceRef, "bpmn:Activity") && (i = { ...i, [t.actionName]: a._createEntry(t, e, (function () { var t = o.create("bpmn:FormalExpression", { body: "" }); r.updateProperties(e, { conditionExpression: t }) })) }); break; default: Er(n.sourceRef, "bpmn:Activity") && n.conditionExpression && (i = { ...i, [t.actionName]: a._createEntry(t, e, (function () { r.updateProperties(e, { conditionExpression: void 0 }) })) }), (Er(n.sourceRef, "bpmn:ExclusiveGateway") || Er(n.sourceRef, "bpmn:InclusiveGateway") || Er(n.sourceRef, "bpmn:ComplexGateway") || Er(n.sourceRef, "bpmn:Activity")) && n.sourceRef.default === n && (i = { ...i, [t.actionName]: a._createEntry(t, e, (function () { r.updateProperties(e.source, { default: void 0 }) })) }) } })), i }, Oy.prototype._createEntry = function (e, t, n) { var i = this._translate, r = this._bpmnReplace.replaceElement, o = e.label; return o && "function" == typeof o && (o = o(t)), n = n || function () { return r(t, e.target) }, { label: i(o), className: e.className, action: n } }, Oy.prototype._getLoopCharacteristicsHeaderEntries = function (e) { var t = this, n = this._translate; function i(n, i) { if (i.active) return void t._modeling.updateProperties(e, { loopCharacteristics: void 0 }); const r = e.businessObject.get("loopCharacteristics"), o = t._moddle.create(i.options.loopCharacteristics); r && t._moddleCopy.copyElement(r, o), o.set("isSequential", i.options.isSequential), t._modeling.updateProperties(e, { loopCharacteristics: o }) } var r, o, a, s = Cr(e).loopCharacteristics; return s && (r = s.isSequential, o = void 0 === s.isSequential, a = void 0 !== s.isSequential && !s.isSequential), { "toggle-parallel-mi": { className: "bpmn-icon-parallel-mi-marker", title: n("Parallel multi-instance"), active: a, action: i, options: { loopCharacteristics: "bpmn:MultiInstanceLoopCharacteristics", isSequential: !1 } }, "toggle-sequential-mi": { className: "bpmn-icon-sequential-mi-marker", title: n("Sequential multi-instance"), active: r, action: i, options: { loopCharacteristics: "bpmn:MultiInstanceLoopCharacteristics", isSequential: !0 } }, "toggle-loop": { className: "bpmn-icon-loop-marker", title: n("Loop"), active: o, action: i, options: { loopCharacteristics: "bpmn:StandardLoopCharacteristics" } } } }, Oy.prototype._getCollectionHeaderEntries = function (e) { var t = this, n = this._translate, i = e.businessObject.dataObjectRef; if (!i) return {}; var r = i.isCollection; return { "toggle-is-collection": { className: "bpmn-icon-parallel-mi-marker", title: n("Collection"), active: r, action: function (n, r) { t._modeling.updateModdleProperties(e, i, { isCollection: !r.active }) } } } }, Oy.prototype._getParticipantMultiplicityHeaderEntries = function (e) { var t = this, n = this._bpmnFactory, i = this._translate; var r = e.businessObject.participantMultiplicity; return { "toggle-participant-multiplicity": { className: "bpmn-icon-parallel-mi-marker", title: i("Participant multiplicity"), active: !!r, action: function (i, r) { var o; r.active || (o = n.create("bpmn:ParticipantMultiplicity")), t._modeling.updateProperties(e, { participantMultiplicity: o }) } } } }, Oy.prototype._getAdHocHeaderEntries = function (e) { var t = this._translate, n = Er(Cr(e), "bpmn:AdHocSubProcess"), i = this._bpmnReplace.replaceElement; return { "toggle-adhoc": { className: "bpmn-icon-ad-hoc-marker", title: t("Ad-hoc"), active: n, action: function (t, r) { return i(e, n ? { type: "bpmn:SubProcess" } : { type: "bpmn:AdHocSubProcess" }, { autoResize: !1, layoutConnection: !1 }) } } } }, Oy.prototype._getNonInterruptingHeaderEntries = function (e) { const t = this._translate, n = Cr(e), i = this, r = Rh(e), o = Er(e, "bpmn:BoundaryEvent") ? Ny["intermediate-event-non-interrupting"] : Ny["start-event-non-interrupting"], a = !n[r]; return { "toggle-non-interrupting": { imageHtml: o, title: t("Toggle non-interrupting"), active: a, action: function () { i._modeling.updateProperties(e, { [r]: !!a }) } } } }; var jy = { __depends__: [Zc, Df, bp], __init__: ["replaceMenuProvider"], replaceMenuProvider: ["type", Oy] }; function Ly(e, t, n, i, r, o, a, s, c, p, l, u, h) { e = e || {}, i.registerProvider(this), this._contextPad = i, this._modeling = r, this._elementFactory = o, this._connect = a, this._create = s, this._popupMenu = c, this._canvas = p, this._rules = l, this._translate = u, this._eventBus = n, this._appendPreview = h, !1 !== e.autoPlace && (this._autoPlace = t.get("autoPlace", !1)), n.on("create.end", 250, (function (e) { var t = e.context.shape; if (Fo(e) && i.isOpen(t)) { var n = i.getEntries(t); n.replace && n.replace.action.click(e, t) } })) } function Iy(e, t, n) { var i = e.$instanceOf(t), r = !1; return g(e.eventDefinitions || [], (function (e) { e.$type === n && (r = !0) })), i && r } Ly.$inject = ["config.contextPad", "injector", "eventBus", "contextPad", "modeling", "elementFactory", "connect", "create", "popupMenu", "canvas", "rules", "translate", "appendPreview"], Ly.prototype.getMultiElementContextPadEntries = function (e) { var t = this._modeling, n = {}; return this._isDeleteAllowed(e) && L(n, { delete: { group: "edit", className: "bpmn-icon-trash", title: this._translate("Remove"), action: { click: function (e, n) { t.removeElements(n.slice()) } } } }), n }, Ly.prototype._isDeleteAllowed = function (e) { var t = this._rules.allowed("elements.delete", { elements: e }); return p(t) ? x(t, (function (e) { return n = e, -1 !== t.indexOf(n); var n })) : t }, Ly.prototype.getContextPadEntries = function (e) { var t = this._contextPad, n = this._modeling, i = this._elementFactory, r = this._connect, o = this._create, a = this._popupMenu, s = this._rules, c = this._autoPlace, l = this._translate, u = this._appendPreview, h = {}; if ("label" === e.type) return h; var d = e.businessObject; function f(e, t) { r.start(e, t) } function m(e, t, n, r) { function a(t, n) { var a = i.createShape(L({ type: e }, r)); o.start(t, a, { source: n }), u.cleanUp() } var s = c ? function (t, n) { var o = i.createShape(L({ type: e }, r)); c.append(n, o), u.cleanUp() } : a, p = c ? function (t, n) { return u.create(n, e, r), () => { u.cleanUp() } } : null; return { group: "model", className: t, title: n, action: { dragstart: a, click: s, hover: p } } } function v(e) { return function (i, r) { n.splitLane(r, e), t.open(r, !0) } } if (Sr(d, ["bpmn:Lane", "bpmn:Participant"]) && Vr(e)) { var y = Du(e); L(h, { "lane-insert-above": { group: "lane-insert-above", className: "bpmn-icon-lane-insert-above", title: l("Add lane above"), action: { click: function (e, t) { n.addLane(t, "top") } } } }), y.length < 2 && (e.height >= 120 && L(h, { "lane-divide-two": { group: "lane-divide", className: "bpmn-icon-lane-divide-two", title: l("Divide into two lanes"), action: { click: v(2) } } }), e.height >= 180 && L(h, { "lane-divide-three": { group: "lane-divide", className: "bpmn-icon-lane-divide-three", title: l("Divide into three lanes"), action: { click: v(3) } } })), L(h, { "lane-insert-below": { group: "lane-insert-below", className: "bpmn-icon-lane-insert-below", title: l("Add lane below"), action: { click: function (e, t) { n.addLane(t, "bottom") } } } }) } Er(d, "bpmn:FlowNode") && (Er(d, "bpmn:EventBasedGateway") ? L(h, { "append.receive-task": m("bpmn:ReceiveTask", "bpmn-icon-receive-task", l("Append receive task")), "append.message-intermediate-event": m("bpmn:IntermediateCatchEvent", "bpmn-icon-intermediate-event-catch-message", l("Append message intermediate catch event"), { eventDefinitionType: "bpmn:MessageEventDefinition" }), "append.timer-intermediate-event": m("bpmn:IntermediateCatchEvent", "bpmn-icon-intermediate-event-catch-timer", l("Append timer intermediate catch event"), { eventDefinitionType: "bpmn:TimerEventDefinition" }), "append.condition-intermediate-event": m("bpmn:IntermediateCatchEvent", "bpmn-icon-intermediate-event-catch-condition", l("Append conditional intermediate catch event"), { eventDefinitionType: "bpmn:ConditionalEventDefinition" }), "append.signal-intermediate-event": m("bpmn:IntermediateCatchEvent", "bpmn-icon-intermediate-event-catch-signal", l("Append signal intermediate catch event"), { eventDefinitionType: "bpmn:SignalEventDefinition" }) }) : Iy(d, "bpmn:BoundaryEvent", "bpmn:CompensateEventDefinition") ? L(h, { "append.compensation-activity": m("bpmn:Task", "bpmn-icon-task", l("Append compensation activity"), { isForCompensation: !0 }) }) : Er(d, "bpmn:EndEvent") || d.isForCompensation || Iy(d, "bpmn:IntermediateThrowEvent", "bpmn:LinkEventDefinition") || Gr(d) || L(h, { "append.end-event": m("bpmn:EndEvent", "bpmn-icon-end-event-none", l("Append end event")), "append.gateway": m("bpmn:ExclusiveGateway", "bpmn-icon-gateway-none", l("Append gateway")), "append.append-task": m("bpmn:Task", "bpmn-icon-task", l("Append task")), "append.intermediate-event": m("bpmn:IntermediateThrowEvent", "bpmn-icon-intermediate-event-none", l("Append intermediate/boundary event")) })), a.isEmpty(e, "bpmn-replace") || L(h, { replace: { group: "edit", className: "bpmn-icon-screw-wrench", title: l("Change type"), action: { click: function (e, n) { var i = L(function (e) { var n = t.getPad(e).html.getBoundingClientRect(); return { x: n.left, y: n.bottom + 5 } }(n), { cursor: { x: e.x, y: e.y } }); a.open(n, "bpmn-replace", i, { title: l("Change element"), width: 300, search: !0 }) } } } }), Er(d, "bpmn:SequenceFlow") && L(h, { "append.text-annotation": m("bpmn:TextAnnotation", "bpmn-icon-text-annotation", l("Append text annotation")) }), Sr(d, ["bpmn:FlowNode", "bpmn:InteractionNode", "bpmn:DataObjectReference", "bpmn:DataStoreReference"]) && L(h, { "append.text-annotation": m("bpmn:TextAnnotation", "bpmn-icon-text-annotation", l("Append text annotation")), connect: { group: "connect", className: "bpmn-icon-connection-multi", title: l("Connect using " + (d.isForCompensation ? "" : "sequence/message flow or ") + "association"), action: { click: f, dragstart: f } } }), Er(d, "bpmn:TextAnnotation") && L(h, { connect: { group: "connect", className: "bpmn-icon-connection-multi", title: l("Connect using association"), action: { click: f, dragstart: f } } }), Sr(d, ["bpmn:DataObjectReference", "bpmn:DataStoreReference"]) && L(h, { connect: { group: "connect", className: "bpmn-icon-connection-multi", title: l("Connect using data input association"), action: { click: f, dragstart: f } } }), Er(d, "bpmn:Group") && L(h, { "append.text-annotation": m("bpmn:TextAnnotation", "bpmn-icon-text-annotation", l("Append text annotation")) }); var g = s.allowed("elements.delete", { elements: [e] }); return p(g) && (g = g[0] === e), g && L(h, { delete: { group: "edit", className: "bpmn-icon-trash", title: l("Remove"), action: { click: function (e, t) { n.removeElements([t]) } } } }), h }; var $y = { __depends__: [ly, yy, Is, ea, $l, uf, jy], __init__: ["contextPadProvider"], contextPadProvider: ["type", Ly] }, Fy = { horizontal: ["x", "width"], vertical: ["y", "height"] }; function zy(e, t) { this._modeling = e, this._filters = [], this.registerFilter((function (e) { var n = t.allowed("elements.distribute", { elements: e }); return p(n) ? n : n ? e : [] })) } zy.$inject = ["modeling", "rules"], zy.prototype.registerFilter = function (e) { if ("function" != typeof e) throw new Error("the filter has to be a function"); this._filters.push(e) }, zy.prototype.trigger = function (e, t) { var n, i, r = this._modeling; if (!(e.length < 3 || (this._setOrientation(t), i = this._filterElements(e), (n = this._createGroups(i)).length <= 2))) return r.distributeElements(n, this._axis, this._dimension), n }, zy.prototype._filterElements = function (e) { var t = this._filters, n = this._axis, i = this._dimension, r = [].concat(e); return t.length ? (g(t, (function (e) { r = e(r, n, i) })), r) : e }, zy.prototype._createGroups = function (e) { var t = [], n = this, i = this._axis, r = this._dimension; if (!i) throw new Error('must have a defined "axis" and "dimension"'); return g(T(e, i), (function (e, o) { var a, s = n._findRange(e, i, r), c = t[t.length - 1]; c && n._hasIntersection(c.range, s) ? t[t.length - 1].elements.push(e) : (a = { range: s, elements: [e] }, t.push(a)) })), t }, zy.prototype._setOrientation = function (e) { var t = Fy[e]; this._axis = t[0], this._dimension = t[1] }, zy.prototype._hasIntersection = function (e, t) { return Math.max(e.min, e.max) >= Math.min(t.min, t.max) && Math.min(e.min, e.max) <= Math.max(t.min, t.max) }, zy.prototype._findRange = function (e) { var t = e[this._axis]; return { min: t + 5, max: t + e[this._dimension] - 5 } }; var Hy = { __init__: ["distributeElements"], distributeElements: ["type", zy] }; function Vy(e) { np.call(this, e) } Vy.$inject = ["eventBus"], e(Vy, np), Vy.prototype.init = function () { this.addRule("elements.distribute", (function (e) { var t = e.elements; return !((t = ut(t = y(t, (function (e) { var t = Sr(e, ["bpmn:Association", "bpmn:BoundaryEvent", "bpmn:DataInputAssociation", "bpmn:DataOutputAssociation", "bpmn:Lane", "bpmn:MessageFlow", "bpmn:SequenceFlow", "bpmn:TextAnnotation"]); return !(e.labelTarget || t) })))).length < 3) && t })) }; var Wy = { horizontal: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n                <polyline points="450 400 450 150 1350 150 1350 400" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>\n                <rect x="150" y="450" width="600" height="1200" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n                <rect x="1050" y="450" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n              </svg>', vertical: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">\n              <polyline points="400 1350 150 1350 150 450 400 450" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>\n              <rect x="450" y="150" width="1200" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>\n              <rect x="450" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>\n            </svg>' }; function Gy(e, t, n, i) { this._distributeElements = t, this._translate = n, this._popupMenu = e, this._rules = i, e.registerProvider("align-elements", 900, this) } Gy.$inject = ["popupMenu", "distributeElements", "translate", "rules"], Gy.prototype.getPopupMenuEntries = function (e) { var t = {}; return this._isAllowed(e) && L(t, this._getEntries(e)), t }, Gy.prototype._isAllowed = function (e) { return this._rules.allowed("elements.distribute", { elements: e }) }, Gy.prototype._getEntries = function (e) { var t = this._distributeElements, n = this._translate, i = this._popupMenu; return { "distribute-elements-horizontal": { group: "distribute", title: n("Distribute elements horizontally"), className: "bjs-align-elements-menu-entry", imageHtml: Wy.horizontal, action: function (n, r) { t.trigger(e, "horizontal"), i.close() } }, "distribute-elements-vertical": { group: "distribute", title: n("Distribute elements vertically"), imageHtml: Wy.vertical, action: function (n, r) { t.trigger(e, "vertical"), i.close() } } } }; var Uy = { __depends__: [Zc, Hy], __init__: ["bpmnDistributeElements", "distributeElementsMenuProvider"], bpmnDistributeElements: ["type", Vy], distributeElementsMenuProvider: ["type", Gy] }, qy = "is not a registered action"; function Ky(e, t) { this._actions = {}; var n = this; e.on("diagram.init", (function () { n._registerDefaultActions(t), e.fire("editorActions.init", { editorActions: n }) })) } function Yy(e, t) { return new Error(e + " " + t) } Ky.$inject = ["eventBus", "injector"], Ky.prototype._registerDefaultActions = function (e) { var t = e.get("commandStack", !1), n = e.get("modeling", !1), i = e.get("selection", !1), r = e.get("zoomScroll", !1), o = e.get("copyPaste", !1), a = e.get("canvas", !1), s = e.get("rules", !1), c = e.get("keyboardMove", !1), l = e.get("keyboardMoveSelection", !1); t && (this.register("undo", (function () { t.undo() })), this.register("redo", (function () { t.redo() }))), o && i && this.register("copy", (function () { var e = i.get(); if (e.length) return o.copy(e) })), o && this.register("paste", (function () { o.paste() })), r && this.register("stepZoom", (function (e) { r.stepZoom(e.value) })), a && this.register("zoom", (function (e) { a.zoom(e.value) })), n && i && s && this.register("removeSelection", (function () { var e = i.get(); if (e.length) { var t, r = s.allowed("elements.delete", { elements: e }); !1 !== r && (t = p(r) ? r : e).length && n.removeElements(t.slice()) } })), c && this.register("moveCanvas", (function (e) { c.moveCanvas(e) })), l && this.register("moveSelection", (function (e) { l.moveSelection(e.direction, e.accelerated) })) }, Ky.prototype.trigger = function (e, t) { if (!this._actions[e]) throw Yy(e, qy); return this._actions[e](t) }, Ky.prototype.register = function (e, t) { var n = this; if ("string" == typeof e) return this._registerAction(e, t); g(e, (function (e, t) { n._registerAction(t, e) })) }, Ky.prototype._registerAction = function (e, t) { if (this.isRegistered(e)) throw Yy(e, "is already registered"); this._actions[e] = t }, Ky.prototype.unregister = function (e) { if (!this.isRegistered(e)) throw Yy(e, qy); this._actions[e] = void 0 }, Ky.prototype.getActions = function () { return Object.keys(this._actions) }, Ky.prototype.isRegistered = function (e) { return !!this._actions[e] }; var Xy = { __init__: ["editorActions"], editorActions: ["type", Ky] }; function Zy(e) { e.invoke(Ky, this) } e(Zy, Ky), Zy.$inject = ["injector"], Zy.prototype._registerDefaultActions = function (e) { Ky.prototype._registerDefaultActions.call(this, e); var t = e.get("canvas", !1), n = e.get("elementRegistry", !1), i = e.get("selection", !1), r = e.get("spaceTool", !1), o = e.get("lassoTool", !1), a = e.get("handTool", !1), s = e.get("globalConnect", !1), c = e.get("distributeElements", !1), p = e.get("alignElements", !1), l = e.get("directEditing", !1), u = e.get("searchPad", !1), h = e.get("modeling", !1), d = e.get("contextPad", !1); t && n && i && this._registerAction("selectElements", (function () { var e = t.getRootElement(), r = n.filter((function (t) { return t !== e })); return i.select(r), r })), r && this._registerAction("spaceTool", (function () { r.toggle() })), o && this._registerAction("lassoTool", (function () { o.toggle() })), a && this._registerAction("handTool", (function () { a.toggle() })), s && this._registerAction("globalConnectTool", (function () { s.toggle() })), i && c && this._registerAction("distributeElements", (function (e) { var t = i.get(), n = e.type; t.length && c.trigger(t, n) })), i && p && this._registerAction("alignElements", (function (e) { var t = i.get(), n = [], r = e.type; t.length && (n = y(t, (function (e) { return !Er(e, "bpmn:Lane") })), p.trigger(n, r)) })), i && h && this._registerAction("setColor", (function (e) { var t = i.get(); t.length && h.setColor(t, e) })), i && l && this._registerAction("directEditing", (function () { var e = i.get(); e.length && l.activate(e[0]) })), u && this._registerAction("find", (function () { u.toggle() })), t && h && this._registerAction("moveToOrigin", (function () { var e, i, r = t.getRootElement(); e = vt(i = Er(r, "bpmn:Collaboration") ? n.filter((function (e) { return Er(e.parent, "bpmn:Collaboration") })) : n.filter((function (e) { return e !== r && !Er(e.parent, "bpmn:SubProcess") }))), h.moveElements(i, { x: -e.x, y: -e.y }, r) })), i && d && this._registerAction("replaceElement", (function (e) { d.triggerEntry("replace", "click", e) })) }; var Qy = { __depends__: [Xy], editorActions: ["type", Zy] }; function Jy(e) { e.on(["create.init", "shape.move.init"], (function (e) { var t = e.context; Sr(e.shape, ["bpmn:Participant", "bpmn:SubProcess", "bpmn:TextAnnotation"]) && (t.gridSnappingContext || (t.gridSnappingContext = {}), t.gridSnappingContext.snapLocation = "top-left") })) } Jy.$inject = ["eventBus"]; function eg(e, t, n) { return n || (n = "round"), Math[n](e / t) * t } function tg(e, t, n) { var i = !n || !1 !== n.active; this._eventBus = t; var r = this; t.on("diagram.init", 800, (function () { r.setActive(i) })), t.on(["create.move", "create.end", "bendpoint.move.move", "bendpoint.move.end", "connect.move", "connect.end", "connectionSegment.move.move", "connectionSegment.move.end", "resize.move", "resize.end", "shape.move.move", "shape.move.end"], 1200, (function (t) { var n = t.originalEvent; if (!(!r.active || n && Ia(n))) { var i = t.context, o = i.gridSnappingContext; o || (o = i.gridSnappingContext = {}), ["x", "y"].forEach((function (n) { var i = {}, o = function (e, t, n) { var i = e.context, r = e.shape, o = i.gridSnappingContext, a = o.snapLocation, s = o.snapOffset; if (s && u(s[t])) return s[t]; s || (s = o.snapOffset = {}); u(s[t]) || (s[t] = 0); if (!r) return s[t]; n.get(r.id) || (ng(t) ? s[t] += r[t] + r.width / 2 : s[t] += r[t] + r.height / 2); if (!a) return s[t]; "x" === t ? /left/.test(a) ? s[t] -= r.width / 2 : /right/.test(a) && (s[t] += r.width / 2) : /top/.test(a) ? s[t] -= r.height / 2 : /bottom/.test(a) && (s[t] += r.height / 2); return s[t] }(t, n, e); o && (i.offset = o); var a = function (e, t) { var n = e.context, i = n.createConstraints, r = n.resizeConstraints || {}, o = n.gridSnappingContext, a = o.snapConstraints; if (a && a[t]) return a[t]; a || (a = o.snapConstraints = {}); a[t] || (a[t] = {}); var s = n.direction; i && (ng(t) ? (a.x.min = i.left, a.x.max = i.right) : (a.y.min = i.top, a.y.max = i.bottom)); var c = r.min, p = r.max; c && (ng(t) ? rg(s) ? a.x.max = c.left : a.x.min = c.right : ig(s) ? a.y.max = c.top : a.y.min = c.bottom); p && (ng(t) ? rg(s) ? a.x.min = p.left : a.x.max = p.right : ig(s) ? a.y.min = p.top : a.y.max = p.bottom); return a[t] }(t, n); a && L(i, a), Rl(t, n) || r.snapEvent(t, n, i) })) } })) } function ng(e) { return "x" === e } function ig(e) { return -1 !== e.indexOf("n") } function rg(e) { return -1 !== e.indexOf("w") } function og(e, t) { la.call(this, e), this._gridSnapping = t; var n = this; this.preExecute("shape.resize", (function (e) { var t = e.context, i = (t.hints || {}).autoResize; if (i) { var r = t.shape, o = t.newBounds; d(i) ? t.newBounds = n.snapComplex(o, i) : t.newBounds = n.snapSimple(r, o) } })) } tg.prototype.snapEvent = function (e, t, n) { Pl(e, t, this.snapValue(e[t], n)) }, tg.prototype.getGridSpacing = function () { return 10 }, tg.prototype.snapValue = function (e, t) { var n, i, r = 0; return t && t.offset && (r = t.offset), e = eg(e += r, 10), t && t.min && u(n = t.min) && (n = eg(n + r, 10, "ceil"), e = Math.max(e, n)), t && t.max && u(i = t.max) && (i = eg(i + r, 10, "floor"), e = Math.min(e, i)), e -= r }, tg.prototype.isActive = function () { return this.active }, tg.prototype.setActive = function (e) { this.active = e, this._eventBus.fire("gridSnapping.toggle", { active: e }) }, tg.prototype.toggleActive = function () { this.setActive(!this.active) }, tg.$inject = ["elementRegistry", "eventBus", "config.gridSnapping"], og.$inject = ["eventBus", "gridSnapping", "modeling"], e(og, la), og.prototype.snapSimple = function (e, t) { var n = this._gridSnapping; return t.width = n.snapValue(t.width, { min: t.width }), t.height = n.snapValue(t.height, { min: t.height }), t.x = e.x + e.width / 2 - t.width / 2, t.y = e.y + e.height / 2 - t.height / 2, t }, og.prototype.snapComplex = function (e, t) { return /w|e/.test(t) && (e = this.snapHorizontally(e, t)), /n|s/.test(t) && (e = this.snapVertically(e, t)), e }, og.prototype.snapHorizontally = function (e, t) { var n = this._gridSnapping, i = /w/.test(t), r = /e/.test(t), o = {}; return o.width = n.snapValue(e.width, { min: e.width }), r && (i ? (o.x = n.snapValue(e.x, { max: e.x }), o.width += n.snapValue(e.x - o.x, { min: e.x - o.x })) : e.x = e.x + e.width - o.width), L(e, o), e }, og.prototype.snapVertically = function (e, t) { var n = this._gridSnapping, i = /n/.test(t), r = /s/.test(t), o = {}; return o.height = n.snapValue(e.height, { min: e.height }), i && (r ? (o.y = n.snapValue(e.y, { max: e.y }), o.height += n.snapValue(e.y - o.y, { min: e.y - o.y })) : e.y = e.y + e.height - o.height), L(e, o), e }; function ag(e, t) { e.on(["spaceTool.move", "spaceTool.end"], 2e3, (function (e) { var n, i = e.context; i.initialized && ("x" === i.axis ? (n = t.snapValue(e.dx), e.x = e.x + n - e.dx, e.dx = n) : (n = t.snapValue(e.dy), e.y = e.y + n - e.dy, e.dy = n)) })) } ag.$inject = ["eventBus", "gridSnapping"]; var sg = { __depends__: [{ __init__: ["gridSnappingResizeBehavior", "gridSnappingSpaceToolBehavior"], gridSnappingResizeBehavior: ["type", og], gridSnappingSpaceToolBehavior: ["type", ag] }], __init__: ["gridSnapping"], gridSnapping: ["type", tg] }; function cg(e, t) { e.on("autoPlace", 2e3, (function (e) { var n = e.source, i = gn(n), r = e.shape, o = yp(n, r); return ["x", "y"].forEach((function (e) { var n = {}; o[e] !== i[e] && (o[e] > i[e] ? n.min = o[e] : n.max = o[e], Er(r, "bpmn:TextAnnotation") && (!function (e) { return "x" === e }(e) ? n.offset = -r.height / 2 : n.offset = -r.width / 2), o[e] = t.snapValue(o[e], n)) })), o })) } cg.$inject = ["eventBus", "gridSnapping"]; function pg(e, t, n) { t.on(["create.start", "shape.move.start"], 1750, (function (t) { var i = t.context, r = i.shape, o = e.getRootElement(); Er(r, "bpmn:Participant") && Er(o, "bpmn:Process") && o.children.length && (i.createConstraints && (r.width = n.snapValue(r.width, { min: r.width }), r.height = n.snapValue(r.height, { min: r.height }))) })) } pg.$inject = ["canvas", "eventBus", "gridSnapping"]; function lg(e, t, n) { la.call(this, e), this._gridSnapping = t; var i = this; this.postExecuted(["connection.create", "connection.layout"], 3e3, (function (e) { var t = e.context, r = t.connection, o = t.hints || {}, a = r.waypoints; o.connectionStart || o.connectionEnd || !1 === o.createElementsBehavior || function (e) { return e.length > 3 }(a) && n.updateWaypoints(r, i.snapMiddleSegments(a)) })) } function ug(e, t, n) { var i = Pt(t, n), r = {}; return function (e) { return "h" === e }(i) && (r.y = e.snapValue(t.y)), function (e) { return "v" === e }(i) && (r.x = e.snapValue(t.x)), ("x" in r || "y" in r) && (t = L({}, t, r), n = L({}, n, r)), [t, n] } lg.$inject = ["eventBus", "gridSnapping", "modeling"], e(lg, la), lg.prototype.snapMiddleSegments = function (e) { var t, n = this._gridSnapping; e = e.slice(); for (var i = 1; i < e.length - 2; i++)t = ug(n, e[i], e[i + 1]), e[i] = t[0], e[i + 1] = t[1]; return e }; var hg = { __depends__: [sg, { __init__: ["gridSnappingAutoPlaceBehavior", "gridSnappingParticipantBehavior", "gridSnappingLayoutConnectionBehavior"], gridSnappingAutoPlaceBehavior: ["type", cg], gridSnappingParticipantBehavior: ["type", pg], gridSnappingLayoutConnectionBehavior: ["type", lg] }], __init__: ["bpmnGridSnapping"], bpmnGridSnapping: ["type", Jy] }; function dg(e, t) { this._interactionEvents = t; var n = this; e.on(["interactionEvents.createHit", "interactionEvents.updateHit"], (function (e) { var t = e.element, i = e.gfx; return Er(t, "bpmn:Lane") ? n._createParticipantHit(t, i) : Er(t, "bpmn:Participant") ? Vr(t) ? n._createParticipantHit(t, i) : n._createDefaultHit(t, i) : Er(t, "bpmn:SubProcess") ? Vr(t) ? n._createSubProcessHit(t, i) : n._createDefaultHit(t, i) : void 0 })) } dg.$inject = ["eventBus", "interactionEvents"], dg.prototype._createDefaultHit = function (e, t) { return this._interactionEvents.removeHits(t), this._interactionEvents.createDefaultHit(e, t), !0 }, dg.prototype._createParticipantHit = function (e, t) { return this._interactionEvents.removeHits(t), this._interactionEvents.createBoxHit(t, "no-move", { width: e.width, height: e.height }), this._interactionEvents.createBoxHit(t, "click-stroke", { width: e.width, height: e.height }), this._interactionEvents.createBoxHit(t, "all", { width: 30, height: e.height }), !0 }, dg.prototype._createSubProcessHit = function (e, t) { return this._interactionEvents.removeHits(t), this._interactionEvents.createBoxHit(t, "no-move", { width: e.width, height: e.height }), this._interactionEvents.createBoxHit(t, "click-stroke", { width: e.width, height: e.height }), this._interactionEvents.createBoxHit(t, "all", { width: e.width, height: 30 }), !0 }; var fg = { __init__: ["bpmnInteractionEvents"], bpmnInteractionEvents: ["type", dg] }; function mg(e) { e.invoke(Ga, this) } e(mg, Ga), mg.$inject = ["injector"], mg.prototype.registerBindings = function (e, t) { function n(n, i) { t.isRegistered(n) && e.addListener(i) } Ga.prototype.registerBindings.call(this, e, t), n("selectElements", (function (n) { var i = n.keyEvent; if (e.isKey(["a", "A"], i) && e.isCmd(i)) return t.trigger("selectElements"), !0 })), n("find", (function (n) { var i = n.keyEvent; if (e.isKey(["f", "F"], i) && e.isCmd(i)) return t.trigger("find"), !0 })), n("spaceTool", (function (n) { var i = n.keyEvent; if (!e.hasModifier(i)) return e.isKey(["s", "S"], i) ? (t.trigger("spaceTool"), !0) : void 0 })), n("lassoTool", (function (n) { var i = n.keyEvent; if (!e.hasModifier(i)) return e.isKey(["l", "L"], i) ? (t.trigger("lassoTool"), !0) : void 0 })), n("handTool", (function (n) { var i = n.keyEvent; if (!e.hasModifier(i)) return e.isKey(["h", "H"], i) ? (t.trigger("handTool"), !0) : void 0 })), n("globalConnectTool", (function (n) { var i = n.keyEvent; if (!e.hasModifier(i)) return e.isKey(["c", "C"], i) ? (t.trigger("globalConnectTool"), !0) : void 0 })), n("directEditing", (function (n) { var i = n.keyEvent; if (!e.hasModifier(i)) return e.isKey(["e", "E"], i) ? (t.trigger("directEditing"), !0) : void 0 })), n("replaceElement", (function (n) { var i = n.keyEvent; if (!e.hasModifier(i)) return e.isKey(["r", "R"], i) ? (t.trigger("replaceElement", i), !0) : void 0 })) }; var vg = { __depends__: [Ua], __init__: ["keyboardBindings"], keyboardBindings: ["type", mg] }, yg = { moveSpeed: 1, moveSpeedAccelerated: 10 }, gg = "left", _g = "right", bg = "down", xg = { ArrowLeft: gg, Left: gg, ArrowUp: "up", Up: "up", ArrowRight: _g, Right: _g, ArrowDown: bg, Down: bg }, wg = { left: function (e) { return { x: -e, y: 0 } }, up: function (e) { return { x: 0, y: -e } }, right: function (e) { return { x: e, y: 0 } }, down: function (e) { return { x: 0, y: e } } }; function Eg(e, t, n, i, r) { var o = this; this._config = L({}, yg, e || {}), t.addListener(1500, (function (e) { var n = e.keyEvent, i = xg[n.key]; if (i && !t.isCmd(n)) { var r = t.isShift(n); return o.moveSelection(i, r), !0 } })), this.moveSelection = function (e, t) { var o = r.get(); if (o.length) { var a = this._config[t ? "moveSpeedAccelerated" : "moveSpeed"], s = wg[e](a); i.allowed("elements.move", { shapes: o }) && n.moveElements(o, s) } } } Eg.$inject = ["config.keyboardMoveSelection", "keyboard", "modeling", "rules", "selection"]; var Sg = { __depends__: [Ua, ea], __init__: ["keyboardMoveSelection"], keyboardMoveSelection: ["type", Eg] }; function Cg(e, t, n, i) { this._dragging = i, this._rules = t; var r = this; function o(e, t) { var n, i = e.shape, o = e.direction, a = e.resizeConstraints; e.delta = t, n = function (e, t, n) { var i = n.x, r = n.y, o = { x: e.x, y: e.y, width: e.width, height: e.height }; return -1 !== t.indexOf("n") ? (o.y = e.y + r, o.height = e.height - r) : -1 !== t.indexOf("s") && (o.height = e.height + r), -1 !== t.indexOf("e") ? o.width = e.width + i : -1 !== t.indexOf("w") && (o.x = e.x + i, o.width = e.width - i), o }(i, o, t), e.newBounds = function (e, t) { if (!t) return e; var n = mn(e); return vn({ top: Su("top", n, t), right: Su("right", n, t), bottom: Su("bottom", n, t), left: Su("left", n, t) }) }(n, a), e.canExecute = r.canResize(e) } e.on("resize.start", (function (e) { var t, n, i; t = e.context, n = t.resizeConstraints, i = t.minBounds, void 0 === n && (void 0 === i && (i = r.computeMinResizeBox(t)), t.resizeConstraints = { min: mn(i) }) })), e.on("resize.move", (function (e) { var t = { x: e.dx, y: e.dy }; o(e.context, t) })), e.on("resize.end", (function (e) { !function (e) { var t = e.shape, i = e.canExecute, r = e.newBounds; if (i) { if (!function (e, t) { return e.x !== t.x || e.y !== t.y || e.width !== t.width || e.height !== t.height }(t, r = dn(r))) return; n.resizeShape(t, r) } }(e.context) })) } function kg(e, t) { var n = gn(e), i = mn(e), r = { x: n.x, y: n.y }; return -1 !== t.indexOf("n") ? r.y = i.top : -1 !== t.indexOf("s") && (r.y = i.bottom), -1 !== t.indexOf("e") ? r.x = i.right : -1 !== t.indexOf("w") && (r.x = i.left), r } function Rg(e) { var t = "resize-"; return "n" === e || "s" === e ? t + "ns" : "e" === e || "w" === e ? t + "ew" : "nw" === e || "se" === e ? t + "nwse" : t + "nesw" } Cg.prototype.canResize = function (e) { var t = this._rules, n = I(e, ["newBounds", "shape", "delta", "direction"]); return t.allowed("shape.resize", n) }, Cg.prototype.activate = function (e, t, n) { var i, r, o = this._dragging; if ("string" == typeof n && (n = { direction: n }), !(r = (i = L({ shape: t }, n)).direction)) throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)"); o.init(e, kg(t, r), "resize", { autoActivate: !0, cursor: Rg(r), data: { shape: t, context: i } }) }, Cg.prototype.computeMinResizeBox = function (e) { var t = e.shape; return function (e, t, n, i) { var r = mn(t), o = { top: /n/.test(e) ? r.bottom - n.height : r.top, left: /w/.test(e) ? r.right - n.width : r.left, bottom: /s/.test(e) ? r.top + n.height : r.bottom, right: /e/.test(e) ? r.left + n.width : r.right }, a = i ? mn(i) : o; return vn({ top: xu(o.top, a.top), left: xu(o.left, a.left), bottom: bu(o.bottom, a.bottom), right: bu(o.right, a.right) }) }(e.direction, t, e.minDimensions || { width: 10, height: 10 }, Ru(t, e.childrenBoxPadding)) }, Cg.$inject = ["eventBus", "rules", "modeling", "dragging"]; var Pg = "djs-resizing", Tg = "resize-not-ok"; function Ag(e, t, n) { e.on("resize.move", 500, (function (e) { var i, r, o, a; i = e.context, r = i.shape, o = i.newBounds, (a = i.frame) || (a = i.frame = n.addFrame(r, t.getActiveLayer()), t.addMarker(r, Pg)), o.width > 5 && we(a, { x: o.x, width: o.width }), o.height > 5 && we(a, { y: o.y, height: o.height }), i.canExecute ? Se(a).remove(Tg) : Se(a).add(Tg) })), e.on("resize.cleanup", (function (e) { var n, i; n = e.context, i = n.shape, n.frame && ke(n.frame), t.removeMarker(i, Pg) })) } Ag.$inject = ["eventBus", "canvas", "previewSupport"]; var Mg = -6, Dg = "djs-resizer", Bg = ["n", "w", "s", "e", "nw", "ne", "se", "sw"]; function Ng(e, t, n, i) { this._resize = i, this._canvas = t; var r = this; e.on("selection.changed", (function (e) { var t = e.newSelection; r.removeResizers(), 1 === t.length && g(t, j(r.addResizer, r)) })), e.on("shape.changed", (function (e) { var t = e.element; n.isSelected(t) && (r.removeResizers(), r.addResizer(t)) })) } Ng.prototype.makeDraggable = function (e, t, n) { var i = this._resize; function r(t) { $o(t) && i.activate(t, e, n) } ae.bind(t, "mousedown", r), ae.bind(t, "touchstart", r) }, Ng.prototype._createResizer = function (e, t, n, i) { var r = this._getResizersParent(), o = function (e) { var t = { x: 0, y: 0 }; -1 !== e.indexOf("e") ? t.x = 6 : -1 !== e.indexOf("w") && (t.x = Mg); -1 !== e.indexOf("s") ? t.y = 6 : -1 !== e.indexOf("n") && (t.y = Mg); return t }(i), a = De("g"); Se(a).add(Dg), Se(a).add(Dg + "-" + e.id), Se(a).add(Dg + "-" + i), ge(r, a); var s = De("rect"); we(s, { x: -4 + o.x, y: -4 + o.y, width: 8, height: 8 }), Se(s).add(Dg + "-visual"), ge(a, s); var c = De("rect"); return we(c, { x: -10 + o.x, y: -10 + o.y, width: 20, height: 20 }), Se(c).add(Dg + "-hit"), ge(a, c), Kn(a, t, n), a }, Ng.prototype.createResizer = function (e, t) { var n = kg(e, t), i = this._createResizer(e, n.x, n.y, t); this.makeDraggable(e, i, t) }, Ng.prototype.addResizer = function (e) { var t = this; !un(e) && this._resize.canResize({ shape: e }) && g(Bg, (function (n) { t.createResizer(e, n) })) }, Ng.prototype.removeResizers = function () { Re(this._getResizersParent()) }, Ng.prototype._getResizersParent = function () { return this._canvas.getLayer("resizers") }, Ng.$inject = ["eventBus", "canvas", "selection", "resize"]; var Og = { __depends__: [Lp, Dp, Gl], __init__: ["resize", "resizePreview", "resizeHandles"], resize: ["type", Cg], resizePreview: ["type", Ag], resizeHandles: ["type", Ng] }; function jg(e, t, n, i, r, o, a) { function s(e, t) { (t || Sr(e, ["bpmn:Task", "bpmn:TextAnnotation", "bpmn:Participant"]) || Lg(e)) && i.activate(e) } this._bpmnFactory = t, this._canvas = n, this._modeling = r, this._textRenderer = a, i.registerProvider(this), e.on("element.dblclick", (function (e) { s(e.element, !0) })), e.on(["autoPlace.start", "canvas.viewbox.changing", "drag.init", "element.mousedown", "popupMenu.open", "root.set", "selection.changed"], (function () { i.isActive() && i.complete() })), e.on(["shape.remove", "connection.remove"], 2e3, (function (e) { i.isActive(e.element) && i.cancel() })), e.on(["commandStack.changed"], (function (e) { i.isActive() && i.cancel() })), e.on("directEditing.activate", (function (e) { o.removeResizers() })), e.on("create.end", 500, (function (e) { var t = e.context, n = t.shape, i = e.context.canExecute; e.isTouch || i && (t.hints && !1 === t.hints.createElementsBehavior || s(n)) })), e.on("autoPlace.end", 500, (function (e) { s(e.shape) })) } function Lg(e) { return Er(e, "bpmn:SubProcess") && !Vr(e) } jg.$inject = ["eventBus", "bpmnFactory", "canvas", "directEditing", "modeling", "resizeHandles", "textRenderer"], jg.prototype.activate = function (e) { var t = eo(e); if (void 0 !== t) { var n = { text: t }; L(n, this.getEditingBBox(e)); var i = {}; return (Sr(e, ["bpmn:Task", "bpmn:Participant", "bpmn:Lane", "bpmn:CallActivity"]) || Lg(e)) && L(i, { centerVertically: !0 }), Yr(e) && L(i, { autoResize: !0 }), Er(e, "bpmn:TextAnnotation") && L(i, { resizable: !0, autoResize: !0 }), L(n, { options: i }), n } }, jg.prototype.getEditingBBox = function (e) { var t = this._canvas, n = e.label || e, i = t.getAbsoluteBBox(n), r = i.x + i.width / 2, o = i.y + i.height / 2, a = { x: i.x, y: i.y }, s = t.zoom(), c = this._textRenderer.getDefaultStyle(), p = this._textRenderer.getExternalStyle(), l = p.fontSize * s, u = p.lineHeight, h = c.fontSize * s, d = c.lineHeight, f = { fontFamily: this._textRenderer.getDefaultStyle().fontFamily, fontWeight: this._textRenderer.getDefaultStyle().fontWeight }; if (Er(e, "bpmn:Lane") || function (e) { return Er(e, "bpmn:Participant") && Vr(e) }(e)) { var m = Wr(e); L(a, m ? { width: i.height, height: 30 * s, x: i.x - i.height / 2 + 15 * s, y: o - 30 * s / 2 } : { width: i.width, height: 30 * s }), L(f, { fontSize: h + "px", lineHeight: d, paddingTop: 7 * s + "px", paddingBottom: 7 * s + "px", paddingLeft: 5 * s + "px", paddingRight: 5 * s + "px", transform: m ? "rotate(-90deg)" : null }) } if (function (e) { return Er(e, "bpmn:Participant") && !Vr(e) }(e)) { var v = Wr(e); L(a, v ? { width: i.width, height: i.height } : { width: i.height, height: i.width, x: r - i.height / 2, y: o - i.width / 2 }), L(f, { fontSize: h + "px", lineHeight: d, paddingTop: 7 * s + "px", paddingBottom: 7 * s + "px", paddingLeft: 5 * s + "px", paddingRight: 5 * s + "px", transform: v ? null : "rotate(-90deg)" }) } (Sr(e, ["bpmn:Task", "bpmn:CallActivity"]) || Lg(e)) && (L(a, { width: i.width, height: i.height }), L(f, { fontSize: h + "px", lineHeight: d, paddingTop: 7 * s + "px", paddingBottom: 7 * s + "px", paddingLeft: 5 * s + "px", paddingRight: 5 * s + "px" })), function (e) { return Er(e, "bpmn:SubProcess") && Vr(e) }(e) && (L(a, { width: i.width, x: i.x }), L(f, { fontSize: h + "px", lineHeight: d, paddingTop: 7 * s + "px", paddingBottom: 7 * s + "px", paddingLeft: 5 * s + "px", paddingRight: 5 * s + "px" })); var y = 90 * s, g = 7 * s, _ = 4 * s; if (n.labelTarget && (L(a, { width: y, height: i.height + g + _, x: r - y / 2, y: i.y - g }), L(f, { fontSize: l + "px", lineHeight: u, paddingTop: g + "px", paddingBottom: _ + "px" })), Yr(n) && !Xr(n) && !hn(n)) { var b = Qr(e), x = t.getAbsoluteBBox({ x: b.x, y: b.y, width: 0, height: 0 }), w = l + g + _; L(a, { width: y, height: w, x: x.x - y / 2, y: x.y - w / 2 }), L(f, { fontSize: l + "px", lineHeight: u, paddingTop: g + "px", paddingBottom: _ + "px" }) } return Er(e, "bpmn:TextAnnotation") && (L(a, { width: i.width, height: i.height, minWidth: 30 * s, minHeight: 10 * s }), L(f, { textAlign: "left", paddingTop: 5 * s + "px", paddingBottom: 7 * s + "px", paddingLeft: 7 * s + "px", paddingRight: 5 * s + "px", fontSize: h + "px", lineHeight: d })), { bounds: a, style: f } }, jg.prototype.update = function (e, t, n, i) { var r, o, a; Er(e, "bpmn:TextAnnotation") && (o = this._canvas.getAbsoluteBBox(e), r = { x: e.x, y: e.y, width: e.width / o.width * i.width, height: e.height / o.height * i.height }), (a = t) && a.trim() || (t = null), this._modeling.updateLabel(e, t, r) }; var Ig = "djs-element-hidden", $g = "djs-label-hidden"; function Fg(e, t, n) { var i, r, o, a = this, s = t.getDefaultLayer(); e.on("directEditing.activate", (function (e) { var c = e.active; if (Er(i = c.element.label || c.element, "bpmn:TextAnnotation")) { r = t.getAbsoluteBBox(i), o = De("g"); var p = n.getScaledPath("TEXT_ANNOTATION", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: i.width, containerHeight: i.height, position: { mx: 0, my: 0 } }), l = a.path = De("path"); we(l, { d: p, strokeWidth: 2, stroke: zg(i) }), ge(o, l), ge(s, o), Yn(o, i.x, i.y) } Er(i, "bpmn:TextAnnotation") || i.labelTarget ? t.addMarker(i, Ig) : (Er(i, "bpmn:Task") || Er(i, "bpmn:CallActivity") || Er(i, "bpmn:SubProcess") || Er(i, "bpmn:Participant")) && t.addMarker(i, $g) })), e.on("directEditing.resize", (function (e) { if (Er(i, "bpmn:TextAnnotation")) { var t = e.height, o = e.dy, s = Math.max(i.height / r.height * (t + o), 0), c = n.getScaledPath("TEXT_ANNOTATION", { xScaleFactor: 1, yScaleFactor: 1, containerWidth: i.width, containerHeight: s, position: { mx: 0, my: 0 } }); we(a.path, { d: c }) } })), e.on(["directEditing.complete", "directEditing.cancel"], (function (e) { var n = e.active; n && (t.removeMarker(n.element.label || n.element, Ig), t.removeMarker(i, $g)), i = void 0, r = void 0, o && (ke(o), o = void 0) })) } function zg(e, t) { return kr(e).get("stroke") || t || "black" } Fg.$inject = ["eventBus", "canvas", "pathMap"]; var Hg = { __depends__: [pa, Og, yy], __init__: ["labelEditingProvider", "labelEditingPreview"], labelEditingProvider: ["type", jg], labelEditingPreview: ["type", Fg] }, Vg = new ta("tt"); function Wg(e, t) { e.style.display = !1 === t ? "none" : "" } var Gg = "djs-tooltip", Ug = "." + Gg; function qg(e, t) { var n, i; this._eventBus = e, this._canvas = t, this._ids = Vg, this._tooltipDefaults = { show: { minZoom: .7, maxZoom: 5 } }, this._tooltips = {}, this._tooltipRoot = (n = t.getContainer(), q(i = de('<div class="djs-tooltip-container" />'), { position: "absolute", width: "0", height: "0" }), n.insertBefore(i, n.firstChild), i); var r = this; pe.bind(this._tooltipRoot, Ug, "mousedown", (function (e) { e.stopPropagation() })), pe.bind(this._tooltipRoot, Ug, "mouseover", (function (e) { r.trigger("mouseover", e) })), pe.bind(this._tooltipRoot, Ug, "mouseout", (function (e) { r.trigger("mouseout", e) })), this._init() } qg.$inject = ["eventBus", "canvas"], qg.prototype.add = function (e) { if (!e.position) throw new Error("must specifiy tooltip position"); if (!e.html) throw new Error("must specifiy tooltip html"); var t = this._ids.next(); return e = L({}, this._tooltipDefaults, e, { id: t }), this._addTooltip(e), e.timeout && this.setTimeout(e), t }, qg.prototype.trigger = function (e, t) { var n = t.delegateTarget || t.target, i = this.get(K(n, "data-tooltip-id")); i && ("mouseover" === e && i.timeout && this.clearTimeout(i), "mouseout" === e && i.timeout && (i.timeout = 1e3, this.setTimeout(i))) }, qg.prototype.get = function (e) { return "string" != typeof e && (e = e.id), this._tooltips[e] }, qg.prototype.clearTimeout = function (e) { if (e = this.get(e)) { var t = e.removeTimer; t && (clearTimeout(t), e.removeTimer = null) } }, qg.prototype.setTimeout = function (e) { if (e = this.get(e)) { this.clearTimeout(e); var t = this; e.removeTimer = setTimeout((function () { t.remove(e) }), e.timeout) } }, qg.prototype.remove = function (e) { var t = this.get(e); t && (ve(t.html), ve(t.htmlContainer), delete t.htmlContainer, delete this._tooltips[t.id]) }, qg.prototype.show = function () { Wg(this._tooltipRoot) }, qg.prototype.hide = function () { Wg(this._tooltipRoot, !1) }, qg.prototype._updateRoot = function (e) { var t = e.scale || 1, n = e.scale || 1, i = "matrix(" + t + ",0,0," + n + "," + -1 * e.x * t + "," + -1 * e.y * n + ")"; this._tooltipRoot.style.transform = i, this._tooltipRoot.style["-ms-transform"] = i }, qg.prototype._addTooltip = function (e) { var t, n = e.id, i = e.html, r = this._tooltipRoot; i.get && i.constructor.prototype.jquery && (i = i.get(0)), d(i) && (i = de(i)), q(t = de('<div data-tooltip-id="' + n + '" class="' + Gg + '">'), { position: "absolute" }), t.appendChild(i), e.type && X(t).add("djs-tooltip-" + e.type), e.className && X(t).add(e.className), e.htmlContainer = t, r.appendChild(t), this._tooltips[n] = e, this._updateTooltip(e) }, qg.prototype._updateTooltip = function (e) { var t = e.position; !function (e, t, n) { q(e, { left: t + "px", top: n + "px" }) }(e.htmlContainer, t.x, t.y) }, qg.prototype._updateTooltipVisibilty = function (e) { g(this._tooltips, (function (t) { var n = t.show, i = t.htmlContainer, r = !0; n && ((n.minZoom > e.scale || n.maxZoom < e.scale) && (r = !1), Wg(i, r)) })) }, qg.prototype._init = function () { var e = this; this._eventBus.on("canvas.viewbox.changing", (function (t) { e.hide() })), this._eventBus.on("canvas.viewbox.changed", (function (t) { var n; n = t.viewbox, e._updateRoot(n), e._updateTooltipVisibilty(n), e.show() })) }; var Kg = { __init__: ["tooltips"], tooltips: ["type", qg] }; function Yg(e, t, n) { e.on(["shape.move.rejected", "create.rejected"], (function (e) { var i, r, o, a = e.context, s = a.shape; Er(a.target, "bpmn:Collaboration") && Er(s, "bpmn:FlowNode") && (i = e, r = n("flow elements must be children of pools/participants"), t.add({ position: { x: i.x + 5, y: i.y + 5 }, type: "error", timeout: o || 2e3, html: "<div>" + r + "</div>" })) })) } Yg.$inject = ["eventBus", "tooltips", "translate"]; var Xg = { __depends__: [Kg], __init__: ["modelingFeedback"], modelingFeedback: ["type", Yg] }, Zg = Math.round; function Qg(e, t, n, i, r) { function o(e, t, n, i) { return r.allowed("elements.move", { shapes: e, delta: t, position: n, target: i }) } function a(e, n, i, r) { if (l(i) && (r = i, i = !1), !n.waypoints && n.parent && !Se(e.target).has("djs-hit-no-move")) { var o = function (e) { return { x: e.x + Zg(e.width / 2), y: e.y + Zg(e.height / 2) } }(n); return t.init(e, o, "shape.move", { cursor: "grabbing", autoActivate: i, data: { shape: n, context: r || {} } }), !0 } } e.on("shape.move.start", 1500, (function (e) { var t = e.context, n = e.shape, r = i.get().slice(); -1 === r.indexOf(n) && (r = [n]), r = function (e) { var t = k(e, "id"); return y(e, (function (e) { for (; e = e.parent;)if (t[e.id]) return !1; return !0 })) }(r), L(t, { shapes: r, validatedShapes: r, shape: n }) })), e.on("shape.move.start", 1250, (function (e) { var t = e.context, n = t.validatedShapes; if (!(t.canExecute = o(n))) return !1 })), e.on("shape.move.move", 500, (function (e) { var t, n = e.context, i = n.validatedShapes, r = e.hover, a = { x: e.dx, y: e.dy }; t = o(i, a, { x: e.x, y: e.y }, r), n.delta = a, n.canExecute = t, n.target = null !== t ? r : null })), e.on("shape.move.end", (function (e) { var t = e.context, i = t.delta, r = t.canExecute, o = "attach" === r, a = t.shapes; if (!1 === r) return !1; i.x = Zg(i.x), i.y = Zg(i.y), 0 === i.x && 0 === i.y || n.moveElements(a, i, t.target, { primaryShape: t.shape, attach: o }) })), e.on("element.mousedown", (function (e) { if ($o(e)) { var t = No(e); if (!t) throw new Error("must supply DOM mousedown event"); return a(t, e.element) } })), this.start = a } Qg.$inject = ["eventBus", "dragging", "modeling", "selection", "rules"]; var Jg = "djs-dragging", e_ = "drop-ok", t_ = "drop-not-ok", n_ = "new-parent", i_ = "attach-ok"; function r_(e, t, n, r) { function o(e) { var t = function (e) { var t = y(e, (function (t) { return !un(t) || m(e, A({ id: t.source.id })) && m(e, A({ id: t.target.id })) })); return t }(a(e)); return t } function a(e) { var t = mt(e, !0), n = E(t, (function (e) { return (e.incoming || []).concat(e.outgoing || []) })); return i(t.concat(n)) } function s(e, n) { [i_, e_, t_, n_].forEach((function (i) { i === n ? t.addMarker(e, i) : t.removeMarker(e, i) })) } e.on("shape.move.start", 499, (function (e) { var s, c = e.context, p = c.shapes, l = c.allDraggedElements, u = o(p); if (!c.dragGroup) { var h = De("g"); we(h, n.cls("djs-drag-group", ["no-events"])), ge(t.getActiveLayer(), h), c.dragGroup = h } u.forEach((function (e) { r.addDragger(e, c.dragGroup) })), g(l = l ? i([l, a(p)]) : a(p), (function (e) { t.addMarker(e, Jg) })), c.allDraggedElements = l, c.differentParents = 1 !== (s = k(p, (function (e) { return e.parent && e.parent.id })), S(s).length) })), e.on("shape.move.move", 499, (function (e) { var t = e.context, n = t.dragGroup, i = t.target, r = t.shape.parent, o = t.canExecute; i && ("attach" === o ? s(i, i_) : t.canExecute && i && i.id !== r.id ? s(i, n_) : s(i, t.canExecute ? e_ : t_)), Yn(n, e.dx, e.dy) })), e.on(["shape.move.out", "shape.move.cleanup"], (function (e) { var t = e.context.target; t && s(t, null) })), e.on("shape.move.cleanup", (function (e) { var n = e.context, i = n.allDraggedElements, r = n.dragGroup; g(i, (function (e) { t.removeMarker(e, Jg) })), r && ke(r) })), this.makeDraggable = function (e, n, i) { r.addDragger(n, e.dragGroup), i && t.addMarker(n, Jg), e.allDraggedElements ? e.allDraggedElements.push(n) : e.allDraggedElements = [n] } } r_.$inject = ["eventBus", "canvas", "styles", "previewSupport"]; var o_ = { __depends__: [Go, ea, qo, Lp, Dp, Gl], __init__: ["move", "movePreview"], move: ["type", Qg], movePreview: ["type", r_] }; const a_ = { width: 36, height: 50 }, s_ = { width: 50, height: 50 }; function c_(e, t, n) { return De("path", { d: e, strokeWidth: 2, transform: `translate(${t.x}, ${t.y})`, ...n }) } function p_(e, t) { this._styles = t, e.registerProvider(this) } function l_(e, t) { var n; return "bpmn:DataObjectReference" === t ? n = a_ : "bpmn:DataStoreReference" === t && (n = s_), e.width === n.width && e.height === n.height } p_.$inject = ["outline", "styles"], p_.prototype.getOutline = function (e) { const t = this._styles.cls("djs-outline", ["no-fill"]); var n; if (!hn(e)) return Er(e, "bpmn:Gateway") ? (L((n = De("rect")).style, { "transform-box": "fill-box", transform: "rotate(45deg)", "transform-origin": "center" }), we(n, L({ x: 2, y: 2, rx: 4, width: e.width - 4, height: e.height - 4 }, t))) : Sr(e, ["bpmn:Task", "bpmn:SubProcess", "bpmn:Group"]) ? we(n = De("rect"), L({ x: -5, y: -5, rx: 14, width: e.width + 10, height: e.height + 10 }, t)) : Er(e, "bpmn:EndEvent") ? we(n = De("circle"), L({ cx: e.width / 2, cy: e.height / 2, r: e.width / 2 + 5 + 1 }, t)) : Er(e, "bpmn:Event") ? we(n = De("circle"), L({ cx: e.width / 2, cy: e.height / 2, r: e.width / 2 + 5 }, t)) : Er(e, "bpmn:DataObjectReference") && l_(e, "bpmn:DataObjectReference") ? n = c_("M44.7648 11.3263L36.9892 2.64074C36.0451 1.58628 34.5651 0.988708 33.1904 0.988708H5.98667C3.22688 0.988708 0.989624 3.34892 0.989624 6.26039V55.0235C0.989624 57.9349 3.22688 60.2952 5.98667 60.2952H40.966C43.7257 60.2952 45.963 57.9349 45.963 55.0235V14.9459C45.963 13.5998 45.6407 12.3048 44.7648 11.3263Z", { x: -6, y: -6 }, t) : Er(e, "bpmn:DataStoreReference") && l_(e, "bpmn:DataStoreReference") && (n = c_("M1.03845 48.1347C1.03845 49.3511 1.07295 50.758 1.38342 52.064C1.69949 53.3938 2.32428 54.7154 3.56383 55.6428C6.02533 57.4841 10.1161 58.7685 14.8212 59.6067C19.5772 60.4538 25.1388 60.8738 30.6831 60.8738C36.2276 60.8738 41.7891 60.4538 46.545 59.6067C51.2504 58.7687 55.3412 57.4842 57.8028 55.6429C59.0424 54.7156 59.6673 53.3938 59.9834 52.064C60.2938 50.7579 60.3285 49.351 60.3285 48.1344V13.8415C60.3285 12.6249 60.2938 11.218 59.9834 9.91171C59.6673 8.58194 59.0423 7.2602 57.8027 6.33294C55.341 4.49168 51.2503 3.20723 46.545 2.36914C41.7891 1.522 36.2276 1.10204 30.6831 1.10205C25.1388 1.10206 19.5772 1.52206 14.8213 2.36923C10.1162 3.20734 6.02543 4.49183 3.5639 6.33314C2.32433 7.26038 1.69951 8.58206 1.38343 9.91181C1.07295 11.2179 1.03845 12.6247 1.03845 13.8411V48.1347Z", { x: -6, y: -6 }, t)), n }, p_.prototype.updateOutline = function (e, t) { if (!hn(e)) return Sr(e, ["bpmn:SubProcess", "bpmn:Group"]) ? (we(t, { width: e.width + 10, height: e.height + 10 }), !0) : !!Sr(e, ["bpmn:Event", "bpmn:Gateway", "bpmn:DataStoreReference", "bpmn:DataObjectReference"]) }; var u_ = { __depends__: [qo], __init__: ["outlineProvider"], outlineProvider: ["type", p_] }, h_ = ".djs-palette-toggle", d_ = ".entry", f_ = h_ + ", " + d_, m_ = "djs-palette-", v_ = "open", y_ = "two-column"; function g_(e, t) { this._eventBus = e, this._canvas = t; var n = this; e.on("tool-manager.update", (function (e) { var t = e.tool; n.updateToolHighlight(t) })), e.on("i18n.changed", (function () { n._update() })), e.on("diagram.init", (function () { n._diagramInitialized = !0, n._rebuild() })) } function __(e, t) { var n = t.getPaletteEntries(); return h(n) ? n(e) : (g(n, (function (t, n) { e[n] = t })), e) } g_.$inject = ["eventBus", "canvas"], g_.prototype.registerProvider = function (e, t) { t || (t = e, e = 1e3), this._eventBus.on("palette.getProviders", e, (function (e) { e.providers.push(t) })), this._rebuild() }, g_.prototype.getEntries = function () { return this._getProviders().reduce(__, {}) }, g_.prototype._rebuild = function () { this._diagramInitialized && (this._getProviders().length && (this._container || this._init(), this._update())) }, g_.prototype._init = function () { var e = this, t = this._eventBus, n = this._getParentContainer(), i = this._container = de(g_.HTML_MARKUP); n.appendChild(i), X(n).add(m_ + "shown"), pe.bind(i, f_, "click", (function (t) { if (J(t.delegateTarget, h_)) return e.toggle(); e.trigger("click", t) })), ae.bind(i, "mousedown", (function (e) { e.stopPropagation() })), pe.bind(i, d_, "dragstart", (function (t) { e.trigger("dragstart", t) })), t.on("canvas.resized", this._layoutChanged, this), t.fire("palette.create", { container: i }) }, g_.prototype._getProviders = function (e) { var t = this._eventBus.createEvent({ type: "palette.getProviders", providers: [] }); return this._eventBus.fire(t), t.providers }, g_.prototype._toggleState = function (e) { e = e || {}; var t, n = this._getParentContainer(), i = this._container, r = this._eventBus, o = X(i), a = X(n); t = "twoColumn" in e ? e.twoColumn : this._needsCollapse(n.clientHeight, this._entries || {}), o.toggle(y_, t), a.toggle(m_ + y_, t), "open" in e && (o.toggle(v_, e.open), a.toggle(m_ + v_, e.open)), r.fire("palette.changed", { twoColumn: t, open: this.isOpen() }) }, g_.prototype._update = function () { var e = fe(".djs-palette-entries", this._container), t = this._entries = this.getEntries(); Q(e), g(t, (function (t, n) { var i = t.group || "default", r = fe("[data-group=" + fa(i) + "]", e); r || (K(r = de('<div class="group"></div>'), "data-group", i), e.appendChild(r)); var o = t.html || (t.separator ? '<hr class="separator" />' : '<div class="entry" draggable="true"></div>'), a = de(o); if (r.appendChild(a), !t.separator && (K(a, "data-action", n), t.title && K(a, "title", t.title), t.className && function (e, t) { var n = X(e); (p(t) ? t : t.split(/\s+/g)).forEach((function (e) { n.add(e) })) }(a, t.className), t.imageUrl)) { var s = de("<img>"); K(s, "src", t.imageUrl), a.appendChild(s) } })), this.open() }, g_.prototype.trigger = function (e, t, n) { var i, r, o = t.delegateTarget || t.target; return o ? (i = K(o, "data-action"), r = t.originalEvent || t, this.triggerEntry(i, e, r, n)) : t.preventDefault() }, g_.prototype.triggerEntry = function (e, t, n, i) { var r, o; if ((r = this._entries[e]) && (o = r.action, !1 !== this._eventBus.fire("palette.trigger", { entry: r, event: n }))) { if (h(o)) { if ("click" === t) return o(n, i) } else if (o[t]) return o[t](n, i); n.preventDefault() } }, g_.prototype._layoutChanged = function () { this._toggleState({}) }, g_.prototype._needsCollapse = function (e, t) { return e < 46 * Object.keys(t).length + 50 }, g_.prototype.close = function () { this._toggleState({ open: !1, twoColumn: !1 }) }, g_.prototype.open = function () { this._toggleState({ open: !0 }) }, g_.prototype.toggle = function () { this.isOpen() ? this.close() : this.open() }, g_.prototype.isActiveTool = function (e) { return e && this._activeTool === e }, g_.prototype.updateToolHighlight = function (e) { var t; this._toolsContainer || (t = fe(".djs-palette-entries", this._container), this._toolsContainer = fe("[data-group=tools]", t)), g(this._toolsContainer.children, (function (t) { var n = t.getAttribute("data-action"); if (n) { var i = X(t); n = n.replace("-tool", ""), i.contains("entry") && n === e ? i.add("highlighted-entry") : i.remove("highlighted-entry") } })) }, g_.prototype.isOpen = function () { return X(this._container).has(v_) }, g_.prototype._getParentContainer = function () { return this._canvas.getContainer() }, g_.HTML_MARKUP = '<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>'; var b_ = { __init__: ["palette"], palette: ["type", g_] }, x_ = "crosshair"; function w_(e, t, n, i, r, o, a) { this._selection = r, this._dragging = n, this._mouse = a; var s = this, c = function (e) { var n, i = t.getActiveLayer(); we(n = e.frame = De("rect"), { class: "djs-lasso-overlay", width: 1, height: 1, x: 0, y: 0 }), ge(i, n) }, p = function (e) { var t = e.frame, n = e.bbox; we(t, { x: n.x, y: n.y, width: n.width, height: n.height }) }, l = function (e) { e.frame && ke(e.frame) }; o.registerTool("lasso", { tool: "lasso.selection", dragging: "lasso" }), e.on("lasso.selection.end", (function (t) { var n = t.originalEvent.target; (t.hover || n instanceof SVGElement) && e.once("lasso.selection.ended", (function () { s.activateLasso(t.originalEvent, !0) })) })), e.on("lasso.end", (function (e) { var t = E_(e), n = i.filter((function (e) { return e })); s.select(n, t) })), e.on("lasso.start", (function (e) { var t = e.context; t.bbox = E_(e), c(t) })), e.on("lasso.move", (function (e) { var t = e.context; t.bbox = E_(e), p(t) })), e.on("lasso.cleanup", (function (e) { var t = e.context; l(t) })), e.on("element.mousedown", 1500, (function (e) { if (zo(e)) return s.activateLasso(e.originalEvent), !0 })) } function E_(e) { var t = { x: e.x - e.dx, y: e.y - e.dy }, n = { x: e.x, y: e.y }; return t.x <= n.x && t.y < n.y || t.x < n.x && t.y <= n.y ? { x: t.x, y: t.y, width: n.x - t.x, height: n.y - t.y } : t.x >= n.x && t.y < n.y || t.x > n.x && t.y <= n.y ? { x: n.x, y: t.y, width: t.x - n.x, height: n.y - t.y } : t.x <= n.x && t.y > n.y || t.x < n.x && t.y >= n.y ? { x: t.x, y: n.y, width: n.x - t.x, height: t.y - n.y } : t.x >= n.x && t.y > n.y || t.x > n.x && t.y >= n.y ? { x: n.x, y: n.y, width: t.x - n.x, height: t.y - n.y } : { x: n.x, y: n.y, width: 0, height: 0 } } w_.$inject = ["eventBus", "canvas", "dragging", "elementRegistry", "selection", "toolManager", "mouse"], w_.prototype.activateLasso = function (e, t) { this._dragging.init(e, "lasso", { autoActivate: t, cursor: x_, data: { context: {} } }) }, w_.prototype.activateSelection = function (e, t) { this._dragging.init(e, "lasso.selection", { trapClick: !1, autoActivate: t, cursor: x_, data: { context: {} } }) }, w_.prototype.select = function (e, t) { var n = function (e, t) { var n = {}; return g(e, (function (e) { var i = e; i.waypoints && (i = vt(i)), !u(t.y) && i.x > t.x && (n[e.id] = e), !u(t.x) && i.y > t.y && (n[e.id] = e), i.x > t.x && i.y > t.y && (u(t.width) && u(t.height) && i.width + i.x < t.width + t.x && i.height + i.y < t.height + t.y ? n[e.id] = e : u(t.width) && u(t.height) || (n[e.id] = e)) })), n }(e, t); this._selection.select(C(n)) }, w_.prototype.toggle = function () { if (this.isActive()) return this._dragging.cancel(); var e = this._mouse.getLastMoveEvent(); this.activateSelection(e, !!e) }, w_.prototype.isActive = function () { var e = this._dragging.context(); return e && /^lasso/.test(e.prefix) }; var S_ = { __depends__: [Nf, df], __init__: ["lassoTool"], lassoTool: ["type", w_] }, C_ = 1500, k_ = "grab"; function R_(e, t, n, i, r, o) { this._dragging = n, this._mouse = o; var a = this, s = i.get("keyboard", !1); r.registerTool("hand", { tool: "hand", dragging: "hand.move" }), e.on("element.mousedown", C_, (function (e) { if (Fo(e)) return a.activateMove(e.originalEvent, !0), !1 })), s && s.addListener(C_, (function (e) { if (P_(e.keyEvent) && !a.isActive()) { var t = a._mouse.getLastMoveEvent(); a.activateMove(t, !!t) } }), "keyboard.keydown"), s && s.addListener(C_, (function (e) { P_(e.keyEvent) && a.isActive() && a.toggle() }), "keyboard.keyup"), e.on("hand.end", (function (t) { var n = t.originalEvent.target; if (!(t.hover || n instanceof SVGElement)) return !1; e.once("hand.ended", (function () { a.activateMove(t.originalEvent, { reactivate: !0 }) })) })), e.on("hand.move.move", (function (e) { var n = t.viewbox().scale; t.scroll({ dx: e.dx * n, dy: e.dy * n }) })), e.on("hand.move.end", (function (t) { var n = t.context.reactivate; return !Fo(t) && n && e.once("hand.move.ended", (function (e) { a.activateHand(e.originalEvent, !0, !0) })), !1 })) } function P_(e) { return $a("Space", e) } R_.$inject = ["eventBus", "canvas", "dragging", "injector", "toolManager", "mouse"], R_.prototype.activateMove = function (e, t, n) { "object" == typeof t && (n = t, t = !1), this._dragging.init(e, "hand.move", { autoActivate: t, cursor: k_, data: { context: n || {} } }) }, R_.prototype.activateHand = function (e, t, n) { this._dragging.init(e, "hand", { trapClick: !1, autoActivate: t, cursor: k_, data: { context: { reactivate: n } } }) }, R_.prototype.toggle = function () { if (this.isActive()) return this._dragging.cancel(); var e = this._mouse.getLastMoveEvent(); this.activateHand(e, !!e) }, R_.prototype.isActive = function () { var e = this._dragging.context(); return !!e && /^(hand|hand\.move)$/.test(e.prefix) }; var T_ = { __depends__: [Nf, df], __init__: ["handTool"], handTool: ["type", R_] }, A_ = "connect-ok", M_ = "connect-not-ok"; function D_(e, t, n, i, r, o, a) { var s = this; this._dragging = t, this._rules = o, this._mouse = a, r.registerTool("global-connect", { tool: "global-connect", dragging: "global-connect.drag" }), e.on("global-connect.hover", (function (e) { var t = e.context, n = e.hover, r = t.canStartConnect = s.canStartConnect(n); null !== r && (t.startTarget = n, i.addMarker(n, r ? A_ : M_)) })), e.on(["global-connect.out", "global-connect.cleanup"], (function (e) { var t = e.context.startTarget, n = e.context.canStartConnect; t && i.removeMarker(t, n ? A_ : M_) })), e.on(["global-connect.ended"], (function (t) { var i = t.context.startTarget, r = { x: t.x, y: t.y }; if (s.canStartConnect(i)) return e.once("element.out", (function () { e.once(["connect.ended", "connect.canceled"], (function () { e.fire("global-connect.drag.ended") })), n.start(null, i, r) })), !1 })) } D_.$inject = ["eventBus", "dragging", "connect", "canvas", "toolManager", "rules", "mouse"], D_.prototype.start = function (e, t) { this._dragging.init(e, "global-connect", { autoActivate: t, trapClick: !1, data: { context: {} } }) }, D_.prototype.toggle = function () { if (this.isActive()) return this._dragging.cancel(); var e = this._mouse.getLastMoveEvent(); return this.start(e, !!e) }, D_.prototype.isActive = function () { var e = this._dragging.context(); return e && /^global-connect/.test(e.prefix) }, D_.prototype.canStartConnect = function (e) { return this._rules.allowed("connection.start", { source: e }) }; var B_ = { __depends__: [$l, Lp, Dp, Nf, df], globalConnect: ["type", D_] }; function N_(e, t, n, i, r, o, a, s) { this._palette = e, this._create = t, this._elementFactory = n, this._spaceTool = i, this._lassoTool = r, this._handTool = o, this._globalConnect = a, this._translate = s, e.registerProvider(this) } N_.$inject = ["palette", "create", "elementFactory", "spaceTool", "lassoTool", "handTool", "globalConnect", "translate"], N_.prototype.getPaletteEntries = function () { var e = {}, t = this._create, n = this._elementFactory, i = this._spaceTool, r = this._lassoTool, o = this._handTool, a = this._globalConnect, s = this._translate; function c(e, i, r, o, a) { function s(i) { var r = n.createShape(L({ type: e }, a)); a && (kr(r).isExpanded = a.isExpanded); t.start(i, r) } return { group: i, className: r, title: o, action: { dragstart: s, click: s } } } function p(e) { var i = n.createShape({ type: "bpmn:SubProcess", x: 0, y: 0, isExpanded: !0 }), r = n.createShape({ type: "bpmn:StartEvent", x: 40, y: 82, parent: i }); t.start(e, [i, r], { hints: { autoSelect: [i] } }) } function l(e) { t.start(e, n.createParticipantShape()) } return L(e, { "hand-tool": { group: "tools", className: "bpmn-icon-hand-tool", title: s("Activate hand tool"), action: { click: function (e) { o.activateHand(e) } } }, "lasso-tool": { group: "tools", className: "bpmn-icon-lasso-tool", title: s("Activate lasso tool"), action: { click: function (e) { r.activateSelection(e) } } }, "space-tool": { group: "tools", className: "bpmn-icon-space-tool", title: s("Activate create/remove space tool"), action: { click: function (e) { i.activateSelection(e) } } }, "global-connect-tool": { group: "tools", className: "bpmn-icon-connection-multi", title: s("Activate global connect tool"), action: { click: function (e) { a.start(e) } } }, "tool-separator": { group: "tools", separator: !0 }, "create.start-event": c("bpmn:StartEvent", "event", "bpmn-icon-start-event-none", s("Create start event")), "create.intermediate-event": c("bpmn:IntermediateThrowEvent", "event", "bpmn-icon-intermediate-event-none", s("Create intermediate/boundary event")), "create.end-event": c("bpmn:EndEvent", "event", "bpmn-icon-end-event-none", s("Create end event")), "create.exclusive-gateway": c("bpmn:ExclusiveGateway", "gateway", "bpmn-icon-gateway-none", s("Create gateway")), "create.task": c("bpmn:Task", "activity", "bpmn-icon-task", s("Create task")), "create.data-object": c("bpmn:DataObjectReference", "data-object", "bpmn-icon-data-object", s("Create data object reference")), "create.data-store": c("bpmn:DataStoreReference", "data-store", "bpmn-icon-data-store", s("Create data store reference")), "create.subprocess-expanded": { group: "activity", className: "bpmn-icon-subprocess-expanded", title: s("Create expanded sub-process"), action: { dragstart: p, click: p } }, "create.participant-expanded": { group: "collaboration", className: "bpmn-icon-participant", title: s("Create pool/participant"), action: { dragstart: l, click: l } }, "create.group": c("bpmn:Group", "artifact", "bpmn-icon-group", s("Create group")) }), e }; var O_ = { __depends__: [b_, uf, em, S_, T_, B_, Ro], __init__: ["paletteProvider"], paletteProvider: ["type", N_] }; function j_(e, t, n, i, r) { la.call(this, e), e.on("shape.move.move", 250, (function (e) { var o = e.context, a = o.canExecute; o.visualReplacements || (o.visualReplacements = {}), a && a.replacements ? function (e) { g(e.canExecute.replacements, (function (o) { var a = o.oldElementId, s = { type: o.newElementType }; if (!e.visualReplacements[a]) { var c = t.get(a); L(s, { x: c.x, y: c.y }); var p = n.createShape(s); i.addShape(p, c.parent); var l = fe('[data-element-id="' + fa(c.id) + '"]', e.dragGroup); l && we(l, { display: "none" }); var u = r.addDragger(p, e.dragGroup); e.visualReplacements[a] = u, i.removeShape(p) } })) }(o) : function (e) { var t = e.visualReplacements; g(t, (function (n, i) { var r = fe('[data-element-id="' + fa(i) + '"]', e.dragGroup); r && we(r, { display: "inline" }), n.remove(), t[i] && delete t[i] })) }(o) })) } j_.$inject = ["eventBus", "elementRegistry", "elementFactory", "canvas", "previewSupport"], e(j_, la); var L_ = { __depends__: [Gl], __init__: ["bpmnReplacePreview"], bpmnReplacePreview: ["type", j_] }, I_ = 40, $_ = 20, F_ = 10, z_ = 20, H_ = ["x", "y"], V_ = Math.abs; function W_(e) { e.on(["connect.hover", "connect.move", "connect.end"], 1250, (function (e) { var t = e.context, n = t.canExecute, i = t.start, r = t.hover, o = t.source, a = t.target; e.originalEvent && Ia(e.originalEvent) || (t.initialConnectionStart || (t.initialConnectionStart = t.connectionStart), n && r && function (e, t, n) { H_.forEach((function (i) { var r = q_(i, t); e[i] < t[i] + n ? Pl(e, i, t[i] + n) : e[i] > t[i] + r - n && Pl(e, i, t[i] + r - n) })) }(e, r, function (e) { return Er(e, "bpmn:Task") ? F_ : $_ }(r)), r && function (e, t) { return w(t, (function (t) { return U_(e, t) })) }(n, ["bpmn:Association", "bpmn:DataInputAssociation", "bpmn:DataOutputAssociation", "bpmn:SequenceFlow"]) ? (t.connectionStart = kl(i), Sr(r, ["bpmn:Event", "bpmn:Gateway"]) && G_(e, kl(r)), Sr(r, ["bpmn:Task", "bpmn:SubProcess"]) && function (e, t) { var n = kl(t); H_.forEach((function (i) { (function (e, t, n) { return e[n] > t[n] + z_ && e[n] < t[n] + q_(n, t) - z_ })(e, t, i) && Pl(e, i, n[i]) })) }(e, r), Er(o, "bpmn:BoundaryEvent") && a === o.host && function (e) { var t = e.context, n = t.source, i = t.target; if (function (e) { var t = e.hover, n = e.source; return t && n && t === n }(t)) return; var r = kl(n), o = _n(r, i, -10), a = []; /top|bottom/.test(o) && a.push("x"); /left|right/.test(o) && a.push("y"); a.forEach((function (t) { var n, i = e[t]; V_(i - r[t]) < I_ && (n = i > r[t] ? r[t] + I_ : r[t] - I_, Pl(e, t, n)) })) }(e)) : U_(n, "bpmn:MessageFlow") ? (Er(i, "bpmn:Event") && (t.connectionStart = kl(i)), Er(r, "bpmn:Event") && G_(e, kl(r))) : t.connectionStart = t.initialConnectionStart) })) } function G_(e, t) { Pl(e, "x", t.x), Pl(e, "y", t.y) } function U_(e, t) { return e && e.type === t } function q_(e, t) { return "x" === e ? t.width : t.height } function K_() { this._targets = {}, this._snapOrigins = {}, this._snapLocations = [], this._defaultSnaps = {} } function Y_() { this._snapValues = {} } W_.$inject = ["eventBus"], K_.prototype.getSnapOrigin = function (e) { return this._snapOrigins[e] }, K_.prototype.setSnapOrigin = function (e, t) { this._snapOrigins[e] = t, -1 === this._snapLocations.indexOf(e) && this._snapLocations.push(e) }, K_.prototype.addDefaultSnap = function (e, t) { var n = this._defaultSnaps[e]; n || (n = this._defaultSnaps[e] = []), n.push(t) }, K_.prototype.getSnapLocations = function () { return this._snapLocations }, K_.prototype.setSnapLocations = function (e) { this._snapLocations = e }, K_.prototype.pointsForTarget = function (e) { var t = e.id || e, n = this._targets[t]; return n || (n = this._targets[t] = new Y_).initDefaults(this._defaultSnaps), n }, Y_.prototype.add = function (e, t) { var n = this._snapValues[e]; n || (n = this._snapValues[e] = { x: [], y: [] }), -1 === n.x.indexOf(t.x) && n.x.push(t.x), -1 === n.y.indexOf(t.y) && n.y.push(t.y) }, Y_.prototype.snap = function (e, t, n, i) { var r = this._snapValues[t]; return r && function (e, t, n) { var i, r; for (n = void 0 === n ? 10 : n, i = 0; i < t.length; i++)if (r = t[i], wl(r - e) <= n) return r }(e[n], r[n], i) }, Y_.prototype.initDefaults = function (e) { var t = this; g(e || {}, (function (e, n) { g(e, (function (e) { t.add(n, e) })) })) }; var X_ = 1250; function Z_(e, t, n) { var i = this; this._elementRegistry = e, t.on(["create.start", "shape.move.start"], (function (e) { i.initSnap(e) })), t.on(["create.move", "create.end", "shape.move.move", "shape.move.end"], X_, (function (e) { var t = e.context, r = t.shape, o = t.snapContext, a = t.target; if ((!e.originalEvent || !Ia(e.originalEvent)) && !Rl(e) && a) { var s = o.pointsForTarget(a); s.initialized || ((s = i.addSnapTargetPoints(s, r, a)).initialized = !0), n.snap(e, s) } })), t.on(["create.cleanup", "shape.move.cleanup"], (function () { n.hide() })) } Z_.$inject = ["elementRegistry", "eventBus", "snapping"], Z_.prototype.initSnap = function (e) { var t, n = this._elementRegistry, i = e.context, r = i.shape, o = i.snapContext; o || (o = i.snapContext = new K_); var a = (t = n.get(r.id) ? kl(r, e) : { x: e.x + kl(r).x, y: e.y + kl(r).y }).x - r.width / 2, s = t.y - r.height / 2, c = t.x + r.width / 2, p = t.y + r.height / 2; return o.setSnapOrigin("mid", { x: t.x - e.x, y: t.y - e.y }), hn(r) || (o.setSnapOrigin("top-left", { x: a - e.x, y: s - e.y }), o.setSnapOrigin("bottom-right", { x: c - e.x, y: p - e.y })), o }, Z_.prototype.addSnapTargetPoints = function (e, t, n) { return g(this.getSnapTargets(t, n), (function (n) { if (hn(n)) hn(t) && e.add("mid", kl(n)); else if (un(n)) { if (n.waypoints.length < 3) return; g(n.waypoints.slice(1, -1), (function (t) { e.add("mid", t) })) } else e.add("mid", kl(n)) })), u(t.x) && u(t.y) ? (this._elementRegistry.get(t.id) && e.add("mid", kl(t)), e) : e }, Z_.prototype.getSnapTargets = function (e, t) { return Tl(t).filter((function (e) { return !e.hidden })) }; function Q_(e, t) { t.invoke(Z_, this), e.on(["create.move", "create.end"], 1500, J_), e.on(["create.move", "create.end", "shape.move.move", "shape.move.end"], 1500, (function (e) { var t = e.context, n = t.canExecute, i = t.target; n && ("attach" === n || n.attach) && !Rl(e) && function (e, t) { var n, i = mn(t), r = fd(e, t), o = e.context, a = o.shape; n = a.parent ? { x: 0, y: 0 } : gn(a); /top/.test(r) ? Pl(e, "y", i.top - n.y) : /bottom/.test(r) && Pl(e, "y", i.bottom - n.y); /left/.test(r) ? Pl(e, "x", i.left - n.x) : /right/.test(r) && Pl(e, "x", i.right - n.x) }(e, i) })) } function J_(e) { var t = e.context.createConstraints; if (t) { var n = t.top, i = t.right, r = t.bottom, o = t.left; (o && o >= e.x || i && i <= e.x) && Pl(e, "x", e.x), (n && n >= e.y || r && r <= e.y) && Pl(e, "y", e.y) } } function eb(e, t) { return -1 !== e.indexOf(t) } function tb(e, t, n) { return t ? { x: e.x - n.x, y: e.y - n.y } : { x: e.x, y: e.y } } e(Q_, Z_), Q_.$inject = ["eventBus", "injector"], Q_.prototype.initSnap = function (e) { var t = Z_.prototype.initSnap.call(this, e), n = e.shape, i = !!this._elementRegistry.get(n.id); return g(n.outgoing, (function (n) { var r = n.waypoints[0]; r = r.original || r, t.setSnapOrigin(n.id + "-docking", tb(r, i, e)) })), g(n.incoming, (function (n) { var r = n.waypoints[n.waypoints.length - 1]; r = r.original || r, t.setSnapOrigin(n.id + "-docking", tb(r, i, e)) })), Er(n, "bpmn:Participant") && t.setSnapLocations(["top-left", "bottom-right", "mid"]), t }, Q_.prototype.addSnapTargetPoints = function (e, t, n) { Z_.prototype.addSnapTargetPoints.call(this, e, t, n); var i = this.getSnapTargets(t, n); g(i, (function (n) { var i; (function (e) { if (Er(e, "bpmn:SubProcess") && Vr(e)) return !0; return Er(e, "bpmn:Participant") }(n) || (i = "bpmn:TextAnnotation", [t, n].every((function (e) { return Er(e, i) })))) && (e.add("top-left", Sl(n)), e.add("bottom-right", Cl(n))) })); var r = this._elementRegistry; return g(t.incoming, (function (n) { if (r.get(t.id)) { eb(i, n.source) || e.add("mid", gn(n.source)); var o = n.waypoints[0]; e.add(n.id + "-docking", o.original || o) } })), g(t.outgoing, (function (n) { if (r.get(t.id)) { eb(i, n.target) || e.add("mid", gn(n.target)); var o = n.waypoints[n.waypoints.length - 1]; e.add(n.id + "-docking", o.original || o) } })), Er(n, "bpmn:SequenceFlow") && (e = this.addSnapTargetPoints(e, t, n.parent)), e }, Q_.prototype.getSnapTargets = function (e, t) { return Z_.prototype.getSnapTargets.call(this, e, t).filter((function (e) { return !Er(e, "bpmn:Lane") })) }; function nb(e, t) { var n = this; e.on(["resize.start"], (function (e) { n.initSnap(e) })), e.on(["resize.move", "resize.end"], 1250, (function (e) { var i = e.context, r = i.shape, o = r.parent, a = i.direction, s = i.snapContext; if (!(e.originalEvent && Ia(e.originalEvent) || Rl(e))) { var c = s.pointsForTarget(o); c.initialized || ((c = n.addSnapTargetPoints(c, r, o, a)).initialized = !0), function (e) { return "n" === e || "s" === e }(a) && Pl(e, "x", e.x), function (e) { return "e" === e || "w" === e }(a) && Pl(e, "y", e.y), t.snap(e, c) } })), e.on(["resize.cleanup"], (function () { t.hide() })) } function ib(e, t) { var n = gn(e), i = mn(e), r = { x: n.x, y: n.y }; return -1 !== t.indexOf("n") ? r.y = i.top : -1 !== t.indexOf("s") && (r.y = i.bottom), -1 !== t.indexOf("e") ? r.x = i.right : -1 !== t.indexOf("w") && (r.x = i.left), r } nb.prototype.initSnap = function (e) { var t = e.context, n = t.shape, i = t.direction, r = t.snapContext; r || (r = t.snapContext = new K_); var o = ib(n, i); return r.setSnapOrigin("corner", { x: o.x - e.x, y: o.y - e.y }), r }, nb.prototype.addSnapTargetPoints = function (e, t, n, i) { return g(this.getSnapTargets(t, n), (function (t) { e.add("corner", Cl(t)), e.add("corner", Sl(t)) })), e.add("corner", ib(t, i)), e }, nb.$inject = ["eventBus", "snapping"], nb.prototype.getSnapTargets = function (e, t) { return Tl(t).filter((function (t) { return !(n = t, i = e, n.host === i || un(t) || function (e) { return !!e.hidden }(t) || hn(t)); var n, i })) }; function rb(e) { this._canvas = e, this._asyncHide = O(j(this.hide, this), 1e3) } rb.$inject = ["canvas"], rb.prototype.snap = function (e, t) { var n = e.context.snapContext, i = n.getSnapLocations(), r = { x: Rl(e, "x"), y: Rl(e, "y") }; g(i, (function (i) { var o = n.getSnapOrigin(i), a = { x: e.x + o.x, y: e.y + o.y }; if (g(["x", "y"], (function (e) { var n; r[e] || void 0 !== (n = t.snap(a, i, e, 7)) && (r[e] = { value: n, originValue: n - o[e] }) })), r.x && r.y) return !1 })), this.showSnapLine("vertical", r.x && r.x.value), this.showSnapLine("horizontal", r.y && r.y.value), g(["x", "y"], (function (t) { var n = r[t]; l(n) && Pl(e, t, n.originValue) })) }, rb.prototype._createLine = function (e) { var t = this._canvas.getLayer("snap"), n = De("path"); return we(n, { d: "M0,0 L0,0" }), Se(n).add("djs-snap-line"), ge(t, n), { update: function (t) { u(t) ? we(n, "horizontal" === e ? { d: "M-100000," + t + " L+100000," + t, display: "" } : { d: "M " + t + ",-100000 L " + t + ", +100000", display: "" }) : we(n, { display: "none" }) } } }, rb.prototype._createSnapLines = function () { this._snapLines = { horizontal: this._createLine("horizontal"), vertical: this._createLine("vertical") } }, rb.prototype.showSnapLine = function (e, t) { var n = this.getSnapLine(e); n && n.update(t), this._asyncHide() }, rb.prototype.getSnapLine = function (e) { return this._snapLines || this._createSnapLines(), this._snapLines[e] }, rb.prototype.hide = function () { g(this._snapLines, (function (e) { e.update() })) }; var ob = { __depends__: [{ __init__: ["createMoveSnapping", "resizeSnapping", "snapping"], createMoveSnapping: ["type", Z_], resizeSnapping: ["type", nb], snapping: ["type", rb] }], __init__: ["connectSnapping", "createMoveSnapping"], connectSnapping: ["type", W_], createMoveSnapping: ["type", Q_] }; function ab(e, t, n, i) { this._open = !1, this._results = [], this._eventMaps = [], this._canvas = e, this._eventBus = t, this._overlays = n, this._selection = i, this._container = de(ab.BOX_HTML), this._searchInput = fe(ab.INPUT_SELECTOR, this._container), this._resultsContainer = fe(ab.RESULTS_CONTAINER_SELECTOR, this._container), this._canvas.getContainer().appendChild(this._container), t.on(["canvas.destroy", "diagram.destroy"], this.close, this) } function sb(e, t, n) { var i = function (e) { var t = ""; return e.forEach((function (e) { e.matched ? t += '<strong class="' + ab.RESULT_HIGHLIGHT_CLASS + '">' + va(e.matched) + "</strong>" : t += va(e.normal) })), "" !== t ? t : null }(t), r = de(n); r.innerHTML = i, e.appendChild(r) } ab.$inject = ["canvas", "eventBus", "overlays", "selection"], ab.prototype._bindEvents = function () { var e = this; function t(t, n, i, r) { e._eventMaps.push({ el: t, type: i, listener: pe.bind(t, n, i, r) }) } t(document, "html", "click", (function (t) { e.close() })), t(this._container, ab.INPUT_SELECTOR, "click", (function (e) { e.stopPropagation(), e.delegateTarget.focus() })), t(this._container, ab.RESULT_SELECTOR, "mouseover", (function (t) { t.stopPropagation(), e._scrollToNode(t.delegateTarget), e._preselect(t.delegateTarget) })), t(this._container, ab.RESULT_SELECTOR, "click", (function (t) { t.stopPropagation(), e._select(t.delegateTarget) })), t(this._container, ab.INPUT_SELECTOR, "keydown", (function (e) { $a("ArrowUp", e) && e.preventDefault(), $a("ArrowDown", e) && e.preventDefault() })), t(this._container, ab.INPUT_SELECTOR, "keyup", (function (t) { if ($a("Escape", t)) return e.close(); if ($a("Enter", t)) { var n = e._getCurrentResult(); return n ? e._select(n) : e.close() } return $a("ArrowUp", t) ? e._scrollToDirection(!0) : $a("ArrowDown", t) ? e._scrollToDirection() : void ($a(["ArrowLeft", "ArrowRight"], t) || e._search(t.delegateTarget.value)) })) }, ab.prototype._unbindEvents = function () { this._eventMaps.forEach((function (e) { pe.unbind(e.el, e.type, e.listener) })) }, ab.prototype._search = function (e) { var t = this; if (this._clearResults(), e && "" !== e) { var n = this._searchProvider.find(e); if (n.length) { n.forEach((function (e) { var n = e.element.id, i = t._createResultNode(e, n); t._results[n] = { element: e.element, node: i } })); var i = fe(ab.RESULT_SELECTOR, this._resultsContainer); this._scrollToNode(i), this._preselect(i) } } }, ab.prototype._scrollToDirection = function (e) { var t = this._getCurrentResult(); if (t) { var n = e ? t.previousElementSibling : t.nextElementSibling; n && (this._scrollToNode(n), this._preselect(n)) } }, ab.prototype._scrollToNode = function (e) { if (e && e !== this._getCurrentResult()) { var t = e.offsetTop, n = this._resultsContainer.scrollTop, i = t - this._resultsContainer.clientHeight + e.clientHeight; t < n ? this._resultsContainer.scrollTop = t : n < i && (this._resultsContainer.scrollTop = i) } }, ab.prototype._clearResults = function () { Q(this._resultsContainer), this._results = [], this._resetOverlay(), this._eventBus.fire("searchPad.cleared") }, ab.prototype._getCurrentResult = function () { return fe(ab.RESULT_SELECTED_SELECTOR, this._resultsContainer) }, ab.prototype._createResultNode = function (e, t) { var n = de(ab.RESULT_HTML); return e.primaryTokens.length > 0 && sb(n, e.primaryTokens, ab.RESULT_PRIMARY_HTML), sb(n, e.secondaryTokens, ab.RESULT_SECONDARY_HTML), K(n, ab.RESULT_ID_ATTRIBUTE, t), this._resultsContainer.appendChild(n), n }, ab.prototype.registerProvider = function (e) { this._searchProvider = e }, ab.prototype.open = function () { if (!this._searchProvider) throw new Error("no search provider registered"); this.isOpen() || (this._bindEvents(), this._open = !0, X(this._container).add("open"), this._searchInput.focus(), this._eventBus.fire("searchPad.opened")) }, ab.prototype.close = function () { this.isOpen() && (this._unbindEvents(), this._open = !1, X(this._container).remove("open"), this._clearResults(), this._searchInput.value = "", this._searchInput.blur(), this._resetOverlay(), this._eventBus.fire("searchPad.closed")) }, ab.prototype.toggle = function () { this.isOpen() ? this.close() : this.open() }, ab.prototype.isOpen = function () { return this._open }, ab.prototype._preselect = function (e) { var t = this._getCurrentResult(); if (e !== t) { t && X(t).remove(ab.RESULT_SELECTED_CLASS); var n = K(e, ab.RESULT_ID_ATTRIBUTE), i = this._results[n].element; X(e).add(ab.RESULT_SELECTED_CLASS), this._resetOverlay(i), this._canvas.scrollToElement(i, { top: 400 }), this._selection.select(i), this._eventBus.fire("searchPad.preselected", i) } }, ab.prototype._select = function (e) { var t = K(e, ab.RESULT_ID_ATTRIBUTE), n = this._results[t].element; this.close(), this._resetOverlay(), this._canvas.scrollToElement(n, { top: 400 }), this._selection.select(n), this._eventBus.fire("searchPad.selected", n) }, ab.prototype._resetOverlay = function (e) { if (this._overlayId && this._overlays.remove(this._overlayId), e) { var t = function (e) { var t = 6, n = e.width + 2 * t, i = e.height + 2 * t, r = { width: n + "px", height: i + "px" }, o = de('<div class="' + ab.OVERLAY_CLASS + '"></div>'); return q(o, r), { position: { bottom: i - t, right: n - t }, show: !0, html: o } }(vt(e)); this._overlayId = this._overlays.add(e, t) } }, ab.CONTAINER_SELECTOR = ".djs-search-container", ab.INPUT_SELECTOR = ".djs-search-input input", ab.RESULTS_CONTAINER_SELECTOR = ".djs-search-results", ab.RESULT_SELECTOR = ".djs-search-result", ab.RESULT_SELECTED_CLASS = "djs-search-result-selected", ab.RESULT_SELECTED_SELECTOR = "." + ab.RESULT_SELECTED_CLASS, ab.RESULT_ID_ATTRIBUTE = "data-result-id", ab.RESULT_HIGHLIGHT_CLASS = "djs-search-highlight", ab.OVERLAY_CLASS = "djs-search-overlay", ab.BOX_HTML = '<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>', ab.RESULT_HTML = '<div class="djs-search-result"></div>', ab.RESULT_PRIMARY_HTML = '<div class="djs-search-result-primary"></div>', ab.RESULT_SECONDARY_HTML = '<p class="djs-search-result-secondary"></p>'; var cb = { __depends__: [sa, ea], searchPad: ["type", ab] }; function pb(e, t, n) { this._elementRegistry = e, this._canvas = n, t.registerProvider(this) } function lb(e) { return y(e, (function (e) { return !!e.matched })).length > 0 } function ub(e, t) { var n = [], i = e; if (!e) return n; e = e.toLowerCase(), t = t.toLowerCase(); var r = e.indexOf(t); return r > -1 ? (0 !== r && n.push({ normal: i.substr(0, r) }), n.push({ matched: i.substr(r, t.length) }), t.length + r < e.length && n.push({ normal: i.substr(t.length + r, e.length) })) : n.push({ normal: i }), n } pb.$inject = ["elementRegistry", "searchPad", "canvas"], pb.prototype.find = function (e) { var t = this._canvas.getRootElement(), n = this._elementRegistry.filter((function (e) { return !e.labelTarget })); return n = y(n, (function (e) { return e !== t })), n = T(n = y(n = E(n, (function (t) { return { primaryTokens: ub(eo(t), e), secondaryTokens: ub(t.id, e), element: t } })), (function (e) { return lb(e.primaryTokens) || lb(e.secondaryTokens) })), (function (e) { return eo(e.element) + e.element.id })) }; var hb = { __depends__: [cb], __init__: ["bpmnSearch"], bpmnSearch: ["type", pb] }; function db(e) { Hr.call(this, e) } return e(db, Hr), db.Viewer = Ba, db.NavigatedViewer = us, db.prototype.createDiagram = function () { return this.importXML('<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>') }, db.prototype._interactionModules = [Ya, rs, xs, ls], db.prototype._modelingModules = [rp, bp, Op, Cp, Bl, $l, zl, $y, Ef, uf, Uy, Qy, hg, fg, vg, Sg, Hg, sy, Xg, o_, u_, O_, L_, Og, ob, hb], db.prototype._modules = [].concat(Ba.prototype._modules, db.prototype._interactionModules, db.prototype._modelingModules), db
}));